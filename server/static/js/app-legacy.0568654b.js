(function(e){function t(t){for(var n,o,s=t[0],l=t[1],c=t[2],h=0,d=[];h<s.length;h++)o=s[h],a[o]&&d.push(a[o][0]),a[o]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);u&&u(t);while(d.length)d.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var e,t=0;t<r.length;t++){for(var i=r[t],n=!0,s=1;s<i.length;s++){var l=i[s];0!==a[l]&&(n=!1)}n&&(r.splice(t--,1),e=o(o.s=i[0]))}return e}var n={},a={app:0},r=[];function o(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=n,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;r.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("cd49")},"0222":function(e,t,i){},"034f":function(e,t,i){"use strict";var n=i("64a9"),a=i.n(n);a.a},"0de1":function(e,t,i){},1:function(e,t){},1133:function(e,t,i){"use strict";var n=i("8336"),a=i.n(n);a.a},"12d3":function(e,t,i){"use strict";var n=i("a260"),a=i.n(n);a.a},"1e7c":function(e,t,i){},2777:function(e,t,i){},"291a":function(e,t,i){"use strict";var n=i("b98b"),a=i.n(n);a.a},"2a75":function(e,t,i){"use strict";var n=i("9195"),a=i.n(n);a.a},"31d1":function(e,t,i){},3972:function(e,t,i){},"3ba3":function(e,t,i){"use strict";var n=i("79b7"),a=i.n(n);a.a},"3d9b":function(e,t,i){"use strict";var n=i("703c"),a=i.n(n);a.a},"3f2c":function(e,t,i){},4315:function(e,t,i){},4612:function(e,t,i){"use strict";var n=i("3972"),a=i.n(n);a.a},"4a14":function(e,t,i){"use strict";var n=i("9850"),a=i.n(n);a.a},"559e":function(e,t,i){"use strict";var n=i("31d1"),a=i.n(n);a.a},"561b":function(e,t,i){"use strict";var n=i("a450"),a=i.n(n);a.a},"57af":function(e,t,i){"use strict";var n=i("1e7c"),a=i.n(n);a.a},"5b11":function(e,t,i){},6146:function(e,t,i){"use strict";var n=i("9ca7"),a=i.n(n);a.a},"618b":function(e,t,i){"use strict";var n=i("d450"),a=i.n(n);a.a},"618e":function(e,t,i){"use strict";var n=i("7985"),a=i.n(n);a.a},"64a9":function(e,t,i){},"6da0":function(e,t,i){"use strict";var n=i("e1a0"),a=i.n(n);a.a},"703c":function(e,t,i){},7392:function(e,t,i){"use strict";var n=i("0222"),a=i.n(n);a.a},"78c7":function(e,t,i){"use strict";var n=i("9227"),a=i.n(n);a.a},7985:function(e,t,i){},"79b7":function(e,t,i){},"7f1e":function(e,t,i){"use strict";var n=i("fe11"),a=i.n(n);a.a},8336:function(e,t,i){},8788:function(e,t,i){},"8d74":function(e,t,i){"use strict";var n=i("8788"),a=i.n(n);a.a},9195:function(e,t,i){},9227:function(e,t,i){},9850:function(e,t,i){},"9c0f":function(e,t,i){"use strict";var n=i("0de1"),a=i.n(n);a.a},"9ca7":function(e,t,i){},a126:function(e,t,i){},a260:function(e,t,i){},a450:function(e,t,i){},aa79:function(e,t,i){"use strict";var n=i("fce9"),a=i.n(n);a.a},ab66:function(e,t,i){"use strict";var n=i("ca99"),a=i.n(n);a.a},ae5a:function(e,t,i){"use strict";var n=i("3f2c"),a=i.n(n);a.a},b98b:function(e,t,i){},c098:function(e,t,i){},c4d5:function(e,t,i){},c947:function(e,t,i){"use strict";var n=i("5b11"),a=i.n(n);a.a},ca99:function(e,t,i){},cd49:function(e,t,i){"use strict";i.r(t);i("cadf"),i("551c"),i("f751"),i("097d");var n=i("a026"),a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("router-view",{ref:"activeComponent"})],1)},r=[],o=(i("034f"),i("2877")),s={},l=Object(o["a"])(s,a,r,!1,null,null,null),c=l.exports,u=i("bc3a"),h=i.n(u),d=i("8c4f"),v=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"AssetManager"}},[i("div",{attrs:{id:"titlebar"}},[e._v("Asset Manager")]),i("div",{attrs:{id:"main"}},[i("div",{attrs:{id:"assets"},on:{dragover:function(t){return t.preventDefault(),e.moveDrag(t)},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.stopDrag(t,e.currentFolder)}}},[i("div",{attrs:{id:"breadcrumbs"}},[i("div",[e._v("/")]),e._l(e.path,function(t){return i("div",{key:t},[e._v(e._s(e.idMap.get(t).name))])})],2),i("div",{attrs:{id:"actionbar"}},[i("input",{attrs:{id:"files",type:"file",multiple:"",hidden:""},on:{change:function(t){return e.upload()}}}),i("div",{attrs:{title:"Create folder"},on:{click:e.createDirectory}},[i("i",{staticClass:"fas fa-plus-square"})]),i("div",{attrs:{title:"Upload files"},on:{click:e.prepareUpload}},[i("i",{staticClass:"fas fa-upload"})])]),i("div",{attrs:{id:"explorer"}},[e.path.length?i("div",{staticClass:"inode folder",on:{dblclick:function(t){return e.changeDirectory(-1)},dragover:function(t){return t.preventDefault(),e.moveDrag(t)},dragleave:function(t){return t.preventDefault(),e.leaveDrag(t)},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.stopDrag(t,e.parentFolder)}}},[i("i",{staticClass:"fas fa-folder",staticStyle:{"font-size":"50px"}}),i("div",{staticClass:"title"},[e._v("..")])]):e._e(),e._l(e.folders,function(t){return i("div",{key:t,staticClass:"inode folder",class:{"inode-selected":e.selected.includes(t)},attrs:{draggable:"true"},on:{click:function(i){return e.select(i,t)},dblclick:function(i){return e.changeDirectory(t)},contextmenu:function(i){return i.preventDefault(),e.$refs.cm.open(i,t)},dragstart:function(i){return e.startDrag(i,t)},dragover:function(t){return t.preventDefault(),e.moveDrag(t)},dragleave:function(t){return t.preventDefault(),e.leaveDrag(t)},drop:function(i){return i.preventDefault(),i.stopPropagation(),e.stopDrag(i,t)}}},[i("i",{staticClass:"fas fa-folder",staticStyle:{"font-size":"50px"}}),i("div",{staticClass:"title"},[e._v(e._s(e.idMap.get(t).name))])])}),e._l(e.files,function(t){return i("div",{key:t,staticClass:"inode file",class:{"inode-selected":e.selected.includes(t)},attrs:{draggable:"true"},on:{click:function(i){return e.select(i,t)},contextmenu:function(i){return i.preventDefault(),e.$refs.cm.open(i,t)},dragstart:function(i){return e.startDrag(i,t)}}},[i("img",{attrs:{src:"/static/assets/"+e.idMap.get(t).file_hash,width:"50"}}),i("div",{staticClass:"title"},[e._v(e._s(e.idMap.get(t).name))])])})],2)]),e.firstSelectedFile?i("div",{attrs:{id:"asset-details"}},[i("div",{attrs:{id:"asset-detail-title"}},[e._v(e._s(e.firstSelectedFile.name))]),i("img",{attrs:{src:"/static/assets/"+e.firstSelectedFile.file_hash}})]):e._e()]),i("AssetContextMenu",{ref:"cm"}),i("Prompt",{ref:"prompt"}),i("ConfirmDialog",{ref:"confirm"})],1)},f=[],p=(i("7f7f"),i("ac4d"),i("8a81"),i("ac6a"),i("75fc")),y=(i("6762"),i("2fdb"),i("d225")),g=i("b0b4"),m=i("308d"),b=i("6bb5"),w=i("4e2b"),k=i("9ab4"),x=i("2fe1"),O=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContextMenu",{attrs:{visible:e.visible,left:e.left+"px",top:e.top+"px"},on:{close:e.close}},[i("li",{on:{click:e.rename}},[e._v("Rename")]),i("li",{on:{click:e.remove}},[e._v("Remove")])])},S=[],_=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.visible?i("div",{staticClass:"ContextMenu",style:{left:e.left,top:e.top},attrs:{tabindex:"-1"},on:{blur:function(t){return e.$emit("close")}}},[i("ul",[e._t("default")],2)]):e._e()},C=[],L=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),t}(n["default"]);L=k["a"]([Object(x["b"])({props:["visible","left","top"]})],L);var E=L,I=E,j=(i("7f1e"),Object(o["a"])(I,_,C,!1,null,null,null)),T=j.exports,M=i("8055"),P=i.n(M),D=(i("5df3"),i("f400"),i("6fc5")),N=i("2f62");n["default"].use(N["a"]);var A=new N["a"].Store({}),R=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.root=-1,e.files=[],e.folders=[],e.idMap=new Map,e.selected=[],e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"clear",value:function(){this.folders=[],this.files=[]}},{key:"clearSelected",value:function(){console.log("Cleared"),this.selected=[]}},{key:"setRoot",value:function(e){this.root=e}}]),t}(D["d"]);k["a"]([D["c"]],R.prototype,"clear",null),k["a"]([D["c"]],R.prototype,"clearSelected",null),k["a"]([D["c"]],R.prototype,"setRoot",null),R=k["a"]([Object(D["b"])({dynamic:!0,store:A,name:"assets",namespaced:!0})],R);var V=Object(D["e"])(R),U=P()(location.protocol+"//"+location.host+"/pa_assetmgmt",{autoConnect:!1});U.on("connect",function(){console.log("Connected")}),U.on("disconnect",function(){console.log("Disconnected")}),U.on("redirect",function(e){console.log("redirecting"),window.location.href=e}),U.on("Folder.Root.Set",function(e){V.setRoot(e)}),U.on("Folder.Set",function(e){if(V.clear(),e.children){var t=!0,i=!1,n=void 0;try{for(var a,r=e.children[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;V.idMap.set(o.id,o),o.file_hash?V.files.push(o.id):V.folders.push(o.id)}}catch(s){i=!0,n=s}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}}),U.on("Folder.Create",function(e){V.folders.push(e.id),V.idMap.set(e.id,e)}),U.on("Asset.Upload.Finish",function(e){V.idMap.set(e.id,e),V.files.push(e.id)});var F=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.left=0,e.top=0,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"open",value:function(e,t){var i=this;V.selected.includes(t)||this.parent.select(e,t),this.visible=!0,this.left=e.pageX,this.top=e.pageY,this.$nextTick(function(){i.$children[0].$el.focus()})}},{key:"close",value:function(){this.visible=!1}},{key:"rename",value:function(){var e=this;if(1===V.selected.length){var t=V.idMap.get(V.selected[0]);this.parent.$refs.prompt.prompt("New name:","Renaming ".concat(t.name)).then(function(i){U.emit("Asset.Rename",{asset:t.id,name:i}),t.name=i,e.parent.$forceUpdate()},function(){}),this.close()}}},{key:"remove",value:function(){0!==V.selected.length&&(this.parent.$refs.confirm.open("Are you sure you wish to remove this?").then(function(e){if(e){var t=!0,i=!1,n=void 0;try{for(var a,r=V.selected[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;U.emit("Asset.Remove",o),V.files.includes(o)?V.files.splice(V.files.indexOf(o),1):V.folders.splice(V.folders.indexOf(o),1)}}catch(s){i=!0,n=s}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}V.clearSelected()}},function(){}),this.close())}},{key:"parent",get:function(){return this.$parent}}]),t}(n["default"]);F=k["a"]([Object(x["b"])({components:{ContextMenu:T}})],F);var $=F,z=$,B=Object(o["a"])(z,O,S,!1,null,null,null),H=B.exports,G=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible},on:{close:e.close},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v("\n        "+e._s(e.title)+"\n    ")])}}])},[i("div",{staticClass:"modal-body"},[i("button",{ref:"confirm",on:{click:e.confirm}},[e._v(e._s(e.yes))]),e.no?i("button",{on:{click:e.deny}},[e._v(e._s(e.no))]):e._e()])])},W=[],X=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"modal"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"mask",class:{"modal-mask":e.mask,"dialog-mask":!e.mask},on:{click:e.close,dragover:function(t){return t.preventDefault(),e.dragOver(t)}}},[i("div",{ref:"container",staticClass:"modal-container",style:{"background-color":e.colour},on:{click:function(e){e.stopPropagation()}}},[e._t("header",null,{dragStart:e.dragStart,dragEnd:e.dragEnd}),e._t("default")],2)])])},Y=[],K=i("60a3"),q=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.positioned=!1,e.offsetX=0,e.offsetY=0,e.screenX=0,e.screenY=0,e.dragging=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){this.updatePosition()}},{key:"updated",value:function(){this.updatePosition()}},{key:"close",value:function(e){this.$emit("close")}},{key:"updatePosition",value:function(){if(!this.positioned){var e=this.$refs.container;if(0===e.offsetWidth&&0===e.offsetHeight)return;this.$refs.container.style.left=(window.innerWidth-e.offsetWidth)/2+"px",this.$refs.container.style.top=(window.innerHeight-e.offsetHeight)/2+"px",this.positioned=!0}}},{key:"dragStart",value:function(e){null!==e&&null!==e.dataTransfer&&(e.dataTransfer.setData("Hack",""),e.dataTransfer.setDragImage(this.$refs.container,e.offsetX,e.offsetY),this.offsetX=e.offsetX,this.offsetY=e.offsetY,this.screenX=e.screenX,this.screenY=e.screenY,this.dragging=!0)}},{key:"dragEnd",value:function(e){this.dragging=!1;var t=e.clientX-this.offsetX,i=e.clientY-this.offsetY;0===e.clientX&&0===e.clientY&&0===e.pageX&&0===e.pageY&&(t=parseInt(this.$refs.container.style.left,10)-(this.screenX-e.screenX),i=parseInt(this.$refs.container.style.top,10)-(this.screenY-e.screenY)),t<0&&(t=0),t>window.innerWidth-100&&(t=window.innerWidth-100),i<0&&(i=0),i>window.innerHeight-100&&(i=window.innerHeight-100),this.$refs.container.style.left=t+"px",this.$refs.container.style.top=i+"px",this.$refs.container.style.display="block"}},{key:"dragOver",value:function(e){this.dragging&&(this.$refs.container.style.display="none")}}]),t}(n["default"]);k["a"]([Object(K["a"])(Boolean)],q.prototype,"visible",void 0),k["a"]([Object(K["a"])({type:Boolean,default:!0})],q.prototype,"mask",void 0),k["a"]([Object(K["a"])({type:String,default:"white"})],q.prototype,"colour",void 0),q=k["a"]([x["b"]],q);var Q=q,Z=Q,J=(i("618e"),Object(o["a"])(Z,X,Y,!1,null,"2098e4f8",null)),ee=J.exports,te=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.yes="Yes",e.no="No",e.title="",e.resolve=function(e){},e.reject=function(){},e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"confirm",value:function(){this.resolve(!0),this.close()}},{key:"deny",value:function(){this.resolve(!1),this.close()}},{key:"close",value:function(){this.reject(),this.visible=!1,this.title=""}},{key:"open",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yes",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"no";return this.yes=i,this.no=n,this.title=e,this.visible=!0,this.$nextTick(function(){t.$refs.confirm.focus()}),new Promise(function(e,i){t.resolve=e,t.reject=i})}}]),t}(n["default"]);te=k["a"]([Object(x["b"])({components:{Modal:ee}})],te);var ie=te,ne=ie,ae=(i("fb5d"),Object(o["a"])(ne,G,W,!1,null,"46dc898b",null)),re=ae.exports,oe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible},on:{close:e.close},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v("\n        "+e._s(e.title)+"\n    ")])}}])},[i("div",{staticClass:"modal-body"},[e._v("\n        "+e._s(e.question)+"\n        "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.answer,expression:"answer"}],ref:"answer",attrs:{type:"text"},domProps:{value:e.answer},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)},input:function(t){t.target.composing||(e.answer=t.target.value)}}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.submit}},[e._v("Submit")])])])},se=[],le=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.question="",e.answer="",e.title="",e.resolve=function(e){},e.reject=function(){},e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"submit",value:function(){this.resolve(this.answer),this.close()}},{key:"close",value:function(){this.reject(),this.visible=!1,this.question="",this.answer="",this.title=""}},{key:"prompt",value:function(e,t){var i=this;return this.question=e,this.title=t,this.visible=!0,this.$nextTick(function(){i.$refs.answer.focus()}),new Promise(function(e,t){i.resolve=e,i.reject=t})}}]),t}(n["default"]);le=k["a"]([Object(x["b"])({components:{Modal:ee}})],le);var ce=le,ue=ce,he=(i("1133"),Object(o["a"])(ue,oe,se,!1,null,"391b52fc",null)),de=he.exports;i("28a5"),i("c5f6"),i("6b54"),i("a481");function ve(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16)})}function fe(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1}function pe(e,t){var i=[[],[]];return e.forEach(function(e){return t(e)?i[1].push(e):i[0].push(e)}),i}function ye(e,t,i,n){var a=.2*Number(e.font.split("px")[0]),r=e.measureText(t).width;return Math.min(i/r,n/a)}var ge=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.path=[],e.draggingSelection=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"changeDirectory",value:function(e){e<0?this.path.pop():this.path.push(e),V.clearSelected(),U.emit("Folder.Get",this.currentFolder)}},{key:"createDirectory",value:function(){var e=window.prompt("New folder name");null!==e&&U.emit("Folder.Create",{name:e,parent:this.currentFolder})}},{key:"moveInode",value:function(e,t){V.files.includes(e)?V.files.splice(V.files.indexOf(e),1):V.folders.splice(V.folders.indexOf(e),1),V.idMap.delete(e),U.emit("Inode.Move",{inode:e,target:t})}},{key:"select",value:function(e,t){if(e.shiftKey&&V.selected.length>0){for(var i=[].concat(Object(p["a"])(V.files),Object(p["a"])(V.folders)),n=i.indexOf(V.selected[V.selected.length-1]),a=i.indexOf(t),r=n;r!==a;n<a?r++:r--)r!==n&&V.selected.push(i[r]);V.selected.push(i[a])}else e.ctrlKey||V.clearSelected(),V.selected.push(t)}},{key:"startDrag",value:function(e,t){null!==e.dataTransfer&&(e.dataTransfer.setData("Hack","ittyHack"),e.dataTransfer.dropEffect="move",V.selected.includes(t)||V.selected.push(t),this.draggingSelection=!0)}},{key:"moveDrag",value:function(e){e.target.classList.contains("folder")&&e.target.classList.add("inode-selected")}},{key:"leaveDrag",value:function(e){e.target.classList.contains("folder")&&e.target.classList.remove("inode-selected")}},{key:"stopDrag",value:function(e,t){if(e.target.classList.remove("inode-selected"),this.draggingSelection){if((t===V.root||V.folders.includes(t))&&!V.selected.includes(t)){var i=!0,n=!1,a=void 0;try{for(var r,o=V.selected[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var s=r.value;this.moveInode(s,t)}}catch(l){n=!0,a=l}finally{try{i||null==o.return||o.return()}finally{if(n)throw a}}}V.clearSelected()}else e.dataTransfer&&e.dataTransfer.files.length>0&&this.upload(e.dataTransfer.files,t);this.draggingSelection=!1}},{key:"prepareUpload",value:function(){document.getElementById("files").click()}},{key:"upload",value:function(e,t){var i=document.getElementById("files").files;if(void 0===e){if(!i)return;e=i}void 0===t&&(t=this.currentFolder);var n=1e5,a=!0,r=!1,o=void 0;try{for(var s,l=function(){for(var e=s.value,i=ve(),a=Math.ceil(e.size/n),r=function(r){var o=new FileReader;o.readAsArrayBuffer(e.slice(r*n,r*n+Math.min(n,e.size-r*n))),o.onload=function(n){U.emit("Asset.Upload",{name:e.name,directory:t,data:o.result,slice:r,totalSlices:a,uuid:i})}},o=0;o<a;o++)r(o)},c=e[Symbol.iterator]();!(a=(s=c.next()).done);a=!0)l()}catch(u){r=!0,o=u}finally{try{a||null==c.return||c.return()}finally{if(r)throw o}}}},{key:"folders",get:function(){return V.folders}},{key:"files",get:function(){return V.files}},{key:"selected",get:function(){return V.selected}},{key:"idMap",get:function(){return V.idMap}},{key:"currentFolder",get:function(){return this.path.length?this.path[this.path.length-1]:V.root}},{key:"parentFolder",get:function(){var e=this.path[this.path.length-2];return void 0===e&&(e=V.root),e}},{key:"firstSelectedFile",get:function(){var e=!0,t=!1,i=void 0;try{for(var n,a=V.selected[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var r=n.value;if(V.idMap.get(r).file_hash)return V.idMap.get(r)}}catch(o){t=!0,i=o}finally{try{e||null==a.return||a.return()}finally{if(t)throw i}}return null}}]),t}(n["default"]);ge=k["a"]([Object(x["b"])({components:{Prompt:de,ConfirmDialog:re,AssetContextMenu:H},beforeRouteEnter:function(e,t,i){U.connect(),i()},beforeRouteLeave:function(e,t,i){U.disconnect(),i()}})],ge);var me=ge,be=me,we=(i("78c7"),Object(o["a"])(be,v,f,!1,null,null,null)),ke=we.exports,xe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("form",{on:{focusin:e.focusin,focusout:e.focusout,submit:function(t){return t.preventDefault(),e.login(t)}}},[i("fieldset",[i("legend",{staticClass:"legend"},[e._v("PlanarAlly")]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{type:"text",name:"username",placeholder:"Username",autocomplete:"username",required:""},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}}),e._m(0)]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",name:"password",placeholder:"Password",autocomplete:"current-password",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),e._m(1)]),i("div",{staticStyle:{display:"flex"}},[i("button",{staticStyle:{visibility:"hidden",display:"none"},attrs:{type:"submit",name:"login"}}),i("button",{staticClass:"submit",attrs:{type:"button",name:"register",title:"Register"},on:{click:e.register}},[i("i",{staticClass:"fas fa-plus"})]),e._m(2)])]),e.error?i("div",{staticClass:"feedback"},[i("p",{staticClass:"error"},[i("strong",[e._v("Error:")]),e._v("\n            "+e._s(e.error)+"\n        ")])]):e._e()])},Oe=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fas fa-user-circle"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fas fa-lock"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("button",{staticClass:"submit",attrs:{type:"submit",name:"login",title:"Login"}},[i("i",{staticClass:"fas fa-arrow-right"})])}],Se=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.authenticated=!1,e.initialized=!1,e.username="",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"setAuthenticated",value:function(e){this.authenticated=e}},{key:"setInitialized",value:function(e){this.initialized=e}},{key:"setUsername",value:function(e){this.username=e}}]),t}(D["d"]);k["a"]([D["c"]],Se.prototype,"setAuthenticated",null),k["a"]([D["c"]],Se.prototype,"setInitialized",null),k["a"]([D["c"]],Se.prototype,"setUsername",null),Se=k["a"]([Object(D["b"])({dynamic:!0,store:A,name:"core"})],Se);var _e=Object(D["e"])(Se),Ce=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.username="",e.password="",e.error="",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"login",value:function(){var e=this;h.a.post("/api/login",{username:this.username,password:this.password}).then(function(t){_e.setUsername(e.username),_e.setAuthenticated(!0),e.$router.push(e.$route.query.redirect||"/")}).catch(function(t){t.response?e.error=t.response.statusText:e.error="Unknown error occured"})}},{key:"register",value:function(){var e=this;h.a.post("/api/register",{username:this.username,password:this.password}).then(function(t){_e.setUsername(e.username),_e.setAuthenticated(!0),e.$router.push(e.$route.query.redirect||"/")}).catch(function(t){t.response?e.error=t.response.statusText:e.error="Unknown error occured"})}},{key:"focusin",value:function(e){if(e.target&&e.target.nextElementSibling){var t=e.target.nextElementSibling;t.style.opacity="0"}}},{key:"focusout",value:function(e){if(e.target&&e.target.nextElementSibling){var t=e.target.nextElementSibling;t.style.opacity="1"}}}]),t}(n["default"]);Ce=k["a"]([x["b"]],Ce);var Le=Ce,Ee=Le,Ie=(i("c947"),Object(o["a"])(Ee,xe,Oe,!1,null,"6062c8f4",null)),je=Ie.exports;x["b"].registerHooks(["beforeRouteEnter"]);var Te=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"beforeRouteEnter",value:function(e,t,i){h.a.post("/api/logout").then(function(){_e.setAuthenticated(!1),_e.setUsername(""),i({path:"/auth/login"})})}}]),t}(n["default"]);Te=k["a"]([Object(x["b"])({})],Te);var Me=Te,Pe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e._v(e._s(e.message))])},De=[],Ne=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.message="Loading...",e}return Object(w["a"])(t,e),t}(n["default"]);Ne=k["a"]([x["b"]],Ne);var Ae=Ne,Re=Ae,Ve=Object(o["a"])(Re,Pe,De,!1,null,null,null),Ue=Ve.exports,Fe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"formcontainer"}},[e.owned||e.joined?i("form",[i("fieldset",[i("legend",{staticClass:"legend"},[e._v("Your sessions")]),i("div",{staticClass:"input"},[e._l(e.owned,function(t,n){return i("router-link",{key:"o-"+n,attrs:{to:"/game/"+encodeURIComponent(t[1])+"/"+encodeURIComponent(t[0])}},[e._v("\n                    "+e._s(t[0])+"\n                ")])}),e._l(e.joined,function(t,n){return i("router-link",{key:"j-"+n,attrs:{to:"/game/"+encodeURIComponent(t[1])+"/"+encodeURIComponent(t[0])}},[e._v("\n                    "+e._s(t[1])+"/"+e._s(t[0])+"\n                ")])})],2),0===e.owned.length?i("div",{staticClass:"input"},[e._v("No active sessions")]):e._e()])]):e._e(),e._m(0),i("form",{on:{submit:function(t){return t.preventDefault(),e.createRoom(t)}}},[i("fieldset",[e.owned||e.joined?i("div",{staticClass:"input"},[e._v("Create a new session")]):i("legend",{staticClass:"legend"},[e._v("Create a session")]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.newSessionName,expression:"newSessionName"}],attrs:{type:"text",name:"room_name",placeholder:"Session Name"},domProps:{value:e.newSessionName},on:{input:function(t){t.target.composing||(e.newSessionName=t.target.value)}}}),e._m(1)]),e._m(2)])]),i("div",{attrs:{id:"account-options"}},[i("form",{on:{submit:function(e){e.preventDefault()}}},[i("router-link",{staticClass:"submit",attrs:{tag:"button",title:"Account Settings",to:"/account"}},[i("i",{staticClass:"fas fa-cog"})])],1),i("form",{on:{submit:function(e){e.preventDefault()}}},[i("router-link",{staticClass:"submit",attrs:{tag:"button",title:"Logout",to:"/auth/logout"}},[i("i",{staticClass:"fas fa-sign-out-alt"})])],1)])])},$e=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("h4",[i("span",[e._v("OR")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fab fa-d-and-d"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("button",{staticClass:"submit",attrs:{type:"submit",title:"Create"}},[i("i",{staticClass:"fas fa-arrow-right"})])}];x["b"].registerHooks(["beforeRouteEnter"]);var ze=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.owned=[],e.joined=[],e.error="",e.newSessionName="",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"beforeRouteEnter",value:function(e,t,i){h.a.get("/api/rooms").then(function(e){i(function(t){t.owned=e.data.owned,t.joined=e.data.joined})}).catch(function(e){i(function(t){t.error=e.message})})}},{key:"createRoom",value:function(e){var t=this;h.a.post("/api/rooms",{name:this.newSessionName}).then(function(e){t.$router.push("/game/".concat(encodeURIComponent(_e.username),"/").concat(encodeURIComponent(t.newSessionName)))}).catch(function(e){t.error=e.message})}}]),t}(n["default"]);ze=k["a"]([x["b"]],ze);var Be=ze,He=Be,Ge=(i("d9e0"),Object(o["a"])(He,Fe,$e,!1,null,"f34c77ee",null)),We=Ge.exports,Xe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"main"},on:{mouseleave:e.mouseleave,wheel:e.zoom}},[e.showUI?i("menu-bar"):e._e(),i("div",{attrs:{id:"board"}},[e.ready.manager?[i("tool-bar",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],ref:"tools"})]:e._e(),i("div",{attrs:{id:"layers"},on:{mousedown:e.mousedown,mouseup:e.mouseup,mousemove:e.mousemove,contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.contextmenu(t)},dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.drop(t)}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showUI&&e.layers.length>1,expression:"showUI && layers.length > 1"}],attrs:{id:"layerselect"}},[i("ul",e._l(e.layers,function(t){return i("li",{key:t.name,class:{"layer-selected":t===e.selectedLayer},on:{mousedown:function(i){return e.selectLayer(t)}}},[i("a",{attrs:{href:"#"}},[e._v(e._s(t))])])}),0)])],2),i("selection-info",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],ref:"selectionInfo"}),i("initiative-dialog",{ref:"initiative",attrs:{id:"initiativedialog"}}),i("note-dialog",{ref:"note"}),i("label-dialog",{ref:"labels"}),e.IS_DM||e.FAKE_PLAYER?i("dm-settings",{ref:"dmsettings"}):e._e(),i("div",{attrs:{id:"zoomer"}},[i("zoom-slider",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],attrs:{id:"zoomer",height:6,width:200,min:0,max:1,interval:.1,"dot-size":[8,20],"dot-options":{style:{"border-radius":"15%","z-index":11}},"tooltip-placement":"bottom",tooltip:"focus","tooltip-formatter":e.zoomDisplay.toFixed(1),"rail-style":{"background-color":"#fff","box-shadow":"0.5px 0.5px 3px 1px rgba(0, 0, 0, .36)"},"process-style":{"background-color":"#fff"}},model:{value:e.zoomDisplay,callback:function(t){e.zoomDisplay=t},expression:"zoomDisplay"}})],1),i("prompt-dialog",{ref:"prompt"}),i("confirm-dialog",{ref:"confirm"})],1)},Ye=[],Ke=i("0f32"),qe=i.n(Ke),Qe=i("4971"),Ze=i.n(Qe),Je=(i("24df"),P()(location.protocol+"//"+location.host+"/planarally",{autoConnect:!1}));function et(e){Je.io.opts.query="user=".concat(decodeURIComponent(e.params.creator),"&room=").concat(decodeURIComponent(e.params.room)),Je.connect()}var tt=new n["default"],it=i("2a88");var nt=function(){function e(t,i){Object(y["a"])(this,e),this.x=t,this.y=i}return Object(g["a"])(e,[{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"subtract",value:function(e){return new ot(this.x-e.x,this.y-e.y)}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"get",value:function(e){return 0===e?this.x:this.y}},{key:"asArray",value:function(){return[this.x,this.y]}}],[{key:"fromArray",value:function(t){return new e(t[0],t[1])}}]),e}(),at=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"add",value:function(e){return Object(it["a"])(Object(b["a"])(t.prototype),"add",this).call(this,e)}},{key:"subtract",value:function(e){return Object(it["a"])(Object(b["a"])(t.prototype),"subtract",this).call(this,e)}},{key:"clone",value:function(){return Object(it["a"])(Object(b["a"])(t.prototype),"clone",this).call(this)}}],[{key:"fromArray",value:function(e){return new t(e[0],e[1])}}]),t}(nt),rt=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"add",value:function(e){return Object(it["a"])(Object(b["a"])(t.prototype),"add",this).call(this,e)}},{key:"subtract",value:function(e){return Object(it["a"])(Object(b["a"])(t.prototype),"subtract",this).call(this,e)}},{key:"clone",value:function(){return Object(it["a"])(Object(b["a"])(t.prototype),"clone",this).call(this)}}]),t}(nt),ot=function(){function e(t,i){Object(y["a"])(this,e),this.x=t,this.y=i}return Object(g["a"])(e,[{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"inverse",value:function(){return new e(0===this.x?0:1/this.x,0===this.y?0:1/this.y)}},{key:"length",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"normalize",value:function(){var t=this.length();return new e(this.x/t,this.y/t)}},{key:"reverse",value:function(){return new e(-this.x,-this.y)}},{key:"multiply",value:function(t){return new e(this.x*t,this.y*t)}},{key:"angle",value:function(){return 180*Math.atan2(this.y,this.x)/Math.PI}}]),e}(),st=function(){function e(t,i,n){Object(y["a"])(this,e),this.direction=i,this.origin=t,void 0===n&&(n=1/0),this.tMax=n}return Object(g["a"])(e,[{key:"get",value:function(e){return new nt(this.origin.x+e*this.direction.x,this.origin.y+e*this.direction.y)}},{key:"getDistance",value:function(e,t){return Math.sqrt(Math.pow(t-e,2)*(Math.pow(this.direction.x,2)+Math.pow(this.direction.y,2)))}},{key:"getT",value:function(e,t){return e+Math.sqrt(Math.pow(t,2)/(Math.pow(this.direction.x,2)+Math.pow(this.direction.y,2)))}}],[{key:"fromPoints",value:function(t,i){var n,a=new ot(i.x-t.x,i.y-t.y);return n=Math.abs(a.x)>.01?(i.x-t.x)/a.x:(i.y-t.y)/a.y,new e(t,a,n)}}]),e}(),lt=(i("7514"),i("4f7f"),i("66cb")),ct=i.n(lt);function ut(e){Je.emit("Client.Options.Set",{locationOptions:e})}function ht(e){var t=Ct.zoomFactor,i=Ct.panX,n=Ct.panY;return new rt((e.x+i)*t,(e.y+n)*t)}function dt(e){return ht(new at(e,0)).x}function vt(e){return ht(new at(0,e)).y}function ft(e){return e*Ct.zoomFactor}function pt(e){return e/Ct.unitSize*Ct.gridSize}function yt(e){return ft(pt(e))}function gt(e){var t=Ct.zoomFactor,i=Ct.panX,n=Ct.panY;return e instanceof rt?new at(e.x/t-i,e.y/t-n):new st(gt(e.origin),e.direction.multiply(1/t),e.tMax)}function mt(e){return gt(new rt(e,0)).x}function bt(e){return gt(new rt(0,e)).y}function wt(e){return e/Ct.zoomFactor}function kt(e){return new rt(e.pageX,e.pageY)}function xt(e){return 1/(-5/3+28/15*Math.exp(1.83*e))}function Ot(e){return Math.log(15/28*(1/e+5/3))/1.83}function St(e,t){return e[0]===t[0]&&e[1]===t[1]}window.g2lx=dt,window.g2ly=vt;var _t=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.layers=[],e.selectedLayerIndex=-1,e.boardInitialized=!1,e.locations=[],e.assets={},e.notes=[],e.IS_DM=!1,e.FAKE_PLAYER=!1,e.isLocked=!1,e.gridSize=50,e.username="",e.roomName="",e.roomCreator="",e.invitationCode="",e.players=[],e.gridColour="rgba(0, 0, 0, 1)",e.fowColour="rgba(0, 0, 0, 1)",e.rulerColour="rgba(255, 0, 0, 1)",e.panX=0,e.panY=0,e.zoomDisplay=.5,e.unitSize=5,e.useGrid=!0,e.fullFOW=!1,e.fowOpacity=.3,e.fowLOS=!1,e.locationName="",e.visionSources=[],e.annotations=[],e.movementblockers=[],e.ownedtokens=[],e._activeTokens=[],e.drawTEContour=!1,e.visionRangeMin=1640,e.visionRangeMax=3281,e.clipboard=[],e.labels={},e.filterNoLabel=!1,e.labelFilters=[],e.showUI=!0,e.selectionHelperID=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"getFogColour",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=ct()(Ct.fowColour);return Ct.IS_DM?t.setAlpha(e?1:Ct.fowOpacity):t.setAlpha(1),t.toRgbString()}},{key:"setSelectionHelperId",value:function(e){this.selectionHelperID=e}},{key:"setFakePlayer",value:function(e){this.FAKE_PLAYER=e,this.IS_DM=!e,Et.invalidate()}},{key:"setZoomDisplay",value:function(e){e!==this.zoomDisplay&&(e<0&&(e=0),e>1&&(e=1),this.zoomDisplay=e,Et.invalidate())}},{key:"setBoardInitialized",value:function(e){this.boardInitialized=e}},{key:"toggleUnlabeledFilter",value:function(){this.filterNoLabel=!this.filterNoLabel}},{key:"addLabel",value:function(e){n["default"].set(this.labels,e.uuid,e)}},{key:"setLabelFilters",value:function(e){this.labelFilters=e}},{key:"setLabelVisibility",value:function(e){e.uuid in this.labels&&(this.labels[e.uuid].visible=e.visible)}},{key:"deleteLabel",value:function(e){if(e.uuid in this.labels){var t=this.labels[e.uuid],i=new Set,a=!0,r=!1,o=void 0;try{for(var s,l=Et.UUIDMap.values()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,u=c.labels.indexOf(t);u>=0&&(c.labels.splice(u,1),i.add(c.layer))}}catch(g){r=!0,o=g}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}var h=!0,d=!1,v=void 0;try{for(var f,p=i[Symbol.iterator]();!(h=(f=p.next()).done);h=!0){var y=f.value;Et.getLayer(y).invalidate(!1)}}catch(g){d=!0,v=g}finally{try{h||null==p.return||p.return()}finally{if(d)throw v}}n["default"].delete(this.labels,e.uuid)}}},{key:"setDM",value:function(e){this.IS_DM=e}},{key:"setUsername",value:function(e){this.username=e}},{key:"setRoomName",value:function(e){this.roomName=e}},{key:"setRoomCreator",value:function(e){this.roomCreator=e}},{key:"setInvitationCode",value:function(e){this.invitationCode=e}},{key:"addLayer",value:function(e){this.layers.push(e),-1===this.selectedLayerIndex&&(this.selectedLayerIndex=this.layers.indexOf(e))}},{key:"selectLayer",value:function(e){var t=this.layers.indexOf(e.name);t>=0&&(this.selectedLayerIndex=t),e.sync&&Je.emit("Client.ActiveLayer.Set",e.name)}},{key:"newNote",value:function(e){this.notes.push(e.note),e.sync&&Je.emit("Note.New",e.note)}},{key:"setAssets",value:function(e){this.assets=e}},{key:"setLocations",value:function(e){this.locations=e}},{key:"resetLayerInfo",value:function(){this.layers=[],this.selectedLayerIndex=-1}},{key:"updateZoom",value:function(e){if(e.newZoomDisplay!==this.zoomDisplay){e.newZoomDisplay<0&&(e.newZoomDisplay=0),e.newZoomDisplay>1&&(e.newZoomDisplay=1);var t=ht(e.zoomLocation);this.zoomDisplay=e.newZoomDisplay;var i=gt(t),n=i.subtract(e.zoomLocation);this.panX+=n.x,this.panY+=n.y,Et.invalidate(),ut(this.locationOptions)}}},{key:"setGridColour",value:function(e){this.gridColour=e.colour,Et.getGridLayer().drawGrid(),e.sync&&Je.emit("Client.Options.Set",{gridColour:e.colour})}},{key:"setFOWColour",value:function(e){this.fowColour=e.colour,Et.invalidate(),e.sync&&Je.emit("Client.Options.Set",{fowColour:e.colour})}},{key:"setRulerColour",value:function(e){this.rulerColour=e.colour,e.sync&&Je.emit("Client.Options.Set",{rulerColour:e.colour})}},{key:"setPanX",value:function(e){this.panX=e}},{key:"setPanY",value:function(e){this.panY=e}},{key:"increasePanX",value:function(e){this.panX+=e}},{key:"increasePanY",value:function(e){this.panY+=e}},{key:"setUnitSize",value:function(e){this.unitSize!==e.unitSize&&e.unitSize>0&&e.unitSize<1/0&&(this.unitSize=e.unitSize,Et.invalidate(),e.sync&&Je.emit("Location.Options.Set",{unit_size:e.unitSize}))}},{key:"setUseGrid",value:function(e){if(this.useGrid!==e.useGrid){this.useGrid=e.useGrid;var t=Et.getGridLayer();e.useGrid?t.canvas.style.display="block":t.canvas.style.display="none",e.sync&&Je.emit("Location.Options.Set",{use_grid:e.useGrid})}}},{key:"setGridSize",value:function(e){if(this.gridSize!==e.gridSize&&e.gridSize>0){this.gridSize=e.gridSize;var t=Et.getGridLayer();void 0!==t&&t.drawGrid(),e.sync&&Je.emit("Gridsize.Set",e.gridSize)}}},{key:"setVisionRangeMin",value:function(e){this.visionRangeMin=e.value,Et.invalidateLight(),e.sync&&Je.emit("Location.Options.Set",{vision_min_range:e.value})}},{key:"setVisionRangeMax",value:function(e){this.visionRangeMax=Math.max(e.value,this.visionRangeMin),Et.invalidateLight(),e.sync&&Je.emit("Location.Options.Set",{vision_max_range:this.visionRangeMax})}},{key:"setFullFOW",value:function(e){this.fullFOW!==e.fullFOW&&(this.fullFOW=e.fullFOW,Et.invalidateLight(),e.sync&&Je.emit("Location.Options.Set",{full_fow:e.fullFOW}))}},{key:"setFOWOpacity",value:function(e){this.fowOpacity=e.fowOpacity,Et.invalidateLight(),e.sync&&Je.emit("Location.Options.Set",{fow_opacity:e.fowOpacity})}},{key:"setLineOfSight",value:function(e){this.fowLOS!==e.fowLOS&&(this.fowLOS=e.fowLOS,Et.invalidate(),e.sync&&Je.emit("Location.Options.Set",{fow_los:e.fowLOS}))}},{key:"setLocationName",value:function(e){this.locationName=e}},{key:"updateNote",value:function(e){var t=this.notes.find(function(t){return t.uuid===e.note.uuid});void 0!==t&&(t.title=e.note.title,t.text=e.note.text,e.sync&&Je.emit("Note.Update",t))}},{key:"removeNote",value:function(e){this.notes=this.notes.filter(function(t){return t.uuid!==e.note.uuid}),e.sync&&Je.emit("Note.Remove",e.note.uuid)}},{key:"toggleUI",value:function(){this.showUI=!this.showUI}},{key:"setClipboard",value:function(e){this.clipboard=e}},{key:"setActiveTokens",value:function(e){this._activeTokens=e,Et.invalidateLight()}},{key:"addActiveToken",value:function(e){this._activeTokens.push(e),Et.invalidateLight()}},{key:"removeActiveToken",value:function(e){0===this._activeTokens.length&&(this._activeTokens=Object(p["a"])(this.ownedtokens)),this._activeTokens.splice(this._activeTokens.indexOf(e),1),Et.invalidateLight()}},{key:"setPlayers",value:function(e){this.players=e}},{key:"addPlayer",value:function(e){this.players.push(e)}},{key:"kickPlayer",value:function(e){this.players=this.players.filter(function(t){return t.id!==e})}},{key:"setIsLocked",value:function(e){this.isLocked=e.isLocked,e.sync&&Je.emit("Room.Info.Set.Locked",this.isLocked)}},{key:"clear",value:function(){this.context.state.visionSources=[],this.context.state.ownedtokens=[],this.context.state.annotations=[],this.context.state.movementblockers=[],this.context.state.notes=[]}},{key:"selectedLayer",get:function(){return this.layers[this.selectedLayerIndex]}},{key:"zoomFactor",get:function(){return xt(this.zoomDisplay)}},{key:"locationOptions",get:function(){return{panX:Ct.panX,panY:Ct.panY,zoomFactor:Ct.zoomFactor}}},{key:"activeTokens",get:function(){return 0===this._activeTokens.length?this.ownedtokens:this._activeTokens}}]),t}(D["d"]);k["a"]([D["c"]],_t.prototype,"setSelectionHelperId",null),k["a"]([D["c"]],_t.prototype,"setFakePlayer",null),k["a"]([D["c"]],_t.prototype,"setZoomDisplay",null),k["a"]([D["c"]],_t.prototype,"setBoardInitialized",null),k["a"]([D["c"]],_t.prototype,"toggleUnlabeledFilter",null),k["a"]([D["c"]],_t.prototype,"addLabel",null),k["a"]([D["c"]],_t.prototype,"setLabelFilters",null),k["a"]([D["c"]],_t.prototype,"setLabelVisibility",null),k["a"]([D["c"]],_t.prototype,"deleteLabel",null),k["a"]([D["c"]],_t.prototype,"setDM",null),k["a"]([D["c"]],_t.prototype,"setUsername",null),k["a"]([D["c"]],_t.prototype,"setRoomName",null),k["a"]([D["c"]],_t.prototype,"setRoomCreator",null),k["a"]([D["c"]],_t.prototype,"setInvitationCode",null),k["a"]([D["c"]],_t.prototype,"addLayer",null),k["a"]([D["c"]],_t.prototype,"selectLayer",null),k["a"]([D["c"]],_t.prototype,"newNote",null),k["a"]([D["c"]],_t.prototype,"setAssets",null),k["a"]([D["c"]],_t.prototype,"setLocations",null),k["a"]([D["c"]],_t.prototype,"resetLayerInfo",null),k["a"]([D["c"]],_t.prototype,"updateZoom",null),k["a"]([D["c"]],_t.prototype,"setGridColour",null),k["a"]([D["c"]],_t.prototype,"setFOWColour",null),k["a"]([D["c"]],_t.prototype,"setRulerColour",null),k["a"]([D["c"]],_t.prototype,"setPanX",null),k["a"]([D["c"]],_t.prototype,"setPanY",null),k["a"]([D["c"]],_t.prototype,"increasePanX",null),k["a"]([D["c"]],_t.prototype,"increasePanY",null),k["a"]([D["c"]],_t.prototype,"setUnitSize",null),k["a"]([D["c"]],_t.prototype,"setUseGrid",null),k["a"]([D["c"]],_t.prototype,"setGridSize",null),k["a"]([D["c"]],_t.prototype,"setVisionRangeMin",null),k["a"]([D["c"]],_t.prototype,"setVisionRangeMax",null),k["a"]([D["c"]],_t.prototype,"setFullFOW",null),k["a"]([D["c"]],_t.prototype,"setFOWOpacity",null),k["a"]([D["c"]],_t.prototype,"setLineOfSight",null),k["a"]([D["c"]],_t.prototype,"setLocationName",null),k["a"]([D["c"]],_t.prototype,"updateNote",null),k["a"]([D["c"]],_t.prototype,"removeNote",null),k["a"]([D["c"]],_t.prototype,"toggleUI",null),k["a"]([D["c"]],_t.prototype,"setClipboard",null),k["a"]([D["c"]],_t.prototype,"setActiveTokens",null),k["a"]([D["c"]],_t.prototype,"addActiveToken",null),k["a"]([D["c"]],_t.prototype,"removeActiveToken",null),k["a"]([D["c"]],_t.prototype,"setPlayers",null),k["a"]([D["c"]],_t.prototype,"addPlayer",null),k["a"]([D["c"]],_t.prototype,"kickPlayer",null),k["a"]([D["c"]],_t.prototype,"setIsLocked",null),k["a"]([D["a"]],_t.prototype,"clear",null),_t=k["a"]([Object(D["b"])({dynamic:!0,store:A,name:"game",namespaced:!0})],_t);var Ct=Object(D["e"])(_t),Lt=function(){function e(){var t=this;Object(y["a"])(this,e),this.layers=[],this.width=window.innerWidth,this.height=window.innerHeight,this.UUIDMap=new Map,this.interval=30,this.drawLoop=function(){for(var e=t.layers.length-1;e>=0;e--)t.layers[e].draw();requestAnimationFrame(t.drawLoop)},requestAnimationFrame(this.drawLoop)}return Object(g["a"])(e,[{key:"reset",value:function(){this.layers=[],this.UUIDMap=new Map}},{key:"setWidth",value:function(e){this.width=e;var t=!0,i=!1,n=void 0;try{for(var a,r=this.layers[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;o.canvas.width=e,o.width=e}}catch(s){i=!0,n=s}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}},{key:"setHeight",value:function(e){this.height=e;var t=!0,i=!1,n=void 0;try{for(var a,r=this.layers[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;o.canvas.height=e,o.height=e}}catch(s){i=!0,n=s}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}},{key:"addLayer",value:function(e){this.layers.push(e),(Ct.IS_DM||e.playerEditable)&&e.selectable&&Ct.addLayer(e.name)}},{key:"hasLayer",value:function(e){return this.layers.some(function(t){return t.name===e})}},{key:"getLayer",value:function(e){e=void 0===e?Ct.selectedLayer:e;var t=!0,i=!1,n=void 0;try{for(var a,r=this.layers[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;if(o.name===e)return o}}catch(s){i=!0,n=s}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}},{key:"selectLayer",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!1,n=!0,a=!1,r=void 0;try{for(var o,s=this.layers[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;l.selectable&&(i&&"fow"!==l.name?l.ctx.globalAlpha=.3:l.ctx.globalAlpha=1,e===l.name&&(Ct.selectLayer({name:e,sync:t}),i=!0),l.clearSelection(),l.invalidate(!0))}}catch(c){a=!0,r=c}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}}},{key:"getGridLayer",value:function(){return this.getLayer("grid")}},{key:"hasSelection",value:function(){var e=this.getSelection();return void 0!==e&&e.length>0}},{key:"getSelection",value:function(){var e=this.getLayer();if(void 0!==e)return e.selection}},{key:"invalidate",value:function(){for(var e=this.layers.length-1;e>=0;e--)this.layers[e].invalidate(!0)}},{key:"invalidateLight",value:function(){for(var e=this.layers.length-1;e>=0;e--)this.layers[e].isVisionLayer&&this.layers[e].invalidate(!0)}}]),e}(),Et=new Lt;window.lm=Et;i("6c7b"),i("20d6"),i("f559");var It,jt=function(){function e(t,i,n){Object(y["a"])(this,e),this.w=i,this.h=n,this.topLeft=t,this.topRight=new at(t.x+i,t.y),this.botRight=new at(t.x+i,t.y+n),this.botLeft=new at(t.x,t.y+n)}return Object(g["a"])(e,[{key:"contains",value:function(e){return this.topLeft.x<=e.x&&this.topRight.x>=e.x&&this.topLeft.y<=e.y&&this.botLeft.y>=e.y}},{key:"offset",value:function(t){return new e(this.topLeft.add(t),this.w,this.h)}},{key:"union",value:function(t){var i=Math.min(this.topLeft.x,t.topLeft.x),n=Math.max(this.topRight.x,t.topRight.x),a=Math.min(this.topLeft.y,t.topLeft.y),r=Math.max(this.botLeft.y,t.botLeft.y);return new e(new at(i,a),n-i,r-a)}},{key:"getDiagCorner",value:function(e){return e?this.botRight:this.topLeft}},{key:"intersectsWith",value:function(e){return!(e.topLeft.x>this.topRight.x||e.topRight.x<this.topLeft.x||e.topLeft.y>this.botLeft.y||e.botLeft.y<this.topLeft.y)}},{key:"intersectsWithInner",value:function(e){return!(e.topLeft.x>=this.topRight.x||e.topRight.x<=this.topLeft.x||e.topLeft.y>=this.botLeft.y||e.botLeft.y<=this.topLeft.y)}},{key:"intersectP",value:function(e,t,i){var n=t.x*(this.getDiagCorner(i[0]).x-e.origin.x),a=t.x*(this.getDiagCorner(!i[0]).x-e.origin.x),r=t.y*(this.getDiagCorner(i[1]).y-e.origin.y),o=t.y*(this.getDiagCorner(!i[1]).y-e.origin.y);return n>o||r>a?{hit:!1,min:n,max:a}:(r>n&&(n=r),o<a&&(a=o),{hit:n<e.tMax&&a>0,min:n,max:a})}},{key:"center",value:function(){return this.topLeft.add(new ot(this.w/2,this.h/2))}},{key:"getMaxExtent",value:function(){return this.w>this.h?0:1}},{key:"visibleInCanvas",value:function(e){var t=!(dt(this.topLeft.x)>e.width||vt(this.topLeft.y)>e.height||dt(this.topRight.x)<0||vt(this.botRight.y)<0);return!!t}},{key:"points",get:function(){return 0===this.w||0===this.h?[[this.topLeft.x,this.topLeft.y]]:[[this.topLeft.x,this.topLeft.y],[this.botLeft.x,this.botLeft.y],[this.botRight.x,this.botRight.y],[this.topRight.x,this.topRight.y]]}}]),e}(),Tt=(i("0d6d"),i("768b")),Mt=function(e){var t=[],i=!0,n=!1,a=void 0;try{for(var r,o=e[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var s=r.value;t.push({uuid:s.uuid,visionSource:s.vision_source,visible:s.visible,name:s.name,value:s.value,dim:s.dim,colour:s.colour})}}catch(l){n=!0,a=l}finally{try{i||null==o.return||o.return()}finally{if(n)throw a}}return t},Pt=function(e){var t=[],i=!0,n=!1,a=void 0;try{for(var r,o=e[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var s=r.value;t.push({uuid:s.uuid,vision_source:s.visionSource,visible:s.visible,name:s.name,value:s.value,dim:s.dim,colour:s.colour})}}catch(l){n=!0,a=l}finally{try{i||null==o.return||o.return()}finally{if(n)throw a}}return t};i("96cf"),i("55dd"),i("2e37");function Dt(e){return(e+2)%3}function Nt(e){return(e+1)%3}function At(e,t){var i=new hi(e,null);if(i.valid)do{var n=3-i.t.indexV(e)-i.ri,a=i.t.vertices[n];if(!a.infinite){if(a===t)return{includes:!0,vi:t,fr:i.t,i:i.ri};var r=Ut(e.point,t.point,a.point);if(r===ai.COLLINEAR&&Rt(e.point,a.point,t.point))return{includes:!0,vi:a,fr:i.t,i:i.ri}}}while(i.next());return{includes:!1}}function Rt(e,t,i){var n,a;return Vt(0,e,i)===ai.EQUAL?(n=Vt(1,e,t),a=Vt(1,t,i)):(n=Vt(0,e,t),a=Vt(0,t,i)),n===ai.SMALLER&&a===ai.SMALLER||n===ai.LARGER&&a===ai.LARGER}function Vt(e,t,i){return t[e]<i[e]?ai.SMALLER:t[e]>i[e]?ai.LARGER:ai.EQUAL}function Ut(e,t,i){var n=e[0],a=e[1],r=t[0],o=t[1],s=i[0],l=i[1],c=r-n,u=o-a,h=s-n,d=l-a,v=Ft(c,u,h,d),f=Math.abs(c),p=Math.abs(u),y=Math.abs(h),g=Math.abs(d);if(f<y&&(f=y),p<g&&(p=g),f>p){var m=[p,f];f=m[0],p=m[1]}if(f<2e-162&&0===f)return ai.ZERO;if(p<1e153){var b=Number.EPSILON*f*p;if(v>b)return ai.POSITIVE;if(v<-b)return ai.NEGATIVE}return ai.ZERO}function Ft(e,t,i,n){return e*n-t*i}function $t(e,t,i){return Ft(t[0]-e[0],t[1]-e[1],i[0]-e[0],i[1]-e[1])<0}function zt(e,t,i){if(!e.isInfinite())return Bt(e.vertices[0].point,e.vertices[1].point,e.vertices[2].point,t,i);throw new Error("SSS")}function Bt(e,t,i,n,a){var r=Xt(e,t,i,n);if(r!==ai.ON_ORIENTED_BOUNDARY||!a)return r;var o=[e,t,i,n];o.sort(function(e,t){return e[0]-t[0]||e[1]-t[1]});var s=!0,l=!1,c=void 0;try{for(var u,h=o.reverse()[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=u.value;if(d===n)return ai.ON_NEGATIVE_SIDE;var v=Ut(e,t,n);if(d===i&&v!==ai.COLLINEAR)return v;if(v=Ut(e,n,i),d===t&&v!==ai.COLLINEAR)return v;if(v=Ut(n,t,i),d===e&&v!==ai.COLLINEAR)return v}}catch(f){l=!0,c=f}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}return ai.ON_NEGATIVE_SIDE}function Ht(e,t){return e[0]===t[0]&&e[1]===t[1]}function Gt(e,t){return e[0]<t[0]||e[0]===t[0]&&e[1]<t[1]}function Wt(e,t){return Gt(e,t)?ai.SMALLER:Ht(e,t)?ai.EQUAL:ai.LARGER}function Xt(e,t,i,n){var a=t[0]-e[0],r=t[1]-e[1],o=i[0]-e[0],s=i[1]-e[1],l=n[0]-e[0],c=n[1]-e[1],u=n[0]-t[0],h=n[1]-t[1],d=i[0]-t[0],v=i[1]-t[1],f=Ft(a*c-r*l,l*u+c*h,a*s-r*o,o*d+s*v),p=Math.abs(a),y=Math.abs(r),g=Math.abs(o),m=Math.abs(s),b=Math.abs(u),w=Math.abs(h),k=Math.abs(l),x=Math.abs(c),O=Math.abs(d),S=Math.abs(v);if(p<g&&(p=g),p<k&&(p=k),p<b&&(p=b),p<O&&(p=O),y<m&&(y=m),y<x&&(y=x),y<w&&(y=w),y<S&&(y=S),p>y){var _=[y,p];p=_[0],y=_[1]}if(p<1e-73&&0===p)return ai.ON_ORIENTED_BOUNDARY;if(y<1e76){var C=Number.EPSILON*p*y*(y*y);if(f>C)return ai.ON_POSITIVE_SIDE;if(f<-C)return ai.ON_NEGATIVE_SIDE}return ai.ZERO}function Yt(e,t,i,n){switch(Ut(e,t,i)){case ai.LEFT_TURN:return Ut(i,n,t)!==ai.RIGHT_TURN;case ai.RIGHT_TURN:return Ut(i,n,t)!==ai.LEFT_TURN;case ai.COLLINEAR:return!0}}function Kt(e,t,i,n){switch(Ut(e,t,i)){case ai.LEFT_TURN:return Ut(e,t,n)!==ai.LEFT_TURN;case ai.RIGHT_TURN:return Ut(e,t,n)!==ai.RIGHT_TURN;case ai.COLLINEAR:return!0}}function qt(e,t,i,n){var a=Zt(e,t,i,n);switch(a.intersectionType){case It.POINT:return a.point;case It.NO_INTERSECTION:return null}throw new Error("sdfgighowen")}function Qt(e,t){if(e[0]===t[0])return[1,0,-e[0]];if(e[1]===t[1])return[0,1,-e[1]];var i=t[0]-e[0],n=t[1]-e[1];return[-n,i,-i*e[1]+n*e[0]]}function Zt(e,t,i,n){if(!ei(e,t,i,n))return{intersectionType:It.NO_INTERSECTION,point:null};var a=Qt(e,t),r=Qt(i,n),o=Jt(a,r);switch(o.intersectionType){case It.POINT:return o}throw new Error("gzseuihgpib")}function Jt(e,t){var i=e[0]*t[1]-t[0]*e[1],n=e[1]*t[2]-t[1]*e[2],a=t[0]*e[2]-e[0]*t[2];return{intersectionType:It.POINT,point:[n/i,a/i]}}function ei(e,t,i,n){if(Gt(e,t)){if(Gt(i,n)){if(Gt(t,i)||Gt(n,e))return!1}else if(Gt(t,n)||Gt(i,e))return!1}else if(Gt(i,n)){if(Gt(e,i)||Gt(n,t))return!1}else if(Gt(e,n)||Gt(i,t))return!1;if(Gt(e,t))if(Gt(i,n))switch(Wt(e,i)){case ai.SMALLER:switch(Wt(t,i)){case ai.SMALLER:return!1;case ai.EQUAL:return!0;default:switch(Wt(t,n)){case ai.SMALLER:return Yt(e,t,i,n);case ai.EQUAL:return!0;default:return Kt(e,t,i,n)}}case ai.EQUAL:return!0;default:switch(Wt(n,e)){case ai.SMALLER:return!1;case ai.EQUAL:return!0;default:switch(Wt(n,t)){case ai.SMALLER:return Yt(i,n,e,t);case ai.EQUAL:return!0;default:return Kt(i,n,e,t)}}}else switch(Wt(e,n)){case ai.SMALLER:switch(Wt(t,n)){case ai.SMALLER:return!1;case ai.EQUAL:return!0;default:switch(Wt(t,i)){case ai.SMALLER:return Yt(e,t,n,i);case ai.EQUAL:return!0;default:return Kt(e,t,n,i)}}case ai.EQUAL:return!0;default:switch(Wt(i,e)){case ai.SMALLER:return!1;case ai.EQUAL:return!0;default:switch(Wt(i,t)){case ai.SMALLER:return Yt(n,i,e,t);case ai.EQUAL:return!0;default:return Kt(n,i,e,t)}}}else if(Gt(i,n))switch(Wt(t,i)){case ai.SMALLER:switch(Wt(e,i)){case ai.SMALLER:return!1;case ai.EQUAL:return!0;default:switch(Wt(e,n)){case ai.SMALLER:return Yt(t,e,i,n);case ai.EQUAL:return!0;default:return Kt(t,e,i,n)}}case ai.EQUAL:return!0;default:switch(Wt(n,t)){case ai.SMALLER:return!1;case ai.EQUAL:return!0;default:switch(Wt(n,e)){case ai.SMALLER:return Yt(i,n,t,e);case ai.EQUAL:return!0;default:return Kt(i,n,t,e)}}}else switch(Wt(t,n)){case ai.SMALLER:switch(Wt(e,n)){case ai.SMALLER:return!1;case ai.EQUAL:return!0;default:switch(Wt(e,i)){case ai.SMALLER:return Yt(t,e,n,i);case ai.EQUAL:return!0;default:return Kt(t,e,n,i)}}case ai.EQUAL:return!0;default:switch(Wt(i,t)){case ai.SMALLER:return!1;case ai.EQUAL:return!0;default:switch(Wt(i,e)){case ai.SMALLER:return Yt(n,i,t,e);case ai.EQUAL:return!0;default:return Kt(n,i,t,e)}}}}function ti(e){if(e!==e)return e;if(e===-1/0)return-Number.MAX_VALUE;if(e===1/0)return 1/0;if(e===+Number.MAX_VALUE)return 1/0;var t=e*(e<0?1-Number.EPSILON/2:1+Number.EPSILON);t===e&&(t=Number.MIN_VALUE*Number.EPSILON>0?e+Number.MIN_VALUE*Number.EPSILON:e+Number.MIN_VALUE),t===1/0&&(t=+Number.MAX_VALUE);var i=e+(t-e)/2;e<i&&i<t&&(t=i);var n=(t+e)/2;return e<n&&n<t&&(t=n),0===t?-0:t}function ii(e){return e<0?ti(e)-e:e+ti(-e)}(function(e){e[e["NO_INTERSECTION"]=0]="NO_INTERSECTION",e[e["POINT"]=1]="POINT",e[e["SEGMENT"]=2]="SEGMENT"})(It||(It={}));var ni,ai,ri,oi=-Infinity;function si(){return[oi,oi]}(function(e){e[e["NEGATIVE"]=-1]="NEGATIVE",e[e["ZERO"]=0]="ZERO",e[e["POSITIVE"]=1]="POSITIVE",e[e["RIGHT_TURN"]=-1]="RIGHT_TURN",e[e["LEFT_TURN"]=1]="LEFT_TURN",e[e["SMALLER"]=-1]="SMALLER",e[e["EQUAL"]=0]="EQUAL",e[e["LARGER"]=1]="LARGER",e[e["CLOCKWISE"]=-1]="CLOCKWISE",e[e["COUNTERCLOCKWISE"]=1]="COUNTERCLOCKWISE",e[e["COLLINEAR"]=0]="COLLINEAR",e[e["COPLANAR"]=0]="COPLANAR",e[e["DEGENERATE"]=0]="DEGENERATE",e[e["ON_NEGATIVE_SIDE"]=-1]="ON_NEGATIVE_SIDE",e[e["ON_ORIENTED_BOUNDARY"]=0]="ON_ORIENTED_BOUNDARY",e[e["ON_POSITIVE_SIDE"]=1]="ON_POSITIVE_SIDE"})(ai||(ai={})),function(e){e[e["UNDEFINED"]=-1]="UNDEFINED",e[e["VERTEX_VERTEX"]=0]="VERTEX_VERTEX",e[e["VERTEX_EDGE"]=1]="VERTEX_EDGE",e[e["EDGE_VERTEX"]=2]="EDGE_VERTEX",e[e["EDGE_EDGE"]=3]="EDGE_EDGE"}(ri||(ri={}));var li=function(){function e(){Object(y["a"])(this,e),this.vertices=[],this.neighbours=[null,null,null],this.constraints=[!1,!1,!1],this.uid=e._counter++;for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];this.vertices=i}return Object(g["a"])(e,[{key:"from",value:function(e){return this.vertices=e.vertices.slice(0,e.vertices.length),this.neighbours=e.neighbours.slice(0,e.neighbours.length),this.constraints=e.constraints.slice(0,e.constraints.length),this}},{key:"addVertex",value:function(e){void 0===e&&console.log("UNDEFINED HIERE"),this.vertices.push(e),e.triangle=this}},{key:"isConstrained",value:function(e){return this.constraints[e]}},{key:"reorient",value:function(){this.vertices=[this.vertices[1],this.vertices[0],this.vertices[2]].slice(0,this.vertices.length),this.neighbours=[this.neighbours[1],this.neighbours[0],this.neighbours[2]],this.constraints=[this.constraints[1],this.constraints[0],this.constraints[2]]}},{key:"hasVertex",value:function(e){return this.vertices.includes(e)}},{key:"indexV",value:function(e){return this.vertices.indexOf(e)}},{key:"indexT",value:function(e){return this.neighbours.indexOf(e)}},{key:"isInfinite",value:function(e){return void 0===e?this.vertices.some(function(e){return e.infinite}):this.vertices[Nt(e)].infinite||this.vertices[Dt(e)].infinite}},{key:"contains",value:function(e){var t=-this.vertices[1].point[1]*this.vertices[2].point[0]+this.vertices[0].point[1]*(-this.vertices[1].point[0]+this.vertices[2].point[0])+this.vertices[0].point[0]*(this.vertices[1].point[1]-this.vertices[2].point[1])+this.vertices[1].point[0]*this.vertices[2].point[1],i=t<0?-1:1,n=(this.vertices[0].point[1]*this.vertices[2].point[0]-this.vertices[0].point[0]*this.vertices[2].point[1]+(this.vertices[2].point[1]-this.vertices[0].point[1])*e[0]+(this.vertices[0].point[0]-this.vertices[2].point[0])*e[1])*i;if(n<0)return!1;var a=(this.vertices[0].point[0]*this.vertices[1].point[1]-this.vertices[0].point[1]*this.vertices[1].point[0]+(this.vertices[0].point[1]-this.vertices[1].point[1])*e[0]+(this.vertices[1].point[0]-this.vertices[0].point[0])*e[1])*i;return a>0&&n+a<t*i}},{key:"cwPermute",value:function(){this.vertices.push(this.vertices.shift()),this.neighbours.push(this.neighbours.shift()),this.constraints.push(this.constraints.shift())}},{key:"ccwPermute",value:function(){this.vertices.unshift(this.vertices.pop()),this.neighbours.unshift(this.neighbours.pop()),this.constraints.unshift(this.constraints.pop())}},{key:"center",get:function(){return[(this.vertices[0].point[0]+this.vertices[1].point[0]+this.vertices[2].point[0])/3,(this.vertices[0].point[1]+this.vertices[1].point[1]+this.vertices[2].point[1])/3]}},{key:"dimension",get:function(){return this.vertices.length-1}}]),e}();li._counter=0;var ci,ui=function(){function e(t){Object(y["a"])(this,e),this.infinite=!1,this.shapes=new Set,this._point=t}return Object(g["a"])(e,[{key:"getIncidentFaces",value:function(){var e=[],t=new vi(this,null);do{e.push(t.t)}while(t.next());return e}},{key:"getIncidentEdges",value:regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=new hi(this,null);case 1:return e.next=3,new pi(t.t,t.ri);case 3:if(t.valid&&t.next()){e.next=1;break}case 4:case"end":return e.stop()}},e,this)})},{key:"point",get:function(){return this._point},set:function(e){this._point=e,this.infinite=!1}}]),e}(),hi=function(){function e(t,i){if(Object(y["a"])(this,e),this.v=t,this.t=i,null===t?this.t=null:null===i&&(this.t=t.triangle),null==this.t||this.t.dimension<1)this.ri=0,this.v=null,this.t=null;else{var n=this.t.indexV(t);2===this.t.dimension?this.ri=Nt(n):this.ri=2}this._ri=this.ri,this._v=this.v,this._t=this.t}return Object(g["a"])(e,[{key:"next",value:function(){var e=this.t.indexV(this.v);return 1===this.t.dimension?this.t=this.t.neighbours[0===e?1:0]:(this.t=this.t.neighbours[Nt(e)],e=this.t.indexV(this.v),this.ri=Nt(e)),this.ri!==this._ri||this.v!==this._v||this.t!==this._t}},{key:"valid",get:function(){return null!==this.t&&null!==this.v}}]),e}(),di=function(){function e(t){if(Object(y["a"])(this,e),this.i=0,this.edge=new pi,this._es=0,this.tds=t,this.edge.second=0,t.dimension<=0)this.pos=null;else{this.pos=t.triangles[0],1===t.dimension&&(this.edge.second=2);while(null!==this.pos&&!this.associatedEdge())throw new Error("[poi");1===t.dimension&&(this._es=2)}}return Object(g["a"])(e,[{key:"next",value:function(){do{this.increment()}while(null!==this.pos&&!this.associatedEdge())}},{key:"collect",value:function(){return this.edge.first=this.pos,this.edge}},{key:"associatedEdge",value:function(){return 1===this.tds.dimension||this.tds.triangles.indexOf(this.pos)<this.tds.triangles.indexOf(this.pos.neighbours[this.edge.second])}},{key:"increment",value:function(){1===this.tds.dimension?(this.i++,this.tds.triangles.length<=this.i?this.pos=null:this.pos=this.tds.triangles[this.i]):2===this.edge.second?(this.edge.second=0,this.i++,this.tds.triangles.length<=this.i?this.pos=null:this.pos=this.tds.triangles[this.i]):this.edge.second++}},{key:"valid",get:function(){return(null!==this.pos||this._es!==this.edge.second)&&this.pos.isInfinite(this.edge.second)}}]),e}(),vi=function(){function e(t,i){Object(y["a"])(this,e),this.v=t,this.t=i,null===t?this.t=null:null===i&&(this.t=t.triangle),(null==this.t||this.t.dimension<2)&&(this.v=null,this.t=null),this._v=this.v,this._t=this.t}return Object(g["a"])(e,[{key:"setDone",value:function(){this._v=this.v,this._t=this.t}},{key:"prev",value:function(){var e=this.t.indexV(this.v);this.t=this.t.neighbours[Dt(e)]}},{key:"next",value:function(){var e=this.t.indexV(this.v);return this.t=this.t.neighbours[Nt(e)],!this.done}},{key:"valid",get:function(){return null!==this.t&&null!==this.v}},{key:"done",get:function(){return this.v===this._v&&this.t===this._t}}]),e}(),fi=function(){function e(t,i,n){Object(y["a"])(this,e),this.i=0,this.pos=null,this.s=ri.UNDEFINED,this._tr=i,this.p=t.point,this.q=n;var a=new vi(t,null),r=a.t.indexV(t),o=a.t.vertices[Dt(r)];while(t===ni||Ut(this.p,this.q,o.point)!==ai.LEFT_TURN)if(a.next(),r=a.t.indexV(t),o=a.t.vertices[Dt(r)],!a.valid)return;var s=a.t.vertices[Nt(r)],l=ai.RIGHT_TURN;while(s!==ni&&(l=Ut(this.p,this.q,s.point))===ai.LEFT_TURN)a.prev(),r=a.t.indexV(t),s=a.t.vertices[Nt(r)];if(r=a.t.indexV(t),o=a.t.vertices[Dt(r)],s===ni)switch(a.prev(),r=a.t.indexV(t),s=a.t.vertices[Nt(r)],l=Ut(this.p,this.q,s.point),l){case ai.RIGHT_TURN:case ai.COLLINEAR:a.next(),r=a.t.indexV(ni),this.pos=a.t,this.s=ri.VERTEX_VERTEX,this.i=r;break;case ai.LEFT_TURN:break}else l===ai.COLLINEAR?(this.pos=a.t,this.s=ri.VERTEX_VERTEX,this.i=Nt(r)):(this.pos=a.t,this.s=ri.VERTEX_EDGE,this.i=r)}return Object(g["a"])(e,[{key:"next",value:function(){this.increment()}},{key:"increment",value:function(){var e;if(this.s===ri.VERTEX_VERTEX||this.s===ri.EDGE_VERTEX){do{var t=this.pos.neighbours[Dt(this.i)];if(this.i=t.indexT(this.pos),this.pos=t,this.pos.vertices[this.i]===ni){e=ai.COLLINEAR,this.i=Dt(this.i);break}e=Ut(this.p,this.q,this.pos.vertices[this.i].point),this.i=Dt(this.i)}while(e===ai.LEFT_TURN);e===ai.COLLINEAR?(this.s=ri.VERTEX_VERTEX,this.i=Nt(this.i)):this.s=ri.VERTEX_EDGE}else{var i=this.pos.neighbours[this.i],n=i.indexT(this.pos);switch(this.pos=i,e=this.pos.vertices[n]===ni?ai.COLLINEAR:Ut(this.p,this.q,this.pos.vertices[n].point),e){case ai.LEFT_TURN:this.s=ri.EDGE_EDGE,this.i=Nt(n);break;case ai.RIGHT_TURN:this.s=ri.EDGE_EDGE,this.i=Dt(n);break;default:this.s=ri.EDGE_VERTEX,this.i=n}}}}]),e}(),pi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(y["a"])(this,e),this.first=null,this.second=0,this.first=t,this.second=i}return Object(g["a"])(e,[{key:"toString",value:function(){return"".concat(this.first.vertices[1===this.second?0:1].point," - ").concat(this.first.vertices[1===this.second?2:1].point)}}]),e}();(function(e){e[e["VERTEX"]=0]="VERTEX",e[e["EDGE"]=1]="EDGE",e[e["FACE"]=2]="FACE",e[e["OUTSIDE_CONVEX_HULL"]=3]="OUTSIDE_CONVEX_HULL",e[e["OUTSIDE_AFFINE_HULL"]=4]="OUTSIDE_AFFINE_HULL"})(ci||(ci={}));var yi=function(){function e(){Object(y["a"])(this,e),this.dimension=-1,this.vertices=[],this.triangles=[],this._infinite=this.createVertex(),ni=this._infinite;var t=new li;t.addVertex(this._infinite),this.triangles.push(t)}return Object(g["a"])(e,[{key:"createVertex",value:function(){var e=new ui(si());return e.infinite=!0,this.vertices.push(e),e}},{key:"deleteVertex",value:function(e){this.vertices=this.vertices.filter(function(t){return t!==e})}},{key:"createTriangle",value:function(e,t,i,n,a,r){var o=new li(e,t,i);return o.neighbours[0]=n,o.neighbours[1]=a,o.neighbours[2]=r,this.triangles.push(o),o}},{key:"createTriangle2",value:function(e,t,i,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=null===a||null===r?i.vertices[Nt(n)]:a.vertices[Dt(r)],s=new li(e.vertices[Dt(t)],i.vertices[Dt(n)],o);return e.neighbours[t]=s,i.neighbours[n]=s,null!==a&&null!==r&&(a.neighbours[r]=s),s.neighbours[0]=i,null!==a&&(s.neighbours[1]=a),s.neighbours[2]=e,this.triangles.push(s),s}},{key:"createTriangle3",value:function(e,t,i){var n=new li(e.vertices[Dt(t)],e.vertices[Nt(t)],i);return n.neighbours[2]=e,e.neighbours[t]=n,this.triangles.push(n),n}},{key:"deleteTriangle",value:function(e){this.triangles=this.triangles.filter(function(t){return t!==e})}},{key:"setAdjacency",value:function(e,t,i,n){e.neighbours[t]=i,i.neighbours[n]=e}},{key:"numberOfEdges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=0,i=0,n=new di(this);while(n.valid)n.next(),n.collect();n.collect();do{i++,n.edge.first.constraints[n.edge.second]&&t++;do{n.next(),n.collect()}while(n.valid)}while(null!==n.pos);return e?t:i}},{key:"numberOfVertices",value:function(e){return this.vertices.length-(e?0:1)}},{key:"insertDimUp",value:function(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ui,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this.createVertex();switch(this.dimension++,this.dimension){case 0:e=this.triangles[0],t=new li(a),this.triangles.push(t),this.setAdjacency(e,0,t,0),a.triangle=t;break;case 1:case 2:var r=[],o=this.triangles.slice(0,this.triangles.length),s=!0,l=!1,c=void 0;try{for(var u,h=o[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=u.value,v=(new li).from(d);this.triangles.push(v),d.vertices[this.dimension]=a,v.vertices[this.dimension]=i,this.setAdjacency(d,this.dimension,v,this.dimension),d.vertices.includes(i)&&r.push(v)}}catch(N){l=!0,c=N}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}var f=!0,p=!1,y=void 0;try{for(var g,m=o[Symbol.iterator]();!(f=(g=m.next()).done);f=!0)for(var b=g.value,w=b.neighbours[this.dimension],k=0;k<this.dimension;++k)w.neighbours[k]=b.neighbours[k].neighbours[this.dimension]}catch(N){p=!0,y=N}finally{try{f||null==m.return||m.return()}finally{if(p)throw y}}var x=0;if(1===this.dimension)n?(o[x].reorient(),x++,o[x].neighbours[1].reorient()):(o[x].neighbours[1].reorient(),x++,o[x].reorient());else{var O=!0,S=!1,_=void 0;try{for(var C,L=o[Symbol.iterator]();!(O=(C=L.next()).done);O=!0){var E=C.value;n?E.neighbours[2].reorient():E.reorient()}}catch(N){S=!0,_=N}finally{try{O||null==L.return||L.return()}finally{if(S)throw _}}}for(var I=0,j=r;I<j.length;I++){var T=j[I],M=1;T.vertices[0]===i&&(M=0),e=T.neighbours[this.dimension];var P=this.mirrorIndex(T,this.dimension);t=T.neighbours[M];var D=this.mirrorIndex(T,M);this.setAdjacency(e,P,t,D),this.deleteTriangle(T)}a.triangle=o[0];break;default:throw new Error("Dimension unknown")}return a}},{key:"mirrorIndex",value:function(e,t){if(1===e.dimension){var i=e.neighbours[t].indexV(e.vertices[0===t?1:0]);return 0===i?1:0}return Nt(e.neighbours[t].indexV(e.vertices[Nt(t)]))}},{key:"insertInFace",value:function(e){var t=this.createVertex(),i=e.vertices[0],n=e.vertices[1],a=e.vertices[2],r=e.neighbours[1],o=e.neighbours[2],s=this.createTriangle(i,t,a,e,r,null),l=this.createTriangle(i,n,t,e,null,o);if(this.setAdjacency(s,2,l,1),null!==r){var c=this.mirrorIndex(e,1);r.neighbours[c]=s}if(null!==o){var u=this.mirrorIndex(e,2);o.neighbours[u]=l}return e.vertices[0]=t,e.neighbours[1]=s,e.neighbours[2]=l,i.triangle===e&&(i.triangle=l),t.triangle=e,t}},{key:"flip",value:function(e,t){var i=e.neighbours[t],n=this.mirrorIndex(e,t),a=e.vertices[Dt(t)],r=e.vertices[Nt(t)],o=e.neighbours[Nt(t)],s=this.mirrorIndex(e,Nt(t)),l=i.neighbours[Nt(n)],c=this.mirrorIndex(i,Nt(n));e.vertices[Dt(t)]=i.vertices[n],i.vertices[Dt(n)]=e.vertices[t],this.setAdjacency(e,t,l,c),this.setAdjacency(e,Nt(t),i,Nt(n)),this.setAdjacency(i,n,o,s),a.triangle===e&&(a.triangle=i),r.triangle===i&&(r.triangle=e)}},{key:"insertInEdge",value:function(e,t){var i;if(1===this.dimension){i=this.createVertex();var n=e.neighbours[0],a=e.vertices[1],r=this.createTriangle(i,a,null,n,e,null);e.vertices[1]=i,e.neighbours[0]=r,n.neighbours[1]=r,i.triangle=r,a.triangle=n}else{var o=e.neighbours[t],s=this.mirrorIndex(e,t);i=this.insertInFace(e),this.flip(o,s)}return i}},{key:"makeHole",value:function(e,t){var i,n,a,r,o,s=[],l=new vi(e,null);do{i=l.t,l.next(),a=i.indexV(e),n=i.neighbours[a],r=n.indexT(i),o=i.vertices[Dt(a)],o.triangle=n,o=i.vertices[Nt(a)],o.triangle=n,n.neighbours[r]=null,t.push([n,r]),s.push(i)}while(!l.done);for(var c=0,u=s;c<u.length;c++){var h=u[c];this.deleteTriangle(h)}}},{key:"fillHoleDelaunay",value:function(e){var t,i,n,a,r,o,s=[];s.push(e);while(s.length>0){var l=s[0],c=void 0;if(3!==l.length){var u=!1;while(!u)i=l[0][0],r=l[0][1],i.vertices[Dt(r)].infinite||i.vertices[Nt(r)].infinite?l.push(l.shift()):u=!0;i=l[0][0],r=l[0][1],l.shift();var h=i.vertices[Dt(r)],d=i.vertices[Nt(r)],v=this._infinite,f=void 0,p=h.point,y=d.point;c=0;var g=0;while(c!==l.length-1){n=l[c][0],o=l[c][1];var m=n.vertices[Nt(o)];if(m.infinite&&v.infinite)g=c;else{var b=m.point;Ut(p,y,b)===ai.COUNTERCLOCKWISE&&(v.infinite?(v=m,f=m,g=c):Bt(p,y,f.point,b,!0)===ai.ON_POSITIVE_SIDE&&(v=m,f=m,g=c))}c++}var w=void 0;if(n=l[0][0],o=l[0][1],n.vertices[Nt(o)]===v)w=this.createTriangle2(i,r,n,o),l.shift(),l.unshift([w,1]);else{n=l[l.length-1][0],o=l[l.length-1][1];var k=n.indexV(v);if(k>=0&&k===Dt(o))w=this.createTriangle2(n,o,i,r),l.pop(),l.push([w,1]);else{w=this.createTriangle3(i,r,v);var x=[];++g;while(l[0]!==l[g--])x.push(l.shift());l.unshift([w,1]),x.unshift([w,0]),s.unshift(x)}}}else c=0,t=l[c][0],a=l[c][1],i=l[++c][0],r=l[c][1],n=l[++c][0],o=l[c][1],this.createTriangle2(t,a,i,r,n,o),s.shift()}}},{key:"removeDimDown",value:function(e){var t;switch(this.dimension){case-1:this.deleteTriangle(e.triangle);break;case 0:t=e.triangle,t.neighbours[0].neighbours[0]=null,this.deleteTriangle(e.triangle);break;case 1:case 2:var i=[],n=[],a=!0,r=!1,o=void 0;try{for(var s,l=this.triangles[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;c.hasVertex(e)?n.push(c):i.push(c)}}catch(g){r=!0,o=g}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}for(var u=0,h=n;u<h.length;u++){var d=h[u],v=d.indexV(e);1===this.dimension?(0===v&&d.reorient(),d.vertices[1]=null,d.neighbours[1]=null):(0===v?d.cwPermute():1===v&&d.ccwPermute(),d.vertices[2]=null,d.neighbours[2]=null),d.vertices[0].triangle=d}for(var f=0,p=i;f<p.length;f++){var y=p[f];this.deleteTriangle(y)}}this.deleteVertex(e),this.dimension--}},{key:"finiteVertex",get:function(){return this.vertices[1]}},{key:"finiteEdge",get:function(){if(this.dimension<1)throw new Error("aspo");var e=new di(this);while(e.valid)e.next();return e.collect()}}]),e}(),gi=function(){function e(t){Object(y["a"])(this,e),this.x1=t[0],this.y1=t[1],this.x2=t[0],this.y2=t[1]}return Object(g["a"])(e,[{key:"dilate",value:function(e){this.x1-=e*ii(this.x1),this.y1-=e*ii(this.y1),this.x2+=e*ii(this.x2),this.y2+=e*ii(this.y2)}},{key:"overlaps",value:function(e){return!(this.x2<e.x1||e.x2<this.x1)&&!(this.y2<e.y1||e.y2<this.y1)}}]),e}(),mi=function(){function e(){Object(y["a"])(this,e),this.tds=new yi}return Object(g["a"])(e,[{key:"insertConstraint",value:function(e,t){var i=this.insert(e),n=this.insert(t);return i!==n&&this.insertConstraintV(i,n),{va:i,vb:n}}},{key:"insertConstraintV",value:function(e,t){var i=[[e,t]];while(i.length>0){var n=i.pop(),a=At(n[0],n[1]);if(a.includes)this.markConstraint(a.fr,a.i),a.vi!==n[1]&&i.push([a.vi,n[1]]);else{var r=this.findIntersectedFaces(n[0],n[1]);r.found?r.vi!==n[0]&&r.vi!==n[1]?(i.push([n[0],r.vi]),i.push([r.vi,n[1]])):i.push(n):(this.triangulateHole(r.intersectedFaces,r.listAB,r.listBA),r.vi!==n[1]&&i.push([r.vi,n[1]]))}}}},{key:"triangulateHole",value:function(e,t,i){var n=[];this.triangulateHole2(e,t,i,n),this.propagatingFlipE(n)}},{key:"triangulateHole2",value:function(e,t,i,n){if(t.length>0){this.triangulateHalfHole(t,n),this.triangulateHalfHole(i,n);var a=t[0][0],r=i[0][0];a.neighbours[2]=r,r.neighbours[2]=a,a.constraints[2]=!0,r.constraints[2]=!0;while(e.length>0)this.tds.deleteTriangle(e.shift())}}},{key:"triangulateHalfHole",value:function(e,t){var i,n,a,r,o,s,l,c,u=0,h=function(){return e[u]},d=function(){return e[i]},v=h()[0].vertices[Nt(h()[1])];i=u,++i;do{r=h()[0],l=h()[1],null!==r.neighbours[l]&&(a=r.neighbours[l],s=Dt(a.indexV(r.vertices[Dt(l)])),r=a.neighbours[s],l=this.tds.mirrorIndex(a,s)),o=d()[0],c=d()[1],null!==o.neighbours[c]&&(a=o.neighbours[c],s=Dt(a.indexV(o.vertices[Dt(c)])),o=a.neighbours[s],c=this.tds.mirrorIndex(a,s));var f=r.vertices[Nt(l)],p=r.vertices[Dt(l)],y=o.vertices[Dt(c)],g=Ut(f.point,p.point,y.point);switch(g){case ai.RIGHT_TURN:var m=this.tds.createTriangle(f,y,p,null,null,null);t.push([m,2]),m.neighbours[1]=r,m.neighbours[0]=o,r.neighbours[l]=m,o.neighbours[c]=m,r.isConstrained(l)&&(m.constraints[1]=!0),o.isConstrained(c)&&(m.constraints[0]=!0),f.triangle=m,p.triangle=m,y.triangle=m,n=u+1,e.splice(u,0,[m,2]),e.splice(Math.max(n,i),1),e.splice(Math.min(n,i),1),i=u,f!==v?--u:++i;break;case ai.LEFT_TURN:case ai.COLLINEAR:++u,++i;break}}while(i<e.length)}},{key:"findIntersectedFaces",value:function(e,t){var i,n=e.point,a=t.point,r=[],o=[],s=[],l=new fi(e,this,a),c=l.pos.indexV(e);if(l.pos.isConstrained(c))return i=this.intersect(l.pos,c,e,t),{found:!0,vi:i,listAB:r,listBA:o,intersectedFaces:s};var u=l.pos.neighbours[Nt(c)],h=l.pos.neighbours[Dt(c)];r.push([u,u.indexT(l.pos)]),o.unshift([h,h.indexT(l.pos)]),s.unshift(l.pos);var d=l.pos;l.next(),c=l.pos.indexT(d);var v=l.pos.vertices[c],f=!1;while(v!==t&&!f){var p=void 0,y=void 0,g=Ut(n,a,v.point);switch(g){case ai.COLLINEAR:f=!0;break;case ai.LEFT_TURN:case ai.RIGHT_TURN:if(g===ai.LEFT_TURN?(p=Nt(c),y=Dt(c)):(p=Dt(c),y=Nt(c)),l.pos.isConstrained(p))return i=this.intersect(l.pos,p,e,t),{found:!0,vi:i,listAB:r,listBA:o,intersectedFaces:s};u=l.pos.neighbours[y],s.unshift(l.pos),g===ai.LEFT_TURN?r.push([u,u.indexT(l.pos)]):o.unshift([u,u.indexT(l.pos)]),d=l.pos,l.next(),c=l.pos.indexT(d),v=l.pos.vertices[c];break}}return i=v,s.unshift(l.pos),u=l.pos.neighbours[Dt(c)],r.push([u,u.indexT(l.pos)]),h=l.pos.neighbours[Nt(c)],o.unshift([h,h.indexT(l.pos)]),{found:!1,vi:i,listAB:r,listBA:o,intersectedFaces:s}}},{key:"intersect",value:function(e,t,i,n){var a,r=e.vertices[Dt(t)],o=e.vertices[Nt(t)],s=i.point,l=n.point,c=r.point,u=o.point,h=qt(s,l,c,u);if(h!==s&&h!==l&&h!==c&&h!==u){var d=new gi(h);d.dilate(4),d.overlaps(new gi(s))&&(h=s),d.overlaps(new gi(l))&&(h=l),d.overlaps(new gi(c))&&(h=c),d.overlaps(new gi(u))&&(h=u)}if(null===h)throw new Error("what");return this.removeConstrainedEdge(e,t),a=this.insert(h,e),a!==r&&a!==o?(this.insertConstraintV(r,a),this.insertConstraintV(a,o)):this.insertConstraintV(r,o),a}},{key:"removeVertex",value:function(e){this.tds.dimension<=1?this.removeConstrainedVertex(e):this.remove2D(e)}},{key:"removeConstrainedVertex",value:function(e){var t=this.tds.numberOfVertices(!1);1===t||2===t?this.tds.removeDimDown(e):1===this.tds.dimension?console.warn("NOT IMPLEMENTED."):this.remove2D(e)}},{key:"remove2D",value:function(e){if(this.testDimDown(e))this.tds.removeDimDown(e);else{var t=[];this.tds.makeHole(e,t);var i=[].concat(t);this.tds.fillHoleDelaunay(t),this.updateConstraints(i),this.tds.deleteVertex(e)}}},{key:"testDimDown",value:function(e){var t=!0,i=!0,n=!1,a=void 0;try{for(var r,o=this.tds.triangles[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var s=r.value;if(!s.isInfinite()&&!s.hasVertex(e)){t=!1;break}}}catch(v){n=!0,a=v}finally{try{i||null==o.return||o.return()}finally{if(n)throw a}}var l=new vi(e,null);while(l.t.isInfinite())l.next();l.setDone();var c=l.t,u=c.indexV(e),h=c.vertices[Dt(u)].point,d=c.vertices[Nt(u)].point;while(t&&l.next())u=l.t.indexV(e),l.t.vertices[Nt(u)]!==this.tds._infinite&&(t=t&&Ut(h,d,l.t.vertices[Nt(u)].point)===ai.COLLINEAR);return t}},{key:"updateConstraints",value:function(e){var t,i,n=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;t=l[0],i=l[1],t.neighbours[i].constraints[this.tds.mirrorIndex(t,i)]=t.isConstrained(i)}}catch(c){a=!0,r=c}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}}},{key:"removeConstrainedEdge",value:function(e,t){e.constraints[t]=!1,2===this.tds.dimension&&(e.neighbours[t].constraints[this.tds.mirrorIndex(e,t)]=!1)}},{key:"removeConstrainedEdgeDelaunay",value:function(e,t){if(this.removeConstrainedEdge(e,t),2===this.tds.dimension){var i=[[e,t]];this.propagatingFlipE(i)}}},{key:"updateConstraintsOpposite",value:function(e){var t,i=e.triangle,n=i;do{t=i.indexV(e),i.neighbours[t].constraints[this.tds.mirrorIndex(i,t)]?i.constraints[t]=!0:i.constraints[t]=!1,i=i.neighbours[Nt(t)]}while(i!==n)}},{key:"markConstraint",value:function(e,t){1===this.tds.dimension?e.constraints[2]=!0:(e.constraints[t]=!0,e.neighbours[t].constraints[this.tds.mirrorIndex(e,t)]=!0)}},{key:"insert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.locate(e,this.iLocate(e,t)),n=this.insertb(e,i.loc,i.lt,i.li);return this.flipAround(n),n}},{key:"flipAround",value:function(e){if(!(this.tds.dimension<=1)){var t,i,n=e.triangle,a=n;do{t=n.indexV(e),i=n.neighbours[Nt(t)],this.propagatingFlip(n,t),n=i}while(i!==a)}}},{key:"propagatingFlip",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.isFlipable(e,t)){var n=100;if(i===n)throw new Error("maxde");var a=e.neighbours[t];this.flip(e,t),this.propagatingFlip(e,t,i+1),t=a.indexV(e.vertices[t]),this.propagatingFlip(a,t,i+1)}}},{key:"lessEdge",value:function(e,t){var i=e[1],n=t[1];return e[0].uid<t[0].uid||e[0].uid===t[0].uid&&i<n}},{key:"propagatingFlipE",value:function(e){var t,i,n,a,r,o,s,l=this,c=0,u=[];while(c<e.length)t=e[c][0],i=e[c][1],this.isFlipable(t,i)&&(n=[t.neighbours[i],this.tds.mirrorIndex(t,i)],this.lessEdge(e[c],n)?u.push(e[c]):u.push(n)),++c;var h=[null,null,null,null];while(u.length>0){t=u[0][0],a=u[0][1],r=t.neighbours[a],o=this.tds.mirrorIndex(t,a),s=[t,a],u.splice(u.findIndex(function(e){return e[0]===s[0]&&e[1]===s[1]}),1),h[0]=[t,Dt(a)],h[1]=[t,Nt(a)],h[2]=[r,Dt(o)],h[3]=[r,Nt(o)];for(var d=function(){var e=f[v],t=e[0],i=e[1];n=[t.neighbours[i],l.tds.mirrorIndex(t,i)],l.lessEdge(e,n)?u.splice(u.findIndex(function(t){return t[0]===e[0]&&t[1]===e[1]}),1):u.splice(u.findIndex(function(e){return e[0]===n[0]&&e[1]===n[1]}),1)},v=0,f=h;v<f.length;v++)d();this.flip(t,a);for(var p=0,y=h;p<y.length;p++){var g=y[p],m=g[0],b=g[1];this.isFlipable(m,b)&&(n=[m.neighbours[b],this.tds.mirrorIndex(m,b)],this.lessEdge(g,n)?u.push(g):u.push(n))}}}},{key:"flip",value:function(e,t){var i=e.neighbours[t],n=this.tds.mirrorIndex(e,t),a=e.neighbours[Dt(t)],r=this.tds.mirrorIndex(e,Dt(t)),o=e.neighbours[Nt(t)],s=this.tds.mirrorIndex(e,Nt(t)),l=i.neighbours[Dt(n)],c=this.tds.mirrorIndex(i,Dt(n)),u=i.neighbours[Nt(n)],h=this.tds.mirrorIndex(i,Nt(n));this.tds.flip(e,t),e.constraints[e.indexT(i)]=!1,i.constraints[i.indexT(e)]=!1,a.neighbours[r].constraints[this.tds.mirrorIndex(a,r)]=a.constraints[r],o.neighbours[s].constraints[this.tds.mirrorIndex(o,s)]=o.constraints[s],l.neighbours[c].constraints[this.tds.mirrorIndex(l,c)]=l.constraints[c],u.neighbours[h].constraints[this.tds.mirrorIndex(u,h)]=u.constraints[h]}},{key:"isFlipable",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=e.neighbours[t];return!e.isInfinite()&&!n.isInfinite()&&(!e.constraints[t]&&zt(n,e.vertices[t].point,i)===ai.ON_POSITIVE_SIDE)}},{key:"insertb",value:function(e,t,i,n){var a,r,o=!1;i===ci.EDGE&&t.isConstrained(n)&&(o=!0,a=t.vertices[Nt(n)],r=t.vertices[Dt(n)]);var s=this.insertc(e,t,i,n);return o?this.updateConstraintsIncident(s,a,r):i!==ci.VERTEX&&this.clearConstraintsIncident(s),2===this.tds.dimension&&this.updateConstraintsOpposite(s),s}},{key:"updateConstraintsIncident",value:function(e,t,i){if(0!==this.tds.dimension)if(1===this.tds.dimension){var n=new hi(e,null);do{n.t.constraints[2]=!0}while(n.next())}else{var a=new vi(e,null);do{var r=a.t.indexV(e),o=Dt(r),s=Nt(r);a.t.vertices[o]===t||a.t.vertices[o]===i?(a.t.constraints[s]=!0,a.t.constraints[o]=!1):(a.t.constraints[s]=!1,a.t.constraints[o]=!0)}while(a.next())}}},{key:"clearConstraintsIncident",value:function(e){var t=new hi(e,null);if(t.valid)do{var i=t.t,n=t.ri;i.constraints[n]=!1,2===this.tds.dimension&&(i.neighbours[n].constraints[this.tds.mirrorIndex(i,n)]=!1)}while(t.next())}},{key:"insertc",value:function(e,t,i,n){if(1===this.tds.vertices.length)return this.insertFirst(e);if(2===this.tds.vertices.length)return i===ci.VERTEX?this.tds.finiteVertex:this.insertSecond(e);switch(i){case ci.VERTEX:return t.vertices[n];case ci.OUTSIDE_AFFINE_HULL:return this.insertOutsideAffineHull(e);case ci.OUTSIDE_CONVEX_HULL:return this.insertOutsideConvexHull(e,t);case ci.EDGE:return this.insertInEdge(e,t,n);case ci.FACE:return this.insertInFace(e,t)}throw new Error("qwe")}},{key:"insertInEdge",value:function(e,t,i){var n=this.tds.insertInEdge(t,i);return n.point=e,n}},{key:"insertInFace",value:function(e,t){var i=this.tds.insertInFace(t);return i.point=e,i}},{key:"insertFirst",value:function(e){var t=this.tds.insertDimUp();return t.point=e,t}},{key:"insertSecond",value:function(e){var t=this.tds.insertDimUp(this.tds._infinite,!0);return t.point=e,t}},{key:"insertOutsideAffineHull",value:function(e){var t=!1;if(1===this.tds.dimension){var i=this.tds.finiteEdge.first,n=Ut(i.vertices[0].point,i.vertices[1].point,e);t=n===ai.COUNTERCLOCKWISE}var a=this.tds.insertDimUp(this.tds._infinite,t);return a.point=e,a}},{key:"insertOutsideConvexHull",value:function(e,t){var i;if(1===this.tds.dimension)throw new Error("sdfasdasd");return i=this.insertOutsideConvexHull2(e,t),i.point=e,i}},{key:"insertOutsideConvexHull2",value:function(e,t){var i=t.indexV(this.tds._infinite),n=[],a=[],r=new vi(this.tds._infinite,t),o=!1;while(!o){r.prev(),i=r.t.indexV(this.tds._infinite);var s=r.t.vertices[Nt(i)].point,l=r.t.vertices[Dt(i)].point;Ut(e,s,l)===ai.LEFT_TURN?n.push(r.t):o=!0}r=new vi(this.tds._infinite,t),o=!1;while(!o){r.next(),i=r.t.indexV(this.tds._infinite);var c=r.t.vertices[Nt(i)].point,u=r.t.vertices[Dt(i)].point;Ut(e,c,u)===ai.LEFT_TURN?a.push(r.t):o=!0}var h,d=this.tds.insertInFace(t);d.point=e;while(n.length>0)h=n[0],i=Nt(h.indexV(this.tds._infinite)),this.tds.flip(h,i),n.shift();while(a.length>0)h=a[0],i=Dt(h.indexV(this.tds._infinite)),this.tds.flip(h,i),a.shift();r=new vi(d,null);while(!r.t.isInfinite())r.next();return this.tds._infinite.triangle=r.t,d}},{key:"locate",value:function(e,t){var i=0,n=0;if(this.tds.dimension<0)return i=ci.OUTSIDE_AFFINE_HULL,n=4,{loc:null,lt:i,li:n};if(0===this.tds.dimension)return i=Ht(e,this.tds.finiteVertex.triangle.vertices[0].point)?ci.VERTEX:ci.OUTSIDE_AFFINE_HULL,n=4,{loc:null,lt:i,li:n};if(1===this.tds.dimension)return this.marchLocate1D(e);if(null===t){var a=this.tds._infinite.triangle;t=a.neighbours[a.indexV(this.tds._infinite)]}else t.isInfinite()&&(t=t.neighbours[t.indexV(this.tds._infinite)]);return this.marchLocate2D(t,e)}},{key:"marchLocate1D",value:function(e){var t=this.tds._infinite.triangle,i=t.indexV(this.tds._infinite),n=t.neighbours[i],a=Ut(n.vertices[0].point,n.vertices[1].point,e);if(a===ai.RIGHT_TURN||a===ai.LEFT_TURN)return{loc:new li,lt:ci.OUTSIDE_AFFINE_HULL,li:4};var r=n.indexT(t);if(Rt(e,n.vertices[1-r].point,n.vertices[r].point))return{loc:t,lt:ci.OUTSIDE_CONVEX_HULL,li:i};if(Ht(e,n.vertices[1-r].point))return{loc:n,lt:ci.VERTEX,li:1-r};throw new Error("sdfsdf")}},{key:"marchLocate2D",value:function(e,t){var i,n,a=null,r=!0;while(1){if(e.isInfinite())return{loc:e,lt:ci.OUTSIDE_CONVEX_HULL,li:e.indexV(this.tds._infinite)};var o=0,s=e.vertices[0].point,l=e.vertices[1].point,c=e.vertices[2].point,u=void 0,h=void 0,d=void 0;if(r){if(a=e,r=!1,u=Ut(s,l,t),u===ai.NEGATIVE){e=e.neighbours[2];continue}if(h=Ut(l,c,t),h===ai.NEGATIVE){e=e.neighbours[0];continue}if(d=Ut(c,s,t),d===ai.NEGATIVE){e=e.neighbours[1];continue}}else if(o)if(e.neighbours[0]===a){if(a=e,u=Ut(s,l,t),u===ai.NEGATIVE){e=e.neighbours[2];continue}if(d=Ut(c,s,t),d===ai.NEGATIVE){e=e.neighbours[1];continue}h=ai.POSITIVE}else if(e.neighbours[1]===a){if(a=e,h=Ut(l,c,t),h===ai.NEGATIVE){e=e.neighbours[0];continue}if(u=Ut(s,l,t),u===ai.NEGATIVE){e=e.neighbours[2];continue}d=ai.POSITIVE}else{if(a=e,d=Ut(c,s,t),d===ai.NEGATIVE){e=e.neighbours[1];continue}if(h=Ut(l,c,t),h===ai.NEGATIVE){e=e.neighbours[0];continue}u=ai.POSITIVE}else if(e.neighbours[0]===a){if(a=e,d=Ut(c,s,t),d===ai.NEGATIVE){e=e.neighbours[1];continue}if(u=Ut(s,l,t),u===ai.NEGATIVE){e=e.neighbours[2];continue}h=ai.POSITIVE}else if(e.neighbours[1]===a){if(a=e,u=Ut(s,l,t),u===ai.NEGATIVE){e=e.neighbours[2];continue}if(h=Ut(l,c,t),h===ai.NEGATIVE){e=e.neighbours[0];continue}d=ai.POSITIVE}else{if(a=e,h=Ut(l,c,t),h===ai.NEGATIVE){e=e.neighbours[0];continue}if(d=Ut(c,s,t),d===ai.NEGATIVE){e=e.neighbours[1];continue}u=ai.POSITIVE}var v=(u===ai.COLLINEAR?1:0)+(h===ai.COLLINEAR?1:0)+(d===ai.COLLINEAR?1:0);switch(v){case 0:i=ci.FACE,n=4;break;case 1:i=ci.EDGE,n=u===ai.COLLINEAR?2:h===ai.COLLINEAR?0:1;break;case 2:i=ci.VERTEX,n=u!==ai.COLLINEAR?2:h!==ai.COLLINEAR?0:1;break}if(void 0===i||void 0===n)throw new Error("ert");return{loc:e,lt:i,li:n}}}},{key:"iLocate",value:function(e,t){if(this.tds.dimension<2)return t;if(null===t){var i=this.tds._infinite.triangle;t=i.neighbours[i.indexV(this.tds._infinite)]}else t.isInfinite()&&(t=t.neighbours[t.indexV(this.tds._infinite)]);var n=null,a=t,r=!0,o=2500;while(1){if(!o--)return a;if(a.isInfinite())return a;var s=a.vertices[0].point,l=a.vertices[1].point,c=a.vertices[2].point;if(r){if(n=a,r=!1,$t(s,l,e)){a=a.neighbours[2];continue}if($t(l,c,e)){a=a.neighbours[0];continue}if($t(c,s,e)){a=a.neighbours[1];continue}}else if(a.neighbours[0]===n){if(n=a,$t(s,l,e)){a=a.neighbours[2];continue}if($t(c,s,e)){a=a.neighbours[1];continue}}else if(a.neighbours[1]===n){if(n=a,$t(s,l,e)){a=a.neighbours[2];continue}if($t(l,c,e)){a=a.neighbours[0];continue}}else{if(n=a,$t(c,s,e)){a=a.neighbours[1];continue}if($t(l,c,e)){a=a.neighbours[0];continue}}break}return a}}]),e}(),bi=function e(t,i){Object(y["a"])(this,e),this.children=[],this.nPrimitives=t,this.bbox=i},wi=function(e){function t(e,i,n){var a;return Object(y["a"])(this,t),a=Object(m["a"])(this,Object(b["a"])(t).call(this,i,n)),a.firstPrimOffset=e,a}return Object(w["a"])(t,e),t}(bi),ki=function(e){function t(e,i,n){var a;return Object(y["a"])(this,t),a=Object(m["a"])(this,Object(b["a"])(t).call(this,0,i.bbox.union(n.bbox))),a.dimension=e,a.children.push(i),a.children.push(n),a}return Object(w["a"])(t,e),t}(bi),xi=function(){function e(t){if(Object(y["a"])(this,e),this.totalNodes=0,this.buildData=[],this.orderedPrims=[],this.nodes=[],this.offset=0,this.shapes=t,0===this.shapes.length)return this.root=null,void(this.nodes=[]);for(var i=0;i<t.length;i++){var n=Et.UUIDMap.get(t[i]);this.buildData.push({index:i,bbox:n.getBoundingBox(),center:new jt(n.center(),0,0)})}this.root=this.recursiveBuild(0,t.length),this.compact()}return Object(g["a"])(e,[{key:"draw",value:function(){var e=Et.getLayer("draw").ctx,t=!0,i=!1,n=void 0;try{for(var a,r=this.nodes[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value,s=o.bbox;e.strokeRect(dt(s.topLeft.x),vt(s.topLeft.y),ft(s.w),ft(s.h))}}catch(l){i=!0,n=l}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}},{key:"recursiveBuild",value:function(e,t){this.totalNodes++;for(var i=this.buildData[e].bbox,n=e+1;n<t;n++)i=i.union(this.buildData[n].bbox);var a=t-e;if(1===a)return this.createLeaf(e,t,a,i);for(var r,o=this.buildData[e].center,s=e;s<t;s++)o=o.union(this.buildData[s].center);var l=o.getMaxExtent();if(o.botRight.get(l)===o.topLeft.get(l))return this.createLeaf(e,t,a,i);var c=.5*(o.topLeft.get(l)+o.botRight.get(l)),u=pe(this.buildData.slice(e,t),function(e){return e.center.center().get(l)<c}),h=[].concat.apply([],u);0!==u[0].length&&0!==u[1].length||console.log("EMPTY"),(r=this.buildData).splice.apply(r,[e,h.length].concat(Object(p["a"])(h)));var d=u[0].length+e;return new ki(l,this.recursiveBuild(e,d),this.recursiveBuild(d,t))}},{key:"intersect",value:function(e,t){if(0===this.nodes.length)return{hit:!1,intersect:e.get(0),tMin:0,tMax:e.tMax};void 0===t&&(t=!1);var i=!1,n=0,a=e.tMax,r=0,o=0,s=[],l=e.direction.inverse(),c=[l.x<0,l.y<0];while(1){var u=this.nodes[o],h=u.bbox.intersectP(e,l,c);if(h.hit)if(u.nPrimitives>0){if(i=!0,n=e.tMax=h.min,a=h.max,0===r||t)break;o=s[--r]}else c[u.dimension]?(s[r++]=o+1,o=u.secondChildOffset):(s[r++]=u.secondChildOffset,o++);else{if(0===r)break;o=s[--r]}}return{hit:i,intersect:e.get(n),tMin:n,tMax:a}}},{key:"compact",value:function(){this.offset=0,null!==this.root&&this.flatten(this.root)}},{key:"flatten",value:function(e){var t=this.offset,i=this.offset++;if(0===e.nPrimitives){this.flatten(e.children[0]);var n=this.flatten(e.children[1]),a={bbox:e.bbox,dimension:e.dimension,nPrimitives:0,secondChildOffset:n};this.nodes[t]=a}else{var r={bbox:e.bbox,primitivesOffset:e.firstPrimOffset,nPrimitives:e.nPrimitives};this.nodes[t]=r}return i}},{key:"createLeaf",value:function(e,t,i,n){for(var a=this.orderedPrims.length,r=e;r<t;r++)this.orderedPrims.push(this.shapes[this.buildData[r].index]);return new wi(a,i,n)}}]),e}(),Oi=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.BV=Object.freeze(new xi([])),e.visionMode="bvh",e.visionBlockers=[],e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"setVisionMode",value:function(e){this.visionMode=e.mode,e.sync&&Je.emit("Location.Options.Set",{vision_mode:e.mode})}},{key:"recalculateVision",value:function(){"triangle"===this.visionMode?Li(Si.VISION):this.BV=Object.freeze(new xi(this.visionBlockers))}},{key:"recalculateMovement",value:function(){"triangle"===this.visionMode&&Li(Si.MOVEMENT)}},{key:"deleteFromTriag",value:function(e){"triangle"===this.visionMode?Ii(e.target,e.vertices):e.standalone&&this.recalculateVision()}},{key:"addToTriag",value:function(e){"triangle"===this.visionMode?ji(e.target,e.points):this.recalculateVision()}},{key:"clear",value:function(){this.context.state.visionBlockers=[],this.context.commit("recalculateVision"),this.context.commit("recalculateMovement")}}]),t}(D["d"]);k["a"]([D["c"]],Oi.prototype,"setVisionMode",null),k["a"]([D["c"]],Oi.prototype,"recalculateVision",null),k["a"]([D["c"]],Oi.prototype,"recalculateMovement",null),k["a"]([D["c"]],Oi.prototype,"deleteFromTriag",null),k["a"]([D["c"]],Oi.prototype,"addToTriag",null),k["a"]([D["a"]],Oi.prototype,"clear",null),Oi=k["a"]([Object(D["b"])({dynamic:!0,store:A,name:"visibility",namespaced:!0})],Oi);var Si,_i=Object(D["e"])(Oi);(function(e){e["VISION"]="vision",e["MOVEMENT"]="movement"})(Si||(Si={}));var Ci={vision:new mi,movement:new mi};function Li(e){console.warn("RETRIANGULATING ".concat(e)),console.time("TRI");var t,i=new mi;t="vision"===e?_i.visionBlockers:Ct.movementblockers;var n=!0,a=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)for(var l=o.value,c=Et.UUIDMap.get(l),u=0;u<c.points.length;u++){var h=c.points[u],d=c.points[(u+1)%c.points.length],v=i.insertConstraint(h,d),f=v.va,p=v.vb;f.shapes.add(c),p.shapes.add(c),c.addTriagVertices(f,p)}}catch(y){a=!0,r=y}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}i.insertConstraint([-1e8,-1e8],[-1e8,1e8]),i.insertConstraint([-1e8,1e8],[-1e11,1e8]),i.insertConstraint([-1e11,1e8],[-1e11,-1e8]),i.insertConstraint([-1e11,-1e8],[-1e8,-1e8]),i.insertConstraint([-1e8,-1e8],[1e8,-1e8]),i.insertConstraint([1e8,-1e8],[1e8,-1e11]),i.insertConstraint([1e8,-1e11],[-1e8,-1e11]),i.insertConstraint([-1e8,-1e11],[-1e8,-1e8]),i.insertConstraint([1e8,-1e8],[1e8,1e8]),i.insertConstraint([1e8,1e8],[1e11,1e8]),i.insertConstraint([1e11,1e8],[1e11,-1e8]),i.insertConstraint([1e11,-1e8],[1e8,-1e8]),i.insertConstraint([-1e8,1e8],[1e8,1e8]),i.insertConstraint([1e8,1e8],[1e8,1e11]),i.insertConstraint([1e8,1e11],[-1e8,1e11]),i.insertConstraint([-1e8,1e11],[-1e8,1e8]),Ci[e]=i,window.CDT=Ci,console.timeEnd("TRI")}function Ei(e,t,i,n,a){var r=e.shapes.size>=(a?2:1);r||n.newConstraints.some(function(t){return t.includes(e)})||n.vertices.add(e);var o=Object(p["a"])(e.getIncidentEdges()).filter(function(e){return e.first.constraints[e.second]}),s=[],l=null,c=!0,u=!1,h=void 0;try{for(var d,v=o[Symbol.iterator]();!(c=(d=v.next()).done);c=!0){var f=d.value,y=f.first.vertices[Nt(f.second)],g=y.point,m=y.shapes.size>(y===i?1:0);if(St(g,i.point))m||n.edges.push(f);else{if(St(g,t.point))continue;if(Rt(e.point,g,i.point))null!==l&&console.warn("Multiple collinear vertices found?"),m||n.edges.push(f),l=y;else if(m||3!==o.length){if((!r||!m)&&4===o.length)if(n.edges.push(f),n.vertices.has(y))for(var b=n.newConstraints.length-1;b>=0;b--){var w=Object(Tt["a"])(n.newConstraints[b],2),k=w[0],x=w[1];if(k===e||x===e){var O=n.newConstraints.splice(b,1)[0];s=[].concat(Object(p["a"])(s),Object(p["a"])(O.filter(function(t){return t!==e}))),n.vertices.add(e)}}else n.triBridge.includes(y)?s.push(n.triBridge.pop()):s.push(y)}else n.edges.push(f),0===n.triBridge.length?n.triBridge.push(a?y:e):n.newConstraints.push([n.triBridge.pop(),a?y:e])}}}catch(S){u=!0,h=S}finally{try{c||null==v.return||v.return()}finally{if(u)throw h}}return 3!==o.length&&4!==o.length||1!==s.length||1!==n.triBridge.length?4===o.length&&s.length>0&&n.newConstraints.push(s):n.newConstraints.push([s.pop(),n.triBridge.pop()]),null===l?e:Ei(l,e,i,n,!1)}function Ii(e,t){console.time("DS");var i=Ci[e],n={vertices:new Set,edges:[],newConstraints:[],triBridge:[]},a=t.length,r=t[a-1],o=!0,s=!1,l=void 0;try{for(var c,u=t.entries()[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var h=Object(Tt["a"])(c.value,2),d=h[0],v=h[1],f=t[(d+1)%a];r=Ei(v,r,f,n,!0)}}catch(D){s=!0,l=D}finally{try{o||null==u.return||u.return()}finally{if(s)throw l}}n.triBridge.length>0&&n.newConstraints.push([n.triBridge.pop(),t[0]]);var p=!0,y=!1,g=void 0;try{for(var m,b=n.edges[Symbol.iterator]();!(p=(m=b.next()).done);p=!0){var w=m.value;i.removeConstrainedEdgeDelaunay(w.first,w.second)}}catch(D){y=!0,g=D}finally{try{p||null==b.return||b.return()}finally{if(y)throw g}}var k=!0,x=!1,O=void 0;try{for(var S,_=n.vertices[Symbol.iterator]();!(k=(S=_.next()).done);k=!0){v=S.value;i.removeVertex(v)}}catch(D){x=!0,O=D}finally{try{k||null==_.return||_.return()}finally{if(x)throw O}}var C=!0,L=!1,E=void 0;try{for(var I,j=n.newConstraints[Symbol.iterator]();!(C=(I=j.next()).done);C=!0){var T=Object(Tt["a"])(I.value,2),M=T[0],P=T[1];i.insertConstraintV(M,P)}}catch(D){L=!0,E=D}finally{try{C||null==j.return||j.return()}finally{if(L)throw E}}console.timeEnd("DS")}function ji(e,t){}var Ti=function(){function e(t,i,n,a){Object(y["a"])(this,e),this.fillColour="#000",this.strokeColour="rgba(0,0,0,0)",this.name="Unknown shape",this.nameVisible=!0,this.trackers=[],this.auras=[],this.labels=[],this._owners=[],this._triagVertices=[],this.visionObstruction=!1,this.movementObstruction=!1,this.isToken=!1,this.showHighlight=!1,this.annotation="",this.globalCompositeOperation="source-over",this.options=new Map,this._refPoint=t,this.uuid=a||ve(),void 0!==i&&(this.fillColour=i),void 0!==n&&(this.strokeColour=n)}return Object(g["a"])(e,[{key:"visibleInCanvas",value:function(e){return!1}},{key:"getPointIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!0,n=!1,a=void 0;try{for(var r,o=this.points.entries()[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var s=Object(Tt["a"])(r.value,2),l=s[0],c=s[1];if(Math.abs(e.x-c[0])<=t&&Math.abs(e.y-c[1])<=t)return l}}catch(u){n=!0,a=u}finally{try{i||null==o.return||o.return()}finally{if(n)throw a}}return-1}},{key:"getPointOrientation",value:function(e){var t=at.fromArray(this.points[(this.points.length+e-1)%this.points.length]),i=at.fromArray(this.points[e]),n=at.fromArray(this.points[(e+1)%this.points.length]),a=n.subtract(t),r=t.add(a.multiply(.5));return i.subtract(r).normalize()}},{key:"invalidate",value:function(e){var t=Et.getLayer(this.layer);t&&t.invalidate(e)}},{key:"checkVisionSources",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!1,i=this,n=_i.visionBlockers.indexOf(this.uuid);this.visionObstruction&&-1===n?(_i.visionBlockers.push(this.uuid),e&&(_i.addToTriag({target:Si.VISION,points:this.points}),t=!0)):!this.visionObstruction&&n>=0&&(_i.visionBlockers.splice(n,1),e&&(_i.deleteFromTriag({target:Si.VISION,vertices:this.triagVertices,standalone:!0}),t=!0)),this.auras.forEach(function(e){var t=Ct.visionSources,n=t.findIndex(function(t){return t.aura===e.uuid});e.visionSource&&-1===n?t.push({shape:i.uuid,aura:e.uuid}):!e.visionSource&&n>=0&&t.splice(n,1)});for(var a=function(e){var t=Ct.visionSources[e];t.shape===i.uuid&&(i.auras.some(function(e){return e.uuid===t.aura&&e.visionSource})||Ct.visionSources.splice(e,1))},r=Ct.visionSources.length-1;r>=0;r--)a(r);return t}},{key:"setMovementBlock",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.movementObstruction=e||!1;var i=Ct.movementblockers.indexOf(this.uuid),n=!1;return this.movementObstruction&&-1===i?(Ct.movementblockers.push(this.uuid),t&&(_i.addToTriag({target:Si.MOVEMENT,points:this.points}),n=!0)):!this.movementObstruction&&i>=0&&(Ct.movementblockers.splice(i,1),t&&(_i.deleteFromTriag({target:Si.MOVEMENT,vertices:this.triagVertices,standalone:!0}),n=!0)),n}},{key:"setIsToken",value:function(e){if(this.isToken=e,this.ownedBy()){var t=Ct.ownedtokens.indexOf(this.uuid);this.isToken&&-1===t?Ct.ownedtokens.push(this.uuid):!this.isToken&&t>=0&&Ct.ownedtokens.splice(t,1)}}},{key:"getBaseDict",value:function(){return{type_:this.type,uuid:this.uuid,x:this.refPoint.x,y:this.refPoint.y,layer:this.layer,draw_operator:this.globalCompositeOperation,movement_obstruction:this.movementObstruction,vision_obstruction:this.visionObstruction,auras:Pt(this.auras),trackers:this.trackers,labels:this.labels,owners:this._owners,fill_colour:this.fillColour,stroke_colour:this.strokeColour,name:this.name,name_visible:this.nameVisible,annotation:this.annotation,is_token:this.isToken,options:JSON.stringify(Object(p["a"])(this.options))}}},{key:"fromDict",value:function(e){this.layer=e.layer,this.globalCompositeOperation=e.draw_operator,this.movementObstruction=e.movement_obstruction,this.visionObstruction=e.vision_obstruction,this.auras=Mt(e.auras),this.trackers=e.trackers,this.labels=e.labels,this._owners=e.owners,this.isToken=e.is_token,this.nameVisible=e.name_visible,e.annotation&&(this.annotation=e.annotation),e.name&&(this.name=e.name),e.options&&(this.options=new Map(JSON.parse(e.options)))}},{key:"draw",value:function(e){if(void 0!==this.globalCompositeOperation?e.globalCompositeOperation=this.globalCompositeOperation:e.globalCompositeOperation="source-over",this.showHighlight){var t=this.getBoundingBox();e.strokeStyle="red",e.strokeRect(dt(t.topLeft.x)-5,vt(t.topLeft.y)-5,ft(t.w)+10,ft(t.h)+10)}}},{key:"drawAuras",value:function(e){var t=!0,i=!1,n=void 0;try{for(var a,r=this.auras[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;if(0===o.value&&0===o.dim)return;e.beginPath();var s=ht(this.center()),l=yt(o.value+o.dim);if(0===o.dim)e.fillStyle=o.colour;else{var c=e.createRadialGradient(s.x,s.y,yt(o.value),s.x,s.y,yt(o.value+o.dim)),u=ct()(o.colour);e.fillStyle=c,c.addColorStop(0,o.colour),c.addColorStop(1,u.setAlpha(0).toRgbString())}if(o.visionSource&&void 0!==o.lastPath)try{e.fill(o.lastPath)}catch(h){e.arc(s.x,s.y,l,0,2*Math.PI),e.fill(),console.warn(h)}else e.arc(s.x,s.y,l,0,2*Math.PI),e.fill()}}catch(d){i=!0,n=d}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}},{key:"getInitiativeRepr",value:function(){return{uuid:this.uuid,visible:!Ct.IS_DM,group:!1,source:this.name,has_img:!1,effects:[],index:1/0}}},{key:"moveLayer",value:function(e,t){var i=Et.getLayer(this.layer),n=Et.getLayer(e);void 0!==i&&void 0!==n&&(this.layer=e,i.shapes.splice(i.shapes.indexOf(this),1),n.shapes.push(this),i.invalidate(!0),n.invalidate(!1),t&&Je.emit("Shape.Layer.Change",{uuid:this.uuid,layer:e}))}},{key:"ownedBy",value:function(e){return void 0===e&&(e=Ct.username),Ct.IS_DM||this._owners.includes(e)||Ct.FAKE_PLAYER&&Ct.activeTokens.includes(this.uuid)}},{key:"addOwner",value:function(e){this._owners.includes(e)||this._owners.push(e)}},{key:"updateOwner",value:function(e,t){var i=this._owners.findIndex(function(t){return t===e});i>=0?this._owners.splice(i,1,t):this.addOwner(t)}},{key:"removeOwner",value:function(e){var t=this._owners.findIndex(function(t){return t===e});this._owners.splice(t,1)}},{key:"addTriagVertices",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(var n=0,a=t;n<a.length;n++){var r=a[n];this._triagVertices.includes(r)||this._triagVertices.push(r)}}},{key:"removeTriagVertices",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this._triagVertices=this._triagVertices.filter(function(e){return!t.includes(e)})}},{key:"refPoint",get:function(){return this._refPoint},set:function(e){this._refPoint=e}},{key:"owners",get:function(){return Object.freeze(this._owners.slice())}},{key:"triagVertices",get:function(){return Object(p["a"])(this._triagVertices)}}]),e}();function Mi(e,t,i){if(0===e.x&&0===e.y)return e;if("bvh"===_i.visionMode){void 0===i&&(i=[]);var n=t.getBoundingBox(),a=n.offset(e),r=!1,o=!0,s=!1,l=void 0;try{for(var c,u=Ct.movementblockers[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var h=c.value;if(!i.includes(h)){var d=Et.UUIDMap.get(h),v=d.getBoundingBox(),f=v.intersectsWithInner(a);if(!f){var p=st.fromPoints(n.topLeft.add(e.normalize()),a.topLeft),y=p.direction.inverse(),g=[y.x<0,y.y<0];f=v.intersectP(p,y,g).hit}if(f){var m=v.center(),b=n.center(),w=b.subtract(m),k=new ot(1,0),x=new ot(0,1),O=w.dot(k),S=w.dot(x);O>v.w/2&&(O=v.w/2),O<-v.w/2&&(O=-v.w/2),S>v.h/2&&(S=v.h/2),S<-v.h/2&&(S=-v.h/2);var _=m.add(k.multiply(O)).add(x.multiply(S));_.x===n.topLeft.x||_.x===n.topRight.x?e=new ot(0,e.y):_.y===n.topLeft.y||_.y===n.botLeft.y?e=new ot(e.x,0):_.x<n.topLeft.x?e=new ot(_.x-n.topLeft.x,e.y):_.x>n.topRight.x?e=new ot(_.x-n.topRight.x,e.y):_.y<n.topLeft.y?e=new ot(e.x,_.y-n.topLeft.y):_.y>n.botLeft.y&&(e=new ot(e.x,_.y-n.botLeft.y)),r=!0,i.push(h);break}}}}catch(N){s=!0,l=N}finally{try{o||null==u.return||u.return()}finally{if(s)throw l}}return r&&(e=Mi(e,t,i)),e}var C=Ci.movement.locate(t.center().asArray(),null).loc,L=!0,E=!1,I=void 0;try{for(var j,T=t.points[Symbol.iterator]();!(L=(j=T.next()).done);L=!0){var M=j.value,P=Ci.movement.locate(M,C),D=P.loc;null!==D&&(e=Pi(M,D,e))}}catch(N){E=!0,I=N}finally{try{L||null==T.return||T.return()}finally{if(E)throw I}}return e}function Pi(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=new at(e[0],e[1]),r=a.add(i).asArray();if(t.contains(r))return i;n.push(t);for(var o=0;o<3;o++)if(!n.includes(t.neighbours[o])){var s=t.vertices[Dt(o)].point,l=t.vertices[Nt(o)].point,c=qt(e,r,s,l);if(null!==c){if(!t.isConstrained(o))return Pi(e,t.neighbours[o],i,n);if(c[0]===a.x&&c[1]===a.y){var u=Ut(e,r,l);if(u===ai.LEFT_TURN)continue;if(u===ai.ZERO)continue}var h=new at(c[0],c[1]).subtract(a).multiply(.8);h.length()<1&&(h=new ot(0,0)),h.length()<i.length()&&(i=h)}}return i}var Di=function(e){function t(e,i,n,a,r,o){var s;return Object(y["a"])(this,t),s=Object(m["a"])(this,Object(b["a"])(t).call(this,e,a,r,o)),s.w=i,s.h=n,s}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"getBaseDict",value:function(){return Object.assign(Object(it["a"])(Object(b["a"])(t.prototype),"getBaseDict",this).call(this),{width:this.w,height:this.h})}},{key:"getBoundingBox",value:function(){return new jt(this.refPoint,this.w,this.h)}},{key:"contains",value:function(e){return this.refPoint.x<=e.x&&this.refPoint.x+this.w>=e.x&&this.refPoint.y<=e.y&&this.refPoint.y+this.h>=e.y}},{key:"center",value:function(e){if(void 0===e)return this.refPoint.add(new ot(this.w/2,this.h/2));this.refPoint=new at(e.x-this.w/2,e.y-this.h/2)}},{key:"visibleInCanvas",value:function(e){if(Object(it["a"])(Object(b["a"])(t.prototype),"visibleInCanvas",this).call(this,e))return!0;var i=!(dt(this.refPoint.x)>e.width||vt(this.refPoint.y)>e.height||dt(this.refPoint.x+this.w)<0||vt(this.refPoint.y+this.h)<0);return!!i}},{key:"snapToGrid",value:function(){var e,t,i=Ct.gridSize,n=this.center(),a=n.x,r=n.y;e=this.w/i%2===0?Math.round(a/i)*i-this.w/2:(Math.round((a+i/2)/i)-.5)*i-this.w/2,t=this.h/i%2===0?Math.round(r/i)*i-this.h/2:(Math.round((r+i/2)/i)-.5)*i-this.h/2;var o=Mi(new ot(e-this.refPoint.x,t-this.refPoint.y),this);this.refPoint=this.refPoint.add(o),this.invalidate(!1)}},{key:"resizeToGrid",value:function(){var e=Ct.gridSize;this.refPoint=new at(Math.round(this.refPoint.x/e)*e,Math.round(this.refPoint.y/e)*e),this.w=Math.max(Math.round(this.w/e)*e,e),this.h=Math.max(Math.round(this.h/e)*e,e),this.invalidate(!1)}},{key:"resize",value:function(e,t){var i=Ct.zoomFactor;switch(e){case 0:this.w=dt(this.refPoint.x)+this.w*i-t.x,this.h=vt(this.refPoint.y)+this.h*i-t.y,this.refPoint=gt(t);break;case 1:this.w=dt(this.refPoint.x)+this.w*i-t.x,this.h=t.y-vt(this.refPoint.y),this.refPoint=new at(mt(t.x),this.refPoint.y);break;case 2:this.w=t.x-dt(this.refPoint.x),this.h=t.y-vt(this.refPoint.y);break;case 3:this.w=t.x-dt(this.refPoint.x),this.h=vt(this.refPoint.y)+this.h*i-t.y,this.refPoint=new at(this.refPoint.x,bt(t.y));break}this.w/=i,this.h/=i,this.w<0&&(this.refPoint=this.refPoint.add(new ot(this.w,0)),this.w=Math.abs(this.w)),this.h<0&&(this.refPoint=this.refPoint.add(new ot(0,this.h)),this.h=Math.abs(this.h))}},{key:"points",get:function(){if(0===this.w||0===this.h)return[[this.refPoint.x,this.refPoint.y]];var e=this.refPoint.add(new ot(0,this.h)),t=this.refPoint.add(new ot(this.w,this.h)),i=this.refPoint.add(new ot(this.w,0));return[[this.refPoint.x,this.refPoint.y],[e.x,e.y],[t.x,t.y],[i.x,i.y]]}}]),t}(Ti),Ni=function(e){function t(e,i,n,a,r){var o;return Object(y["a"])(this,t),o=Object(m["a"])(this,Object(b["a"])(t).call(this,i,n,a,void 0,void 0,r)),o.type="assetrect",o.src="",o.img=e,o}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{src:this.src})}},{key:"fromDict",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this.src=e.src}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e);try{e.drawImage(this.img,dt(this.refPoint.x),vt(this.refPoint.y),ft(this.w),ft(this.h))}catch(i){console.warn("Shape ".concat(this.uuid," could not load the image ").concat(this.src))}}},{key:"getInitiativeRepr",value:function(){return{uuid:this.uuid,visible:!Ct.IS_DM,group:!1,source:this.src,has_img:!0,effects:[],index:1/0}}}]),t}(Di),Ai=function(e){function t(e,i,n,a,r){var o;return Object(y["a"])(this,t),o=Object(m["a"])(this,Object(b["a"])(t).call(this,e,n,a,r)),o.type="circle",o.r=i||1,o}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{radius:this.r})}},{key:"fromDict",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this.r=e.radius}},{key:"getBoundingBox",value:function(){return new jt(new at(this.refPoint.x-this.r,this.refPoint.y-this.r),2*this.r,2*this.r)}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.beginPath(),"fog"===this.fillColour?e.fillStyle=Ct.getFogColour():e.fillStyle=this.fillColour;var i=ht(this.refPoint);e.arc(i.x,i.y,ft(this.r),0,2*Math.PI),e.fill(),"rgba(0, 0, 0, 0)"!==this.strokeColour&&(e.beginPath(),e.lineWidth=ft(5),e.strokeStyle=this.strokeColour,e.arc(i.x,i.y,ft(this.r),0,2*Math.PI),e.stroke())}},{key:"contains",value:function(e){return Math.pow(e.x-this.refPoint.x,2)+Math.pow(e.y-this.refPoint.y,2)<Math.pow(this.r,2)}},{key:"center",value:function(e){if(void 0===e)return this.refPoint;this.refPoint=e}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){var e,t,i=Ct.gridSize;e=2*this.r/i%2===0?Math.round(this.refPoint.x/i)*i:Math.round((this.refPoint.x-i/2)/i)*i+this.r,t=2*this.r/i%2===0?Math.round(this.refPoint.y/i)*i:Math.round((this.refPoint.y-i/2)/i)*i+this.r;var n=Mi(new ot(e-this.refPoint.x,t-this.refPoint.y),this);this.refPoint=this.refPoint.add(n),this.invalidate(!1)}},{key:"resizeToGrid",value:function(){var e=Ct.gridSize;this.r=Math.max(Math.round(this.r/e)*e,e/2),this.invalidate(!1)}},{key:"resize",value:function(e,t){var i=gt(t).subtract(this.refPoint);this.r=Math.sqrt(Math.pow(i.length(),2)/2)}},{key:"points",get:function(){return this.getBoundingBox().points}}]),t}(Ti),Ri=function(e){function t(e,i,n,a,r,o,s){var l;return Object(y["a"])(this,t),l=Object(m["a"])(this,Object(b["a"])(t).call(this,e,i,r,o,s)),l.type="circulartoken",l.text=n,l.font=a,l}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{radius:this.r,text:this.text,font:this.font})}},{key:"fromDict",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this.r=e.radius,this.text=e.text,this.font=e.font}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.font=this.font,e.save();var i=ht(this.center());e.textAlign="center",e.textBaseline="middle";var n=ye(e,this.text,ft(this.r),ft(this.r)),a=0;e.transform(n,a,-a,n,i.x,i.y),e.fillStyle=lt["mostReadable"](this.fillColour,["#000","#fff"]).toHexString(),e.fillText(this.text,0,0),e.restore()}},{key:"getInitiativeRepr",value:function(){return{uuid:this.uuid,visible:!Ct.IS_DM,group:!1,source:""===this.name||"Unknown shape"===this.name?this.text:this.name,has_img:!1,effects:[],index:1/0}}}]),t}(Ai),Vi=function(e){function t(e,i,n,a,r){var o;return Object(y["a"])(this,t),o=Object(m["a"])(this,Object(b["a"])(t).call(this,e,"rgba(0, 0, 0, 0)",a||"#000",r)),o.type="line",o.endPoint=i,o.lineWidth=void 0===n?1:n,o}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{x2:this.endPoint.x,y2:this.endPoint.y,line_width:this.lineWidth})}},{key:"getBoundingBox",value:function(){return new jt(new at(Math.min(this.refPoint.x,this.endPoint.x),Math.min(this.refPoint.y,this.endPoint.y)),Math.abs(this.refPoint.x-this.endPoint.x),Math.abs(this.refPoint.y-this.endPoint.y))}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.strokeStyle=this.strokeColour,e.beginPath(),e.moveTo(dt(this.refPoint.x),vt(this.refPoint.y)),e.lineTo(dt(this.endPoint.x),vt(this.endPoint.y)),e.lineWidth=this.lineWidth,e.stroke()}},{key:"contains",value:function(e){return!1}},{key:"center",value:function(e){}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){}},{key:"resizeToGrid",value:function(){}},{key:"resize",value:function(e,t){0===e?this.refPoint=gt(t):this.endPoint=gt(t)}},{key:"points",get:function(){return[[this.refPoint.x,this.refPoint.y],[this.endPoint.x,this.endPoint.y]]}}]),t}(Ti),Ui=function(e){function t(e,i,n,a,r){var o;return Object(y["a"])(this,t),o=Object(m["a"])(this,Object(b["a"])(t).call(this,e,"rgba(0, 0, 0, 0)",a||"#000",r)),o.type="multiline",o._points=[],o._points=i||[],o.lineWidth=n||3,o}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{line_width:this.lineWidth,points:this._points.map(function(e){return{x:e.x,y:e.y}})})}},{key:"fromDict",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this._points=e.points.map(function(e){return new at(e.x,e.y)})}},{key:"getBoundingBox",value:function(){var e=this.refPoint.x,t=this.refPoint.x,i=this.refPoint.y,n=this.refPoint.y,a=!0,r=!1,o=void 0;try{for(var s,l=this._points[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;c.x<e&&(e=c.x),c.x>t&&(t=c.x),c.y<i&&(i=c.y),c.y>n&&(n=c.y)}}catch(u){r=!0,o=u}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}return new jt(new at(e,i),t-e,n-i)}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.beginPath(),e.lineCap="round",e.lineJoin="round",e.moveTo(dt(this.refPoint.x),vt(this.refPoint.y));var i=!0,n=!1,a=void 0;try{for(var r,o=this._points[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var s=r.value;e.lineTo(dt(s.x),vt(s.y))}}catch(l){n=!0,a=l}finally{try{i||null==o.return||o.return()}finally{if(n)throw a}}"fog"===this.strokeColour?e.strokeStyle=Ct.getFogColour():e.strokeStyle=this.strokeColour,e.lineWidth=ft(this.lineWidth),e.stroke()}},{key:"contains",value:function(e){return this.getBoundingBox().contains(e)}},{key:"center",value:function(e){return this.getBoundingBox().center()}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){}},{key:"resizeToGrid",value:function(){}},{key:"resize",value:function(e,t){0===e?this._refPoint=gt(t):this._points[e-1]=gt(t)}},{key:"refPoint",get:function(){return this._refPoint},set:function(e){var t=e.subtract(this._refPoint);this._refPoint=e;for(var i=0;i<this._points.length;i++)this._points[i]=this._points[i].add(t)}},{key:"points",get:function(){return this._points.map(function(e){return[e.x,e.y]})}}]),t}(Ti),Fi=function(e){function t(e,i,n,a,r,o){var s;return Object(y["a"])(this,t),s=Object(m["a"])(this,Object(b["a"])(t).call(this,e,i,n,a,r,o)),s.type="rect",s}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object(it["a"])(Object(b["a"])(t.prototype),"getBaseDict",this).call(this)}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),"fog"===this.fillColour?e.fillStyle=Ct.getFogColour():e.fillStyle=this.fillColour;var i=Ct.zoomFactor,n=ht(this.refPoint);e.fillRect(n.x,n.y,this.w*i,this.h*i),"rgba(0, 0, 0, 0)"!==this.strokeColour&&(e.strokeStyle=this.strokeColour,e.lineWidth=5,e.strokeRect(n.x,n.y,this.w*i,this.h*i))}}]),t}(Di),$i=function(e){function t(e,i,n,a,r,o,s){var l;return Object(y["a"])(this,t),l=Object(m["a"])(this,Object(b["a"])(t).call(this,e,r,o,s)),l.type="text",l.text=i,l.font=n,l.angle=a||0,l}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{text:this.text,font:this.font,angle:this.angle})}},{key:"getBoundingBox",value:function(){return new jt(this.refPoint,5,5)}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.font=this.font,e.fillStyle=this.fillColour,e.save();var i=ht(this.refPoint);e.translate(i.x,i.y),e.rotate(this.angle),e.textAlign="center",this.getLines(e).map(function(t){return e.fillText(t.text,t.x,t.y)}),e.restore()}},{key:"contains",value:function(e){return!1}},{key:"center",value:function(e){}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){}},{key:"resizeToGrid",value:function(){}},{key:"resize",value:function(e,t){}},{key:"getMaxHeight",value:function(e){var t=this.getLines(e),i=30;return i*t.length}},{key:"getMaxWidth",value:function(e){var t=this.getLines(e),i=t.map(function(t){return e.measureText(t.text).width});return Math.max.apply(Math,Object(p["a"])(i))}},{key:"getLines",value:function(e){var t=this.text.split("\n"),i=[],n=e.canvas.width,a=30,r=0,o=0,s=!0,l=!1,c=void 0;try{for(var u,h=t[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=u.value,v="",f=d.split(" "),p=!0,y=!1,g=void 0;try{for(var m,b=f[Symbol.iterator]();!(p=(m=b.next()).done);p=!0){var w=m.value,k=v+w+" ",x=e.measureText(k),O=x.width;O>n?(e.fillText(v,r,o),i.push({text:v,x:r,y:o}),v=w+" ",o+=a):v=k}}catch(S){y=!0,g=S}finally{try{p||null==b.return||b.return()}finally{if(y)throw g}}i.push({text:v,x:r,y:o}),o+=a}}catch(S){l=!0,c=S}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}return i}},{key:"points",get:function(){return[[this.refPoint.x,this.refPoint.y]]}}]),t}(Ti),zi=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;return Object(y["a"])(this,t),i=Object(m["a"])(this,Object(b["a"])(t).call(this,e,a,r,o)),i.type="polygon",i._vertices=[],i._vertices=n,i}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{vertices:this._vertices.map(function(e){return{x:e.x,y:e.y}})})}},{key:"fromDict",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this._vertices=e.vertices.map(function(e){return new at(e.x,e.y)})}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.lineCap="round",e.lineJoin="round","fog"===this.strokeColour?e.strokeStyle=Ct.getFogColour():2===this.vertices.length?e.strokeStyle=this.fillColour:e.strokeStyle=this.strokeColour,"fog"===this.fillColour?e.fillStyle=Ct.getFogColour():e.fillStyle=this.fillColour,e.lineWidth=ft(2),e.beginPath(),e.moveTo(dt(this.vertices[0].x),vt(this.vertices[0].y));for(var i=1;i<=this.vertices.length;i++){var n=this.vertices[i%this.vertices.length];e.lineTo(dt(n.x),vt(n.y))}e.fill(),e.stroke()}},{key:"contains",value:function(e){return this.getBoundingBox().contains(e)}},{key:"center",value:function(e){return this.getBoundingBox().center()}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){}},{key:"resizeToGrid",value:function(){}},{key:"resize",value:function(e,t){0===e?this._refPoint=gt(t):this._vertices[e-1]=gt(t)}},{key:"getBoundingBox",value:function(){var e=this.refPoint.x,t=this.refPoint.x,i=this.refPoint.y,n=this.refPoint.y,a=!0,r=!1,o=void 0;try{for(var s,l=this._vertices[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;c.x<e&&(e=c.x),c.x>t&&(t=c.x),c.y<i&&(i=c.y),c.y>n&&(n=c.y)}}catch(u){r=!0,o=u}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}return new jt(new at(e,i),t-e,n-i)}},{key:"refPoint",get:function(){return this._refPoint},set:function(e){var t=e.subtract(this._refPoint);this._refPoint=e;for(var i=0;i<this._vertices.length;i++)this._vertices[i]=this._vertices[i].add(t)}},{key:"vertices",get:function(){return[this._refPoint].concat(Object(p["a"])(this._vertices))}},{key:"points",get:function(){return this.vertices.map(function(e){return[e.x,e.y]})}}]),t}(Ti);function Bi(e){var t,i=new at(e.x,e.y);if("rect"===e.type_){var n=e;t=new Fi(i,n.width,n.height,n.fill_colour,n.stroke_colour,n.uuid)}else if("circle"===e.type_){var a=e;t=new Ai(i,a.radius,a.fill_colour,a.stroke_colour,a.uuid)}else if("circulartoken"===e.type_){var r=e;t=new Ri(i,r.radius,r.text,r.font,r.fill_colour,r.stroke_colour,r.uuid)}else if("line"===e.type_){var o=e;t=new Vi(i,new at(o.x2,o.y2),o.line_width,o.stroke_colour,o.uuid)}else if("multiline"===e.type_){var s=e;t=new Ui(i,s.points.map(function(e){return new at(e.x,e.y)}),s.line_width,s.stroke_colour,s.uuid)}else if("polygon"===e.type_){var l=e;t=new zi(i,l.vertices.map(function(e){return new at(e.x,e.y)}),l.fill_colour,l.stroke_colour,l.uuid)}else if("text"===e.type_){var c=e;t=new $i(i,c.text,c.font,c.angle,c.fill_colour,c.stroke_colour,c.uuid)}else{if("assetrect"!==e.type_)return;var u=e,h=new Image(u.width,u.height);u.src.startsWith("http")?h.src=new URL(u.src).pathname:h.src=u.src,t=new Ni(h,i,u.width,u.height,u.uuid),h.onload=function(){Et.getLayer(e.layer).invalidate(!1)}}return t.fromDict(e),t}var Hi=function(){function e(t,i){Object(y["a"])(this,e),this.selectable=!1,this.playerEditable=!1,this.isVisionLayer=!1,this.valid=!1,this.shapes=[],this.selection=[],this.selectionColor="#CC0000",this.selectionWidth=2,this.canvas=t,this.name=i,this.width=t.width,this.height=t.height,this.ctx=t.getContext("2d")}return Object(g["a"])(e,[{key:"invalidate",value:function(e){this.valid=!1,e||Et.invalidateLight()}},{key:"addShape",value:function(e,t,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];void 0===i&&(i=!1),e.layer=this.name,this.shapes.push(e),Et.UUIDMap.set(e.uuid,e),e.checkVisionSources(n),e.setMovementBlock(e.movementObstruction,n),e.ownedBy(Ct.username)&&e.isToken&&Ct.ownedtokens.push(e.uuid),e.annotation.length&&Ct.annotations.push(e.uuid),t&&Je.emit("Shape.Add",{shape:e.asDict(),temporary:i}),n&&this.invalidate(!t)}},{key:"setShapes",value:function(e){var t=!0,i=!1,n=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value,s=Bi(o);if(void 0===s)return void console.log("Shape with unknown type ".concat(o.type_," could not be added"));this.addShape(s,!1,!1,!1)}}catch(l){i=!0,n=l}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}this.clearSelection(),this.invalidate(!1)}},{key:"removeShape",value:function(e,t,i){void 0===i&&(i=!1),this.shapes.splice(this.shapes.indexOf(e),1),t&&Je.emit("Shape.Remove",{shape:e.asDict(),temporary:i});var n=Ct.visionSources.findIndex(function(t){return t.shape===e.uuid}),a=_i.visionBlockers.findIndex(function(t){return t===e.uuid}),r=Ct.movementblockers.findIndex(function(t){return t===e.uuid}),o=Ct.annotations.findIndex(function(t){return t===e.uuid});n>=0&&Ct.visionSources.splice(n,1),a>=0&&_i.visionBlockers.splice(a,1),r>=0&&Ct.movementblockers.splice(r,1),o>=0&&Ct.annotations.splice(o,1);var s=Ct.annotations.indexOf(e.uuid);s>=0&&Ct.annotations.splice(s,1);var l=Ct.ownedtokens.indexOf(e.uuid);l>=0&&Ct.ownedtokens.splice(l,1),Et.UUIDMap.delete(e.uuid);var c=this.selection.indexOf(e);c>=0&&this.selection.splice(c,1),a>=0&&_i.deleteFromTriag({target:Si.VISION,vertices:e.triagVertices,standalone:!0}),r>=0&&_i.deleteFromTriag({target:Si.MOVEMENT,vertices:e.triagVertices,standalone:!0}),this.invalidate(!t)}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.width,this.height)}},{key:"clearSelection",value:function(){this.selection=[],tt.$emit("SelectionInfo.Shape.Set",null)}},{key:"draw",value:function(e){if(!this.valid){var t=this.ctx,i=t.globalCompositeOperation;e=void 0===e||e,e&&this.clear();var n=this;if(this.shapes.forEach(function(e){e.options.has("skipDraw")&&e.options.get("skipDraw")||void 0!==Et.getLayer()&&e.visibleInCanvas(n.canvas)&&("fow"===n.name&&e.visionObstruction&&Et.getLayer().name!==n.name||e.drawAuras(t))}),this.shapes.forEach(function(e){e.options.has("skipDraw")&&e.options.get("skipDraw")||0===e.labels.length&&Ct.filterNoLabel||e.labels.length&&Ct.labelFilters.length&&!e.labels.some(function(e){return Ct.labelFilters.includes(e.uuid)})||void 0!==Et.getLayer()&&e.visibleInCanvas(n.canvas)&&("fow"===n.name&&e.visionObstruction&&Et.getLayer().name!==n.name||e.draw(t))}),null!=this.selection){t.fillStyle=this.selectionColor,t.strokeStyle=this.selectionColor,t.lineWidth=this.selectionWidth;var a=Ct.zoomFactor;this.selection.forEach(function(e){t.globalCompositeOperation=e.globalCompositeOperation;var i=e.getBoundingBox();t.strokeRect(dt(i.topLeft.x),vt(i.topLeft.y),i.w*a,i.h*a);var n=!0,r=!1,o=void 0;try{for(var s,l=e.points[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var c=s.value;t.beginPath(),t.arc(dt(c[0]),vt(c[1]),3,0,2*Math.PI),t.fill()}}catch(d){r=!0,o=d}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}t.beginPath(),t.moveTo(dt(e.points[0][0]),vt(e.points[0][1]));for(var u=1;u<=e.points.length;u++){var h=e.points[u%e.points.length];t.lineTo(dt(h[0]),vt(h[1]))}t.stroke()})}t.globalCompositeOperation=i,this.valid=!0}}},{key:"moveShapeOrder",value:function(e,t,i){var n=this.shapes.indexOf(e);n!==t&&(this.shapes.splice(n,1),this.shapes.splice(t,0,e),i&&Je.emit("Shape.Order.Set",{shape:e.asDict(),index:t}),this.invalidate(!0))}}]),e}(),Gi=function e(){Object(y["a"])(this,e)};function Wi(e,t,i){var n=Et.getLayer("draw");if(void 0!==n){var a=n.ctx;a.lineJoin="round",a.strokeStyle=void 0===i?"rgb(".concat(255*Math.random(),", ").concat(255*Math.random(),", ").concat(255*Math.random(),")"):i,a.moveTo(dt(e[0]),vt(e[1])),a.beginPath(),a.arc(dt(e[0]),vt(e[1]),t,0,2*Math.PI),a.closePath(),a.stroke()}}function Xi(e,t){var i=Et.getLayer("draw");if(void 0!==i){var n=i.ctx;n.lineJoin="round",n.lineJoin="round",n.beginPath(),n.strokeStyle=void 0===t?"rgb(".concat(255*Math.random(),", ").concat(255*Math.random(),", ").concat(255*Math.random(),")"):t,n.moveTo(dt(e[0][0]),vt(e[0][1]));var a=!0,r=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;n.lineTo(dt(c[0]),vt(c[1]))}}catch(u){r=!0,o=u}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}n.closePath(),n.stroke()}}function Yi(e,t){var i=Et.getLayer("draw");if(void 0!==i){var n=i.ctx;n.lineJoin="round",n.lineJoin="round",n.beginPath(),n.strokeStyle=void 0===t?"rgb(".concat(255*Math.random(),", ").concat(255*Math.random(),", ").concat(255*Math.random(),")"):t,n.moveTo(e[0][0],e[0][1]);var a=!0,r=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;n.lineTo(c[0],c[1])}}catch(u){r=!0,o=u}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}n.closePath(),n.stroke()}}function Ki(e,t){return t?e:dt(e)}function qi(e,t){return t?e:vt(e)}Gi.angleSteps=4,Gi.drawAngleLines=!1,Gi.drawFirstLightHit=!1,Gi.skipPlayerFOW=!1,Gi.skipLightFOW=!1,Gi.tempFill="fog";var Qi=0,Zi=0;function Ji(e,t,i,n){var a=Et.getLayer("draw");if(void 0!==a){var r=a.ctx;r.beginPath(),r.strokeStyle=i?"rgba(255, 255, 0, 0.30)":"rgba(0, 0, 0, 0.30)",r.moveTo(Ki(e[0],n),qi(e[1],n)),r.lineTo(Ki(t[0],n),qi(t[1],n)),r.closePath(),r.stroke()}}function en(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Qi=0,Zi=0;var a=0,r=Et.getLayer("draw");if(void 0!==r){var o=r.ctx;i&&o.clearRect(0,0,window.innerWidth,window.innerHeight),o.lineJoin="round",o.lineJoin="round";var s=new di(e);while(s.valid)s.next(),s.collect();s.collect();do{var l=s.edge.first.vertices[Nt(s.edge.second)].point,c=s.edge.first.vertices[Dt(s.edge.second)].point;if(n>0){if(l[0]===-1/0||c[0]===-1/0){s.next();continue}Zi++,s.edge.first.constraints[s.edge.second]?(Qi++,2===n&&console.log("Edge: (*) ".concat(l," > ").concat(c,"   (").concat(s.edge.first.uid,")"))):2===n&&console.log("Edge: ".concat(l," > ").concat(c,"   (").concat(s.edge.first.uid,")"))}do{s.next(),s.collect()}while(s.valid)}while(null!==s.pos);var u=!0,h=!1,d=void 0;try{for(var v,f=e.triangles[Symbol.iterator]();!(u=(v=f.next()).done);u=!0){var p,y=v.value;if(!y.isInfinite()){a++;var g=[];o.fillStyle="blue",void 0!==y.vertices[0]&&(g.push(y.vertices[0].point),o.beginPath(),o.arc(Ki(y.vertices[0].point[0],t),qi(y.vertices[0].point[1],t),5,0,2*Math.PI),o.closePath(),o.fill()),void 0!==y.vertices[1]&&(g.push(y.vertices[1].point),o.arc(Ki(y.vertices[1].point[0],t),qi(y.vertices[1].point[1],t),5,0,2*Math.PI),o.closePath(),o.fill()),void 0!==y.vertices[2]&&(g.push(y.vertices[2].point),o.arc(Ki(y.vertices[2].point[0],t),qi(y.vertices[2].point[1],t),5,0,2*Math.PI),o.closePath(),o.fill()),2===n&&(p=console).log.apply(p,["[T ".concat(y.uid,"] ")].concat(g,[y.constraints])),o.moveTo(Ki(y.vertices[0].point[0],t),qi(y.vertices[0].point[1],t)),void 0!==y.vertices[0]&&void 0!==y.vertices[1]&&Ji(y.vertices[0].point,y.vertices[1].point,y.constraints[2],t),void 0!==y.vertices[1]&&void 0!==y.vertices[2]&&Ji(y.vertices[1].point,y.vertices[2].point,y.constraints[0],t),void 0!==y.vertices[2]&&void 0!==y.vertices[0]&&Ji(y.vertices[2].point,y.vertices[0].point,y.constraints[1],t)}}}catch(m){h=!0,d=m}finally{try{u||null==f.return||f.return()}finally{if(h)throw d}}n>0&&(console.log("Edges: ".concat(Qi,"/").concat(Zi)),console.log("Faces: ".concat(a)))}}function tn(e,t,i){void 0===i&&(i=Ct.drawTEContour);var n=[e.x,e.y],a=[],r=Ci[t].locate(n,null).loc;return null===r?(console.error("Triangle not found"),[]):(a.push(r.vertices[1].point),r.isConstrained(0)||nn(n,r.vertices[2].point,r.vertices[1].point,r,0,a),a.push(r.vertices[2].point),r.isConstrained(1)||nn(n,r.vertices[0].point,r.vertices[2].point,r,1,a),a.push(r.vertices[0].point),r.isConstrained(2)||nn(n,r.vertices[1].point,r.vertices[0].point,r,2,a),i&&Xi(a,"red"),a)}function nn(e,t,i,n,a,r){var o=n.neighbours[a],s=o.indexT(n),l=Nt(s),c=Dt(s),u=o.vertices[s],h=o.vertices[c],d=o.vertices[l],v=[o,l],f=[o,c],p=Ut(e,i,u.point),y=Ut(e,t,u.point);if(p===ai.COUNTERCLOCKWISE)if(v[0].isConstrained(v[1]))i!==h.point&&r.push(an(e,i,u.point,h.point)),y===ai.COUNTERCLOCKWISE&&r.push(an(e,t,u.point,h.point));else{if(y===ai.COUNTERCLOCKWISE)return nn(e,t,i,o,l,r);nn(e,u.point,i,o,l,r)}if(p!==ai.CLOCKWISE&&y!==ai.COUNTERCLOCKWISE&&r.push(u.point),y===ai.CLOCKWISE)return f[0].isConstrained(f[1])?(p===ai.CLOCKWISE&&r.push(an(e,i,u.point,d.point)),void(t!==d.point&&r.push(an(e,t,u.point,d.point)))):p===ai.CLOCKWISE?nn(e,t,i,o,c,r):nn(e,t,u.point,o,c,r)}function an(e,t,i,n){var a=(n[1]-i[1])*(t[0]-e[0])-(n[0]-i[0])*(t[1]-e[1]),r=((n[0]-i[0])*(e[1]-i[1])-(n[1]-i[1])*(e[0]-i[0]))/a,o=e[0]+r*(t[0]-e[0]),s=e[1]+r*(t[1]-e[1]);return[o,s]}window.DC=Wi,window.DL=Ji,window.DP=Xi,window.DPL=Yi,window.DPT=en;var rn=function(e){function t(e,i){var n;return Object(y["a"])(this,t),n=Object(m["a"])(this,Object(b["a"])(t).call(this,e,i)),n.isVisionLayer=!0,n.preFogShapes=[],n.virtualCanvas=document.createElement("canvas"),n.virtualCanvas.width=window.innerWidth,n.virtualCanvas.height=window.innerHeight,n.vCtx=n.virtualCanvas.getContext("2d"),n}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"addShape",value:function(e,i,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];Object(it["a"])(Object(b["a"])(t.prototype),"addShape",this).call(this,e,i,n,a),e.options.has("preFogShape")&&e.options.get("preFogShape")&&this.preFogShapes.push(e)}},{key:"removeShape",value:function(e,i,n){if(e.options.has("preFogShape")&&e.options.get("preFogShape")){var a=this.preFogShapes.findIndex(function(t){return t.uuid===e.uuid});this.preFogShapes.splice(a,1)}Object(it["a"])(Object(b["a"])(t.prototype),"removeShape",this).call(this,e,i,n)}},{key:"draw",value:function(){var e=this;if(!this.valid){var i=this.ctx;if(Gi.skipLightFOW)return i.clearRect(0,0,this.canvas.width,this.canvas.height),void(this.valid=!0);var n=i.globalCompositeOperation;i.clearRect(0,0,this.canvas.width,this.canvas.height),i.fillStyle="rgba(0, 0, 0, 1)";var a=Et.getLayer("draw").ctx;(Gi.drawAngleLines||Gi.drawFirstLightHit)&&a.clearRect(0,0,a.canvas.width,a.canvas.height),Ct.fullFOW&&Et.hasLayer("tokens")&&Et.getLayer("tokens").shapes.forEach(function(e){if(e.ownedBy()&&e.isToken){var t=e.getBoundingBox(),n=ht(e.center()),a=.8*ft(t.w);i.beginPath(),i.arc(n.x,n.y,a,0,2*Math.PI);var r=i.createRadialGradient(n.x,n.y,a/2,n.x,n.y,a);r.addColorStop(0,"rgba(0, 0, 0, 1)"),r.addColorStop(1,"rgba(0, 0, 0, 0)"),i.fillStyle=r,i.fill()}}),this.vCtx.clearRect(0,0,window.innerWidth,window.innerHeight);var r=!0,o=!1,s=void 0;try{for(var l,c=function(){var t=l.value,n=Et.UUIDMap.get(t.shape);if(void 0===n)return"continue";var r=n.auras.find(function(e){return e.uuid===t.aura});if(void 0===r)return"continue";var o=pt(r.value+r.dim),s=n.center(),c=ht(s),u=new Ai(s,o);if(!u.visibleInCanvas(i.canvas))return"continue";if("bvh"===_i.visionMode){var h,d=-1,v=new Path2D;v.moveTo(c.x,c.y);for(var f=0;f<2*Math.PI;f+=Gi.angleSteps/180*Math.PI){var p=new at(s.x+o*Math.cos(f),s.y+o*Math.sin(f));Gi.drawAngleLines&&(a.beginPath(),a.moveTo(dt(s.x),vt(s.y)),a.lineTo(dt(p.x),vt(p.y)),a.stroke());var y=st.fromPoints(s,p),g=_i.BV.intersect(y);if(0===f&&(h=g.hit?g.intersect:p),g.hit)-1!==d&&(v.arc(c.x,c.y,yt(r.value+r.dim),d,f),d=-1),v.lineTo(dt(g.intersect.x),vt(g.intersect.y));else if(-1===d){d=f;var m=ht(p);i.lineTo(m.x,m.y)}}if(-1===d?v.lineTo(dt(h.x),vt(h.y)):v.arc(c.x,c.y,yt(r.value+r.dim),d,2*Math.PI),Ct.fullFOW){if(r.dim>0){var b=i.createRadialGradient(c.x,c.y,yt(r.value),c.x,c.y,yt(r.value+r.dim));b.addColorStop(0,"rgba(0, 0, 0, 1)"),b.addColorStop(1,"rgba(0, 0, 0, 0)"),i.fillStyle=b}else i.fillStyle="rgba(0, 0, 0, 1)";i.fill(v)}r.lastPath=v}else{e.vCtx.globalCompositeOperation="source-over",e.vCtx.fillStyle="rgba(0, 0, 0, 1)";var w=tn(s,Si.VISION);e.vCtx.beginPath(),e.vCtx.moveTo(dt(w[0][0]),vt(w[0][1]));var k=!0,x=!1,O=void 0;try{for(var S,_=w[Symbol.iterator]();!(k=(S=_.next()).done);k=!0){var C=S.value;e.vCtx.lineTo(dt(C[0]),vt(C[1]))}}catch(E){x=!0,O=E}finally{try{k||null==_.return||_.return()}finally{if(x)throw O}}if(e.vCtx.closePath(),e.vCtx.fill(),r.dim>0){var L=e.vCtx.createRadialGradient(c.x,c.y,yt(r.value),c.x,c.y,yt(r.value+r.dim));L.addColorStop(0,"rgba(0, 0, 0, 1)"),L.addColorStop(1,"rgba(0, 0, 0, 0)"),e.vCtx.fillStyle=L}else e.vCtx.fillStyle="rgba(0, 0, 0, 1)";e.vCtx.globalCompositeOperation="source-in",e.vCtx.beginPath(),e.vCtx.arc(c.x,c.y,yt(r.value+r.dim),0,2*Math.PI),e.vCtx.fill(),i.drawImage(e.virtualCanvas,0,0)}},u=Ct.visionSources[Symbol.iterator]();!(r=(l=u.next()).done);r=!0)c()}catch(m){o=!0,s=m}finally{try{r||null==u.return||u.return()}finally{if(o)throw s}}Ct.fowLOS&&(i.globalCompositeOperation="source-in",i.drawImage(Et.getLayer("fow-players").canvas,0,0));var h=!0,d=!1,v=void 0;try{for(var f,p=this.preFogShapes[Symbol.iterator]();!(h=(f=p.next()).done);h=!0){var y=f.value;if(y.visibleInCanvas(this.canvas)){var g=y.globalCompositeOperation;Ct.fullFOW||("source-over"===y.globalCompositeOperation?y.globalCompositeOperation="destination-out":"destination-out"===y.globalCompositeOperation&&(y.globalCompositeOperation="source-over")),y.draw(i),y.globalCompositeOperation=g}}}catch(m){d=!0,v=m}finally{try{h||null==p.return||p.return()}finally{if(d)throw v}}Ct.fullFOW&&(i.globalCompositeOperation="source-out",i.fillStyle=Ct.getFogColour(),i.fillRect(0,0,i.canvas.width,i.canvas.height)),Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,!1),i.globalCompositeOperation=n}}}]),t}(Hi),on=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.isVisionLayer=!0,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"draw",value:function(){if(!this.valid){var e=this.ctx;if(!Ct.fowLOS||Gi.skipPlayerFOW)return e.clearRect(0,0,this.canvas.width,this.canvas.height),void(this.valid=!0);e.clearRect(0,0,this.canvas.width,this.canvas.height);var i=e.globalCompositeOperation;e.fillStyle="rgba(0, 0, 0, 1)",Ct.IS_DM||Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,!Ct.fullFOW);var n=e.canvas.width+e.canvas.height,a=!0,r=!1,o=void 0;try{for(var s,l=Ct.activeTokens[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,u=Et.UUIDMap.get(c);if(void 0!==u){var h=u.center(),d=ht(h);if("bvh"===_i.visionMode){e.beginPath();for(var v=-1,f=0;f<2*Math.PI;f+=Gi.angleSteps/2/180*Math.PI){var p=Math.cos(f),y=Math.sin(f),g=new st(h,new ot(p,y)),m=_i.BV.intersect(g);m.hit?(-1!==v&&(e.arc(d.x,d.y,n,v,f),v=-1),e.lineTo(dt(m.intersect.x),vt(m.intersect.y))):-1===v&&(e.lineTo(d.x+n*p,d.y+n*y),v=f)}-1!==v?e.arc(d.x,d.y,n,v,2*Math.PI):e.closePath(),e.fill()}else{var w=e.createRadialGradient(d.x,d.y,yt(Ct.visionRangeMin),d.x,d.y,yt(Ct.visionRangeMax));w.addColorStop(0,"rgba(0, 0, 0, 1)"),w.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=w;try{var k=tn(u.center(),Si.VISION);e.beginPath(),e.moveTo(dt(k[0][0]),vt(k[0][1]));var x=!0,O=!1,S=void 0;try{for(var _,C=k[Symbol.iterator]();!(x=(_=C.next()).done);x=!0){var L=_.value;e.lineTo(dt(L[0]),vt(L[1]))}}catch(E){O=!0,S=E}finally{try{x||null==C.return||C.return()}finally{if(O)throw S}}e.closePath(),e.fill()}catch(I){}}}}}catch(E){r=!0,o=E}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}Ct.IS_DM&&Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,!Ct.fullFOW),e.globalCompositeOperation=i}}}]),t}(Hi),sn=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"invalidate",value:function(){this.valid=!1}},{key:"draw",value:function(e){this.valid||this.drawGrid()}},{key:"drawGrid",value:function(){var e=this.ctx;this.clear(),e.beginPath();for(var t=Ct.gridSize,i=0;i<this.width;i+=t*Ct.zoomFactor)e.moveTo(i+Ct.panX%t*Ct.zoomFactor,0),e.lineTo(i+Ct.panX%t*Ct.zoomFactor,this.height),e.moveTo(0,i+Ct.panY%t*Ct.zoomFactor),e.lineTo(this.width,i+Ct.panY%t*Ct.zoomFactor);e.strokeStyle=Ct.gridColour,e.lineWidth=1,e.stroke(),this.valid=!0}}]),t}(Hi);function ln(e){var t,i=document.createElement("canvas");i.style.zIndex=Et.layers.length.toString(),i.width=window.innerWidth,i.height=window.innerHeight,t="grid"===e.type_?new sn(i,e.name):"fow"===e.type_?new rn(i,e.name):"fow-players"===e.type_?new on(i,e.name):new Hi(i,e.name),t.selectable=e.selectable,t.playerEditable=e.player_editable,Et.addLayer(t);var n=document.getElementById("layers");null!==n?("fow-players"!==e.name&&n.appendChild(i),"grid"===e.type_&&e.size&&Ct.setGridSize({gridSize:e.size,sync:!1}),t.setShapes(e.shapes)):console.warn("Layers div is missing, this will prevent the main game board from loading!")}function cn(e){var t=Et.getLayer();if(void 0!==t&&null!==e&&null!==e.dataTransfer){var i=document.createElement("img");i.src=e.dataTransfer.getData("text/plain");var n=new Ni(i,new at(mt(e.clientX),bt(e.clientY)),wt(i.width),wt(i.height));if(n.src=new URL(i.src).pathname,Ct.useGrid){var a=Ct.gridSize;n.refPoint=new at(Math.round(n.refPoint.x/a)*a,Math.round(n.refPoint.y/a)*a),n.w=Math.max(Math.round(n.w/a)*a,a),n.h=Math.max(Math.round(n.h/a)*a,a)}t.addShape(n,!0)}}var un=function(){function e(){Object(y["a"])(this,e),this.shown=!1;var t=new at(0,0);this.annotationText=new $i(t,"","bold 20px serif",0,"rgba(230, 230, 230, 1)"),this.annotationRect=new Fi(t,0,0,"rgba(0, 0, 0, 0.6)")}return Object(g["a"])(e,[{key:"setActiveText",value:function(e){if(void 0===this.layer){if(!Et.hasLayer("draw"))return void console.warn("There is no draw layer to draw annotations on!");this.layer=Et.getLayer("draw"),this.layer.addShape(this.annotationRect,!1),this.layer.addShape(this.annotationText,!1)}this.shown=""!==e,this.annotationText.refPoint=gt(new rt(this.layer.canvas.width/2,50)),this.annotationText.text=e;var t=this.shown?this.annotationText.getMaxWidth(this.layer.ctx)+10:0,i=this.shown?this.annotationText.getMaxHeight(this.layer.ctx)+10:0;this.annotationRect.refPoint=gt(new rt(this.layer.canvas.width/2-t/2,30)),this.annotationRect.w=t/Ct.zoomFactor,this.annotationRect.h=i/Ct.zoomFactor,this.layer.invalidate(!0)}}]),e}(),hn=function(){function e(){Object(y["a"])(this,e),this.selectedTool=0,this.annotationManager=new un}return Object(g["a"])(e,[{key:"addShape",value:function(e){if(Et.hasLayer(e.layer)){var t=Et.getLayer(e.layer),i=Bi(e);void 0!==i?(t.addShape(i,!1),t.invalidate(!1)):console.log("Shape with unknown type ".concat(e.type_," could not be added"))}else console.log("Shape with unknown layer ".concat(e.layer," could not be added"))}},{key:"updateShape",value:function(e){if(Et.hasLayer(e.shape.layer)){var t=Bi(e.shape);if(void 0!==t){var i=Et.UUIDMap.get(e.shape.uuid);if(void 0!==i){var n=Object(p["a"])(i.triagVertices),a=t.owners!==i.owners,r=Object.assign(i,t),o=r.checkVisionSources(),s=r.setMovementBlock(r.movementObstruction);r.setIsToken(r.isToken),e.redraw&&(r.visionObstruction&&!o&&(_i.deleteFromTriag({target:Si.VISION,vertices:n,standalone:!1}),_i.addToTriag({target:Si.VISION,points:r.points})),Et.getLayer(e.shape.layer).invalidate(!1),r.movementObstruction&&!s&&(_i.deleteFromTriag({target:Si.MOVEMENT,vertices:n,standalone:!1}),_i.addToTriag({target:Si.MOVEMENT,points:r.points}))),a&&tt.$emit("Initiative.ForceUpdate")}else console.log("Shape with unknown id could not be updated")}else console.log("Shape with unknown type ".concat(e.shape.type_," could not be added"))}else console.log("Shape with unknown layer ".concat(e.shape.layer," could not be added"))}},{key:"setCenterPosition",value:function(e){var t=ht(e);Ct.increasePanX((window.innerWidth/2-t.x)/Ct.zoomFactor),Ct.increasePanY((window.innerHeight/2-t.y)/Ct.zoomFactor),Et.invalidate(),ut(Ct.locationOptions)}}]),e}(),dn=new hn;window.gameManager=dn,Je.on("connect",function(){console.log("Connected")}),Je.on("disconnect",function(){console.log("Disconnected")}),Je.on("connect_error",function(e){console.error("Could not connect to game session."),bo.push("/dashboard")}),Je.on("error",function(e){console.error("Game session does not exist."),bo.push("/dashboard")}),Je.on("redirect",function(e){console.log("redirecting"),bo.push(e)}),Je.on("Room.Info.Set",function(e){Ct.setRoomName(e.name),Ct.setRoomCreator(e.creator),Ct.setInvitationCode(e.invitationCode),Ct.setIsLocked({isLocked:e.isLocked,sync:!1}),Ct.setPlayers(e.players)}),Je.on("Room.Info.InvitationCode.Set",function(e){Ct.setInvitationCode(e),tt.$emit("DmSettings.RefreshedInviteCode")}),Je.on("Room.Info.Players.Add",function(e){Ct.addPlayer(e)}),Je.on("Username.Set",function(e){Ct.setUsername(e),Ct.setDM(e===decodeURIComponent(window.location.pathname.split("/")[2]))}),Je.on("Client.Options.Set",function(e){Ct.setGridColour({colour:e.grid_colour,sync:!1}),Ct.setFOWColour({colour:e.fow_colour,sync:!1}),Ct.setRulerColour({colour:e.ruler_colour,sync:!1}),Ct.setPanX(e.pan_x),Ct.setPanY(e.pan_y),Ct.setZoomDisplay(Ot(e.zoom_factor)),e.active_layer&&Et.selectLayer(e.active_layer,!1),void 0!==Et.getGridLayer()&&Et.getGridLayer().invalidate()}),Je.on("Location.Set",function(e){void 0!==e.name&&Ct.setLocationName(e.name),void 0!==e.unit_size&&Ct.setUnitSize({unitSize:e.unit_size,sync:!1}),void 0!==e.use_grid&&Ct.setUseGrid({useGrid:e.use_grid,sync:!1}),void 0!==e.full_fow&&Ct.setFullFOW({fullFOW:e.full_fow,sync:!1}),void 0!==e.fow_opacity&&Ct.setFOWOpacity({fowOpacity:e.fow_opacity,sync:!1}),void 0!==e.fow_los&&Ct.setLineOfSight({fowLOS:e.fow_los,sync:!1}),void 0!==e.vision_min_range&&Ct.setVisionRangeMin({value:e.vision_min_range,sync:!1}),void 0!==e.vision_max_range&&Ct.setVisionRangeMax({value:e.vision_max_range,sync:!1}),void 0!==e.vision_mode&&(_i.setVisionMode({mode:e.vision_mode,sync:!1}),_i.recalculateVision(),_i.recalculateMovement())}),Je.on("Position.Set",function(e){dn.setCenterPosition(new at(e.x,e.y))}),Je.on("Notes.Set",function(e){var t=!0,i=!1,n=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;Ct.newNote({note:o,sync:!1})}}catch(s){i=!0,n=s}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}),Je.on("Asset.List.Set",function(e){Ct.setAssets(e)}),Je.on("Board.Set",function(e){Ct.clear(),Ct.setLocations(e.locations),document.getElementById("layers").innerHTML="",Ct.resetLayerInfo(),Et.reset();var t=!0,i=!1,n=void 0;try{for(var a,r=e.layers[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;ln(o)}}catch(s){i=!0,n=s}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}Et.selectLayer(Et.getLayer().name,!1),tt.$emit("Initiative.Clear"),_i.recalculateVision(),_i.recalculateMovement(),Ct.setBoardInitialized(!0)}),Je.on("Gridsize.Set",function(e){Ct.setGridSize({gridSize:e,sync:!1})}),Je.on("Shape.Add",function(e){dn.addShape(e)}),Je.on("Shape.Remove",function(e){if(Et.UUIDMap.has(e.uuid))if(Et.hasLayer(e.layer)){var t=Et.getLayer(e.layer);t.removeShape(Et.UUIDMap.get(e.uuid),!1),t.invalidate(!1)}else console.log("Attempted to remove shape from an unknown layer ".concat(e.layer));else console.log("Attempted to remove an unknown shape")}),Je.on("Shape.Order.Set",function(e){if(Et.UUIDMap.has(e.shape.uuid))if(Et.hasLayer(e.shape.layer)){var t=Et.UUIDMap.get(e.shape.uuid),i=Et.getLayer(t.layer);i.moveShapeOrder(t,e.index,!1)}else console.log("Attempted to remove shape from an unknown layer ".concat(e.shape.layer));else console.log("Attempted to move the shape order of an unknown shape")}),Je.on("Shape.Layer.Change",function(e){var t=Et.UUIDMap.get(e.uuid);void 0!==t&&t.moveLayer(e.layer,!1)}),Je.on("Shape.Update",function(e){dn.updateShape(e)}),Je.on("Temp.Clear",function(e){e.forEach(function(e){if(Et.UUIDMap.has(e.uuid))if(Et.hasLayer(e.layer)){var t=Et.UUIDMap.get(e.uuid);Et.getLayer(e.layer).removeShape(t,!1)}else console.log("Attempted to remove shape from an unknown layer ".concat(e.layer));else console.log("Attempted to remove an unknown temporary shape")})}),Je.on("Labels.Set",function(e){var t=!0,i=!1,n=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;Ct.addLabel(o)}}catch(s){i=!0,n=s}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}),Je.on("Label.Visibility.Set",function(e){Ct.setLabelVisibility(e)}),Je.on("Label.Add",function(e){Ct.addLabel(e)}),Je.on("Label.Delete",function(e){Ct.deleteLabel(e)}),Je.on("Labels.Filter.Add",function(e){Ct.labelFilters.push(e),Et.invalidate()}),Je.on("Labels.Filter.Remove",function(e){var t=Ct.labelFilters.indexOf(e);t>=0&&(Ct.labelFilters.splice(t,1),Et.invalidate())}),Je.on("Labels.Filters.Set",function(e){Ct.setLabelFilters(e)});var vn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Initiative")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("draggable",{attrs:{id:"initiative-list",setData:e.fakeSetData,disabled:!e.$store.state.game.IS_DM},on:{change:e.updateOrder},model:{value:e.$store.state.initiative.data,callback:function(t){e.$set(e.$store.state.initiative,"data",t)},expression:"$store.state.initiative.data"}},[e._l(e.$store.state.initiative.data,function(t){return[i("div",{key:t.uuid,staticStyle:{display:"flex","flex-direction":"column","align-items":"flex-end"}},[i("div",{staticClass:"initiative-actor",class:{"initiative-selected":e.$store.state.initiative.currentActor===t.uuid},style:{cursor:e.$store.state.game.IS_DM&&"move"},on:{mouseenter:function(i){return e.toggleHighlight(t,!0)},mouseleave:function(i){return e.toggleHighlight(t,!1)}}},[t.has_img?[i("img",{attrs:{src:t.source,width:"30px",height:"30px"}})]:[i("span",{staticStyle:{width:"auto"}},[e._v(e._s(t.source))])],i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:t.initiative,expression:"actor.initiative",modifiers:{lazy:!0,number:!0}}],class:{notAllowed:!e.owns(t)},attrs:{type:"text",placeholder:"value",disabled:!e.owns(t)},domProps:{value:t.initiative},on:{change:[function(i){e.$set(t,"initiative",e._n(i.target.value))},function(i){return e.syncInitiative(t)}],blur:function(t){return e.$forceUpdate()}}}),i("div",{staticClass:"initiative-effects-icon",class:{notAllowed:!e.owns(t)},staticStyle:{opacity:"0.6"},on:{click:function(i){e.createEffect(t,e.getDefaultEffect(),!0)}}},[i("i",{staticClass:"fas fa-stopwatch"}),t.effects?[e._v("\n                                "+e._s(t.effects.length)+"\n                            ")]:[e._v("\n                                0\n                            ")]],2),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:t.visible?"1.0":"0.3"},on:{click:function(i){return e.toggleOption(t,"visible")}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:t.group?"1.0":"0.3"},on:{click:function(i){return e.toggleOption(t,"group")}}},[i("i",{staticClass:"fas fa-users"})]),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:e.owns(t)?"1.0":"0.3"},on:{click:function(i){return e.removeInitiative(t.uuid,!0,!0)}}},[i("i",{staticClass:"fas fa-trash-alt"})])],2),t.effects?i("div",{staticClass:"initiative-effect"},e._l(t.effects,function(n){return i("div",{key:n.uuid},[i("input",{directives:[{name:"model",rawName:"v-model",value:n.name,expression:"effect.name"}],attrs:{type:"text",size:n.name.length||1},domProps:{value:n.name},on:{change:function(i){return e.updateEffect(t.uuid,n,!0)},input:function(t){t.target.composing||e.$set(n,"name",t.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model",value:n.turns,expression:"effect.turns"}],attrs:{type:"text",size:n.turns.toString().length||1},domProps:{value:n.turns},on:{change:function(i){return e.updateEffect(t.uuid,n,!0)},input:function(t){t.target.composing||e.$set(n,"turns",t.target.value)}}})])}),0):e._e()])]})],2),i("div",{attrs:{id:"initiative-bar"}},[i("div",{attrs:{id:"initiative-round"}},[e._v("Round "+e._s(e.$store.state.initiative.roundCounter))]),i("div",{staticStyle:{display:"flex"}}),i("div",{staticClass:"initiative-bar-button",style:e.visionLock?"background-color: #82c8a0":"",on:{click:e.toggleVisionLock}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{staticClass:"initiative-bar-button",style:e.cameraLock?"background-color: #82c8a0":"",on:{click:function(t){e.cameraLock=!e.cameraLock}}},[i("i",{staticClass:"fas fa-video"})]),i("div",{staticClass:"initiative-bar-button",class:{notAllowed:!e.$store.state.game.IS_DM},on:{click:function(t){e.setRound(0,!0),e.updateTurn(e.$store.state.initiative.data[0].uuid,!0)}}},[i("i",{staticClass:"fas fa-sync-alt"})]),i("div",{staticClass:"initiative-bar-button",class:{notAllowed:!e.$store.state.game.IS_DM},on:{click:e.nextTurn}},[i("i",{staticClass:"fas fa-chevron-right"})])])],1)])},fn=[],pn=i("310e"),yn=i.n(pn),gn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.data=[],e.currentActor=null,e.roundCounter=0,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"contains",value:function(e){return this.data.some(function(t){return t.uuid===e})}},{key:"syncInitiative",value:function(e){U.emit("Initiative.Update",e)}},{key:"clear",value:function(){this.data=[],this.currentActor=null}},{key:"setData",value:function(e){this.data=e}},{key:"addInitiative",value:function(e){var t=this.data.findIndex(function(t){return t.uuid===e.uuid});t>=0||(void 0===e.initiative&&(e.initiative=0),this.syncInitiative(e))}},{key:"setRoundCounter",value:function(e){this.roundCounter=e}},{key:"setTurn",value:function(e){this.currentActor=e}}]),t}(D["d"]);k["a"]([D["c"]],gn.prototype,"clear",null),k["a"]([D["c"]],gn.prototype,"setData",null),k["a"]([D["c"]],gn.prototype,"addInitiative",null),k["a"]([D["c"]],gn.prototype,"setRoundCounter",null),k["a"]([D["c"]],gn.prototype,"setTurn",null),gn=k["a"]([Object(D["b"])({dynamic:!0,store:A,name:"initiative",namespaced:!0})],gn);var mn=Object(D["e"])(gn);n["default"].component("draggable",yn.a);var bn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.visionLock=!1,e.cameraLock=!1,e._activeTokens=[],e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("Initiative.Clear",mn.clear),tt.$on("Initiative.Remove",function(t){return e.removeInitiative(t)}),tt.$on("Initiative.Show",function(){return e.visible=!0}),tt.$on("Initiative.ForceUpdate",function(){return e.$forceUpdate()}),Je.on("Initiative.Set",mn.setData),Je.on("Initiative.Turn.Set",function(t){return e.setTurn(t)}),Je.on("Initiative.Turn.Update",function(t){return e.updateTurn(t,!1)}),Je.on("Initiative.Round.Update",function(t){return e.setRound(t,!1)}),Je.on("Initiative.Effect.New",function(t){var i=e.getActor(t.actor);void 0!==i&&e.createEffect(i,t.effect,!1)}),Je.on("Initiative.Effect.Update",function(t){return e.updateEffect(t.actor,t.effect,!1)})}},{key:"beforeDestroy",value:function(){tt.$off("Initiative.Clear"),tt.$off("Initiative.Remove"),tt.$off("Initiative.Show")}},{key:"getActor",value:function(e){return mn.data.find(function(t){return t.uuid===e})}},{key:"owns",value:function(e){if(Ct.IS_DM)return!0;var t=Et.UUIDMap.get(e.uuid);return void 0!==t&&t.owners.includes(Ct.username)}},{key:"getDefaultEffect",value:function(){return{uuid:ve(),name:"New Effect",turns:10}}},{key:"fakeSetData",value:function(e){e.setData("Hack","")}},{key:"removeInitiative",value:function(e){var t=mn.data.findIndex(function(t){return t.uuid===e});if(!(t<0||mn.data[t].group)){mn.syncInitiative({uuid:e});var i=Et.UUIDMap.get(e);void 0!==i&&i.showHighlight&&(i.showHighlight=!1,Et.getLayer(i.layer).invalidate(!0))}}},{key:"updateOrder",value:function(){Ct.IS_DM&&Je.emit("Initiative.Set",mn.data.map(function(e){return e.uuid}))}},{key:"updateTurn",value:function(e,t){if(Ct.IS_DM||!t){mn.currentActor=e;var i=mn.data.find(function(t){return t.uuid===e});if(void 0!==i){if(i.effects)for(var n=i.effects.length-1;n>=0;n--)i.effects[n].turns<=0?i.effects.splice(n,1):i.effects[n].turns--;if(this.visionLock&&(null!==e&&Ct.ownedtokens.includes(e)?Ct.setActiveTokens([e]):Ct.setActiveTokens([])),this.cameraLock&&null!==e){var a=Et.UUIDMap.get(e);void 0!==a&&a.ownedBy()&&dn.setCenterPosition(a.center())}t&&Je.emit("Initiative.Turn.Update",e)}}}},{key:"setRound",value:function(e,t){!Ct.IS_DM&&t||(mn.setRoundCounter(e),t&&Je.emit("Initiative.Round.Update",e))}},{key:"setTurn",value:function(e){mn.setTurn(e)}},{key:"nextTurn",value:function(){if(Ct.IS_DM){var e=mn.data,t=e[(e.findIndex(function(e){return e.uuid===mn.currentActor})+1)%e.length];mn.data[0].uuid===t.uuid&&this.setRound(mn.roundCounter+1,!0),this.updateTurn(t.uuid,!0)}}},{key:"toggleHighlight",value:function(e,t){var i=Et.UUIDMap.get(e.uuid);void 0!==i&&(i.showHighlight=t,Et.getLayer(i.layer).invalidate(!0))}},{key:"toggleOption",value:function(e,t){this.owns(e)&&(e[t]=!e[t],mn.syncInitiative(e))}},{key:"createEffect",value:function(e,t,i){this.owns(e)&&(e.effects.push(t),i&&Je.emit("Initiative.Effect.New",{actor:e.uuid,effect:t}))}},{key:"syncEffect",value:function(e,t){this.owns(e)&&Je.emit("Initiative.Effect.Update",{actor:e.uuid,effect:t})}},{key:"updateEffect",value:function(e,t,i){var n=mn.data.find(function(t){return t.uuid===e});if(void 0!==n){var a=n.effects.findIndex(function(e){return e.uuid===t.uuid});void 0!==a&&(n.effects[a]=t,i?this.syncEffect(n,t):this.$forceUpdate())}}},{key:"toggleVisionLock",value:function(){this.visionLock=!this.visionLock,this.visionLock?(this._activeTokens=Object(p["a"])(Ct._activeTokens),null!==mn.currentActor&&Ct.ownedtokens.includes(mn.currentActor)&&Ct.setActiveTokens([mn.currentActor])):Ct.setActiveTokens(this._activeTokens)}}]),t}(n["default"]);bn=k["a"]([Object(x["b"])({components:{Modal:ee,draggable:yn.a}})],bn);var wn=bn,kn=wn,xn=(i("291a"),Object(o["a"])(kn,vn,fn,!1,null,"6bbba6d3",null)),On=xn.exports,Sn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Label manager")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("div",{staticClass:"grid"},[i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Category"}},[e._v("Cat.")])]),i("div",{staticClass:"header name"},[e._v("Name")]),i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Visible"}},[e._v("Vis.")])]),i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Delete"}},[e._v("Del.")])]),i("div",{staticClass:"separator spanrow",staticStyle:{margin:"0 0 7px"}}),i("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],ref:"search",staticClass:"spanrow",attrs:{type:"text",placeholder:"search"},domProps:{value:e.search},on:{input:function(t){t.target.composing||(e.search=t.target.value)}}})]),i("div",{staticClass:"grid scroll"},[e._l(e.categories,function(t){return[e._l(e.labels[t],function(t){return[i("div",{key:"row-"+t.uuid,staticClass:"row",on:{click:function(i){return e.selectLabel(t.uuid)}}},[t.category?[i("div",{key:"cat-"+t.uuid},[e._v(e._s(t.category))]),i("div",{key:"name-"+t.uuid,staticClass:"name"},[e._v(e._s(t.name))])]:e._e(),t.category?e._e():[i("div",{key:"cat-"+t.uuid}),i("div",{key:"name-"+t.uuid,staticClass:"name"},[e._v(e._s(t.name))])],i("div",{key:"visible-"+t.uuid,class:{"lower-opacity":!t.visible},style:{textAlign:"center"},on:{click:function(i){return i.stopPropagation(),e.toggleVisibility(t)}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{key:"delete-"+t.uuid,on:{click:function(i){return i.stopPropagation(),e.deleteLabel(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})])],2)]})]}),0===e.labels.length?[i("div",{attrs:{id:"no-labels"}},[e._v("No labels exist yet")])]:e._e()],2),i("div",{staticClass:"grid"},[i("div",{staticClass:"separator spanrow"}),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.newCategory,expression:"newCategory",modifiers:{trim:!0}}],attrs:{type:"text"},domProps:{value:e.newCategory},on:{input:function(t){t.target.composing||(e.newCategory=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.newName,expression:"newName",modifiers:{trim:!0}}],attrs:{type:"text"},domProps:{value:e.newName},on:{input:function(t){t.target.composing||(e.newName=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),i("button",{attrs:{id:"addLabelButton"},on:{click:function(t){return t.stopPropagation(),e.addLabel(t)}}},[e._v("Add")])])])])},_n=[],Cn=(i("456d"),i("386d"),function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.newCategory="",e.newName="",e.search="",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("LabelManager.Open",function(){e.visible=!0,e.newCategory="",e.newName="",e.$nextTick(function(){return e.$refs.search.focus()})})}},{key:"beforeDestroy",value:function(){tt.$off("LabelManager.Open")}},{key:"selectLabel",value:function(e){tt.$emit("EditDialog.AddLabel",e),this.visible=!1}},{key:"toggleVisibility",value:function(e){e.visible=!e.visible,Je.emit("Label.Visibility.Set",{uuid:e.uuid,visible:e.visible})}},{key:"addLabel",value:function(){if(""!==this.newName){var e={uuid:ve(),category:this.newCategory,name:this.newName,visible:!1,user:Ct.username};Ct.addLabel(e),Je.emit("Label.Add",e),this.newCategory="",this.newName=""}}},{key:"deleteLabel",value:function(e){Ct.deleteLabel({uuid:e,user:Ct.username}),Je.emit("Label.Delete",e)}},{key:"labels",get:function(){for(var e={"":[]},t=0,i=Object.keys(Ct.labels);t<i.length;t++){var n=i[t],a=Ct.labels[n];this.search.length&&"".concat(a.category.toLowerCase()).concat(a.name.toLowerCase()).search(this.search.toLowerCase())<0||a.user===Ct.username&&(a.category?(a.category in e||(e[a.category]=[]),e[a.category].push(a),e[a.category].sort(function(e,t){return e.name.localeCompare(t.name)})):e[""].push(a))}return e}},{key:"categories",get:function(){return Object.keys(this.labels).sort()}}]),t}(n["default"]));Cn=k["a"]([Object(x["b"])({components:{Modal:ee}})],Cn);var Ln=Cn,En=Ln,In=(i("ab66"),Object(o["a"])(En,Sn,_n,!1,null,"3261513c",null)),jn=In.exports,Tn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"menuContainer"}},[i("div",{ref:"rm",style:{left:e.visible.settings?"200px":"0",top:e.visible.locations?"100px":"0"},attrs:{id:"radialmenu"}},[i("div",{staticClass:"rm-wrapper"},[i("div",{staticClass:"rm-toggler"},[i("ul",{staticClass:"rm-list",class:{"rm-list-dm":e.IS_DM}},[e.IS_DM?i("li",{staticClass:"rm-item",attrs:{id:"rm-locations"},on:{click:function(t){e.visible.locations=!e.visible.locations}}},[e._m(0)]):e._e(),i("li",{staticClass:"rm-item",attrs:{id:"rm-settings"},on:{click:function(t){e.visible.settings=!e.visible.settings}}},[e._m(1)])])]),e._m(2)])]),i("transition",{attrs:{name:"settings"},on:{enter:function(t){e.$refs.rm.style.transition="left 500ms"}}},[e.visible.settings?i("div",{ref:"settings",attrs:{id:"menu"},on:{click:e.settingsClick}},[i("div",{staticStyle:{width:"200px",height:"90%","overflow-y":"auto","overflow-x":"hidden"}},[e.IS_DM?[i("button",{staticClass:"menu-accordion"},[e._v("Assets")]),i("div",{staticClass:"menu-accordion-panel"},[i("a",{staticClass:"actionButton",attrs:{href:"/assets",target:"blank",title:"Open asset manager"}},[i("i",{staticClass:"fas fa-external-link-alt"})]),i("div",{staticClass:"directory",attrs:{id:"menu-tokens"}},[i("asset-node",{attrs:{asset:e.assets}}),e.assets?e._e():i("div",[e._v("No assets")])],1)]),i("button",{staticClass:"menu-accordion"},[e._v("Notes")]),i("div",{staticClass:"menu-accordion-panel"},[i("div",{staticClass:"menu-accordion-subpanel",attrs:{id:"menu-notes"}},[i("a",{staticClass:"actionButton",on:{click:e.createNote}},[i("i",{staticClass:"far fa-plus-square"})]),e._l(e.notes,function(t){return i("div",{key:t.uuid,staticStyle:{cursor:"pointer"},on:{click:function(i){return e.openNote(t)}}},[e._v("\n                                "+e._s(t.title||"[?]")+"\n                            ")])}),e.notes.length?e._e():i("div",[e._v("No notes")])],2)]),i("button",{staticClass:"menu-accordion",on:{click:e.openDmSettings}},[e._v("DM Options")])]:e._e(),i("button",{staticClass:"menu-accordion"},[e._v("Client Options")]),i("div",{staticClass:"menu-accordion-panel"},[i("div",{staticClass:"menu-accordion-subpanel"},[i("label",{attrs:{for:"gridColour"}},[e._v("Grid Colour:")]),i("color-picker",{attrs:{id:"gridColour",color:e.gridColour},on:{"update:color":function(t){e.gridColour=t}}}),i("label",{attrs:{for:"fowColour"}},[e._v("FOW Colour:")]),i("color-picker",{attrs:{id:"fowColour",color:e.fowColour},on:{"update:color":function(t){e.fowColour=t}}}),i("label",{attrs:{for:"rulerColour"}},[e._v("Ruler Colour:")]),i("color-picker",{attrs:{id:"rulerColour",color:e.rulerColour},on:{"update:color":function(t){e.rulerColour=t}}})],1)])],2),i("router-link",{staticClass:"menu-accordion",staticStyle:{"text-decoration":"none",display:"inline-block",position:"absolute",bottom:"0"},attrs:{to:"/dashboard"}},[e._v("\n                Exit\n            ")])],1):e._e()]),i("transition",{attrs:{name:"locations"},on:{enter:function(t){e.$refs.rm.style.transition="top 500ms"}}},[e.IS_DM&&e.visible.locations?i("div",{attrs:{id:"locations-menu"}},[i("div",[e._l(e.locations,function(t){return i("div",{key:t,on:{click:function(i){return e.changeLocation(t)}}},[e._v("\n                    "+e._s(t)+"\n                ")])}),i("div",{on:{click:e.createLocation}},[i("i",{staticClass:"fas fa-plus"})])],2)]):e._e()]),i("img",{attrs:{id:"dragImage"}})],1)},Mn=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{attrs:{href:"#"}},[i("i",{staticClass:"far fa-compass"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{attrs:{href:"#"}},[i("i",{staticClass:"fas fa-cog"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"rm-topper"},[i("i",{staticClass:"icon-share-alt"})])}],Pn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"outer",on:{click:function(t){return t.target!==t.currentTarget?null:e.open(t)}}},[i("div",{staticClass:"current-color",style:e.transparent?"background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)":"background-color:"+e.color,on:{click:function(t){return t.target!==t.currentTarget?null:e.open(t)}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.display,expression:"display"}],staticClass:"mask",on:{click:function(t){return t.target!==t.currentTarget?null:e.closePicker(t)}}}),i("chrome-picker",{directives:[{name:"show",rawName:"v-show",value:e.display,expression:"display"}],ref:"chromePicker",style:{position:"fixed",left:e.left+"px",top:e.top+"px","z-index":9999},attrs:{value:e.color,tabindex:"-1"},on:{input:e.updateColor}})],1)},Dn=[],Nn=i("c345"),An=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.display=!1,e.left=0,e.top=0,e.transparent=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){this.transparent=0===this.$refs.chromePicker.val.rgba.a,this.setPosition()}},{key:"open",value:function(){var e=this;this.display||this.disabled||(this.setPosition(),this.display=!0,this.$nextTick(function(){return e.$children[0].$el.focus()}))}},{key:"updateColor",value:function(e){this.transparent=0===e.rgba.a;var t=ct()(e.rgba).toRgbString();this.$emit("update:color",t),this.$emit("input",t)}},{key:"closePicker",value:function(){this.display=!1,this.$emit("change",this.color)}},{key:"setPosition",value:function(){var e=this.$el.getBoundingClientRect();e.right+224>window.innerWidth?this.left=e.left-224:this.left=e.right,e.bottom+242>window.innerHeight?this.top=e.top-242:this.top=e.bottom}}]),t}(n["default"]);k["a"]([Object(K["a"])(String)],An.prototype,"color",void 0),k["a"]([Object(K["a"])(Boolean)],An.prototype,"disabled",void 0),An=k["a"]([Object(x["b"])({components:{"chrome-picker":Nn["Chrome"]}})],An);var Rn=An,Vn=Rn,Un=(i("618b"),Object(o["a"])(Vn,Pn,Dn,!1,null,"24ff2c54",null)),Fn=Un.exports,$n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",[e._l(e.folders,function(t){return i("li",{key:t,staticClass:"folder",on:{click:function(t){return t.stopPropagation(),e.toggle(t)}}},[e._v("\n        "+e._s(t)+"\n        "),i("asset-node",{attrs:{asset:e.asset[t]}})],1)}),e._l(e.files,function(t){return i("li",{key:t.name,staticClass:"file draggable token",attrs:{draggable:"true"},on:{mouseover:function(i){e.showImage=t.hash},mouseout:function(t){e.showImage=null},dragstart:function(i){return e.dragStart(i,"/static/assets/"+t.hash)}}},[e._v("\n        "+e._s(t.name)+"\n        "),e.showImage==t.hash?i("div",{staticClass:"preview"},[i("img",{staticClass:"asset-preview-image",attrs:{src:"/static/assets/"+t.hash}})]):e._e()])})],2)},zn=[],Bn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.showImage=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"toggle",value:function(e){for(var t=0;t<e.target.children.length;t++){var i=e.target.children[t];i.style.display=""===i.style.display?"block":""}}},{key:"dragStart",value:function(e,t){if(this.showImage=null,null!==e&&null!==e.dataTransfer){var i=e.target.querySelector(".preview");e.dataTransfer.setDragImage(i,0,0),e.dataTransfer.setData("text/plain",t)}}},{key:"folders",get:function(){return Object.keys(this.asset).filter(function(e){return!["__files"].includes(e)}).sort(fe)}},{key:"files",get:function(){return this.asset.__files?this.asset.__files.concat().sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}):[]}}]),t}(n["default"]);k["a"]([Object(K["a"])()],Bn.prototype,"asset",void 0),Bn=k["a"]([Object(x["b"])({name:"asset-node"})],Bn);var Hn=Bn,Gn=Hn,Wn=(i("3ba3"),Object(o["a"])(Gn,$n,zn,!1,null,"03f9ac64",null)),Xn=Wn.exports,Yn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible={settings:!1,locations:!1},e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"settingsClick",value:function(e){if(e.target.classList.contains("menu-accordion")){e.target.classList.toggle("menu-accordion-active");var t=e.target.nextElementSibling;null!==t&&(t.style.display=""===t.style.display?"block":"")}}},{key:"changeLocation",value:function(e){Je.emit("Location.Change",e)}},{key:"createLocation",value:function(){this.$parent.$parent.$refs.prompt.prompt("New location name:","Create new location").then(function(e){Je.emit("Location.New",e)},function(){})}},{key:"createNote",value:function(){var e={title:"New note",text:"",uuid:ve()};Ct.newNote({note:e,sync:!0}),this.openNote(e)}},{key:"openNote",value:function(e){this.$parent.$parent.$refs.note.open(e)}},{key:"openDmSettings",value:function(){tt.$emit("DmSettings.Open")}},{key:"IS_DM",get:function(){return Ct.IS_DM||Ct.FAKE_PLAYER}},{key:"gridColour",get:function(){return Ct.gridColour},set:function(e){Ct.setGridColour({colour:e,sync:!0})}},{key:"fowColour",get:function(){return Ct.fowColour},set:function(e){Ct.setFOWColour({colour:e,sync:!0})}},{key:"rulerColour",get:function(){return Ct.rulerColour},set:function(e){Ct.setRulerColour({colour:e,sync:!0})}}]),t}(n["default"]);Yn=k["a"]([Object(x["b"])({components:{"color-picker":Fn,"asset-node":Xn},computed:Object.assign({},Object(N["b"])("game",["locations","assets","notes"]))})],Yn);var Kn=Yn,qn=Kn,Qn=(i("6146"),Object(o["a"])(qn,Tn,Mn,!1,null,"9190ff3e",null)),Zn=Qn.exports,Jn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return null!==e.note?i("modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("span",{on:{click:function(t){return e.$refs.title.select()}}},[i("i",{staticClass:"fas fa-pencil-alt",staticStyle:{"font-size":"15px"}})]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.note.title,expression:"note.title"}],ref:"title",domProps:{value:e.note.title},on:{change:e.updateNote,input:function(t){t.target.composing||e.$set(e.note,"title",t.target.value)}}}),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}],null,!1,1320213373)},[i("div",{staticClass:"modal-body"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.note.text,expression:"note.text"}],ref:"textarea",style:{height:e.calcHeight()},domProps:{value:e.note.text},on:{change:e.updateNote,input:function(t){t.target.composing||e.$set(e.note,"text",t.target.value)}}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.removeNote}},[i("i",{staticClass:"far fa-trash-alt"}),e._v("\n            Remove\n        ")])])]):e._e()},ea=[],ta=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.note=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"open",value:function(e){this.visible=!0,this.note=e}},{key:"calcHeight",value:function(){if(this.$refs.textarea){var e=this.$refs.textarea;return e.style.height="auto",e.style.height=e.scrollHeight+"px",e.scrollHeight+"px"}return"100px"}},{key:"updateNote",value:function(){this.note&&Ct.updateNote({note:this.note,sync:!0})}},{key:"removeNote",value:function(){var e=this;this.$parent.$parent.$refs.confirm.open("Are you sure you wish to remove this?").then(function(t){t&&e.note&&(Ct.removeNote({note:e.note,sync:!0}),e.visible=!1)},function(){})}}]),t}(n["default"]);ta=k["a"]([Object(x["b"])({components:{Modal:ee}})],ta);var ia=ta,na=ia,aa=(i("57af"),Object(o["a"])(na,Jn,ea,!1,null,"2c1a0e9a",null)),ra=aa.exports,oa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.shapes.length>0,expression:"shapes.length > 0"}]},e._l(e.shapes,function(t){return i("div",{key:t.uuid},[i("div",{attrs:{id:"selection-menu"}},[i("div",{attrs:{id:"selection-edit-button"},on:{click:e.openEditDialog}},[i("i",{staticClass:"fas fa-edit"})]),i("div",{attrs:{id:"selection-name"}},[e._v(e._s(t.name))]),i("div",{attrs:{id:"selection-trackers"}},[e._l(e.visibleTrackers,function(t){return[i("div",{key:"name-"+t.uuid},[e._v(e._s(t.name))]),i("div",{key:"value-"+t.uuid,staticClass:"selection-tracker-value",on:{click:function(i){return e.changeValue(t,!1)}}},[0===t.maxvalue?[e._v("\n                            "+e._s(t.value)+"\n                        ")]:[e._v("\n                            "+e._s(t.value)+" / "+e._s(t.maxvalue)+"\n                        ")]],2)]})],2),i("div",{attrs:{id:"selection-auras"}},[e._l(e.visibleAuras,function(t){return[i("div",{key:"name-"+t.uuid},[e._v(e._s(t.name))]),i("div",{key:"value-"+t.uuid,staticClass:"selection-tracker-value",on:{click:function(i){return e.changeValue(t,!0)}}},[0===t.dim?[e._v("\n                            "+e._s(t.value)+"\n                        ")]:[e._v("\n                            "+e._s(t.value)+" / "+e._s(t.dim)+"\n                        ")]],2)]})],2)]),i("edit-dialog",{ref:"editDialog",refInFor:!0,attrs:{shape:t}})],1)}),0)},sa=[],la=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Edit asset")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("div",{staticClass:"grid"},[i("label",{attrs:{for:"shapeselectiondialog-name"}},[e._v("Name")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.shape.name,expression:"shape.name"}],staticStyle:{"grid-column":"numerator / remove"},attrs:{type:"text",id:"shapeselectiondialog-name",disabled:!e.owned},domProps:{value:e.shape.name},on:{change:function(t){return e.updateShape(!1)},input:function(t){t.target.composing||e.$set(e.shape,"name",t.target.value)}}}),i("div",{style:{opacity:e.shape.nameVisible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(t){e.shape.nameVisible=!e.shape.nameVisible,e.updateShape(!1)}}},[i("i",{staticClass:"fas fa-eye"})]),i("label",{attrs:{for:"shapeselectiondialog-istoken"}},[e._v("Is a token")]),i("input",{staticClass:"styled-checkbox",staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-istoken",disabled:!e.owned},domProps:{checked:e.shape.isToken},on:{click:e.setToken}}),i("label",{attrs:{for:"shapeselectiondialog-visionblocker"}},[e._v("Blocks vision/light")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.shape.visionObstruction,expression:"shape.visionObstruction"}],staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-visionblocker",disabled:!e.owned},domProps:{checked:Array.isArray(e.shape.visionObstruction)?e._i(e.shape.visionObstruction,null)>-1:e.shape.visionObstruction},on:{change:[function(t){var i=e.shape.visionObstruction,n=t.target,a=!!n.checked;if(Array.isArray(i)){var r=null,o=e._i(i,r);n.checked?o<0&&e.$set(e.shape,"visionObstruction",i.concat([r])):o>-1&&e.$set(e.shape,"visionObstruction",i.slice(0,o).concat(i.slice(o+1)))}else e.$set(e.shape,"visionObstruction",a)},e.setVisionBlocker]}}),i("label",{attrs:{for:"shapeselectiondialog-moveblocker"}},[e._v("Blocks movement")]),i("input",{staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-moveblocker",disabled:!e.owned},domProps:{checked:e.shape.movementObstruction},on:{click:e.setMovementBlocker}}),i("label",{attrs:{for:"shapeselectiondialog-strokecolour"}},[e._v("Border colour")]),i("color-picker",{staticStyle:{"grid-column-start":"remove"},attrs:{color:e.shape.strokeColour,disabled:!e.owned},on:{"update:color":function(t){return e.$set(e.shape,"strokeColour",t)},input:function(t){return e.updateShape(!0,!0)},change:function(t){return e.updateShape(!0)}}}),i("label",{attrs:{for:"shapeselectiondialog-fillcolour"}},[e._v("Fill colour")]),i("color-picker",{staticStyle:{"grid-column-start":"remove"},attrs:{color:e.shape.fillColour,disabled:!e.owned},on:{"update:color":function(t){return e.$set(e.shape,"fillColour",t)},input:function(t){return e.updateShape(!0,!0)},change:function(t){return e.updateShape(!0)}}}),i("div",{staticClass:"spanrow header"},[e._v("Access")]),e._l(e.shape.owners,function(t){return[i("input",{key:t,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t},on:{change:function(i){return e.updateOwner(i,t)}}}),""!==t?i("div",{key:"remove-"+t,style:{opacity:e.owned?1:.3,textAlign:"center",gridColumnStart:"remove"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeOwner(t)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]}),i("div",{staticClass:"spanrow header"},[e._v("Trackers")]),e._l(e.shape.trackers,function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"tracker.name"}],key:"name-"+t.uuid,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t.name},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"name",i.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.value,expression:"tracker.value",modifiers:{number:!0}}],key:"value-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.value},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"value",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"fspan-"+t.uuid},[e._v("/")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.maxvalue,expression:"tracker.maxvalue",modifiers:{number:!0}}],key:"maxvalue-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.maxvalue},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"maxvalue",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"sspan-"+t.uuid}),i("div",{key:"visibility-"+t.uuid,style:{opacity:t.visible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){t.visible=!t.visible,e.updateShape(!1)}}},[i("i",{staticClass:"fas fa-eye"})]),i("span",{key:"tspan-"+t.uuid}),""!==t.name||0!==t.value?i("div",{key:"remove-"+t.uuid,style:{opacity:e.owned?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeTracker(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]}),i("div",{staticClass:"spanrow header"},[e._v("Auras")]),e._l(e.shape.auras,function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"aura.name"}],key:"name-"+t.uuid,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t.name},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"name",i.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.value,expression:"aura.value",modifiers:{number:!0}}],key:"value-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.value},on:{change:function(t){return e.updateShape(!0)},input:function(i){i.target.composing||e.$set(t,"value",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"fspan-"+t.uuid},[e._v("/")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.dim,expression:"aura.dim",modifiers:{number:!0}}],key:"dimvalue-"+t.uuid,attrs:{type:"text",title:"Dim value",disabled:!e.owned},domProps:{value:t.dim},on:{change:function(t){return e.updateShape(!0)},input:function(i){i.target.composing||e.$set(t,"dim",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("color-picker",{key:"colour-"+t.uuid,attrs:{color:t.colour,disabled:!e.owned},on:{"update:color":function(i){return e.$set(t,"colour",i)},input:function(i){return e.updateAuraColour(t,i)},change:function(t){return e.updateShape(!0)}}}),i("div",{key:"visibility-"+t.uuid,style:{opacity:t.visible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){t.visible=!t.visible,e.updateShape(!0)}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{key:"visionsource-"+t.uuid,style:{opacity:t.visionSource?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.updateAuraVisionSource(t)}}},[i("i",{staticClass:"fas fa-lightbulb"})]),""!==t.name||0!==t.value?i("div",{key:"remove-"+t.uuid,style:{opacity:e.owned?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeAura(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]}),i("div",{staticClass:"spanrow header"},[e._v("Labels")]),i("div",{staticClass:"spanrow",attrs:{id:"labels"}},[e._l(e.shape.labels,function(t){return i("div",{key:t.uuid,staticClass:"label"},[t.category?[i("div",{staticClass:"label-user"},[e._v(e._s(t.category))]),i("div",{staticClass:"label-main",on:{click:function(i){return e.removeLabel(t.uuid)}}},[e._v(e._s(t.name))])]:e._e(),t.category?e._e():[i("div",{staticClass:"label-main",on:{click:function(i){return e.removeLabel(t.uuid)}}},[e._v(e._s(t.name))])]],2)}),e.owned?i("div",{staticClass:"label",attrs:{id:"label-add"}},[i("div",{staticClass:"label-main",on:{click:e.openLabelManager}},[e._v("+")])]):e._e()],2),i("div",{staticClass:"spanrow header"},[e._v("Annotation")]),i("textarea",{staticClass:"spanrow",attrs:{disabled:!e.owned},domProps:{value:e.shape.annotation},on:{change:e.updateAnnotation}})],2)])])},ca=[],ua=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("EditDialog.Open",function(t){e.shape=t,e.visible=!0}),tt.$on("EditDialog.AddLabel",function(t){e.visible&&(e.shape.labels.push(Ct.labels[t]),e.updateShape(!0))})}},{key:"beforeDestroy",value:function(){tt.$off("EditDialog.Open"),tt.$off("EditDialog.AddLabel")}},{key:"updated",value:function(){this.addEmpty()}},{key:"addEmpty",value:function(){""!==this.shape.owners[this.shape.owners.length-1]&&this.shape.addOwner(""),this.shape.trackers.length&&""===this.shape.trackers[this.shape.trackers.length-1].name&&0===this.shape.trackers[this.shape.trackers.length-1].value||this.shape.trackers.push({uuid:ve(),name:"",value:0,maxvalue:0,visible:!1}),this.shape.auras.length&&""===this.shape.auras[this.shape.auras.length-1].name&&0===this.shape.auras[this.shape.auras.length-1].value||this.shape.auras.push({uuid:ve(),name:"",value:0,dim:0,visionSource:!1,colour:"rgba(0,0,0,0)",visible:!1})}},{key:"updateShape",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.owned&&(Je.emit("Shape.Update",{shape:this.shape.asDict(),redraw:e,temporary:t}),e&&Et.invalidate(),this.addEmpty())}},{key:"setToken",value:function(e){this.owned&&(this.shape.setIsToken(e.target.checked),this.updateShape(!0))}},{key:"setVisionBlocker",value:function(e){this.owned&&(this.shape.checkVisionSources(),this.updateShape(!0))}},{key:"setMovementBlocker",value:function(e){this.owned&&(this.shape.setMovementBlock(e.target.checked),this.updateShape(!1))}},{key:"updateAnnotation",value:function(e){var t=this;if(this.owned){var i=""!==this.shape.annotation;this.shape.annotation=e.target.value,""===this.shape.annotation||i?""===this.shape.annotation&&i&&(Ct.annotations.splice(Ct.annotations.findIndex(function(e){return e===t.shape.uuid})),Et.hasLayer("draw")&&Et.getLayer("draw").invalidate(!0)):(Ct.annotations.push(this.shape.uuid),Et.hasLayer("draw")&&Et.getLayer("draw").invalidate(!0)),this.updateShape(!1)}}},{key:"updateOwner",value:function(e,t){this.owned&&(this.shape.updateOwner(t,e.target.value),this.updateShape(Ct.fowLOS))}},{key:"removeOwner",value:function(e){this.owned&&(this.shape.removeOwner(e),this.updateShape(Ct.fowLOS))}},{key:"removeTracker",value:function(e){this.owned&&(this.shape.trackers=this.shape.trackers.filter(function(t){return t.uuid!==e}),this.updateShape(!1))}},{key:"removeAura",value:function(e){this.owned&&(this.shape.auras=this.shape.auras.filter(function(t){return t.uuid!==e}),this.shape.checkVisionSources(),this.updateShape(!0))}},{key:"updateAuraVisionSource",value:function(e){if(this.owned){e.visionSource=!e.visionSource;var t=Ct.visionSources.findIndex(function(t){return t.aura===e.uuid});e.visionSource&&-1===t?Ct.visionSources.push({shape:this.shape.uuid,aura:e.uuid}):!e.visionSource&&t>=0&&Ct.visionSources.splice(t,1),this.updateShape(!0)}}},{key:"updateAuraColour",value:function(e,t){if(this.owned){var i=Et.getLayer(this.shape.layer);void 0!==i&&i.invalidate(!e.visionSource)}}},{key:"openLabelManager",value:function(){tt.$emit("LabelManager.Open")}},{key:"removeLabel",value:function(e){this.owned&&(this.shape.labels=this.shape.labels.filter(function(t){return t.uuid!==e}),this.updateShape(!0))}},{key:"owned",get:function(){return this.shape.ownedBy()}}]),t}(n["default"]);k["a"]([Object(K["a"])()],ua.prototype,"shape",void 0),ua=k["a"]([Object(x["b"])({components:{Modal:ee,"color-picker":Fn}})],ua);var ha=ua,da=ha,va=(i("6da0"),Object(o["a"])(da,la,ca,!1,null,"40314b6e",null)),fa=va.exports,pa=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.shape=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("SelectionInfo.Shape.Set",function(t){e.shape=t})}},{key:"beforeDestroy",value:function(){tt.$off("SelectionInfo.Shape.Set")}},{key:"openEditDialog",value:function(){this.$refs.editDialog.visible=!0}},{key:"changeValue",value:function(e,t){var i=this;null!==this.shape&&this.$parent.$parent.$refs.prompt.prompt("New  ".concat(e.name," value:"),"Updating ".concat(e.name)).then(function(n){if(null!==i.shape){var a=e.value;"+"===n[0]||"-"===n[0]?e.value+=parseInt(n,10):e.value=parseInt(n,10),isNaN(e.value)&&(e.value=a),Je.emit("Shape.Update",{shape:i.shape.asDict(),redraw:t,temporary:!1}),t&&Et.invalidate()}},function(){})}},{key:"shapes",get:function(){return null===this.shape?[]:[this.shape]}},{key:"visibleTrackers",get:function(){return null===this.shape?[]:this.shape.trackers.filter(function(e){return""!==e.name||0!==e.value})}},{key:"visibleAuras",get:function(){return null===this.shape?[]:this.shape.auras.filter(function(e){return""!==e.name||0!==e.value})}}]),t}(n["default"]);pa=k["a"]([Object(x["b"])({components:{"edit-dialog":fa}})],pa);var ya=pa,ga=ya,ma=(i("ae5a"),Object(o["a"])(ga,oa,sa,!1,null,"4ce4ab65",null)),ba=ma.exports,wa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{attrs:{id:"toolselect"}},[i("ul",e._l(e.visibleTools,function(t){return i("li",{directives:[{name:"show",rawName:"v-show",value:e.toolVisible(t),expression:"toolVisible(tool)"}],key:t,ref:t+"-selector",refInFor:!0,class:{"tool-selected":e.currentTool===t},on:{mousedown:function(i){e.currentTool=t}}},[i("a",{attrs:{href:"#"}},[e._v(e._s(t))])])}),0)]),i("div",[[i("select-tool",{directives:[{name:"show",rawName:"v-show",value:"Select"===e.currentTool,expression:"currentTool === 'Select'"}],ref:"selectTool"}),i("pan-tool",{directives:[{name:"show",rawName:"v-show",value:"Pan"===e.currentTool,expression:"currentTool === 'Pan'"}]}),i("keep-alive",[i("draw-tool",{directives:[{name:"show",rawName:"v-show",value:"Draw"===e.currentTool,expression:"currentTool === 'Draw'"}]})],1),i("ruler-tool",{directives:[{name:"show",rawName:"v-show",value:"Ruler"===e.currentTool,expression:"currentTool === 'Ruler'"}]}),i("map-tool",{directives:[{name:"show",rawName:"v-show",value:"Map"===e.currentTool,expression:"currentTool === 'Map'"}]}),i("filter-tool",{directives:[{name:"show",rawName:"v-show",value:"Filter"===e.currentTool,expression:"currentTool === 'Filter'"}]}),i("vision-tool",{directives:[{name:"show",rawName:"v-show",value:"Vision"===e.currentTool,expression:"currentTool === 'Vision'"}]}),i("shape-menu",{ref:"shapecontext"}),i("createtoken-dialog",{ref:"createtokendialog"})]],2)])},ka=[],xa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return void 0!==e.getActiveLayer()?i("ContextMenu",{attrs:{visible:e.visible,left:e.x+"px",top:e.y+"px"},on:{close:e.close}},[e.getLayers().length>1?i("li",[e._v("\n        Layer\n        "),i("ul",e._l(e.getLayers(),function(t){return i("li",{key:t.name,style:[e.getActiveLayer().name===t.name?{"background-color":"#82c8a0"}:{}],on:{click:function(i){return e.setLayer(t.name)}}},[e._v("\n                "+e._s(t.name)+"\n            ")])}),0)]):e._e(),i("li",{on:{click:e.moveToBack}},[e._v("Move to back")]),i("li",{on:{click:e.moveToFront}},[e._v("Move to front")]),i("li",{on:{click:e.addInitiative}},[e._v(e._s(e.getInitiativeWord())+" initiative")]),i("li",{on:{click:e.openEditDialog}},[e._v("Show properties")])]):e._e()},Oa=[],Sa=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.x=0,e.y=0,e.shape=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"open",value:function(e,t){var i=this;this.visible=!0,this.x=e.pageX,this.y=e.pageY,this.shape=t,this.$nextTick(function(){return i.$children[0].$el.focus()})}},{key:"close",value:function(){this.visible=!1,this.shape=null}},{key:"getLayers",value:function(){return Et.layers.filter(function(e){return e.selectable&&(Ct.IS_DM||e.playerEditable)})}},{key:"getActiveLayer",value:function(){return Et.getLayer()}},{key:"getInitiativeWord",value:function(){return null===this.shape?"":mn.contains(this.shape.uuid)?"Show":"Add"}},{key:"setLayer",value:function(e){null!==this.shape&&(this.shape.moveLayer(e,!0),this.close())}},{key:"moveToBack",value:function(){if(null!==this.shape){var e=this.getActiveLayer();e.moveShapeOrder(this.shape,0,!0),this.close()}}},{key:"moveToFront",value:function(){if(null!==this.shape){var e=this.getActiveLayer();e.moveShapeOrder(this.shape,e.shapes.length-1,!0),this.close()}}},{key:"addInitiative",value:function(){null!==this.shape&&(this.$parent.$parent.$parent,mn.contains(this.shape.uuid)||mn.addInitiative(this.shape.getInitiativeRepr()),tt.$emit("Initiative.Show"),this.close())}},{key:"openEditDialog",value:function(){tt.$emit("EditDialog.Open",this.shape),this.close()}},{key:"activeLayer",get:function(){var e=Et.getLayer();return void 0===e?"":e.name}}]),t}(n["default"]);Sa=k["a"]([Object(x["b"])({components:{ContextMenu:T}})],Sa);var _a=Sa,Ca=_a,La=(i("8d74"),Object(o["a"])(Ca,xa,Oa,!1,null,"1a591495",null)),Ea=La.exports,Ia=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v("\n        Create basic token\n    ")])}}])},[i("div",{staticClass:"modal-body"},[i("label",{attrs:{for:"createtokendialog-text"}},[e._v("Text")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"text"}],attrs:{type:"text",id:"createtokendialog-name"},domProps:{value:e.text},on:{input:function(t){t.target.composing||(e.text=t.target.value)}}}),i("label",[e._v("Colours")]),i("div",{staticClass:"colours"},[i("span",[e._v("Fill:")]),i("color-picker",{attrs:{color:e.fillColour},on:{"update:color":function(t){e.fillColour=t}}}),i("span",[e._v("Border:")]),i("color-picker",{attrs:{color:e.borderColour},on:{"update:color":function(t){e.borderColour=t}}})],1),i("canvas",{ref:"canvas",attrs:{width:"100px",height:"100px"}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.submit}},[e._v("Submit")])])])},ja=[],Ta=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.x=0,e.y=0,e.visible=!1,e.text="X",e.fillColour="rgba(255, 255, 255, 1)",e.borderColour="rgba(0, 0, 0, 1)",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){this.updatePreview()}},{key:"onTextChange",value:function(e,t){this.updatePreview()}},{key:"onFillChange",value:function(e,t){this.updatePreview()}},{key:"onBorderChange",value:function(e,t){this.updatePreview()}},{key:"open",value:function(e,t){this.visible=!0,this.x=e,this.y=t}},{key:"submit",value:function(){var e=Et.getLayer();if(void 0!==e){var t=new Ri(gt(new rt(this.x,this.y)),pt(Ct.unitSize/2),this.text,"10px serif",this.fillColour,this.borderColour);t.addOwner(Ct.username),e.addShape(t,!0),e.invalidate(!1),this.visible=!1}}},{key:"updatePreview",value:function(){var e=this.$refs.canvas.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath();var t={x:e.canvas.width/2,y:e.canvas.height/2},i=.9*Math.min(t.x,t.y);e.fillStyle=this.fillColour,e.arc(t.x,t.y,i,0,2*Math.PI),e.fill(),"rgba(0, 0, 0, 0)"!==this.borderColour&&(e.beginPath(),e.lineWidth=5,e.strokeStyle=this.borderColour,e.arc(t.x,t.y,i,0,2*Math.PI),e.stroke()),e.save(),e.textAlign="center",e.textBaseline="middle";var n=ye(e,this.text,i,i),a=0;e.transform(n,a,-a,n,t.x,t.y),e.fillStyle=lt["mostReadable"](this.fillColour,["#000","#fff"]).toHexString(),e.fillText(this.text,0,0),e.restore()}}]),t}(n["default"]);k["a"]([Object(K["b"])("text")],Ta.prototype,"onTextChange",null),k["a"]([Object(K["b"])("fillColour")],Ta.prototype,"onFillChange",null),k["a"]([Object(K["b"])("borderColour")],Ta.prototype,"onBorderChange",null),Ta=k["a"]([Object(x["b"])({components:{Modal:ee,"color-picker":Fn},computed:Object.assign({},Object(N["b"])("game",["unitSize"]))})],Ta);var Ma=Ta,Pa=Ma,Da=(i("2a75"),Object(o["a"])(Pa,Ia,ja,!1,null,"bf063922",null)),Na=Da.exports,Aa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.IS_DM,expression:"IS_DM"}]},[e._v("Mode")]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.IS_DM,expression:"IS_DM"}],staticClass:"selectgroup"},e._l(e.modes,function(t){return i("div",{key:t,staticClass:"option",class:{"option-selected":e.modeSelect===t},on:{click:function(i){e.modeSelect=t}}},[e._v("\n            "+e._s(t)+"\n        ")])}),0),i("div",[e._v("Shape")]),i("div",{staticClass:"selectgroup"},e._l(e.shapes,function(t){return i("div",{key:t,staticClass:"option",class:{"option-selected":e.shapeSelect===t},on:{click:function(i){e.shapeSelect=t}}},[i("i",{staticClass:"fas",class:"fa-"+t})])}),0),i("div",[e._v("Colours")]),i("div",{staticClass:"selectgroup"},[i("color-picker",{staticClass:"option",attrs:{color:e.fillColour},on:{"update:color":function(t){e.fillColour=t}}}),i("color-picker",{staticClass:"option",attrs:{color:e.borderColour},on:{"update:color":function(t){e.borderColour=t}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"paint-brush"===e.shapeSelect,expression:"shapeSelect === 'paint-brush'"}]},[e._v("Brush size")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.brushSize,expression:"brushSize"},{name:"show",rawName:"v-show",value:"paint-brush"===e.shapeSelect,expression:"shapeSelect === 'paint-brush'"}],staticStyle:{"max-width":"100px"},attrs:{type:"text"},domProps:{value:e.brushSize},on:{input:function(t){t.target.composing||(e.brushSize=t.target.value)}}})]):e._e()},Ra=[],Va=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="",e.selected=!1,e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"created",value:function(){var e=this;this.$parent.$on("mousedown",function(t,i){i===e.name&&e.onMouseDown(t)}),this.$parent.$on("mouseup",function(t,i){i===e.name&&e.onMouseUp(t)}),this.$parent.$on("mousemove",function(t,i){i===e.name&&e.onMouseMove(t)}),this.$parent.$on("contextmenu",function(t,i){i===e.name&&e.onContextMenu(t)}),this.$parent.$on("tools-select-change",function(t,i){i===e.name?(e.selected=!1,e.onDeselect()):t===e.name&&(e.selected=!0,e.onSelect())})}},{key:"onSelect",value:function(){}},{key:"onDeselect",value:function(){}},{key:"onMouseDown",value:function(e){}},{key:"onMouseUp",value:function(e){}},{key:"onMouseMove",value:function(e){}},{key:"onContextMenu",value:function(e){}},{key:"detailRight",get:function(){var e=this.$parent.$refs[this.name+"-selector"][0].getBoundingClientRect(),t=e.left+e.width/2;return"".concat(window.innerWidth-Math.min(window.innerWidth-25,t+75),"px")}},{key:"detailArrow",get:function(){var e=this.$parent.$refs[this.name+"-selector"][0].getBoundingClientRect(),t=e.left+e.width/2,i=Math.min(window.innerWidth-25,t+75);return"".concat(i-t-14,"px")}}]),t}(n["default"]);Va=k["a"]([x["b"]],Va);var Ua,Fa,$a=Va,za=$a,Ba=(i("12d3"),Object(o["a"])(za,Ua,Fa,!1,null,null,null)),Ha=Ba.exports,Ga=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Draw",e.active=!1,e.startPoint=null,e.shape=null,e.brushHelper=null,e.ruler=null,e.fillColour="rgba(0, 0, 0, 1)",e.borderColour="rgba(255, 255, 255, 0)",e.shapeSelect="square",e.shapes=["square","circle","draw-polygon","paint-brush"],e.modeSelect="normal",e.modes=["normal","reveal","hide"],e.brushSize=pt(Ct.unitSize),e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"onFillChange",value:function(){this.brushHelper&&(this.brushHelper.fillColour=this.fillColour)}},{key:"onModeUpdate",value:function(e,t){this.onModeChange(e,t)}},{key:"setupBrush",value:function(){null!==this.brushHelper&&("reveal"===this.modeSelect||"hide"===this.modeSelect?(this.brushHelper.options.set("preFogShape",!0),this.brushHelper.options.set("skipDraw",!0),this.brushHelper.fillColour="rgba(0, 0, 0, 1)","reveal"===this.modeSelect?this.brushHelper.globalCompositeOperation="source-over":"hide"===this.modeSelect&&(this.brushHelper.globalCompositeOperation="destination-out")):(this.brushHelper.options.delete("preFogShape"),this.brushHelper.options.delete("skipDraw"),this.brushHelper.globalCompositeOperation="source-over",this.brushHelper.fillColour=this.fillColour))}},{key:"onModeChange",value:function(e,t){if(null!==this.brushHelper){var i=Et.getLayer("fow"),n=Et.getLayer();void 0!==i&&void 0!==n&&(this.setupBrush(),"normal"!==e&&"normal"===t?(n.removeShape(this.brushHelper,!1),i.addShape(this.brushHelper,!1)):"normal"===e&&"normal"!==t&&(n.addShape(this.brushHelper,!1),i.removeShape(this.brushHelper,!1)))}}},{key:"getLayer",value:function(){return"normal"===this.modeSelect?Et.getLayer():Et.getLayer("fow")}},{key:"onMouseDown",value:function(e){var t=this.getLayer();if(void 0!==t){if(this.active)null!==this.shape&&this.shape instanceof zi&&this.shape._vertices.push(gt(kt(e)));else{switch(this.startPoint=gt(kt(e)),this.active=!0,this.shapeSelect){case"square":this.shape=new Fi(this.startPoint.clone(),0,0,this.fillColour,this.borderColour);break;case"circle":this.shape=new Ai(this.startPoint.clone(),this.helperSize,this.fillColour,this.borderColour);break;case"paint-brush":this.shape=new Ui(this.startPoint.clone(),[],this.brushSize),this.shape.fillColour=this.fillColour;break;case"draw-polygon":this.shape=new zi(this.startPoint.clone(),[],this.fillColour,this.borderColour);break;default:return}"normal"!==this.modeSelect&&(this.shape.options.set("preFogShape",!0),this.shape.options.set("skipDraw",!0),this.shape.fillColour="rgba(0, 0, 0, 1)"),"reveal"===this.modeSelect?this.shape.globalCompositeOperation="source-over":"hide"===this.modeSelect&&(this.shape.globalCompositeOperation="destination-out"),this.shape.addOwner(Ct.username),"fow"===t.name&&"normal"===this.modeSelect&&(this.shape.visionObstruction=!0),t.addShape(this.shape,!0,!1,!1),this.pushBrushBack()}if(null!==this.shape&&this.shape instanceof zi){var i=gt(kt(e));null===this.ruler?(this.ruler=new Vi(i,i,3,"black"),t.addShape(this.ruler,!1)):(this.ruler.refPoint=i,this.ruler.endPoint=i),this.shape.visionObstruction&&Ci.vision.insertConstraint(this.shape.points[this.shape.points.length-2],this.shape.points[this.shape.points.length-1]),t.invalidate(!1),Je.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!0})}}else console.log("No active layer!")}},{key:"onMouseMove",value:function(e){var t=gt(kt(e)),i=this.getLayer();if(void 0!==i){if(null!==this.brushHelper&&(this.brushHelper.r=this.helperSize,this.brushHelper.refPoint=t,this.active||i.invalidate(!1)),this.active&&null!==this.startPoint&&null!==this.shape){switch(this.shapeSelect){case"square":var n=this.shape,a=Math.abs(t.x-this.startPoint.x),r=Math.abs(t.y-this.startPoint.y);if(a===n.w&&r===n.h)return;n.w=a,n.h=r,(t.x<this.startPoint.x||t.y<this.startPoint.y)&&(this.shape.refPoint=new at(Math.min(this.startPoint.x,t.x),Math.min(this.startPoint.y,t.y)));break;case"circle":var o=this.shape,s=t.subtract(this.startPoint).length();if(o.r===s)return;o.r=s;break;case"paint-brush":var l=this.shape;if(St(l.points[l.points.length-1],[t.x,t.y]))return;l._points.push(t);break;case"draw-polygon":this.ruler.endPoint=t;break}this.shape instanceof zi||(Je.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!0}),this.shape.visionObstruction&&(this.shape.triagVertices.length>1&&_i.deleteFromTriag({target:Si.VISION,vertices:this.shape.triagVertices,standalone:!1}),_i.addToTriag({target:Si.VISION,points:this.shape.points}))),i.invalidate(!1)}}else console.log("No active layer!")}},{key:"onMouseUp",value:function(e){!this.active||null===this.shape||this.shape instanceof zi||(!e.altKey&&this.useGrid&&(_i.deleteFromTriag({target:Si.VISION,vertices:this.shape.triagVertices,standalone:!1}),this.shape.resizeToGrid(),_i.addToTriag({target:Si.VISION,points:this.shape.points})),this.finaliseShape())}},{key:"onContextMenu",value:function(e){if(this.active&&null!==this.shape&&this.shape instanceof zi){var t=this.getLayer();void 0!==t?(t.removeShape(this.ruler,!1),this.ruler=null,this.finaliseShape()):console.log("No active layer!")}}},{key:"finaliseShape",value:function(){null!==this.shape&&(this.shape.visionObstruction&&_i.recalculateVision(),this.shape.movementObstruction&&_i.recalculateMovement(),Je.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!1}),this.active=!1)}},{key:"onSelect",value:function(){var e=this.getLayer();void 0!==e&&(this.brushHelper=new Ai(new at(-1e3,-1e3),this.brushSize/2,this.fillColour),this.setupBrush(),e.addShape(this.brushHelper,!1))}},{key:"onDeselect",value:function(){var e=this.getLayer();null!==this.brushHelper&&void 0!==e&&e.removeShape(this.brushHelper,!1),this.active&&void 0!==e&&null!==this.shape&&(e.removeShape(this.shape,!0,!1),this.shape=null,this.active=!1,e.invalidate(!1))}},{key:"pushBrushBack",value:function(){var e=this.getLayer();void 0!==e?(null!==this.brushHelper&&e.removeShape(this.brushHelper,!1),this.brushHelper=new Ai(new at(-1e3,-1e3),this.brushSize/2,this.fillColour),this.setupBrush(),e.addShape(this.brushHelper,!1)):console.log("No active layer!")}},{key:"helperSize",get:function(){return"paint-brush"===this.shapeSelect?this.brushSize/2:pt(this.unitSize)/8}},{key:"IS_DM",get:function(){return Ct.IS_DM}},{key:"unitSize",get:function(){return Ct.unitSize}},{key:"useGrid",get:function(){return Ct.useGrid}}]),t}(Ha);k["a"]([Object(K["b"])("fillColour")],Ga.prototype,"onFillChange",null),k["a"]([Object(K["b"])("modeSelect")],Ga.prototype,"onModeUpdate",null),Ga=k["a"]([Object(x["b"])({components:{"color-picker":Fn}})],Ga);var Wa=Ga,Xa=Wa,Ya=(i("3d9b"),Object(o["a"])(Xa,Aa,Ra,!1,null,"5d5e81ae",null)),Ka=Ya.exports,qa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",{attrs:{id:"accordion-container"}},e._l(e.categories,function(t){return i("accordion",{key:t,attrs:{title:""===t?"no category":t,showArrow:!1,items:e.labels[t],initialValues:e.initalValues[t]},on:{selectionupdate:e.updateSelection}})}),1)]):e._e()},Qa=[],Za=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"accordion"},[i("div",{attrs:{id:"header"},on:{click:function(t){return t.preventDefault(),e.toggleDisplay(t)}}},[i("input",{ref:"overall",attrs:{type:"checkbox"},on:{click:function(t){return t.stopPropagation(),e.toggleCategory(t)}}}),i("strong",[e._v(e._s(e.title))]),e.showArrow?[i("span",{directives:[{name:"show",rawName:"v-show",value:e.showArrow&&!e.active,expression:"showArrow && !active"}],staticClass:"down-Arrow"},[e._v("")]),i("span",{directives:[{name:"show",rawName:"v-show",value:e.showArrow&&e.active,expression:"showArrow && active"}],staticClass:"up-Arrow"},[e._v("")])]:e._e()],2),i("div",{directives:[{name:"show",rawName:"v-show",value:e.active,expression:"active"}],attrs:{id:"body"}},e._l(e.items,function(t){return i("div",{key:t[0],staticClass:"item",on:{click:function(i){return e.toggleSelection(t[0])}}},[i("input",{attrs:{type:"checkbox"},domProps:{checked:e.selected.includes(t[0])},on:{click:function(e){e.preventDefault()}}}),e._v("\n            "+e._s(t[1])+"\n        ")])}),0)])},Ja=[],er=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.selected=[],e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){this.selected=this.initialValues,this.updateCategory()}},{key:"toggleDisplay",value:function(e){this.active=!this.active}},{key:"toggleCategory",value:function(){var e=this.$refs.overall;e.checked?this.selected=this.items.map(function(e){return e[0]}):this.selected=[],this.$emit("selectionupdate",{title:this.title,selection:this.selected})}},{key:"updateCategory",value:function(){var e=this.$refs.overall;0===this.selected.length?(e.checked=!1,e.indeterminate=!1):this.selected.length===this.items.length?(e.checked=!0,e.indeterminate=!1):(e.checked=!1,e.indeterminate=!0)}},{key:"toggleSelection",value:function(e){var t=this.selected.indexOf(e);-1===t?this.selected.push(e):this.selected.splice(t,1),this.updateCategory(),this.$emit("selectionupdate",{title:this.title,selection:this.selected})}}]),t}(n["default"]);k["a"]([Object(K["a"])(String)],er.prototype,"title",void 0),k["a"]([Object(K["a"])({default:!0,type:Boolean})],er.prototype,"showArrow",void 0),k["a"]([Object(K["a"])({default:function(){return[]}})],er.prototype,"items",void 0),k["a"]([Object(K["a"])({default:function(){return[]}})],er.prototype,"initialValues",void 0),er=k["a"]([x["b"]],er);var tr=er,ir=tr,nr=(i("aa79"),Object(o["a"])(ir,Za,Ja,!1,null,"32e257d0",null)),ar=nr.exports,rr=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Filter",e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"isFilter",value:function(e){return Ct.labelFilters.includes(e)}},{key:"toggleFilter",value:function(e){var t=Ct.labelFilters.indexOf(e);t>=0?Ct.labelFilters.splice(t,1):Ct.labelFilters.push(e),Et.invalidate()}},{key:"toggleUnlabeled",value:function(){Ct.toggleUnlabeledFilter(),Et.invalidate()}},{key:"updateSelection",value:function(e){if(e.title in this.labels){var t=!0,i=!1,n=void 0;try{for(var a,r=this.labels[e.title][Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=Object(Tt["a"])(a.value,2),s=o[0],l=(o[1],Ct.labelFilters.indexOf(s)),c=e.selection.includes(s);l>=0&&!c?(Ct.labelFilters.splice(l,1),Je.emit("Labels.Filter.Remove",s)):l<0&&c&&(Ct.labelFilters.push(s),Je.emit("Labels.Filter.Add",s))}}catch(u){i=!0,n=u}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}Et.invalidate()}}},{key:"labels",get:function(){for(var e={"":[]},t=0,i=Object.keys(Ct.labels);t<i.length;t++){var n=i[t],a=Ct.labels[n];a.category?(a.category in e||(e[a.category]=[]),e[a.category].push([a.uuid,a.name]),e[a.category].sort(function(e,t){return e[1].localeCompare(t[1])})):e[""].push([a.uuid,a.name])}return e}},{key:"initalValues",get:function(){for(var e=this,t={},i=function(){var i=a[n];t[i]=Ct.labelFilters.filter(function(t){return e.labels[i].map(function(e){return e[0]}).includes(t)})},n=0,a=Object.keys(this.labels);n<a.length;n++)i();return t}},{key:"categories",get:function(){return Object.keys(this.labels).sort()}}]),t}(Ha);rr=k["a"]([Object(x["b"])({components:{accordion:ar}})],rr);var or=rr,sr=or,lr=(i("e3f5"),i("4a14"),Object(o["a"])(sr,qa,Qa,!1,null,"75b63661",null)),cr=lr.exports,ur=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",[e._v("#X")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.xCount,expression:"xCount"}],attrs:{type:"text"},domProps:{value:e.xCount},on:{input:function(t){t.target.composing||(e.xCount=t.target.value)}}}),i("div",[e._v("#Y")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.yCount,expression:"yCount"}],attrs:{type:"text"},domProps:{value:e.yCount},on:{input:function(t){t.target.composing||(e.yCount=t.target.value)}}})]):e._e()},hr=[],dr=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Map",e.active=!1,e.xCount=3,e.yCount=3,e.startPoint=null,e.rect=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"onMouseDown",value:function(e){var t=Et.getLayer();void 0!==t?(this.active=!0,this.startPoint=gt(kt(e)),this.rect=new Fi(this.startPoint.clone(),0,0,"rgba(0,0,0,0)","black"),t.addShape(this.rect,!1,!1)):console.log("No active layer!")}},{key:"onMouseMove",value:function(e){if(this.active&&null!==this.rect&&null!==this.startPoint){var t=Et.getLayer();if(void 0!==t){var i=gt(kt(e));this.rect.w=Math.abs(i.x-this.startPoint.x),this.rect.h=Math.abs(i.y-this.startPoint.y),this.rect.refPoint=new at(Math.min(this.startPoint.x,i.x),Math.min(this.startPoint.y,i.y)),t.invalidate(!1)}else console.log("No active layer!")}}},{key:"onMouseUp",value:function(e){if(this.active&&null!==this.rect){var t=Et.getLayer();if(void 0!==t)if(this.active=!1,1===t.selection.length){var i=this.rect.w,n=this.rect.h,a=t.selection[0];a instanceof Di&&(a.w*=this.xCount*Ct.gridSize/i,a.h*=this.yCount*Ct.gridSize/n),t.removeShape(this.rect,!1,!1)}else t.removeShape(this.rect,!1,!1);else console.log("No active layer!")}}}]),t}(Ha);dr=k["a"]([x["b"]],dr);var vr=dr,fr=vr,pr=Object(o["a"])(fr,ur,hr,!1,null,null,null),yr=pr.exports,gr=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Pan",e.panStart=new rt(0,0),e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"onMouseDown",value:function(e){this.panStart=kt(e),this.active=!0}},{key:"onMouseMove",value:function(e){if(this.active){var t=kt(e),i=t.subtract(this.panStart).multiply(1/Ct.zoomFactor);Ct.increasePanX(Math.round(i.x)),Ct.increasePanY(Math.round(i.y)),this.panStart=t,Et.invalidate()}}},{key:"onMouseUp",value:function(e){this.active=!1,ut(Ct.locationOptions)}}]),t}(Ha);gr=k["a"]([x["b"]],gr);var mr=gr,br=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("SelectContext",{ref:"selectcontext"})},wr=[],kr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContextMenu",{attrs:{visible:e.visible,left:e.x+"px",top:e.y+"px"},on:{close:e.close}},[e.IS_DM?i("li",{on:{click:e.bringPlayers}},[e._v("Bring players")]):e._e(),i("li",{on:{click:e.createToken}},[e._v("Create basic token")]),i("li",{on:{click:e.showInitiative}},[e._v("Show initiative")])])},xr=[],Or=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.x=0,e.y=0,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"open",value:function(e){var t=this;this.visible=!0,this.x=e.pageX,this.y=e.pageY,this.$nextTick(function(){return t.$children[0].$el.focus()})}},{key:"close",value:function(){this.visible=!1}},{key:"bringPlayers",value:function(){Ct.IS_DM&&(Je.emit("Players.Bring",{x:mt(this.x),y:bt(this.y)}),this.close())}},{key:"createToken",value:function(){this.$parent.$parent.$refs.createtokendialog.open(this.x,this.y),this.close()}},{key:"showInitiative",value:function(){tt.$emit("Initiative.Show"),this.close()}},{key:"IS_DM",get:function(){return Ct.IS_DM}}]),t}(n["default"]);Or=k["a"]([Object(x["b"])({components:{ContextMenu:T}})],Or);var Sr,_r=Or,Cr=_r,Lr=(i("9c0f"),Object(o["a"])(Cr,kr,xr,!1,null,"7983fcf6",null)),Er=Lr.exports;(function(e){e[e["Noop"]=0]="Noop",e[e["Resize"]=1]="Resize",e[e["Drag"]=2]="Drag",e[e["GroupSelect"]=3]="GroupSelect"})(Sr||(Sr={}));var Ir=new at(-1e3,-1e3),jr=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Select",e.showContextMenu=!1,e.active=!1,e.mode=Sr.Noop,e.resizePoint=0,e.deltaChanged=!1,e.dragRay=new st(new rt(0,0),new ot(0,0)),e.selectionStartPoint=Ir,e.selectionHelper=new Fi(Ir,0,0),e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"created",value:function(){this.selectionHelper.globalCompositeOperation="source-over",Ct.setSelectionHelperId(this.selectionHelper.uuid)}},{key:"onMouseDown",value:function(e){var t=Et.getLayer();if(void 0!==t){this.selectionHelper.owners.includes(Ct.username)||this.selectionHelper.addOwner(Ct.username);var i,n=kt(e),a=gt(n),r=!1;i=t.selection.length?t.shapes.concat(t.selection):t.shapes;for(var o=i.length-1;o>=0;o--){var s=i[o];if(this.resizePoint=s.getPointIndex(a,wt(3)),this.resizePoint>=0){t.selection=[s],tt.$emit("SelectionInfo.Shape.Set",s),this.mode=Sr.Resize,t.invalidate(!0),r=!0;break}if(s.contains(a)){var l=s;-1===t.selection.indexOf(l)&&(t.selection=[l],tt.$emit("SelectionInfo.Shape.Set",l)),this.mode=Sr.Drag;var c=ht(l.refPoint);this.dragRay=new st(c,n.subtract(c)),t.invalidate(!0),r=!0;break}}if(!r){this.mode=Sr.GroupSelect;var u=!0,h=!1,d=void 0;try{for(var v,f=t.selection[Symbol.iterator]();!(u=(v=f.next()).done);u=!0){var p=v.value;tt.$emit("SelectionInfo.Shape.Set",p)}}catch(y){h=!0,d=y}finally{try{u||null==f.return||f.return()}finally{if(h)throw d}}this.selectionStartPoint=a,this.selectionHelper.refPoint=this.selectionStartPoint,this.selectionHelper.w=0,this.selectionHelper.h=0,t.selection=[this.selectionHelper],t.invalidate(!0)}this.active=!0}else console.log("No active layer!")}},{key:"onMouseMove",value:function(e){var t=Et.getLayer();if(void 0!==t){var i=kt(e),n=gt(i);if(this.deltaChanged=!1,this.mode===Sr.GroupSelect){var a=n;this.selectionHelper.w=Math.abs(a.x-this.selectionStartPoint.x),this.selectionHelper.h=Math.abs(a.y-this.selectionStartPoint.y),this.selectionHelper.refPoint=new at(Math.min(this.selectionStartPoint.x,a.x),Math.min(this.selectionStartPoint.y,a.y)),t.invalidate(!0)}else if(t.selection.length){var r=ht(t.selection[t.selection.length-1].refPoint),o=r.add(this.dragRay.direction),s=i.subtract(o).multiply(1/Ct.zoomFactor),l=s;if(this.mode===Sr.Drag){if("tokens"===t.name&&(!e.shiftKey||!Ct.IS_DM)){var c=!0,u=!1,h=void 0;try{for(var d,v=t.selection[Symbol.iterator]();!(c=(d=v.next()).done);c=!0){var f=d.value;f.ownedBy()&&(f.uuid!==this.selectionHelper.uuid&&(s=Mi(s,f),s!==l&&(this.deltaChanged=!0)))}}catch(L){u=!0,h=L}finally{try{c||null==v.return||v.return()}finally{if(u)throw h}}}var p=!0,y=!1,g=void 0;try{for(var m,b=t.selection[Symbol.iterator]();!(p=(m=b.next()).done);p=!0){var w=m.value;w.ownedBy()&&(w.visionObstruction&&_i.deleteFromTriag({target:Si.VISION,vertices:w.triagVertices,standalone:!1}),w.refPoint=w.refPoint.add(s),w.visionObstruction&&_i.addToTriag({target:Si.VISION,points:w.points}),w!==this.selectionHelper&&Je.emit("Shape.Update",{shape:w.asDict(),redraw:!0,temporary:!0}))}}catch(L){y=!0,g=L}finally{try{p||null==b.return||b.return()}finally{if(y)throw g}}t.invalidate(!1)}else if(this.mode===Sr.Resize){var k=!0,x=!1,O=void 0;try{for(var S,_=t.selection[Symbol.iterator]();!(k=(S=_.next()).done);k=!0){var C=S.value;C.ownedBy()&&(C.visionObstruction&&_i.deleteFromTriag({target:Si.VISION,vertices:C.triagVertices,standalone:!1}),C.resize(this.resizePoint,i),C!==this.selectionHelper&&(C.visionObstruction&&_i.addToTriag({target:Si.VISION,points:C.points}),Je.emit("Shape.Update",{shape:C.asDict(),redraw:!0,temporary:!0})),t.invalidate(!1),this.updateCursor(t,n))}}catch(L){x=!0,O=L}finally{try{k||null==_.return||_.return()}finally{if(x)throw O}}}else this.updateCursor(t,n)}else document.body.style.cursor="default"}else console.log("No active layer!")}},{key:"onMouseUp",value:function(e){var t=this;if(this.active)if(void 0!==Et.getLayer()){var i=Et.getLayer();this.mode===Sr.GroupSelect?(i.clearSelection(),i.shapes.forEach(function(e){if(e.ownedBy()&&e!==t.selectionHelper){var n=e.getBoundingBox();e.ownedBy()&&t.selectionHelper.refPoint.x<=n.topRight.x&&t.selectionHelper.refPoint.x+t.selectionHelper.w>=n.topLeft.x&&t.selectionHelper.refPoint.y<=n.botLeft.y&&t.selectionHelper.refPoint.y+t.selectionHelper.h>=n.topLeft.y&&i.selection.push(e)}}),i.selection.length>0&&i.selection.push(this.selectionHelper),i.invalidate(!0)):i.selection.length&&i.selection.forEach(function(n){if(n.ownedBy()){if(t.mode===Sr.Drag){if(t.dragRay.origin.x===dt(n.refPoint.x)&&t.dragRay.origin.y===vt(n.refPoint.y))return;!Ct.useGrid||e.altKey||t.deltaChanged||(n.visionObstruction&&_i.deleteFromTriag({target:Si.VISION,vertices:n.triagVertices,standalone:!1}),n.movementObstruction&&_i.deleteFromTriag({target:Si.MOVEMENT,vertices:n.triagVertices,standalone:!1}),n.snapToGrid(),n.visionObstruction&&_i.addToTriag({target:Si.VISION,points:n.points}),n.movementObstruction&&_i.addToTriag({target:Si.MOVEMENT,points:n.points})),n!==t.selectionHelper&&Je.emit("Shape.Update",{shape:n.asDict(),redraw:!0,temporary:!1}),i.invalidate(!1)}t.mode===Sr.Resize&&(Ct.useGrid&&!e.altKey&&(n.visionObstruction&&_i.deleteFromTriag({target:Si.VISION,vertices:n.triagVertices,standalone:!1}),n.movementObstruction&&_i.deleteFromTriag({target:Si.MOVEMENT,vertices:n.triagVertices,standalone:!1}),n.snapToGrid(),n.visionObstruction&&_i.addToTriag({target:Si.VISION,points:n.points}),n.visionObstruction&&_i.addToTriag({target:Si.VISION,points:n.points})),n!==t.selectionHelper&&Je.emit("Shape.Update",{shape:n.asDict(),redraw:!0,temporary:!1}),i.invalidate(!1))}}),this.mode=Sr.Noop,this.active=!1}else console.log("No active layer!")}},{key:"onContextMenu",value:function(e){if(void 0!==Et.getLayer()){var t=Et.getLayer(),i=kt(e),n=gt(i),a=!0,r=!1,o=void 0;try{for(var s,l=t.selection[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;if(c.contains(n)&&c!==this.selectionHelper)return t.selection=[c],tt.$emit("SelectionInfo.Shape.Set",c),t.invalidate(!0),void this.$parent.$refs.shapecontext.open(e,c)}}catch(u){r=!0,o=u}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}this.$refs.selectcontext.open(e)}else console.log("No active layer!")}},{key:"updateCursor",value:function(e,t){var i=!0,n=!1,a=void 0;try{for(var r,o=e.selection[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var s=r.value,l=s.getPointIndex(t,wt(3));if(l<0)document.body.style.cursor="default";else{var c=s.getPointOrientation(l).angle();c<0&&(c+=360);var u=22.5;(c>=315+u||c<u||c>=135+u&&c<225-u)&&(document.body.style.cursor="ew-resize"),(c>=45+u&&c<135-u||c>=225+u&&c<315-u)&&(document.body.style.cursor="ns-resize"),(c>=u&&c<90-u||c>=180+u&&c<270-u)&&(document.body.style.cursor="nwse-resize"),(c>=90+u&&c<180-u||c>=270+u&&c<360-u)&&(document.body.style.cursor="nesw-resize")}}}catch(h){n=!0,a=h}finally{try{i||null==o.return||o.return()}finally{if(n)throw a}}}}]),t}(Ha);jr=k["a"]([Object(x["b"])({components:{SelectContext:Er}})],jr);var Tr=jr,Mr=Tr,Pr=Object(o["a"])(Mr,br,wr,!1,null,null,null),Dr=Pr.exports,Nr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},e._l(e.tokens,function(t){return i("div",{key:t.uuid,staticClass:"token",class:{selected:e.selection.includes(t.uuid)},on:{click:function(i){return e.toggle(t.uuid)}}},[t.src?i("img",{attrs:{src:t.src,width:"30px",height:"30px"}}):e._e(),i("div",[e._v(e._s(t.name))])])}),0):e._e()},Ar=[],Rr=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Vision",e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"toggle",value:function(e){this.selection.includes(e)?Ct.removeActiveToken(e):Ct.addActiveToken(e)}},{key:"selection",get:function(){return Ct.activeTokens}},{key:"tokens",get:function(){return Ct.ownedtokens.map(function(e){return Et.UUIDMap.get(e)})}}]),t}(Ha);Rr=k["a"]([x["b"]],Rr);var Vr=Rr,Ur=Vr,Fr=(i("7392"),Object(o["a"])(Ur,Nr,Ar,!1,null,"f995dfd4",null)),$r=Fr.exports,zr=(i("0b21"),function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Ruler",e.active=!1,e.startPoint=null,e.ruler=null,e.text=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"onMouseDown",value:function(e){var t=Et.getLayer("draw");void 0!==t?(this.active=!0,this.startPoint=gt(kt(e)),this.ruler=new Vi(this.startPoint,this.startPoint,3,Ct.rulerColour),this.text=new $i(this.startPoint.clone(),"","bold 20px serif"),this.ruler.addOwner(Ct.username),this.text.addOwner(Ct.username),t.addShape(this.ruler,!0,!0),t.addShape(this.text,!0,!0)):console.log("No draw layer!")}},{key:"onMouseMove",value:function(e){if(this.active&&null!==this.ruler&&null!==this.startPoint&&null!==this.text){var t=Et.getLayer("draw");if(void 0!==t){var i=gt(kt(e));this.ruler.endPoint=i,Je.emit("Shape.Update",{shape:this.ruler.asDict(),redraw:!0,temporary:!0});var n=Math.sign(i.x-this.startPoint.x)*Math.sign(i.y-this.startPoint.y),a=Math.abs(i.x-this.startPoint.x),r=Math.abs(i.y-this.startPoint.y),o=Math.round(Math.sqrt(Math.pow(a,2)+Math.pow(r,2))*Ct.unitSize/Ct.gridSize)+" ft",s=Math.atan2(n*r,a),l=Math.min(this.startPoint.x,i.x)+a/2,c=Math.min(this.startPoint.y,i.y)+r/2;this.text.refPoint=new at(l,c),this.text.text=o,this.text.angle=s,Je.emit("Shape.Update",{shape:this.text.asDict(),redraw:!0,temporary:!0}),t.invalidate(!0)}else console.log("No draw layer!")}}},{key:"onMouseUp",value:function(e){if(this.active&&null!==this.ruler&&null!==this.startPoint&&null!==this.text){var t=Et.getLayer("draw");void 0!==t?(this.active=!1,t.removeShape(this.ruler,!0,!0),t.removeShape(this.text,!0,!0),t.invalidate(!0),this.ruler=this.startPoint=this.text=null):console.log("No active layer!")}}}]),t}(Ha));zr=k["a"]([x["b"]],zr);var Br=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.currentTool="Select",e.tools=["Select","Pan","Draw","Ruler","Map","Filter","Vision"],e.dmTools=["Map"],e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"toolVisible",value:function(e){return"Filter"===e?Object.keys(Ct.labels).length>0:"Vision"!==e||Ct.ownedtokens.length>1}},{key:"mousedown",value:function(e){if("CANVAS"===e.target.tagName){var t=this.currentTool;if(1===e.button)t="Pan";else if(0!==e.button)return;this.$emit("mousedown",e,t)}}},{key:"mouseup",value:function(e){if("CANVAS"===e.target.tagName){var t=this.currentTool;if(1===e.button)t="Pan";else if(0!==e.button)return;this.$emit("mouseup",e,t)}}},{key:"mousemove",value:function(e){if("CANVAS"===e.target.tagName){var t=this.currentTool;if(0!==(4&e.buttons))t="Pan";else if((1&e.button)>1)return;this.$emit("mousemove",e,t);var i=!1,n=!0,a=!1,r=void 0;try{for(var o,s=Ct.annotations[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;if(Et.UUIDMap.has(l)&&Et.hasLayer("draw")){var c=Et.UUIDMap.get(l);c.contains(gt(kt(e)))&&(i=!0,dn.annotationManager.setActiveText(c.annotation))}}}catch(u){a=!0,r=u}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}!i&&dn.annotationManager.shown&&dn.annotationManager.setActiveText("")}}},{key:"mouseleave",value:function(e){0!==(1&e.buttons)&&this.$emit("mouseup",e,this.currentTool)}},{key:"contextmenu",value:function(e){"CANVAS"===e.target.tagName&&2===e.button&&"CANVAS"===e.target.tagName&&this.$emit("contextmenu",e,this.currentTool)}},{key:"IS_DM",get:function(){return Ct.IS_DM}},{key:"currentToolComponent",get:function(){return"".concat(this.currentTool.toLowerCase(),"-tool")}},{key:"visibleTools",get:function(){var e=this;return this.tools.filter(function(t){return!e.dmTools.includes(t)||e.IS_DM})}}]),t}(n["default"]);Br=k["a"]([Object(x["b"])({components:{"select-tool":Dr,"pan-tool":mr,"draw-tool":Ka,"ruler-tool":zr,"map-tool":yr,"filter-tool":cr,"vision-tool":$r,"shape-menu":Ea,"createtoken-dialog":Na},watch:{currentTool:function(e,t){this.$emit("tools-select-change",e,t)}}})],Br);var Hr=Br,Gr=Hr,Wr=(i("4612"),Object(o["a"])(Gr,wa,ka,!1,null,"4302f32a",null)),Xr=Wr.exports;function Yr(e){if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)&&("Delete"===e.key||"Del"===e.key||"Backspace"===e.key)){if(void 0===Et.getLayer)return void console.log("No active layer selected for delete operation");for(var t=Et.getLayer(),i=t.selection.length-1;i>=0;i--){var n=t.selection[i];Ct.selectionHelperID!==n.uuid?(t.removeShape(n,!0,!1),tt.$emit("SelectionInfo.Shape.Set",null),tt.$emit("Initiative.Remove",n.uuid)):t.selection.splice(i,1)}}}function Kr(e){if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)65===e.keyCode&&e.ctrlKey&&e.target.select();else if(e.keyCode>=37&&e.keyCode<=40){var t=Math.round(Ct.gridSize),i=t*(e.keyCode%2),n=t*(e.keyCode%2?0:1);if(Et.hasSelection()){var a=Et.getSelection();i*=e.keyCode<=38?-1:1,n*=e.keyCode<=38?-1:1;var r=new ot(i,n);if(!e.shiftKey||!Ct.IS_DM){var o=!0,s=!1,l=void 0;try{for(var c,u=a[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var h=c.value;Ct.selectionHelperID!==h.uuid&&(r=Mi(r,h))}}catch(Q){s=!0,l=Q}finally{try{o||null==u.return||u.return()}finally{if(s)throw l}}}if(0===r.length())return;var d=!0,v=!1,f=void 0;try{for(var p,y=a[Symbol.iterator]();!(d=(p=y.next()).done);d=!0){var g=p.value;Ct.selectionHelperID!==g.uuid&&(g.movementObstruction&&_i.deleteFromTriag({target:Si.VISION,vertices:g.triagVertices,standalone:!1}),g.refPoint=g.refPoint.add(r),g.movementObstruction&&_i.addToTriag({target:Si.VISION,points:g.points}),Je.emit("Shape.Position.Update",{shape:g.asDict(),redraw:!0,temporary:!1}))}}catch(Q){v=!0,f=Q}finally{try{d||null==y.return||y.return()}finally{if(v)throw f}}Et.getLayer().invalidate(!1)}else Ct.increasePanX(i*(e.keyCode<=38?1:-1)),Ct.increasePanY(n*(e.keyCode<=38?1:-1)),Et.invalidate(),ut(Ct.locationOptions)}else if(68===e.keyCode){var m=Et.getLayer();m&&(m.clearSelection(),m.invalidate(!0))}else if("u"===e.key&&e.ctrlKey)e.preventDefault(),e.stopPropagation(),Ct.toggleUI();else if("c"===e.key&&e.ctrlKey){var b=Et.getLayer();if(!b)return;if(!b.selection)return;var w=[],k=!0,x=!1,O=void 0;try{for(var S,_=b.selection[Symbol.iterator]();!(k=(S=_.next()).done);k=!0){var C=S.value;Ct.selectionHelperID!==C.uuid&&w.push(C.asDict())}}catch(Q){x=!0,O=Q}finally{try{k||null==_.return||_.return()}finally{if(x)throw O}}Ct.setClipboard(w)}else if("v"===e.key&&e.ctrlKey){var L=Et.getLayer();if(!L)return;if(!Ct.clipboard)return;L.selection=[];var E=!0,I=!1,j=void 0;try{for(var T,M=Ct.clipboard[Symbol.iterator]();!(E=(T=M.next()).done);E=!0){var P=T.value;P.x+=10,P.y+=10,P.uuid=ve();var D=P.trackers;P.trackers=[];var N=!0,A=!1,R=void 0;try{for(var V,U=D[Symbol.iterator]();!(N=(V=U.next()).done);N=!0){var F=V.value,$=Object.assign({},F,{uuid:ve()});P.trackers.push($)}}catch(Q){A=!0,R=Q}finally{try{N||null==U.return||U.return()}finally{if(A)throw R}}var z=P.auras;P.auras=[];var B=!0,H=!1,G=void 0;try{for(var W,X=z[Symbol.iterator]();!(B=(W=X.next()).done);B=!0){var Y=W.value,K=Object.assign({},Y,{uuid:ve()});P.auras.push(K)}}catch(Q){H=!0,G=Q}finally{try{B||null==X.return||X.return()}finally{if(H)throw G}}var q=Bi(P);void 0!==q&&(L.addShape(q,!0),L.selection.push(q))}}catch(Q){I=!0,j=Q}finally{try{E||null==M.return||M.return()}finally{if(I)throw j}}1===L.selection.length?tt.$emit("SelectionInfo.Shape.Set",L.selection[0]):tt.$emit("SelectionInfo.Shape.Set",null),L.invalidate(!1)}}function qr(e){var t;e.target&&e.target.tagName&&"CANVAS"===e.target.tagName&&(t=-1*Math.sign(e.deltaY),Ct.updateZoom({newZoomDisplay:Ct.zoomDisplay-.1*t,zoomLocation:gt(kt(e))}))}var Qr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,colour:"rgba(255, 255, 255, 0.8)",mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("DM Settings")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body",on:{click:e.handleClick}},[i("div",{attrs:{id:"categories"}},e._l(e.categories,function(t,n){return i("div",{key:t,staticClass:"category",class:{selected:e.selection===n},on:{click:function(t){e.selection=n}}},[e._v("\n                "+e._s(t)+"\n            ")])}),0),i("div",{directives:[{name:"show",rawName:"v-show",value:0===e.selection,expression:"selection === 0"}],staticClass:"panel"},[i("div",{staticClass:"spanrow header"},[e._v("Players")]),e._l(e.$store.state.game.players,function(t){return i("div",{key:t.id,staticClass:"row smallrow"},[i("div",[e._v(e._s(t.name))]),i("div",[i("div",{on:{click:function(i){return e.kickPlayer(t.id)}}},[e._v("Kick")])])])}),0===Object.values(e.$store.state.game.players).length?i("div",{staticClass:"row smallrow"},[i("div",{staticClass:"spanrow"},[e._v("There are no players yet, invite some using the link below!")])]):e._e(),i("div",{staticClass:"spanrow header"},[e._v("Invitecode")]),i("div",{staticClass:"row"},[i("div",[e._v("Invitation URL:")]),e.showRefreshState?[i("InputCopyElement",{attrs:{value:e.refreshState}})]:[i("InputCopyElement",{attrs:{value:e.invitationUrl}})]],2),i("div",{staticClass:"row",on:{click:e.refreshInviteCode}},[i("div"),i("div",[i("button",[e._v("Refresh invitation code")])])]),i("div",{staticClass:"spanrow header"},[e._v("DangerZone")]),i("div",{staticClass:"row"},[i("div",[e.locked?[e._v("\n                        Unlock\n                    ")]:[e._v("\n                        Lock\n                    ")],e._v("\n                    Session\n                    "),i("i",[e._v("(DM access only)")])],2),i("div",[i("button",{staticClass:"danger",on:{click:e.toggleSessionLock}},[e.locked?[e._v("\n                            Unlock\n                        ")]:[e._v("\n                            Lock\n                        ")],e._v("\n                        this Session\n                    ")],2)])]),i("div",{staticClass:"row"},[i("div",[e._v("Remove Session")]),i("div",[i("button",{staticClass:"danger",on:{click:e.deleteSession}},[e._v("Delete this Session")])])])],2),i("div",{directives:[{name:"show",rawName:"v-show",value:1===e.selection,expression:"selection === 1"}],staticClass:"panel"},[i("div",{staticClass:"row"},[i("label",{attrs:{for:"useGridInput"}},[e._v("Use grid")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.useGrid,expression:"useGrid"}],attrs:{id:"useGridInput",type:"checkbox"},domProps:{checked:Array.isArray(e.useGrid)?e._i(e.useGrid,null)>-1:e.useGrid},on:{change:function(t){var i=e.useGrid,n=t.target,a=!!n.checked;if(Array.isArray(i)){var r=null,o=e._i(i,r);n.checked?o<0&&(e.useGrid=i.concat([r])):o>-1&&(e.useGrid=i.slice(0,o).concat(i.slice(o+1)))}else e.useGrid=a}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"gridSizeInput"}},[e._v("Grid Size (in pixels):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.gridSize,expression:"gridSize",modifiers:{number:!0}}],attrs:{id:"gridSizeInput",type:"number",min:"0"},domProps:{value:e.gridSize},on:{input:function(t){t.target.composing||(e.gridSize=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"unitSizeInput"}},[e._v("Unit Size (in ft.):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.unitSize,expression:"unitSize",modifiers:{number:!0}}],attrs:{id:"unitSizeInput",type:"number"},domProps:{value:e.unitSize},on:{input:function(t){t.target.composing||(e.unitSize=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:2===e.selection,expression:"selection === 2"}],staticClass:"panel"},[i("div",{staticClass:"spanrow header"},[e._v("Core")]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fakePlayerInput"}},[e._v("Fake player:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fakePlayer,expression:"fakePlayer"}],attrs:{id:"fakePlayerInput",type:"checkbox"},domProps:{checked:Array.isArray(e.fakePlayer)?e._i(e.fakePlayer,null)>-1:e.fakePlayer},on:{change:function(t){var i=e.fakePlayer,n=t.target,a=!!n.checked;if(Array.isArray(i)){var r=null,o=e._i(i,r);n.checked?o<0&&(e.fakePlayer=i.concat([r])):o>-1&&(e.fakePlayer=i.slice(0,o).concat(i.slice(o+1)))}else e.fakePlayer=a}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"useFOWInput"}},[e._v("Fill entire canvas with FOW:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fullFOW,expression:"fullFOW"}],attrs:{id:"useFOWInput",type:"checkbox"},domProps:{checked:Array.isArray(e.fullFOW)?e._i(e.fullFOW,null)>-1:e.fullFOW},on:{change:function(t){var i=e.fullFOW,n=t.target,a=!!n.checked;if(Array.isArray(i)){var r=null,o=e._i(i,r);n.checked?o<0&&(e.fullFOW=i.concat([r])):o>-1&&(e.fullFOW=i.slice(0,o).concat(i.slice(o+1)))}else e.fullFOW=a}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fowLOS"}},[e._v("Only show lights in LoS:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fowLOS,expression:"fowLOS"}],attrs:{id:"fowLOS",type:"checkbox"},domProps:{checked:Array.isArray(e.fowLOS)?e._i(e.fowLOS,null)>-1:e.fowLOS},on:{change:function(t){var i=e.fowLOS,n=t.target,a=!!n.checked;if(Array.isArray(i)){var r=null,o=e._i(i,r);n.checked?o<0&&(e.fowLOS=i.concat([r])):o>-1&&(e.fowLOS=i.slice(0,o).concat(i.slice(o+1)))}else e.fowLOS=a}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fowOpacity"}},[e._v("FOW opacity:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.fowOpacity,expression:"fowOpacity",modifiers:{number:!0}}],attrs:{id:"fowOpacity",type:"number",min:"0",max:"1",step:"0.1"},domProps:{value:e.fowOpacity},on:{input:function(t){t.target.composing||(e.fowOpacity=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"spanrow header"},[e._v("Advanced")]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"visionMode"}},[e._v("Vision Mode:")]),i("div",[i("select",{attrs:{id:"visionMode"},on:{change:e.changeVisionMode}},[i("option",{domProps:{selected:"bvh"===e.$store.state.visibility.visionMode}},[e._v("BVH")]),i("option",{domProps:{selected:"triangle"===e.$store.state.visibility.visionMode}},[e._v("Triangle")])])])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"vmininp"}},[e._v("Minimal full vision (ft):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:e.visionRangeMin,expression:"visionRangeMin",modifiers:{lazy:!0,number:!0}}],attrs:{id:"vmininp",type:"number",min:"0"},domProps:{value:e.visionRangeMin},on:{change:function(t){e.visionRangeMin=e._n(t.target.value)},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"vmaxinp"}},[e._v("Maximal vision (ft):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:e.visionRangeMax,expression:"visionRangeMax",modifiers:{lazy:!0,number:!0}}],attrs:{id:"vmaxinp",type:"number",min:"0"},domProps:{value:e.visionRangeMax},on:{change:function(t){e.visionRangeMax=e._n(t.target.value)},blur:function(t){return e.$forceUpdate()}}})])])])])])},Zr=[],Jr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"input-copy"},on:{mouseleave:function(t){e.showPopup=!1}}},[i("input",{attrs:{type:"text",disabled:"disabled",id:"input-element"},domProps:{value:e.value}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showPopup,expression:"showPopup"}],attrs:{id:"show-popup"}},[e._v(e._s(e.popupString))]),i("div",{attrs:{id:"copy-button"},on:{click:e.copy}},[i("i",{staticClass:"far fa-copy"})])])},eo=[],to=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.borderColour="lightgray",e.popupString="",e.showPopup=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"copy",value:function(){var e=this;navigator.clipboard.writeText(this.value).then(function(){e.popupString="Copied!",e.showPopup=!0},function(){console.log("Could not copy to clipboard :("),e.popupString="Error!",e.showPopup=!0})}}]),t}(n["default"]);k["a"]([Object(K["a"])()],to.prototype,"value",void 0),to=k["a"]([x["b"]],to);var io=to,no=io,ao=(i("e60f"),Object(o["a"])(no,Jr,eo,!1,null,"628dde30",null)),ro=ao.exports,oo=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.categories=["Admin","Grid","Vision"],e.selection=0,e.showRefreshState=!1,e.refreshState="pending",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("DmSettings.Open",function(){e.visible=!0}),tt.$on("DmSettings.RefreshedInviteCode",function(){e.showRefreshState=!1})}},{key:"beforeDestroy",value:function(){tt.$off("DmSettings.Open"),tt.$off("DmSettings.RefreshedInviteCode")}},{key:"changeVisionMode",value:function(e){var t=e.target.value.toLowerCase();"bvh"!==t&&"triangle"!==t||(_i.setVisionMode({mode:t,sync:!0}),_i.recalculateVision(),_i.recalculateMovement(),Et.invalidate())}},{key:"handleClick",value:function(e){var t=e.target.firstElementChild;t instanceof HTMLInputElement&&t.click()}},{key:"refreshInviteCode",value:function(){Je.emit("Room.Info.InviteCode.Refresh"),this.refreshState="pending",this.showRefreshState=!0}},{key:"kickPlayer",value:function(e){Je.emit("Room.Info.Players.Kick",e),Ct.kickPlayer(e)}},{key:"toggleSessionLock",value:function(){Ct.setIsLocked({isLocked:!Ct.isLocked,sync:!0})}},{key:"deleteSession",value:function(){var e=this;this.$parent.$parent.$refs.prompt.prompt("ENTER ".concat(Ct.roomCreator,"/").concat(Ct.roomName," TO CONFIRM SESSION REMOVAL."),"DELETING SESSION").then(function(t){t==="".concat(Ct.roomCreator,"/").concat(Ct.roomName)&&(Je.emit("Room.Delete"),e.$router.push("/"))},function(){})}},{key:"invitationUrl",get:function(){return window.location.protocol+"//"+window.location.host+"/invite/"+Ct.invitationCode}},{key:"locked",get:function(){return Ct.isLocked}},{key:"useGrid",get:function(){return Ct.useGrid},set:function(e){Ct.setUseGrid({useGrid:e,sync:!0})}},{key:"unitSize",get:function(){return Ct.unitSize},set:function(e){"number"===typeof e&&Ct.setUnitSize({unitSize:e,sync:!0})}},{key:"gridSize",get:function(){return Ct.gridSize},set:function(e){"number"===typeof e&&Ct.setGridSize({gridSize:e,sync:!0})}},{key:"fakePlayer",get:function(){return Ct.FAKE_PLAYER},set:function(e){Ct.setFakePlayer(e)}},{key:"fullFOW",get:function(){return Ct.fullFOW},set:function(e){Ct.setFullFOW({fullFOW:e,sync:!0})}},{key:"fowOpacity",get:function(){return Ct.fowOpacity},set:function(e){"number"===typeof e&&Ct.setFOWOpacity({fowOpacity:e,sync:!0})}},{key:"fowLOS",get:function(){return Ct.fowLOS},set:function(e){Ct.setLineOfSight({fowLOS:e,sync:!0})}},{key:"visionRangeMin",get:function(){return Ct.visionRangeMin},set:function(e){"number"===typeof e&&Ct.setVisionRangeMin({value:e,sync:!0})}},{key:"visionRangeMax",get:function(){return Ct.visionRangeMax},set:function(e){"number"===typeof e&&Ct.setVisionRangeMax({value:e,sync:!0})}}]),t}(n["default"]);oo=k["a"]([Object(x["b"])({components:{InputCopyElement:ro,Modal:ee},computed:Object.assign({},Object(N["b"])("game",["invitationCode"]))})],oo);var so=oo,lo=so,co=(i("559e"),Object(o["a"])(lo,Qr,Zr,!1,null,"261cc18f",null)),uo=co.exports,ho=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.ready={manager:!1,tools:!1},e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){window.addEventListener("resize",this.resizeWindow),window.addEventListener("keyup",Yr),window.addEventListener("keydown",Kr),this.ready.manager=!0}},{key:"destroyed",value:function(){window.removeEventListener("resize",this.resizeWindow),window.removeEventListener("keyup",Yr),window.removeEventListener("keydown",Kr),this.ready.manager=!1}},{key:"zoom",value:function(e){qe()(qr)(e)}},{key:"resizeWindow",value:function(){Et.setWidth(window.innerWidth),Et.setHeight(window.innerHeight),Et.invalidate()}},{key:"mousedown",value:function(e){this.$refs.tools.mousedown(e)}},{key:"mouseup",value:function(e){this.$refs.tools.mouseup(e)}},{key:"mousemove",value:function(e){this.$refs.tools.mousemove(e)}},{key:"mouseleave",value:function(e){this.$refs.tools.mouseleave(e)}},{key:"contextmenu",value:function(e){this.$refs.tools.contextmenu(e)}},{key:"selectLayer",value:function(e){Et.selectLayer(e)}},{key:"drop",value:function(e){if(null!==e&&null!==e.dataTransfer)if(e.dataTransfer.files.length>0)this.$refs.confirm.open("Uploading files should be done through the asset manager.","Ok","").then(function(){},function(){});else{if(""===e.dataTransfer.getData("text/plain"))return;cn(e)}}},{key:"showUI",get:function(){return Ct.showUI}},{key:"IS_DM",get:function(){return Ct.IS_DM}},{key:"FAKE_PLAYER",get:function(){return Ct.FAKE_PLAYER}},{key:"layers",get:function(){return Ct.layers}},{key:"selectedLayer",get:function(){return Ct.selectedLayer}},{key:"zoomDisplay",get:function(){return Ct.zoomDisplay},set:function(e){Ct.updateZoom({newZoomDisplay:e,zoomLocation:gt(new rt(window.innerWidth/2,window.innerHeight/2))})}}]),t}(n["default"]);ho=k["a"]([Object(x["b"])({components:{"tool-bar":Xr,"selection-info":ba,"prompt-dialog":de,"confirm-dialog":re,"menu-bar":Zn,"initiative-dialog":On,"zoom-slider":Ze.a,"note-dialog":ra,"label-dialog":jn,"dm-settings":uo},beforeRouteEnter:function(e,t,i){et(e),i()},beforeRouteLeave:function(e,t,i){Je.disconnect(),i()}})],ho);var vo=ho,fo=vo,po=(i("561b"),i("d3f9"),Object(o["a"])(fo,Xe,Ye,!1,null,"5bd5872f",null)),yo=po.exports,go=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"beforeRouteEnter",value:function(e,t,i){h.a.post("/api/invite",{code:e.params.code}).then(function(e){i({path:e.data.sessionUrl})}).catch(function(e){console.error("Invitation code could not be redeemed"),i({path:"/dashboard"})})}}]),t}(n["default"]);go=k["a"]([Object(x["b"])({template:""})],go);var mo=go;n["default"].use(d["a"]);var bo=new d["a"]({mode:"history",base:"/",routes:[{path:"/",redirect:"/dashboard"},{path:"/_load",name:"load",component:Ue},{path:"/assets",component:ke,meta:{auth:!0}},{path:"/auth",component:{template:"<router-view></router-view>"},children:[{path:"login",component:je},{path:"logout",component:Me}]},{path:"/invite/:code",component:mo,meta:{auth:!0}},{path:"/dashboard",component:We,meta:{auth:!0}},{path:"/game/:creator/:room",component:yo,meta:{auth:!0}}]});bo.beforeEach(function(e,t,i){_e.initialized||"/_load"===e.path?e.matched.some(function(e){return e.meta.auth})&&!_e.authenticated?i({path:"/auth/login",query:{redirect:e.path}}):i():(i({path:"/_load"}),h.a.get("/api/auth").then(function(t){t.data.auth&&(_e.setAuthenticated(!0),_e.setUsername(t.data.username)),_e.setInitialized(!0),bo.push(e.path)}).catch(function(){console.error("Authentication check could not be fulfilled.")}))}),i.d(t,"app",function(){return wo}),n["default"].config.productionTip=!1,n["default"].config.devtools=!0,n["default"].config.performance=!0;var wo=new n["default"]({router:bo,store:A,render:function(e){return e(c)}}).$mount("#app");window.app=wo},d3f9:function(e,t,i){"use strict";var n=i("2777"),a=i.n(n);a.a},d450:function(e,t,i){},d9e0:function(e,t,i){"use strict";var n=i("c098"),a=i.n(n);a.a},e1a0:function(e,t,i){},e3f5:function(e,t,i){"use strict";var n=i("a126"),a=i.n(n);a.a},e60f:function(e,t,i){"use strict";var n=i("c4d5"),a=i.n(n);a.a},fb5d:function(e,t,i){"use strict";var n=i("4315"),a=i.n(n);a.a},fce9:function(e,t,i){},fe11:function(e,t,i){}});
//# sourceMappingURL=app-legacy.0568654b.js.map