(function(e){function t(t){for(var n,s,o=t[0],l=t[1],u=t[2],h=0,d=[];h<o.length;h++)s=o[h],a[s]&&d.push(a[s][0]),a[s]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);c&&c(t);while(d.length)d.shift()();return r.push.apply(r,u||[]),i()}function i(){for(var e,t=0;t<r.length;t++){for(var i=r[t],n=!0,o=1;o<i.length;o++){var l=i[o];0!==a[l]&&(n=!1)}n&&(r.splice(t--,1),e=s(s.s=i[0]))}return e}var n={},a={app:0},r=[];function s(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=n,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var c=l;r.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("cd49")},"0222":function(e,t,i){},"034f":function(e,t,i){"use strict";var n=i("64a9"),a=i.n(n);a.a},"0de1":function(e,t,i){},1:function(e,t){},1133:function(e,t,i){"use strict";var n=i("8336"),a=i.n(n);a.a},"12d3":function(e,t,i){"use strict";var n=i("a260"),a=i.n(n);a.a},"1e7c":function(e,t,i){},"23fd":function(e,t,i){},2777:function(e,t,i){},"291a":function(e,t,i){"use strict";var n=i("b98b"),a=i.n(n);a.a},"2a75":function(e,t,i){"use strict";var n=i("9195"),a=i.n(n);a.a},"31d1":function(e,t,i){},3972:function(e,t,i){},"3ba3":function(e,t,i){"use strict";var n=i("79b7"),a=i.n(n);a.a},"3f2c":function(e,t,i){},4315:function(e,t,i){},4612:function(e,t,i){"use strict";var n=i("3972"),a=i.n(n);a.a},"4a14":function(e,t,i){"use strict";var n=i("9850"),a=i.n(n);a.a},"559e":function(e,t,i){"use strict";var n=i("31d1"),a=i.n(n);a.a},"561b":function(e,t,i){"use strict";var n=i("a450"),a=i.n(n);a.a},"57af":function(e,t,i){"use strict";var n=i("1e7c"),a=i.n(n);a.a},"5b11":function(e,t,i){},6146:function(e,t,i){"use strict";var n=i("9ca7"),a=i.n(n);a.a},"618b":function(e,t,i){"use strict";var n=i("d450"),a=i.n(n);a.a},"618e":function(e,t,i){"use strict";var n=i("7985"),a=i.n(n);a.a},"64a9":function(e,t,i){},"6da0":function(e,t,i){"use strict";var n=i("e1a0"),a=i.n(n);a.a},7392:function(e,t,i){"use strict";var n=i("0222"),a=i.n(n);a.a},"78c7":function(e,t,i){"use strict";var n=i("9227"),a=i.n(n);a.a},7985:function(e,t,i){},"79b7":function(e,t,i){},"7f1e":function(e,t,i){"use strict";var n=i("fe11"),a=i.n(n);a.a},8336:function(e,t,i){},9195:function(e,t,i){},9227:function(e,t,i){},"95c9":function(e,t,i){"use strict";var n=i("23fd"),a=i.n(n);a.a},9850:function(e,t,i){},"9b70":function(e,t,i){},"9c0f":function(e,t,i){"use strict";var n=i("0de1"),a=i.n(n);a.a},"9ca7":function(e,t,i){},a126:function(e,t,i){},a260:function(e,t,i){},a450:function(e,t,i){},aa79:function(e,t,i){"use strict";var n=i("fce9"),a=i.n(n);a.a},ab66:function(e,t,i){"use strict";var n=i("ca99"),a=i.n(n);a.a},ae5a:function(e,t,i){"use strict";var n=i("3f2c"),a=i.n(n);a.a},b98b:function(e,t,i){},c098:function(e,t,i){},c4d5:function(e,t,i){},c65f:function(e,t,i){"use strict";var n=i("9b70"),a=i.n(n);a.a},c947:function(e,t,i){"use strict";var n=i("5b11"),a=i.n(n);a.a},ca99:function(e,t,i){},cd49:function(e,t,i){"use strict";i.r(t);i("cadf"),i("551c"),i("f751"),i("097d");var n=i("a026"),a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("router-view",{ref:"activeComponent"})],1)},r=[],s=(i("034f"),i("2877")),o={},l=Object(s["a"])(o,a,r,!1,null,null,null),u=l.exports,c=i("bc3a"),h=i.n(c),d=i("8c4f"),v=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"AssetManager"}},[i("div",{attrs:{id:"titlebar"}},[e._v("Asset Manager")]),i("div",{attrs:{id:"main"}},[i("div",{attrs:{id:"assets"},on:{dragover:function(t){return t.preventDefault(),e.moveDrag(t)},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.stopDrag(t,e.currentFolder)}}},[i("div",{attrs:{id:"breadcrumbs"}},[i("div",[e._v("/")]),e._l(e.path,function(t){return i("div",{key:t},[e._v(e._s(e.idMap.get(t).name))])})],2),i("div",{attrs:{id:"actionbar"}},[i("input",{attrs:{id:"files",type:"file",multiple:"",hidden:""},on:{change:function(t){return e.upload()}}}),i("div",{attrs:{title:"Create folder"},on:{click:e.createDirectory}},[i("i",{staticClass:"fas fa-plus-square"})]),i("div",{attrs:{title:"Upload files"},on:{click:e.prepareUpload}},[i("i",{staticClass:"fas fa-upload"})])]),i("div",{attrs:{id:"explorer"}},[e.path.length?i("div",{staticClass:"inode folder",on:{dblclick:function(t){return e.changeDirectory(-1)},dragover:function(t){return t.preventDefault(),e.moveDrag(t)},dragleave:function(t){return t.preventDefault(),e.leaveDrag(t)},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.stopDrag(t,e.parentFolder)}}},[i("i",{staticClass:"fas fa-folder",staticStyle:{"font-size":"50px"}}),i("div",{staticClass:"title"},[e._v("..")])]):e._e(),e._l(e.folders,function(t){return i("div",{key:t,staticClass:"inode folder",class:{"inode-selected":e.selected.includes(t)},attrs:{draggable:"true"},on:{click:function(i){return e.select(i,t)},dblclick:function(i){return e.changeDirectory(t)},contextmenu:function(i){return i.preventDefault(),e.$refs.cm.open(i,t)},dragstart:function(i){return e.startDrag(i,t)},dragover:function(t){return t.preventDefault(),e.moveDrag(t)},dragleave:function(t){return t.preventDefault(),e.leaveDrag(t)},drop:function(i){return i.preventDefault(),i.stopPropagation(),e.stopDrag(i,t)}}},[i("i",{staticClass:"fas fa-folder",staticStyle:{"font-size":"50px"}}),i("div",{staticClass:"title"},[e._v(e._s(e.idMap.get(t).name))])])}),e._l(e.files,function(t){return i("div",{key:t,staticClass:"inode file",class:{"inode-selected":e.selected.includes(t)},attrs:{draggable:"true"},on:{click:function(i){return e.select(i,t)},contextmenu:function(i){return i.preventDefault(),e.$refs.cm.open(i,t)},dragstart:function(i){return e.startDrag(i,t)}}},[i("img",{attrs:{src:"/static/assets/"+e.idMap.get(t).file_hash,width:"50"}}),i("div",{staticClass:"title"},[e._v(e._s(e.idMap.get(t).name))])])})],2)]),e.firstSelectedFile?i("div",{attrs:{id:"asset-details"}},[i("div",{attrs:{id:"asset-detail-title"}},[e._v(e._s(e.firstSelectedFile.name))]),i("img",{attrs:{src:"/static/assets/"+e.firstSelectedFile.file_hash}})]):e._e()]),i("AssetContextMenu",{ref:"cm"}),i("Prompt",{ref:"prompt"}),i("ConfirmDialog",{ref:"confirm"})],1)},f=[],p=(i("7f7f"),i("ac4d"),i("8a81"),i("ac6a"),i("75fc")),y=(i("6762"),i("2fdb"),i("d225")),g=i("b0b4"),m=i("308d"),b=i("6bb5"),w=i("4e2b"),k=i("9ab4"),x=i("2fe1"),O=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContextMenu",{attrs:{visible:e.visible,left:e.left+"px",top:e.top+"px"},on:{close:e.close}},[i("li",{on:{click:e.rename}},[e._v("Rename")]),i("li",{on:{click:e.remove}},[e._v("Remove")])])},S=[],_=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.visible?i("div",{staticClass:"ContextMenu",style:{left:e.left,top:e.top},attrs:{tabindex:"-1"},on:{blur:function(t){return e.$emit("close")}}},[i("ul",[e._t("default")],2)]):e._e()},C=[],L=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),t}(n["default"]);L=k["a"]([Object(x["b"])({props:["visible","left","top"]})],L);var E=L,I=E,j=(i("7f1e"),Object(s["a"])(I,_,C,!1,null,null,null)),T=j.exports,M=i("8055"),P=i.n(M),D=(i("5df3"),i("f400"),i("6fc5")),N=i("2f62");n["default"].use(N["a"]);var A=new N["a"].Store({}),R=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.root=-1,e.files=[],e.folders=[],e.idMap=new Map,e.selected=[],e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"clear",value:function(){this.folders=[],this.files=[]}},{key:"clearSelected",value:function(){console.log("Cleared"),this.selected=[]}},{key:"setRoot",value:function(e){this.root=e}}]),t}(D["d"]);k["a"]([D["c"]],R.prototype,"clear",null),k["a"]([D["c"]],R.prototype,"clearSelected",null),k["a"]([D["c"]],R.prototype,"setRoot",null),R=k["a"]([Object(D["b"])({dynamic:!0,store:A,name:"assets",namespaced:!0})],R);var V=Object(D["e"])(R),U=P()(location.protocol+"//"+location.host+"/pa_assetmgmt",{autoConnect:!1});U.on("connect",function(){console.log("Connected")}),U.on("disconnect",function(){console.log("Disconnected")}),U.on("redirect",function(e){console.log("redirecting"),window.location.href=e}),U.on("Folder.Root.Set",function(e){V.setRoot(e)}),U.on("Folder.Set",function(e){if(V.clear(),e.children){var t=!0,i=!1,n=void 0;try{for(var a,r=e.children[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;V.idMap.set(s.id,s),s.file_hash?V.files.push(s.id):V.folders.push(s.id)}}catch(o){i=!0,n=o}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}}),U.on("Folder.Create",function(e){V.folders.push(e.id),V.idMap.set(e.id,e)}),U.on("Asset.Upload.Finish",function(e){V.idMap.set(e.id,e),V.files.push(e.id)});var F=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.left=0,e.top=0,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"open",value:function(e,t){var i=this;V.selected.includes(t)||this.parent.select(e,t),this.visible=!0,this.left=e.pageX,this.top=e.pageY,this.$nextTick(function(){i.$children[0].$el.focus()})}},{key:"close",value:function(){this.visible=!1}},{key:"rename",value:function(){var e=this;if(1===V.selected.length){var t=V.idMap.get(V.selected[0]);this.parent.$refs.prompt.prompt("New name:","Renaming ".concat(t.name)).then(function(i){U.emit("Asset.Rename",{asset:t.id,name:i}),t.name=i,e.parent.$forceUpdate()},function(){}),this.close()}}},{key:"remove",value:function(){0!==V.selected.length&&(this.parent.$refs.confirm.open("Are you sure you wish to remove this?").then(function(e){if(e){var t=!0,i=!1,n=void 0;try{for(var a,r=V.selected[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;U.emit("Asset.Remove",s),V.files.includes(s)?V.files.splice(V.files.indexOf(s),1):V.folders.splice(V.folders.indexOf(s),1)}}catch(o){i=!0,n=o}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}V.clearSelected()}},function(){}),this.close())}},{key:"parent",get:function(){return this.$parent}}]),t}(n["default"]);F=k["a"]([Object(x["b"])({components:{ContextMenu:T}})],F);var $=F,z=$,B=Object(s["a"])(z,O,S,!1,null,null,null),H=B.exports,G=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible},on:{close:e.close},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v("\n        "+e._s(e.title)+"\n    ")])}}])},[i("div",{staticClass:"modal-body"},[i("button",{ref:"confirm",on:{click:e.confirm}},[e._v(e._s(e.yes))]),e.no?i("button",{on:{click:e.deny}},[e._v(e._s(e.no))]):e._e()])])},W=[],X=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"modal"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"mask",class:{"modal-mask":e.mask,"dialog-mask":!e.mask},on:{click:e.close,dragover:function(t){return t.preventDefault(),e.dragOver(t)}}},[i("div",{ref:"container",staticClass:"modal-container",style:{"background-color":e.colour},on:{click:function(e){e.stopPropagation()}}},[e._t("header",null,{dragStart:e.dragStart,dragEnd:e.dragEnd}),e._t("default")],2)])])},Y=[],K=i("60a3"),q=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.positioned=!1,e.offsetX=0,e.offsetY=0,e.screenX=0,e.screenY=0,e.dragging=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){this.updatePosition()}},{key:"updated",value:function(){this.updatePosition()}},{key:"close",value:function(e){this.$emit("close")}},{key:"updatePosition",value:function(){if(!this.positioned){var e=this.$refs.container;if(0===e.offsetWidth&&0===e.offsetHeight)return;this.$refs.container.style.left=(window.innerWidth-e.offsetWidth)/2+"px",this.$refs.container.style.top=(window.innerHeight-e.offsetHeight)/2+"px",this.positioned=!0}}},{key:"dragStart",value:function(e){null!==e&&null!==e.dataTransfer&&(e.dataTransfer.setData("Hack",""),e.dataTransfer.setDragImage(this.$refs.container,e.offsetX,e.offsetY),this.offsetX=e.offsetX,this.offsetY=e.offsetY,this.screenX=e.screenX,this.screenY=e.screenY,this.dragging=!0)}},{key:"dragEnd",value:function(e){this.dragging=!1;var t=e.clientX-this.offsetX,i=e.clientY-this.offsetY;0===e.clientX&&0===e.clientY&&0===e.pageX&&0===e.pageY&&(t=parseInt(this.$refs.container.style.left,10)-(this.screenX-e.screenX),i=parseInt(this.$refs.container.style.top,10)-(this.screenY-e.screenY)),t<0&&(t=0),t>window.innerWidth-100&&(t=window.innerWidth-100),i<0&&(i=0),i>window.innerHeight-100&&(i=window.innerHeight-100),this.$refs.container.style.left=t+"px",this.$refs.container.style.top=i+"px",this.$refs.container.style.display="block"}},{key:"dragOver",value:function(e){this.dragging&&(this.$refs.container.style.display="none")}}]),t}(n["default"]);k["a"]([Object(K["a"])(Boolean)],q.prototype,"visible",void 0),k["a"]([Object(K["a"])({type:Boolean,default:!0})],q.prototype,"mask",void 0),k["a"]([Object(K["a"])({type:String,default:"white"})],q.prototype,"colour",void 0),q=k["a"]([x["b"]],q);var Q=q,Z=Q,J=(i("618e"),Object(s["a"])(Z,X,Y,!1,null,"2098e4f8",null)),ee=J.exports,te=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.yes="Yes",e.no="No",e.title="",e.resolve=function(e){},e.reject=function(){},e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"confirm",value:function(){this.resolve(!0),this.close()}},{key:"deny",value:function(){this.resolve(!1),this.close()}},{key:"close",value:function(){this.reject(),this.visible=!1,this.title=""}},{key:"open",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yes",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"no";return this.yes=i,this.no=n,this.title=e,this.visible=!0,this.$nextTick(function(){t.$refs.confirm.focus()}),new Promise(function(e,i){t.resolve=e,t.reject=i})}}]),t}(n["default"]);te=k["a"]([Object(x["b"])({components:{Modal:ee}})],te);var ie=te,ne=ie,ae=(i("fb5d"),Object(s["a"])(ne,G,W,!1,null,"46dc898b",null)),re=ae.exports,se=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible},on:{close:e.close},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v("\n        "+e._s(e.title)+"\n    ")])}}])},[i("div",{staticClass:"modal-body"},[e._v("\n        "+e._s(e.question)+"\n        "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.answer,expression:"answer"}],ref:"answer",attrs:{type:"text"},domProps:{value:e.answer},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)},input:function(t){t.target.composing||(e.answer=t.target.value)}}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.submit}},[e._v("Submit")])])])},oe=[],le=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.question="",e.answer="",e.title="",e.resolve=function(e){},e.reject=function(){},e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"submit",value:function(){this.resolve(this.answer),this.close()}},{key:"close",value:function(){this.reject(),this.visible=!1,this.question="",this.answer="",this.title=""}},{key:"prompt",value:function(e,t){var i=this;return this.question=e,this.title=t,this.visible=!0,this.$nextTick(function(){i.$refs.answer.focus()}),new Promise(function(e,t){i.resolve=e,i.reject=t})}}]),t}(n["default"]);le=k["a"]([Object(x["b"])({components:{Modal:ee}})],le);var ue=le,ce=ue,he=(i("1133"),Object(s["a"])(ce,se,oe,!1,null,"391b52fc",null)),de=he.exports;i("28a5"),i("c5f6"),i("6b54"),i("a481");function ve(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16)})}function fe(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1}function pe(e,t){var i=[[],[]];return e.forEach(function(e){return t(e)?i[1].push(e):i[0].push(e)}),i}function ye(e,t,i,n){var a=.2*Number(e.font.split("px")[0]),r=e.measureText(t).width;return Math.min(i/r,n/a)}var ge=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.path=[],e.draggingSelection=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"changeDirectory",value:function(e){e<0?this.path.pop():this.path.push(e),V.clearSelected(),U.emit("Folder.Get",this.currentFolder)}},{key:"createDirectory",value:function(){var e=window.prompt("New folder name");null!==e&&U.emit("Folder.Create",{name:e,parent:this.currentFolder})}},{key:"moveInode",value:function(e,t){V.files.includes(e)?V.files.splice(V.files.indexOf(e),1):V.folders.splice(V.folders.indexOf(e),1),V.idMap.delete(e),U.emit("Inode.Move",{inode:e,target:t})}},{key:"select",value:function(e,t){if(e.shiftKey&&V.selected.length>0){for(var i=[].concat(Object(p["a"])(V.files),Object(p["a"])(V.folders)),n=i.indexOf(V.selected[V.selected.length-1]),a=i.indexOf(t),r=n;r!==a;n<a?r++:r--)r!==n&&V.selected.push(i[r]);V.selected.push(i[a])}else e.ctrlKey||V.clearSelected(),V.selected.push(t)}},{key:"startDrag",value:function(e,t){null!==e.dataTransfer&&(e.dataTransfer.setData("Hack","ittyHack"),e.dataTransfer.dropEffect="move",V.selected.includes(t)||V.selected.push(t),this.draggingSelection=!0)}},{key:"moveDrag",value:function(e){e.target.classList.contains("folder")&&e.target.classList.add("inode-selected")}},{key:"leaveDrag",value:function(e){e.target.classList.contains("folder")&&e.target.classList.remove("inode-selected")}},{key:"stopDrag",value:function(e,t){if(e.target.classList.remove("inode-selected"),this.draggingSelection){if((t===V.root||V.folders.includes(t))&&!V.selected.includes(t)){var i=!0,n=!1,a=void 0;try{for(var r,s=V.selected[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var o=r.value;this.moveInode(o,t)}}catch(l){n=!0,a=l}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}}V.clearSelected()}else e.dataTransfer&&e.dataTransfer.files.length>0&&this.upload(e.dataTransfer.files,t);this.draggingSelection=!1}},{key:"prepareUpload",value:function(){document.getElementById("files").click()}},{key:"upload",value:function(e,t){var i=document.getElementById("files").files;if(void 0===e){if(!i)return;e=i}void 0===t&&(t=this.currentFolder);var n=1e5,a=!0,r=!1,s=void 0;try{for(var o,l=function(){for(var e=o.value,i=ve(),a=Math.ceil(e.size/n),r=function(r){var s=new FileReader;s.readAsArrayBuffer(e.slice(r*n,r*n+Math.min(n,e.size-r*n))),s.onload=function(n){U.emit("Asset.Upload",{name:e.name,directory:t,data:s.result,slice:r,totalSlices:a,uuid:i})}},s=0;s<a;s++)r(s)},u=e[Symbol.iterator]();!(a=(o=u.next()).done);a=!0)l()}catch(c){r=!0,s=c}finally{try{a||null==u.return||u.return()}finally{if(r)throw s}}}},{key:"folders",get:function(){return V.folders}},{key:"files",get:function(){return V.files}},{key:"selected",get:function(){return V.selected}},{key:"idMap",get:function(){return V.idMap}},{key:"currentFolder",get:function(){return this.path.length?this.path[this.path.length-1]:V.root}},{key:"parentFolder",get:function(){var e=this.path[this.path.length-2];return void 0===e&&(e=V.root),e}},{key:"firstSelectedFile",get:function(){var e=!0,t=!1,i=void 0;try{for(var n,a=V.selected[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var r=n.value;if(V.idMap.get(r).file_hash)return V.idMap.get(r)}}catch(s){t=!0,i=s}finally{try{e||null==a.return||a.return()}finally{if(t)throw i}}return null}}]),t}(n["default"]);ge=k["a"]([Object(x["b"])({components:{Prompt:de,ConfirmDialog:re,AssetContextMenu:H},beforeRouteEnter:function(e,t,i){U.connect(),i()},beforeRouteLeave:function(e,t,i){U.disconnect(),i()}})],ge);var me=ge,be=me,we=(i("78c7"),Object(s["a"])(be,v,f,!1,null,null,null)),ke=we.exports,xe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("form",{on:{focusin:e.focusin,focusout:e.focusout,submit:function(t){return t.preventDefault(),e.login(t)}}},[i("fieldset",[i("legend",{staticClass:"legend"},[e._v("PlanarAlly")]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{type:"text",name:"username",placeholder:"Username",autocomplete:"username",required:""},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}}),e._m(0)]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",name:"password",placeholder:"Password",autocomplete:"current-password",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),e._m(1)]),i("div",{staticStyle:{display:"flex"}},[i("button",{staticStyle:{visibility:"hidden",display:"none"},attrs:{type:"submit",name:"login"}}),i("button",{staticClass:"submit",attrs:{type:"button",name:"register",title:"Register"},on:{click:e.register}},[i("i",{staticClass:"fas fa-plus"})]),e._m(2)])]),e.error?i("div",{staticClass:"feedback"},[i("p",{staticClass:"error"},[i("strong",[e._v("Error:")]),e._v("\n            "+e._s(e.error)+"\n        ")])]):e._e()])},Oe=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fas fa-user-circle"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fas fa-lock"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("button",{staticClass:"submit",attrs:{type:"submit",name:"login",title:"Login"}},[i("i",{staticClass:"fas fa-arrow-right"})])}],Se=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.authenticated=!1,e.initialized=!1,e.username="",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"setAuthenticated",value:function(e){this.authenticated=e}},{key:"setInitialized",value:function(e){this.initialized=e}},{key:"setUsername",value:function(e){this.username=e}}]),t}(D["d"]);k["a"]([D["c"]],Se.prototype,"setAuthenticated",null),k["a"]([D["c"]],Se.prototype,"setInitialized",null),k["a"]([D["c"]],Se.prototype,"setUsername",null),Se=k["a"]([Object(D["b"])({dynamic:!0,store:A,name:"core"})],Se);var _e=Object(D["e"])(Se),Ce=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.username="",e.password="",e.error="",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"login",value:function(){var e=this;h.a.post("/api/login",{username:this.username,password:this.password}).then(function(t){_e.setUsername(e.username),_e.setAuthenticated(!0),e.$router.push(e.$route.query.redirect||"/")}).catch(function(t){t.response?e.error=t.response.statusText:e.error="Unknown error occured"})}},{key:"register",value:function(){var e=this;h.a.post("/api/register",{username:this.username,password:this.password}).then(function(t){_e.setUsername(e.username),_e.setAuthenticated(!0),e.$router.push(e.$route.query.redirect||"/")}).catch(function(t){t.response?e.error=t.response.statusText:e.error="Unknown error occured"})}},{key:"focusin",value:function(e){if(e.target&&e.target.nextElementSibling){var t=e.target.nextElementSibling;t.style.opacity="0"}}},{key:"focusout",value:function(e){if(e.target&&e.target.nextElementSibling){var t=e.target.nextElementSibling;t.style.opacity="1"}}}]),t}(n["default"]);Ce=k["a"]([x["b"]],Ce);var Le=Ce,Ee=Le,Ie=(i("c947"),Object(s["a"])(Ee,xe,Oe,!1,null,"6062c8f4",null)),je=Ie.exports;x["b"].registerHooks(["beforeRouteEnter"]);var Te=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"beforeRouteEnter",value:function(e,t,i){h.a.post("/api/logout").then(function(){_e.setAuthenticated(!1),_e.setUsername(""),i({path:"/auth/login"})})}}]),t}(n["default"]);Te=k["a"]([Object(x["b"])({})],Te);var Me=Te,Pe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e._v(e._s(e.message))])},De=[],Ne=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.message="Loading...",e}return Object(w["a"])(t,e),t}(n["default"]);Ne=k["a"]([x["b"]],Ne);var Ae=Ne,Re=Ae,Ve=Object(s["a"])(Re,Pe,De,!1,null,null,null),Ue=Ve.exports,Fe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"formcontainer"}},[e.owned||e.joined?i("form",[i("fieldset",[i("legend",{staticClass:"legend"},[e._v("Your sessions")]),i("div",{staticClass:"input"},[e._l(e.owned,function(t,n){return i("router-link",{key:"o-"+n,attrs:{to:"/game/"+encodeURIComponent(t[1])+"/"+encodeURIComponent(t[0])}},[e._v("\n                    "+e._s(t[0])+"\n                ")])}),e._l(e.joined,function(t,n){return i("router-link",{key:"j-"+n,attrs:{to:"/game/"+encodeURIComponent(t[1])+"/"+encodeURIComponent(t[0])}},[e._v("\n                    "+e._s(t[1])+"/"+e._s(t[0])+"\n                ")])})],2),0===e.owned.length?i("div",{staticClass:"input"},[e._v("No active sessions")]):e._e()])]):e._e(),e._m(0),i("form",{on:{submit:function(t){return t.preventDefault(),e.createRoom(t)}}},[i("fieldset",[e.owned||e.joined?i("div",{staticClass:"input"},[e._v("Create a new session")]):i("legend",{staticClass:"legend"},[e._v("Create a session")]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.newSessionName,expression:"newSessionName"}],attrs:{type:"text",name:"room_name",placeholder:"Session Name"},domProps:{value:e.newSessionName},on:{input:function(t){t.target.composing||(e.newSessionName=t.target.value)}}}),e._m(1)]),e._m(2)])]),i("div",{attrs:{id:"account-options"}},[i("form",{on:{submit:function(e){e.preventDefault()}}},[i("router-link",{staticClass:"submit",attrs:{tag:"button",title:"Account Settings",to:"/account"}},[i("i",{staticClass:"fas fa-cog"})])],1),i("form",{on:{submit:function(e){e.preventDefault()}}},[i("router-link",{staticClass:"submit",attrs:{tag:"button",title:"Logout",to:"/auth/logout"}},[i("i",{staticClass:"fas fa-sign-out-alt"})])],1)])])},$e=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("h4",[i("span",[e._v("OR")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fab fa-d-and-d"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("button",{staticClass:"submit",attrs:{type:"submit",title:"Create"}},[i("i",{staticClass:"fas fa-arrow-right"})])}];x["b"].registerHooks(["beforeRouteEnter"]);var ze=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.owned=[],e.joined=[],e.error="",e.newSessionName="",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"beforeRouteEnter",value:function(e,t,i){h.a.get("/api/rooms").then(function(e){i(function(t){t.owned=e.data.owned,t.joined=e.data.joined})}).catch(function(e){i(function(t){t.error=e.message})})}},{key:"createRoom",value:function(e){var t=this;h.a.post("/api/rooms",{name:this.newSessionName}).then(function(e){t.$router.push("/game/".concat(encodeURIComponent(_e.username),"/").concat(encodeURIComponent(t.newSessionName)))}).catch(function(e){t.error=e.message})}}]),t}(n["default"]);ze=k["a"]([x["b"]],ze);var Be=ze,He=Be,Ge=(i("d9e0"),Object(s["a"])(He,Fe,$e,!1,null,"f34c77ee",null)),We=Ge.exports,Xe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"main"},on:{mouseleave:e.mouseleave,wheel:e.zoom}},[e.showUI?i("menu-bar"):e._e(),i("div",{attrs:{id:"board"}},[e.ready.manager?[i("tool-bar",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],ref:"tools"})]:e._e(),i("div",{attrs:{id:"layers"},on:{mousedown:e.mousedown,mouseup:e.mouseup,mousemove:e.mousemove,contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.contextmenu(t)},dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.drop(t)}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showUI&&e.layers.length>1,expression:"showUI && layers.length > 1"}],attrs:{id:"layerselect"}},[i("ul",e._l(e.layers,function(t){return i("li",{key:t.name,class:{"layer-selected":t===e.selectedLayer},on:{mousedown:function(i){return e.selectLayer(t)}}},[i("a",{attrs:{href:"#"}},[e._v(e._s(t))])])}),0)])],2),i("selection-info",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],ref:"selectionInfo"}),i("initiative-dialog",{ref:"initiative",attrs:{id:"initiativedialog"}}),i("note-dialog",{ref:"note"}),i("label-dialog",{ref:"labels"}),e.IS_DM||e.FAKE_PLAYER?i("dm-settings",{ref:"dmsettings"}):e._e(),i("div",{attrs:{id:"zoomer"}},[i("zoom-slider",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],attrs:{id:"zoomer",height:6,width:200,min:0,max:1,interval:.1,"dot-size":[8,20],"dot-options":{style:{"border-radius":"15%","z-index":11}},"tooltip-placement":"bottom",tooltip:"focus","tooltip-formatter":e.zoomDisplay.toFixed(1),"rail-style":{"background-color":"#fff","box-shadow":"0.5px 0.5px 3px 1px rgba(0, 0, 0, .36)"},"process-style":{"background-color":"#fff"}},model:{value:e.zoomDisplay,callback:function(t){e.zoomDisplay=t},expression:"zoomDisplay"}})],1),i("prompt-dialog",{ref:"prompt"}),i("confirm-dialog",{ref:"confirm"})],1)},Ye=[],Ke=i("0f32"),qe=i.n(Ke),Qe=i("4971"),Ze=i.n(Qe),Je=(i("24df"),P()(location.protocol+"//"+location.host+"/planarally",{autoConnect:!1}));function et(e){Je.io.opts.query="user=".concat(decodeURIComponent(e.params.creator),"&room=").concat(decodeURIComponent(e.params.room)),Je.connect()}var tt=new n["default"],it=i("2a88");var nt=function(){function e(t,i){Object(y["a"])(this,e),this.x=t,this.y=i}return Object(g["a"])(e,[{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"subtract",value:function(e){return new st(this.x-e.x,this.y-e.y)}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"get",value:function(e){return 0===e?this.x:this.y}},{key:"asArray",value:function(){return[this.x,this.y]}}],[{key:"fromArray",value:function(t){return new e(t[0],t[1])}}]),e}(),at=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"add",value:function(e){return Object(it["a"])(Object(b["a"])(t.prototype),"add",this).call(this,e)}},{key:"subtract",value:function(e){return Object(it["a"])(Object(b["a"])(t.prototype),"subtract",this).call(this,e)}},{key:"clone",value:function(){return Object(it["a"])(Object(b["a"])(t.prototype),"clone",this).call(this)}}],[{key:"fromArray",value:function(e){return new t(e[0],e[1])}}]),t}(nt),rt=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"add",value:function(e){return Object(it["a"])(Object(b["a"])(t.prototype),"add",this).call(this,e)}},{key:"subtract",value:function(e){return Object(it["a"])(Object(b["a"])(t.prototype),"subtract",this).call(this,e)}},{key:"clone",value:function(){return Object(it["a"])(Object(b["a"])(t.prototype),"clone",this).call(this)}}]),t}(nt),st=function(){function e(t,i){Object(y["a"])(this,e),this.x=t,this.y=i}return Object(g["a"])(e,[{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"inverse",value:function(){return new e(0===this.x?0:1/this.x,0===this.y?0:1/this.y)}},{key:"length",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"normalize",value:function(){var t=this.length();return new e(this.x/t,this.y/t)}},{key:"reverse",value:function(){return new e(-this.x,-this.y)}},{key:"multiply",value:function(t){return new e(this.x*t,this.y*t)}},{key:"angle",value:function(){return 180*Math.atan2(this.y,this.x)/Math.PI}}]),e}(),ot=function(){function e(t,i,n){Object(y["a"])(this,e),this.direction=i,this.origin=t,void 0===n&&(n=1/0),this.tMax=n}return Object(g["a"])(e,[{key:"get",value:function(e){return new nt(this.origin.x+e*this.direction.x,this.origin.y+e*this.direction.y)}},{key:"getDistance",value:function(e,t){return Math.sqrt(Math.pow(t-e,2)*(Math.pow(this.direction.x,2)+Math.pow(this.direction.y,2)))}},{key:"getT",value:function(e,t){return e+Math.sqrt(Math.pow(t,2)/(Math.pow(this.direction.x,2)+Math.pow(this.direction.y,2)))}}],[{key:"fromPoints",value:function(t,i){var n,a=new st(i.x-t.x,i.y-t.y);return n=Math.abs(a.x)>.01?(i.x-t.x)/a.x:(i.y-t.y)/a.y,new e(t,a,n)}}]),e}();i("7514"),i("4f7f");function lt(e){Je.emit("Client.Options.Set",{locationOptions:e})}function ut(e){var t=Lt.zoomFactor,i=Lt.panX,n=Lt.panY;return new rt((e.x+i)*t,(e.y+n)*t)}function ct(e){return ut(new at(e,0)).x}function ht(e){return ut(new at(0,e)).y}function dt(e){return e*Lt.zoomFactor}function vt(e){return e/Lt.unitSize*Lt.gridSize}function ft(e){return dt(vt(e))}function pt(e){var t=Lt.zoomFactor,i=Lt.panX,n=Lt.panY;return e instanceof rt?new at(e.x/t-i,e.y/t-n):new ot(pt(e.origin),e.direction.multiply(1/t),e.tMax)}function yt(e){return pt(new rt(e,0)).x}function gt(e){return pt(new rt(0,e)).y}function mt(e){return e/Lt.zoomFactor}window.g2lx=ct,window.g2ly=ht;var bt=i("66cb"),wt=i.n(bt);function kt(e){return new rt(e.pageX,e.pageY)}function xt(e){return 1/(-5/3+28/15*Math.exp(1.83*e))}function Ot(e){return Math.log(15/28*(1/e+5/3))/1.83}function St(e,t){return e[0]===t[0]&&e[1]===t[1]}function _t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=wt()(Lt.fowColour);return Lt.IS_DM?t.setAlpha(e?1:Lt.fowOpacity):t.setAlpha(1),t.toRgbString()}var Ct=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.layers=[],e.selectedLayerIndex=-1,e.boardInitialized=!1,e.locations=[],e.assets={},e.notes=[],e.IS_DM=!1,e.FAKE_PLAYER=!1,e.isLocked=!1,e.gridSize=50,e.username="",e.roomName="",e.roomCreator="",e.invitationCode="",e.players=[],e.gridColour="rgba(0, 0, 0, 1)",e.fowColour="rgba(0, 0, 0, 1)",e.rulerColour="rgba(255, 0, 0, 1)",e.panX=0,e.panY=0,e.zoomDisplay=.5,e.unitSize=5,e.useGrid=!0,e.fullFOW=!1,e.fowOpacity=.3,e.fowLOS=!1,e.locationName="",e.visionSources=[],e.annotations=[],e.movementblockers=[],e.ownedtokens=[],e._activeTokens=[],e.drawTEContour=!1,e.visionRangeMin=1640,e.visionRangeMax=3281,e.clipboard=[],e.labels={},e.filterNoLabel=!1,e.labelFilters=[],e.showUI=!0,e.selectionHelperID=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"setSelectionHelperId",value:function(e){this.selectionHelperID=e}},{key:"setFakePlayer",value:function(e){this.FAKE_PLAYER=e,this.IS_DM=!e,It.invalidate()}},{key:"setZoomDisplay",value:function(e){e!==this.zoomDisplay&&(e<0&&(e=0),e>1&&(e=1),this.zoomDisplay=e,It.invalidate())}},{key:"setBoardInitialized",value:function(e){this.boardInitialized=e}},{key:"toggleUnlabeledFilter",value:function(){this.filterNoLabel=!this.filterNoLabel}},{key:"addLabel",value:function(e){n["default"].set(this.labels,e.uuid,e)}},{key:"setLabelFilters",value:function(e){this.labelFilters=e}},{key:"setLabelVisibility",value:function(e){e.uuid in this.labels&&(this.labels[e.uuid].visible=e.visible)}},{key:"deleteLabel",value:function(e){if(e.uuid in this.labels){var t=this.labels[e.uuid],i=new Set,a=!0,r=!1,s=void 0;try{for(var o,l=It.UUIDMap.values()[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value,c=u.labels.indexOf(t);c>=0&&(u.labels.splice(c,1),i.add(u.layer))}}catch(g){r=!0,s=g}finally{try{a||null==l.return||l.return()}finally{if(r)throw s}}var h=!0,d=!1,v=void 0;try{for(var f,p=i[Symbol.iterator]();!(h=(f=p.next()).done);h=!0){var y=f.value;It.getLayer(y).invalidate(!1)}}catch(g){d=!0,v=g}finally{try{h||null==p.return||p.return()}finally{if(d)throw v}}n["default"].delete(this.labels,e.uuid)}}},{key:"setDM",value:function(e){this.IS_DM=e}},{key:"setUsername",value:function(e){this.username=e}},{key:"setRoomName",value:function(e){this.roomName=e}},{key:"setRoomCreator",value:function(e){this.roomCreator=e}},{key:"setInvitationCode",value:function(e){this.invitationCode=e}},{key:"addLayer",value:function(e){this.layers.push(e),-1===this.selectedLayerIndex&&(this.selectedLayerIndex=this.layers.indexOf(e))}},{key:"selectLayer",value:function(e){var t=this.layers.indexOf(e.name);t>=0&&(this.selectedLayerIndex=t),e.sync&&Je.emit("Client.ActiveLayer.Set",e.name)}},{key:"newNote",value:function(e){this.notes.push(e.note),e.sync&&Je.emit("Note.New",e.note)}},{key:"setAssets",value:function(e){this.assets=e}},{key:"setLocations",value:function(e){this.locations=e}},{key:"resetLayerInfo",value:function(){this.layers=[],this.selectedLayerIndex=-1}},{key:"updateZoom",value:function(e){if(e.newZoomDisplay!==this.zoomDisplay){e.newZoomDisplay<0&&(e.newZoomDisplay=0),e.newZoomDisplay>1&&(e.newZoomDisplay=1);var t=ut(e.zoomLocation);this.zoomDisplay=e.newZoomDisplay;var i=pt(t),n=i.subtract(e.zoomLocation);this.panX+=n.x,this.panY+=n.y,It.invalidate(),lt(this.locationOptions)}}},{key:"setGridColour",value:function(e){this.gridColour=e.colour,It.getGridLayer().drawGrid(),e.sync&&Je.emit("Client.Options.Set",{gridColour:e.colour})}},{key:"setFOWColour",value:function(e){this.fowColour=e.colour,It.invalidate(),e.sync&&Je.emit("Client.Options.Set",{fowColour:e.colour})}},{key:"setRulerColour",value:function(e){this.rulerColour=e.colour,e.sync&&Je.emit("Client.Options.Set",{rulerColour:e.colour})}},{key:"setPanX",value:function(e){this.panX=e}},{key:"setPanY",value:function(e){this.panY=e}},{key:"increasePanX",value:function(e){this.panX+=e}},{key:"increasePanY",value:function(e){this.panY+=e}},{key:"setUnitSize",value:function(e){this.unitSize!==e.unitSize&&e.unitSize>0&&e.unitSize<1/0&&(this.unitSize=e.unitSize,It.invalidate(),e.sync&&Je.emit("Location.Options.Set",{unit_size:e.unitSize}))}},{key:"setUseGrid",value:function(e){if(this.useGrid!==e.useGrid){this.useGrid=e.useGrid;var t=It.getGridLayer();e.useGrid?t.canvas.style.display="block":t.canvas.style.display="none",e.sync&&Je.emit("Location.Options.Set",{use_grid:e.useGrid})}}},{key:"setGridSize",value:function(e){if(this.gridSize!==e.gridSize&&e.gridSize>0){this.gridSize=e.gridSize;var t=It.getGridLayer();void 0!==t&&t.drawGrid(),e.sync&&Je.emit("Gridsize.Set",e.gridSize)}}},{key:"setVisionRangeMin",value:function(e){this.visionRangeMin=e.value,It.invalidateLight(),e.sync&&Je.emit("Location.Options.Set",{vision_min_range:e.value})}},{key:"setVisionRangeMax",value:function(e){this.visionRangeMax=Math.max(e.value,this.visionRangeMin),It.invalidateLight(),e.sync&&Je.emit("Location.Options.Set",{vision_max_range:this.visionRangeMax})}},{key:"setFullFOW",value:function(e){this.fullFOW!==e.fullFOW&&(this.fullFOW=e.fullFOW,It.invalidateLight(),e.sync&&Je.emit("Location.Options.Set",{full_fow:e.fullFOW}))}},{key:"setFOWOpacity",value:function(e){this.fowOpacity=e.fowOpacity,It.invalidateLight(),e.sync&&Je.emit("Location.Options.Set",{fow_opacity:e.fowOpacity})}},{key:"setLineOfSight",value:function(e){this.fowLOS!==e.fowLOS&&(this.fowLOS=e.fowLOS,It.invalidate(),e.sync&&Je.emit("Location.Options.Set",{fow_los:e.fowLOS}))}},{key:"setLocationName",value:function(e){this.locationName=e}},{key:"updateNote",value:function(e){var t=this.notes.find(function(t){return t.uuid===e.note.uuid});void 0!==t&&(t.title=e.note.title,t.text=e.note.text,e.sync&&Je.emit("Note.Update",t))}},{key:"removeNote",value:function(e){this.notes=this.notes.filter(function(t){return t.uuid!==e.note.uuid}),e.sync&&Je.emit("Note.Remove",e.note.uuid)}},{key:"toggleUI",value:function(){this.showUI=!this.showUI}},{key:"setClipboard",value:function(e){this.clipboard=e}},{key:"setActiveTokens",value:function(e){this._activeTokens=e,It.invalidateLight()}},{key:"addActiveToken",value:function(e){this._activeTokens.push(e),It.invalidateLight()}},{key:"removeActiveToken",value:function(e){0===this._activeTokens.length&&(this._activeTokens=Object(p["a"])(this.ownedtokens)),this._activeTokens.splice(this._activeTokens.indexOf(e),1),It.invalidateLight()}},{key:"setPlayers",value:function(e){this.players=e}},{key:"addPlayer",value:function(e){this.players.push(e)}},{key:"kickPlayer",value:function(e){this.players=this.players.filter(function(t){return t.id!==e})}},{key:"setIsLocked",value:function(e){this.isLocked=e.isLocked,e.sync&&Je.emit("Room.Info.Set.Locked",this.isLocked)}},{key:"clear",value:function(){this.context.state.visionSources=[],this.context.state.ownedtokens=[],this.context.state.annotations=[],this.context.state.movementblockers=[],this.context.state.notes=[]}},{key:"selectedLayer",get:function(){return this.layers[this.selectedLayerIndex]}},{key:"zoomFactor",get:function(){return xt(this.zoomDisplay)}},{key:"locationOptions",get:function(){return{panX:Lt.panX,panY:Lt.panY,zoomFactor:Lt.zoomFactor}}},{key:"activeTokens",get:function(){return 0===this._activeTokens.length?this.ownedtokens:this._activeTokens}}]),t}(D["d"]);k["a"]([D["c"]],Ct.prototype,"setSelectionHelperId",null),k["a"]([D["c"]],Ct.prototype,"setFakePlayer",null),k["a"]([D["c"]],Ct.prototype,"setZoomDisplay",null),k["a"]([D["c"]],Ct.prototype,"setBoardInitialized",null),k["a"]([D["c"]],Ct.prototype,"toggleUnlabeledFilter",null),k["a"]([D["c"]],Ct.prototype,"addLabel",null),k["a"]([D["c"]],Ct.prototype,"setLabelFilters",null),k["a"]([D["c"]],Ct.prototype,"setLabelVisibility",null),k["a"]([D["c"]],Ct.prototype,"deleteLabel",null),k["a"]([D["c"]],Ct.prototype,"setDM",null),k["a"]([D["c"]],Ct.prototype,"setUsername",null),k["a"]([D["c"]],Ct.prototype,"setRoomName",null),k["a"]([D["c"]],Ct.prototype,"setRoomCreator",null),k["a"]([D["c"]],Ct.prototype,"setInvitationCode",null),k["a"]([D["c"]],Ct.prototype,"addLayer",null),k["a"]([D["c"]],Ct.prototype,"selectLayer",null),k["a"]([D["c"]],Ct.prototype,"newNote",null),k["a"]([D["c"]],Ct.prototype,"setAssets",null),k["a"]([D["c"]],Ct.prototype,"setLocations",null),k["a"]([D["c"]],Ct.prototype,"resetLayerInfo",null),k["a"]([D["c"]],Ct.prototype,"updateZoom",null),k["a"]([D["c"]],Ct.prototype,"setGridColour",null),k["a"]([D["c"]],Ct.prototype,"setFOWColour",null),k["a"]([D["c"]],Ct.prototype,"setRulerColour",null),k["a"]([D["c"]],Ct.prototype,"setPanX",null),k["a"]([D["c"]],Ct.prototype,"setPanY",null),k["a"]([D["c"]],Ct.prototype,"increasePanX",null),k["a"]([D["c"]],Ct.prototype,"increasePanY",null),k["a"]([D["c"]],Ct.prototype,"setUnitSize",null),k["a"]([D["c"]],Ct.prototype,"setUseGrid",null),k["a"]([D["c"]],Ct.prototype,"setGridSize",null),k["a"]([D["c"]],Ct.prototype,"setVisionRangeMin",null),k["a"]([D["c"]],Ct.prototype,"setVisionRangeMax",null),k["a"]([D["c"]],Ct.prototype,"setFullFOW",null),k["a"]([D["c"]],Ct.prototype,"setFOWOpacity",null),k["a"]([D["c"]],Ct.prototype,"setLineOfSight",null),k["a"]([D["c"]],Ct.prototype,"setLocationName",null),k["a"]([D["c"]],Ct.prototype,"updateNote",null),k["a"]([D["c"]],Ct.prototype,"removeNote",null),k["a"]([D["c"]],Ct.prototype,"toggleUI",null),k["a"]([D["c"]],Ct.prototype,"setClipboard",null),k["a"]([D["c"]],Ct.prototype,"setActiveTokens",null),k["a"]([D["c"]],Ct.prototype,"addActiveToken",null),k["a"]([D["c"]],Ct.prototype,"removeActiveToken",null),k["a"]([D["c"]],Ct.prototype,"setPlayers",null),k["a"]([D["c"]],Ct.prototype,"addPlayer",null),k["a"]([D["c"]],Ct.prototype,"kickPlayer",null),k["a"]([D["c"]],Ct.prototype,"setIsLocked",null),k["a"]([D["a"]],Ct.prototype,"clear",null),Ct=k["a"]([Object(D["b"])({dynamic:!0,store:A,name:"game",namespaced:!0})],Ct);var Lt=Object(D["e"])(Ct),Et=function(){function e(){var t=this;Object(y["a"])(this,e),this.layers=[],this.width=window.innerWidth,this.height=window.innerHeight,this.UUIDMap=new Map,this.interval=30,this.drawLoop=function(){for(var e=t.layers.length-1;e>=0;e--)t.layers[e].draw();requestAnimationFrame(t.drawLoop)},requestAnimationFrame(this.drawLoop)}return Object(g["a"])(e,[{key:"reset",value:function(){this.layers=[],this.UUIDMap=new Map}},{key:"setWidth",value:function(e){this.width=e;var t=!0,i=!1,n=void 0;try{for(var a,r=this.layers[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;s.canvas.width=e,s.width=e}}catch(o){i=!0,n=o}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}},{key:"setHeight",value:function(e){this.height=e;var t=!0,i=!1,n=void 0;try{for(var a,r=this.layers[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;s.canvas.height=e,s.height=e}}catch(o){i=!0,n=o}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}},{key:"addLayer",value:function(e){this.layers.push(e),(Lt.IS_DM||e.playerEditable)&&e.selectable&&Lt.addLayer(e.name)}},{key:"hasLayer",value:function(e){return this.layers.some(function(t){return t.name===e})}},{key:"getLayer",value:function(e){e=void 0===e?Lt.selectedLayer:e;var t=!0,i=!1,n=void 0;try{for(var a,r=this.layers[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;if(s.name===e)return s}}catch(o){i=!0,n=o}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}},{key:"selectLayer",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!1,n=!0,a=!1,r=void 0;try{for(var s,o=this.layers[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var l=s.value;l.selectable&&(i&&"fow"!==l.name?l.ctx.globalAlpha=.3:l.ctx.globalAlpha=1,e===l.name&&(Lt.selectLayer({name:e,sync:t}),i=!0),l.clearSelection(),l.invalidate(!0))}}catch(u){a=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}}},{key:"getGridLayer",value:function(){return this.getLayer("grid")}},{key:"hasSelection",value:function(){var e=this.getSelection();return void 0!==e&&e.length>0}},{key:"getSelection",value:function(){var e=this.getLayer();if(void 0!==e)return e.selection}},{key:"invalidate",value:function(){for(var e=this.layers.length-1;e>=0;e--)this.layers[e].invalidate(!0)}},{key:"invalidateLight",value:function(){for(var e=this.layers.length-1;e>=0;e--)this.layers[e].isVisionLayer&&this.layers[e].invalidate(!0)}}]),e}(),It=new Et;window.lm=It;i("6c7b"),i("20d6"),i("f559");var jt,Tt=function(){function e(t,i,n){Object(y["a"])(this,e),this.w=i,this.h=n,this.topLeft=t,this.topRight=new at(t.x+i,t.y),this.botRight=new at(t.x+i,t.y+n),this.botLeft=new at(t.x,t.y+n)}return Object(g["a"])(e,[{key:"contains",value:function(e){return this.topLeft.x<=e.x&&this.topRight.x>=e.x&&this.topLeft.y<=e.y&&this.botLeft.y>=e.y}},{key:"offset",value:function(t){return new e(this.topLeft.add(t),this.w,this.h)}},{key:"union",value:function(t){var i=Math.min(this.topLeft.x,t.topLeft.x),n=Math.max(this.topRight.x,t.topRight.x),a=Math.min(this.topLeft.y,t.topLeft.y),r=Math.max(this.botLeft.y,t.botLeft.y);return new e(new at(i,a),n-i,r-a)}},{key:"getDiagCorner",value:function(e){return e?this.botRight:this.topLeft}},{key:"intersectsWith",value:function(e){return!(e.topLeft.x>this.topRight.x||e.topRight.x<this.topLeft.x||e.topLeft.y>this.botLeft.y||e.botLeft.y<this.topLeft.y)}},{key:"intersectsWithInner",value:function(e){return!(e.topLeft.x>=this.topRight.x||e.topRight.x<=this.topLeft.x||e.topLeft.y>=this.botLeft.y||e.botLeft.y<=this.topLeft.y)}},{key:"intersectP",value:function(e,t,i){var n=t.x*(this.getDiagCorner(i[0]).x-e.origin.x),a=t.x*(this.getDiagCorner(!i[0]).x-e.origin.x),r=t.y*(this.getDiagCorner(i[1]).y-e.origin.y),s=t.y*(this.getDiagCorner(!i[1]).y-e.origin.y);return n>s||r>a?{hit:!1,min:n,max:a}:(r>n&&(n=r),s<a&&(a=s),{hit:n<e.tMax&&a>0,min:n,max:a})}},{key:"center",value:function(){return this.topLeft.add(new st(this.w/2,this.h/2))}},{key:"getMaxExtent",value:function(){return this.w>this.h?0:1}},{key:"visibleInCanvas",value:function(e){var t=!(ct(this.topLeft.x)>e.width||ht(this.topLeft.y)>e.height||ct(this.topRight.x)<0||ht(this.botRight.y)<0);return!!t}},{key:"points",get:function(){return 0===this.w||0===this.h?[[this.topLeft.x,this.topLeft.y]]:[[this.topLeft.x,this.topLeft.y],[this.botLeft.x,this.botLeft.y],[this.botRight.x,this.botRight.y],[this.topRight.x,this.topRight.y]]}}]),e}(),Mt=(i("0d6d"),i("768b")),Pt=function(e){var t=[],i=!0,n=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var o=r.value;t.push({uuid:o.uuid,visionSource:o.vision_source,visible:o.visible,name:o.name,value:o.value,dim:o.dim,colour:o.colour})}}catch(l){n=!0,a=l}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return t},Dt=function(e){var t=[],i=!0,n=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var o=r.value;t.push({uuid:o.uuid,vision_source:o.visionSource,visible:o.visible,name:o.name,value:o.value,dim:o.dim,colour:o.colour})}}catch(l){n=!0,a=l}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return t};i("96cf"),i("55dd"),i("2e37");function Nt(e){return(e+2)%3}function At(e){return(e+1)%3}function Rt(e,t){var i=new di(e,null);if(i.valid)do{var n=3-i.t.indexV(e)-i.ri,a=i.t.vertices[n];if(!a.infinite){if(a===t)return{includes:!0,vi:t,fr:i.t,i:i.ri};var r=Ft(e.point,t.point,a.point);if(r===ri.COLLINEAR&&Vt(e.point,a.point,t.point))return{includes:!0,vi:a,fr:i.t,i:i.ri}}}while(i.next());return{includes:!1}}function Vt(e,t,i){var n,a;return Ut(0,e,i)===ri.EQUAL?(n=Ut(1,e,t),a=Ut(1,t,i)):(n=Ut(0,e,t),a=Ut(0,t,i)),n===ri.SMALLER&&a===ri.SMALLER||n===ri.LARGER&&a===ri.LARGER}function Ut(e,t,i){return t[e]<i[e]?ri.SMALLER:t[e]>i[e]?ri.LARGER:ri.EQUAL}function Ft(e,t,i){var n=e[0],a=e[1],r=t[0],s=t[1],o=i[0],l=i[1],u=r-n,c=s-a,h=o-n,d=l-a,v=$t(u,c,h,d),f=Math.abs(u),p=Math.abs(c),y=Math.abs(h),g=Math.abs(d);if(f<y&&(f=y),p<g&&(p=g),f>p){var m=[p,f];f=m[0],p=m[1]}if(f<2e-162&&0===f)return ri.ZERO;if(p<1e153){var b=Number.EPSILON*f*p;if(v>b)return ri.POSITIVE;if(v<-b)return ri.NEGATIVE}return ri.ZERO}function $t(e,t,i,n){return e*n-t*i}function zt(e,t,i){return $t(t[0]-e[0],t[1]-e[1],i[0]-e[0],i[1]-e[1])<0}function Bt(e,t,i){if(!e.isInfinite())return Ht(e.vertices[0].point,e.vertices[1].point,e.vertices[2].point,t,i);throw new Error("SSS")}function Ht(e,t,i,n,a){var r=Yt(e,t,i,n);if(r!==ri.ON_ORIENTED_BOUNDARY||!a)return r;var s=[e,t,i,n];s.sort(function(e,t){return e[0]-t[0]||e[1]-t[1]});var o=!0,l=!1,u=void 0;try{for(var c,h=s.reverse()[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var d=c.value;if(d===n)return ri.ON_NEGATIVE_SIDE;var v=Ft(e,t,n);if(d===i&&v!==ri.COLLINEAR)return v;if(v=Ft(e,n,i),d===t&&v!==ri.COLLINEAR)return v;if(v=Ft(n,t,i),d===e&&v!==ri.COLLINEAR)return v}}catch(f){l=!0,u=f}finally{try{o||null==h.return||h.return()}finally{if(l)throw u}}return ri.ON_NEGATIVE_SIDE}function Gt(e,t){return e[0]===t[0]&&e[1]===t[1]}function Wt(e,t){return e[0]<t[0]||e[0]===t[0]&&e[1]<t[1]}function Xt(e,t){return Wt(e,t)?ri.SMALLER:Gt(e,t)?ri.EQUAL:ri.LARGER}function Yt(e,t,i,n){var a=t[0]-e[0],r=t[1]-e[1],s=i[0]-e[0],o=i[1]-e[1],l=n[0]-e[0],u=n[1]-e[1],c=n[0]-t[0],h=n[1]-t[1],d=i[0]-t[0],v=i[1]-t[1],f=$t(a*u-r*l,l*c+u*h,a*o-r*s,s*d+o*v),p=Math.abs(a),y=Math.abs(r),g=Math.abs(s),m=Math.abs(o),b=Math.abs(c),w=Math.abs(h),k=Math.abs(l),x=Math.abs(u),O=Math.abs(d),S=Math.abs(v);if(p<g&&(p=g),p<k&&(p=k),p<b&&(p=b),p<O&&(p=O),y<m&&(y=m),y<x&&(y=x),y<w&&(y=w),y<S&&(y=S),p>y){var _=[y,p];p=_[0],y=_[1]}if(p<1e-73&&0===p)return ri.ON_ORIENTED_BOUNDARY;if(y<1e76){var C=Number.EPSILON*p*y*(y*y);if(f>C)return ri.ON_POSITIVE_SIDE;if(f<-C)return ri.ON_NEGATIVE_SIDE}return ri.ZERO}function Kt(e,t,i,n){switch(Ft(e,t,i)){case ri.LEFT_TURN:return Ft(i,n,t)!==ri.RIGHT_TURN;case ri.RIGHT_TURN:return Ft(i,n,t)!==ri.LEFT_TURN;case ri.COLLINEAR:return!0}}function qt(e,t,i,n){switch(Ft(e,t,i)){case ri.LEFT_TURN:return Ft(e,t,n)!==ri.LEFT_TURN;case ri.RIGHT_TURN:return Ft(e,t,n)!==ri.RIGHT_TURN;case ri.COLLINEAR:return!0}}function Qt(e,t,i,n){var a=Jt(e,t,i,n);switch(a.intersectionType){case jt.POINT:return a.point;case jt.NO_INTERSECTION:return null}throw new Error("sdfgighowen")}function Zt(e,t){if(e[0]===t[0])return[1,0,-e[0]];if(e[1]===t[1])return[0,1,-e[1]];var i=t[0]-e[0],n=t[1]-e[1];return[-n,i,-i*e[1]+n*e[0]]}function Jt(e,t,i,n){if(!ti(e,t,i,n))return{intersectionType:jt.NO_INTERSECTION,point:null};var a=Zt(e,t),r=Zt(i,n),s=ei(a,r);switch(s.intersectionType){case jt.POINT:return s}throw new Error("gzseuihgpib")}function ei(e,t){var i=e[0]*t[1]-t[0]*e[1],n=e[1]*t[2]-t[1]*e[2],a=t[0]*e[2]-e[0]*t[2];return{intersectionType:jt.POINT,point:[n/i,a/i]}}function ti(e,t,i,n){if(Wt(e,t)){if(Wt(i,n)){if(Wt(t,i)||Wt(n,e))return!1}else if(Wt(t,n)||Wt(i,e))return!1}else if(Wt(i,n)){if(Wt(e,i)||Wt(n,t))return!1}else if(Wt(e,n)||Wt(i,t))return!1;if(Wt(e,t))if(Wt(i,n))switch(Xt(e,i)){case ri.SMALLER:switch(Xt(t,i)){case ri.SMALLER:return!1;case ri.EQUAL:return!0;default:switch(Xt(t,n)){case ri.SMALLER:return Kt(e,t,i,n);case ri.EQUAL:return!0;default:return qt(e,t,i,n)}}case ri.EQUAL:return!0;default:switch(Xt(n,e)){case ri.SMALLER:return!1;case ri.EQUAL:return!0;default:switch(Xt(n,t)){case ri.SMALLER:return Kt(i,n,e,t);case ri.EQUAL:return!0;default:return qt(i,n,e,t)}}}else switch(Xt(e,n)){case ri.SMALLER:switch(Xt(t,n)){case ri.SMALLER:return!1;case ri.EQUAL:return!0;default:switch(Xt(t,i)){case ri.SMALLER:return Kt(e,t,n,i);case ri.EQUAL:return!0;default:return qt(e,t,n,i)}}case ri.EQUAL:return!0;default:switch(Xt(i,e)){case ri.SMALLER:return!1;case ri.EQUAL:return!0;default:switch(Xt(i,t)){case ri.SMALLER:return Kt(n,i,e,t);case ri.EQUAL:return!0;default:return qt(n,i,e,t)}}}else if(Wt(i,n))switch(Xt(t,i)){case ri.SMALLER:switch(Xt(e,i)){case ri.SMALLER:return!1;case ri.EQUAL:return!0;default:switch(Xt(e,n)){case ri.SMALLER:return Kt(t,e,i,n);case ri.EQUAL:return!0;default:return qt(t,e,i,n)}}case ri.EQUAL:return!0;default:switch(Xt(n,t)){case ri.SMALLER:return!1;case ri.EQUAL:return!0;default:switch(Xt(n,e)){case ri.SMALLER:return Kt(i,n,t,e);case ri.EQUAL:return!0;default:return qt(i,n,t,e)}}}else switch(Xt(t,n)){case ri.SMALLER:switch(Xt(e,n)){case ri.SMALLER:return!1;case ri.EQUAL:return!0;default:switch(Xt(e,i)){case ri.SMALLER:return Kt(t,e,n,i);case ri.EQUAL:return!0;default:return qt(t,e,n,i)}}case ri.EQUAL:return!0;default:switch(Xt(i,t)){case ri.SMALLER:return!1;case ri.EQUAL:return!0;default:switch(Xt(i,e)){case ri.SMALLER:return Kt(n,i,t,e);case ri.EQUAL:return!0;default:return qt(n,i,t,e)}}}}function ii(e){if(e!==e)return e;if(e===-1/0)return-Number.MAX_VALUE;if(e===1/0)return 1/0;if(e===+Number.MAX_VALUE)return 1/0;var t=e*(e<0?1-Number.EPSILON/2:1+Number.EPSILON);t===e&&(t=Number.MIN_VALUE*Number.EPSILON>0?e+Number.MIN_VALUE*Number.EPSILON:e+Number.MIN_VALUE),t===1/0&&(t=+Number.MAX_VALUE);var i=e+(t-e)/2;e<i&&i<t&&(t=i);var n=(t+e)/2;return e<n&&n<t&&(t=n),0===t?-0:t}function ni(e){return e<0?ii(e)-e:e+ii(-e)}(function(e){e[e["NO_INTERSECTION"]=0]="NO_INTERSECTION",e[e["POINT"]=1]="POINT",e[e["SEGMENT"]=2]="SEGMENT"})(jt||(jt={}));var ai,ri,si,oi=-Infinity;function li(){return[oi,oi]}(function(e){e[e["NEGATIVE"]=-1]="NEGATIVE",e[e["ZERO"]=0]="ZERO",e[e["POSITIVE"]=1]="POSITIVE",e[e["RIGHT_TURN"]=-1]="RIGHT_TURN",e[e["LEFT_TURN"]=1]="LEFT_TURN",e[e["SMALLER"]=-1]="SMALLER",e[e["EQUAL"]=0]="EQUAL",e[e["LARGER"]=1]="LARGER",e[e["CLOCKWISE"]=-1]="CLOCKWISE",e[e["COUNTERCLOCKWISE"]=1]="COUNTERCLOCKWISE",e[e["COLLINEAR"]=0]="COLLINEAR",e[e["COPLANAR"]=0]="COPLANAR",e[e["DEGENERATE"]=0]="DEGENERATE",e[e["ON_NEGATIVE_SIDE"]=-1]="ON_NEGATIVE_SIDE",e[e["ON_ORIENTED_BOUNDARY"]=0]="ON_ORIENTED_BOUNDARY",e[e["ON_POSITIVE_SIDE"]=1]="ON_POSITIVE_SIDE"})(ri||(ri={})),function(e){e[e["UNDEFINED"]=-1]="UNDEFINED",e[e["VERTEX_VERTEX"]=0]="VERTEX_VERTEX",e[e["VERTEX_EDGE"]=1]="VERTEX_EDGE",e[e["EDGE_VERTEX"]=2]="EDGE_VERTEX",e[e["EDGE_EDGE"]=3]="EDGE_EDGE"}(si||(si={}));var ui=function(){function e(){Object(y["a"])(this,e),this.vertices=[],this.neighbours=[null,null,null],this.constraints=[!1,!1,!1],this.uid=e._counter++;for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];this.vertices=i}return Object(g["a"])(e,[{key:"from",value:function(e){return this.vertices=e.vertices.slice(0,e.vertices.length),this.neighbours=e.neighbours.slice(0,e.neighbours.length),this.constraints=e.constraints.slice(0,e.constraints.length),this}},{key:"addVertex",value:function(e){void 0===e&&console.log("UNDEFINED HIERE"),this.vertices.push(e),e.triangle=this}},{key:"isConstrained",value:function(e){return this.constraints[e]}},{key:"reorient",value:function(){this.vertices=[this.vertices[1],this.vertices[0],this.vertices[2]].slice(0,this.vertices.length),this.neighbours=[this.neighbours[1],this.neighbours[0],this.neighbours[2]],this.constraints=[this.constraints[1],this.constraints[0],this.constraints[2]]}},{key:"hasVertex",value:function(e){return this.vertices.includes(e)}},{key:"indexV",value:function(e){return this.vertices.indexOf(e)}},{key:"indexT",value:function(e){return this.neighbours.indexOf(e)}},{key:"isInfinite",value:function(e){return void 0===e?this.vertices.some(function(e){return e.infinite}):this.vertices[At(e)].infinite||this.vertices[Nt(e)].infinite}},{key:"contains",value:function(e){var t=-this.vertices[1].point[1]*this.vertices[2].point[0]+this.vertices[0].point[1]*(-this.vertices[1].point[0]+this.vertices[2].point[0])+this.vertices[0].point[0]*(this.vertices[1].point[1]-this.vertices[2].point[1])+this.vertices[1].point[0]*this.vertices[2].point[1],i=t<0?-1:1,n=(this.vertices[0].point[1]*this.vertices[2].point[0]-this.vertices[0].point[0]*this.vertices[2].point[1]+(this.vertices[2].point[1]-this.vertices[0].point[1])*e[0]+(this.vertices[0].point[0]-this.vertices[2].point[0])*e[1])*i;if(n<0)return!1;var a=(this.vertices[0].point[0]*this.vertices[1].point[1]-this.vertices[0].point[1]*this.vertices[1].point[0]+(this.vertices[0].point[1]-this.vertices[1].point[1])*e[0]+(this.vertices[1].point[0]-this.vertices[0].point[0])*e[1])*i;return a>0&&n+a<t*i}},{key:"cwPermute",value:function(){this.vertices.push(this.vertices.shift()),this.neighbours.push(this.neighbours.shift()),this.constraints.push(this.constraints.shift())}},{key:"ccwPermute",value:function(){this.vertices.unshift(this.vertices.pop()),this.neighbours.unshift(this.neighbours.pop()),this.constraints.unshift(this.constraints.pop())}},{key:"center",get:function(){return[(this.vertices[0].point[0]+this.vertices[1].point[0]+this.vertices[2].point[0])/3,(this.vertices[0].point[1]+this.vertices[1].point[1]+this.vertices[2].point[1])/3]}},{key:"dimension",get:function(){return this.vertices.length-1}}]),e}();ui._counter=0;var ci,hi=function(){function e(t){Object(y["a"])(this,e),this.infinite=!1,this.shapes=new Set,this._point=t}return Object(g["a"])(e,[{key:"getIncidentFaces",value:function(){var e=[],t=new fi(this,null);do{e.push(t.t)}while(t.next());return e}},{key:"getIncidentEdges",value:regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=new di(this,null);case 1:return e.next=3,new yi(t.t,t.ri);case 3:if(t.valid&&t.next()){e.next=1;break}case 4:case"end":return e.stop()}},e,this)})},{key:"point",get:function(){return this._point},set:function(e){this._point=e,this.infinite=!1}}]),e}(),di=function(){function e(t,i){if(Object(y["a"])(this,e),this.v=t,this.t=i,null===t?this.t=null:null===i&&(this.t=t.triangle),null==this.t||this.t.dimension<1)this.ri=0,this.v=null,this.t=null;else{var n=this.t.indexV(t);2===this.t.dimension?this.ri=At(n):this.ri=2}this._ri=this.ri,this._v=this.v,this._t=this.t}return Object(g["a"])(e,[{key:"next",value:function(){var e=this.t.indexV(this.v);return 1===this.t.dimension?this.t=this.t.neighbours[0===e?1:0]:(this.t=this.t.neighbours[At(e)],e=this.t.indexV(this.v),this.ri=At(e)),this.ri!==this._ri||this.v!==this._v||this.t!==this._t}},{key:"valid",get:function(){return null!==this.t&&null!==this.v}}]),e}(),vi=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Object(y["a"])(this,e),this.i=0,this._es=0,this.tds=t,this.filterInfinite=i,this.es=0,t.dimension<=0)this.pos=null;else{this.pos=t.triangles[0],1===t.dimension&&(this.es=2);while(null!==this.pos&&!this.associatedEdge())throw new Error("[poi");1===t.dimension&&(this._es=2)}}return Object(g["a"])(e,[{key:"next",value:function(){do{do{this.increment()}while(null!==this.pos&&!this.associatedEdge())}while(null!==this.pos&&this.predicate())}},{key:"predicate",value:function(){return!!this.filterInfinite&&this.pos.isInfinite(this.es)}},{key:"associatedEdge",value:function(){return 1===this.tds.dimension||this.tds.triangles.indexOf(this.pos)<this.tds.triangles.indexOf(this.pos.neighbours[this.es])}},{key:"increment",value:function(){1===this.tds.dimension?(this.i++,this.tds.triangles.length<=this.i?this.pos=null:this.pos=this.tds.triangles[this.i]):2===this.es?(this.es=0,this.i++,this.tds.triangles.length<=this.i?this.pos=null:this.pos=this.tds.triangles[this.i]):this.es++}},{key:"valid",get:function(){return(null!==this.pos||this._es!==this.es)&&!this.predicate()}},{key:"edge",get:function(){return new yi(this.pos,this.es)}}]),e}(),fi=function(){function e(t,i){Object(y["a"])(this,e),this.v=t,this.t=i,null===t?this.t=null:null===i&&(this.t=t.triangle),(null==this.t||this.t.dimension<2)&&(this.v=null,this.t=null),this._v=this.v,this._t=this.t}return Object(g["a"])(e,[{key:"setDone",value:function(){this._v=this.v,this._t=this.t}},{key:"prev",value:function(){var e=this.t.indexV(this.v);this.t=this.t.neighbours[Nt(e)]}},{key:"next",value:function(){var e=this.t.indexV(this.v);return this.t=this.t.neighbours[At(e)],!this.done}},{key:"valid",get:function(){return null!==this.t&&null!==this.v}},{key:"done",get:function(){return this.v===this._v&&this.t===this._t}}]),e}(),pi=function(){function e(t,i,n){Object(y["a"])(this,e),this.i=0,this.pos=null,this.s=si.UNDEFINED,this._tr=i,this.p=t.point,this.q=n;var a=new fi(t,null),r=a.t.indexV(t),s=a.t.vertices[Nt(r)];while(t===ai||Ft(this.p,this.q,s.point)!==ri.LEFT_TURN)if(a.next(),r=a.t.indexV(t),s=a.t.vertices[Nt(r)],!a.valid)return;var o=a.t.vertices[At(r)],l=ri.RIGHT_TURN;while(o!==ai&&(l=Ft(this.p,this.q,o.point))===ri.LEFT_TURN)a.prev(),r=a.t.indexV(t),o=a.t.vertices[At(r)];if(r=a.t.indexV(t),s=a.t.vertices[Nt(r)],o===ai)switch(a.prev(),r=a.t.indexV(t),o=a.t.vertices[At(r)],l=Ft(this.p,this.q,o.point),l){case ri.RIGHT_TURN:case ri.COLLINEAR:a.next(),r=a.t.indexV(ai),this.pos=a.t,this.s=si.VERTEX_VERTEX,this.i=r;break;case ri.LEFT_TURN:break}else l===ri.COLLINEAR?(this.pos=a.t,this.s=si.VERTEX_VERTEX,this.i=At(r)):(this.pos=a.t,this.s=si.VERTEX_EDGE,this.i=r)}return Object(g["a"])(e,[{key:"next",value:function(){this.increment()}},{key:"increment",value:function(){var e;if(this.s===si.VERTEX_VERTEX||this.s===si.EDGE_VERTEX){do{var t=this.pos.neighbours[Nt(this.i)];if(this.i=t.indexT(this.pos),this.pos=t,this.pos.vertices[this.i]===ai){e=ri.COLLINEAR,this.i=Nt(this.i);break}e=Ft(this.p,this.q,this.pos.vertices[this.i].point),this.i=Nt(this.i)}while(e===ri.LEFT_TURN);e===ri.COLLINEAR?(this.s=si.VERTEX_VERTEX,this.i=At(this.i)):this.s=si.VERTEX_EDGE}else{var i=this.pos.neighbours[this.i],n=i.indexT(this.pos);switch(this.pos=i,e=this.pos.vertices[n]===ai?ri.COLLINEAR:Ft(this.p,this.q,this.pos.vertices[n].point),e){case ri.LEFT_TURN:this.s=si.EDGE_EDGE,this.i=At(n);break;case ri.RIGHT_TURN:this.s=si.EDGE_EDGE,this.i=Nt(n);break;default:this.s=si.EDGE_VERTEX,this.i=n}}}}]),e}(),yi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(y["a"])(this,e),this.first=null,this.second=0,this.first=t,this.second=i}return Object(g["a"])(e,[{key:"toString",value:function(){return"".concat(this.first.vertices[1===this.second?0:1].point," - ").concat(this.first.vertices[1===this.second?2:1].point)}}]),e}();(function(e){e[e["VERTEX"]=0]="VERTEX",e[e["EDGE"]=1]="EDGE",e[e["FACE"]=2]="FACE",e[e["OUTSIDE_CONVEX_HULL"]=3]="OUTSIDE_CONVEX_HULL",e[e["OUTSIDE_AFFINE_HULL"]=4]="OUTSIDE_AFFINE_HULL"})(ci||(ci={}));var gi=function(){function e(){Object(y["a"])(this,e),this.dimension=-1,this.vertices=[],this.triangles=[],this._infinite=this.createVertex(),ai=this._infinite;var t=new ui;t.addVertex(this._infinite),this.triangles.push(t)}return Object(g["a"])(e,[{key:"createVertex",value:function(){var e=new hi(li());return e.infinite=!0,this.vertices.push(e),e}},{key:"deleteVertex",value:function(e){this.vertices=this.vertices.filter(function(t){return t!==e})}},{key:"createTriangle",value:function(e,t,i,n,a,r){var s=new ui(e,t,i);return s.neighbours[0]=n,s.neighbours[1]=a,s.neighbours[2]=r,this.triangles.push(s),s}},{key:"createTriangle2",value:function(e,t,i,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=null===a||null===r?i.vertices[At(n)]:a.vertices[Nt(r)],o=new ui(e.vertices[Nt(t)],i.vertices[Nt(n)],s);return e.neighbours[t]=o,i.neighbours[n]=o,null!==a&&null!==r&&(a.neighbours[r]=o),o.neighbours[0]=i,null!==a&&(o.neighbours[1]=a),o.neighbours[2]=e,this.triangles.push(o),o}},{key:"createTriangle3",value:function(e,t,i){var n=new ui(e.vertices[Nt(t)],e.vertices[At(t)],i);return n.neighbours[2]=e,e.neighbours[t]=n,this.triangles.push(n),n}},{key:"deleteTriangle",value:function(e){this.triangles=this.triangles.filter(function(t){return t!==e})}},{key:"setAdjacency",value:function(e,t,i,n){e.neighbours[t]=i,i.neighbours[n]=e}},{key:"getEdges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new vi(this),i=[];if(null===t.edge.first)return i;while(!t.valid)t.next();do{var n=t.edge;e?n.first.constraints[n.second]&&i.push(n):i.push(n),t.next()}while(t.valid);return i}},{key:"numberOfEdges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=0,i=0,n=new vi(this);if(null===n.edge.first)return 0;while(!n.valid)n.next();do{i++;var a=n.edge;a.first.constraints[a.second]&&t++,n.next()}while(n.valid);return e?t:i}},{key:"numberOfVertices",value:function(e){return this.vertices.length-(e?0:1)}},{key:"insertDimUp",value:function(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hi,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this.createVertex();switch(this.dimension++,this.dimension){case 0:e=this.triangles[0],t=new ui(a),this.triangles.push(t),this.setAdjacency(e,0,t,0),a.triangle=t;break;case 1:case 2:var r=[],s=this.triangles.slice(0,this.triangles.length),o=!0,l=!1,u=void 0;try{for(var c,h=s[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var d=c.value,v=(new ui).from(d);this.triangles.push(v),d.vertices[this.dimension]=a,v.vertices[this.dimension]=i,this.setAdjacency(d,this.dimension,v,this.dimension),d.vertices.includes(i)&&r.push(v)}}catch(N){l=!0,u=N}finally{try{o||null==h.return||h.return()}finally{if(l)throw u}}var f=!0,p=!1,y=void 0;try{for(var g,m=s[Symbol.iterator]();!(f=(g=m.next()).done);f=!0)for(var b=g.value,w=b.neighbours[this.dimension],k=0;k<this.dimension;++k)w.neighbours[k]=b.neighbours[k].neighbours[this.dimension]}catch(N){p=!0,y=N}finally{try{f||null==m.return||m.return()}finally{if(p)throw y}}var x=0;if(1===this.dimension)n?(s[x].reorient(),x++,s[x].neighbours[1].reorient()):(s[x].neighbours[1].reorient(),x++,s[x].reorient());else{var O=!0,S=!1,_=void 0;try{for(var C,L=s[Symbol.iterator]();!(O=(C=L.next()).done);O=!0){var E=C.value;n?E.neighbours[2].reorient():E.reorient()}}catch(N){S=!0,_=N}finally{try{O||null==L.return||L.return()}finally{if(S)throw _}}}for(var I=0,j=r;I<j.length;I++){var T=j[I],M=1;T.vertices[0]===i&&(M=0),e=T.neighbours[this.dimension];var P=this.mirrorIndex(T,this.dimension);t=T.neighbours[M];var D=this.mirrorIndex(T,M);this.setAdjacency(e,P,t,D),this.deleteTriangle(T)}a.triangle=s[0];break;default:throw new Error("Dimension unknown")}return a}},{key:"mirrorIndex",value:function(e,t){if(1===e.dimension){var i=e.neighbours[t].indexV(e.vertices[0===t?1:0]);return 0===i?1:0}return At(e.neighbours[t].indexV(e.vertices[At(t)]))}},{key:"insertInFace",value:function(e){var t=this.createVertex(),i=e.vertices[0],n=e.vertices[1],a=e.vertices[2],r=e.neighbours[1],s=e.neighbours[2],o=this.createTriangle(i,t,a,e,r,null),l=this.createTriangle(i,n,t,e,null,s);if(this.setAdjacency(o,2,l,1),null!==r){var u=this.mirrorIndex(e,1);r.neighbours[u]=o}if(null!==s){var c=this.mirrorIndex(e,2);s.neighbours[c]=l}return e.vertices[0]=t,e.neighbours[1]=o,e.neighbours[2]=l,i.triangle===e&&(i.triangle=l),t.triangle=e,t}},{key:"flip",value:function(e,t){var i=e.neighbours[t],n=this.mirrorIndex(e,t),a=e.vertices[Nt(t)],r=e.vertices[At(t)],s=e.neighbours[At(t)],o=this.mirrorIndex(e,At(t)),l=i.neighbours[At(n)],u=this.mirrorIndex(i,At(n));e.vertices[Nt(t)]=i.vertices[n],i.vertices[Nt(n)]=e.vertices[t],this.setAdjacency(e,t,l,u),this.setAdjacency(e,At(t),i,At(n)),this.setAdjacency(i,n,s,o),a.triangle===e&&(a.triangle=i),r.triangle===i&&(r.triangle=e)}},{key:"insertInEdge",value:function(e,t){var i;if(1===this.dimension){i=this.createVertex();var n=e.neighbours[0],a=e.vertices[1],r=this.createTriangle(i,a,null,n,e,null);e.vertices[1]=i,e.neighbours[0]=r,n.neighbours[1]=r,i.triangle=r,a.triangle=n}else{var s=e.neighbours[t],o=this.mirrorIndex(e,t);i=this.insertInFace(e),this.flip(s,o)}return i}},{key:"makeHole",value:function(e,t){var i,n,a,r,s,o=[],l=new fi(e,null);do{i=l.t,l.next(),a=i.indexV(e),n=i.neighbours[a],r=n.indexT(i),s=i.vertices[Nt(a)],s.triangle=n,s=i.vertices[At(a)],s.triangle=n,n.neighbours[r]=null,t.push([n,r]),o.push(i)}while(!l.done);for(var u=0,c=o;u<c.length;u++){var h=c[u];this.deleteTriangle(h)}}},{key:"fillHoleDelaunay",value:function(e){var t,i,n,a,r,s,o=[];o.push(e);while(o.length>0){var l=o[0],u=void 0;if(3!==l.length){var c=!1;while(!c)i=l[0][0],r=l[0][1],i.vertices[Nt(r)].infinite||i.vertices[At(r)].infinite?l.push(l.shift()):c=!0;i=l[0][0],r=l[0][1],l.shift();var h=i.vertices[Nt(r)],d=i.vertices[At(r)],v=this._infinite,f=void 0,p=h.point,y=d.point;u=0;var g=0;while(u!==l.length-1){n=l[u][0],s=l[u][1];var m=n.vertices[At(s)];if(m.infinite&&v.infinite)g=u;else{var b=m.point;Ft(p,y,b)===ri.COUNTERCLOCKWISE&&(v.infinite?(v=m,f=m,g=u):Ht(p,y,f.point,b,!0)===ri.ON_POSITIVE_SIDE&&(v=m,f=m,g=u))}u++}var w=void 0;if(n=l[0][0],s=l[0][1],n.vertices[At(s)]===v)w=this.createTriangle2(i,r,n,s),l.shift(),l.unshift([w,1]);else{n=l[l.length-1][0],s=l[l.length-1][1];var k=n.indexV(v);if(k>=0&&k===Nt(s))w=this.createTriangle2(n,s,i,r),l.pop(),l.push([w,1]);else{w=this.createTriangle3(i,r,v);var x=[];++g;while(l[0]!==l[g--])x.push(l.shift());l.unshift([w,1]),x.unshift([w,0]),o.unshift(x)}}}else u=0,t=l[u][0],a=l[u][1],i=l[++u][0],r=l[u][1],n=l[++u][0],s=l[u][1],this.createTriangle2(t,a,i,r,n,s),o.shift()}}},{key:"removeDimDown",value:function(e){var t;switch(this.dimension){case-1:this.deleteTriangle(e.triangle);break;case 0:t=e.triangle,t.neighbours[0].neighbours[0]=null,this.deleteTriangle(e.triangle);break;case 1:case 2:var i=[],n=[],a=!0,r=!1,s=void 0;try{for(var o,l=this.triangles[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value;u.hasVertex(e)?n.push(u):i.push(u)}}catch(g){r=!0,s=g}finally{try{a||null==l.return||l.return()}finally{if(r)throw s}}for(var c=0,h=n;c<h.length;c++){var d=h[c],v=d.indexV(e);1===this.dimension?(0===v&&d.reorient(),d.vertices[1]=null,d.neighbours[1]=null):(0===v?d.cwPermute():1===v&&d.ccwPermute(),d.vertices[2]=null,d.neighbours[2]=null),d.vertices[0].triangle=d}for(var f=0,p=i;f<p.length;f++){var y=p[f];this.deleteTriangle(y)}}this.deleteVertex(e),this.dimension--}},{key:"finiteVertex",get:function(){return this.vertices[1]}},{key:"finiteEdge",get:function(){if(this.dimension<1)throw new Error("aspo");var e=new vi(this,!0);while(!e.valid)e.next();return e.edge}}]),e}(),mi=function(){function e(t){Object(y["a"])(this,e),this.x1=t[0],this.y1=t[1],this.x2=t[0],this.y2=t[1]}return Object(g["a"])(e,[{key:"dilate",value:function(e){this.x1-=e*ni(this.x1),this.y1-=e*ni(this.y1),this.x2+=e*ni(this.x2),this.y2+=e*ni(this.y2)}},{key:"overlaps",value:function(e){return!(this.x2<e.x1||e.x2<this.x1)&&!(this.y2<e.y1||e.y2<this.y1)}}]),e}(),bi=function(){function e(){Object(y["a"])(this,e),this.tds=new gi}return Object(g["a"])(e,[{key:"insertConstraint",value:function(e,t){var i=this.insert(e),n=this.insert(t);return i!==n&&this.insertConstraintV(i,n),{va:i,vb:n}}},{key:"insertConstraintV",value:function(e,t){var i=[[e,t]];while(i.length>0){var n=i.pop(),a=Rt(n[0],n[1]);if(a.includes)this.markConstraint(a.fr,a.i),a.vi!==n[1]&&i.push([a.vi,n[1]]);else{var r=this.findIntersectedFaces(n[0],n[1]);r.found?r.vi!==n[0]&&r.vi!==n[1]?(i.push([n[0],r.vi]),i.push([r.vi,n[1]])):i.push(n):(this.triangulateHole(r.intersectedFaces,r.listAB,r.listBA),r.vi!==n[1]&&i.push([r.vi,n[1]]))}}}},{key:"triangulateHole",value:function(e,t,i){var n=[];this.triangulateHole2(e,t,i,n),this.propagatingFlipE(n)}},{key:"triangulateHole2",value:function(e,t,i,n){if(t.length>0){this.triangulateHalfHole(t,n),this.triangulateHalfHole(i,n);var a=t[0][0],r=i[0][0];a.neighbours[2]=r,r.neighbours[2]=a,a.constraints[2]=!0,r.constraints[2]=!0;while(e.length>0)this.tds.deleteTriangle(e.shift())}}},{key:"triangulateHalfHole",value:function(e,t){var i,n,a,r,s,o,l,u,c=0,h=function(){return e[c]},d=function(){return e[i]},v=h()[0].vertices[At(h()[1])];i=c,++i;do{r=h()[0],l=h()[1],null!==r.neighbours[l]&&(a=r.neighbours[l],o=Nt(a.indexV(r.vertices[Nt(l)])),r=a.neighbours[o],l=this.tds.mirrorIndex(a,o)),s=d()[0],u=d()[1],null!==s.neighbours[u]&&(a=s.neighbours[u],o=Nt(a.indexV(s.vertices[Nt(u)])),s=a.neighbours[o],u=this.tds.mirrorIndex(a,o));var f=r.vertices[At(l)],p=r.vertices[Nt(l)],y=s.vertices[Nt(u)],g=Ft(f.point,p.point,y.point);switch(g){case ri.RIGHT_TURN:var m=this.tds.createTriangle(f,y,p,null,null,null);t.push([m,2]),m.neighbours[1]=r,m.neighbours[0]=s,r.neighbours[l]=m,s.neighbours[u]=m,r.isConstrained(l)&&(m.constraints[1]=!0),s.isConstrained(u)&&(m.constraints[0]=!0),f.triangle=m,p.triangle=m,y.triangle=m,n=c+1,e.splice(c,0,[m,2]),e.splice(Math.max(n,i),1),e.splice(Math.min(n,i),1),i=c,f!==v?--c:++i;break;case ri.LEFT_TURN:case ri.COLLINEAR:++c,++i;break}}while(i<e.length)}},{key:"findIntersectedFaces",value:function(e,t){var i,n=e.point,a=t.point,r=[],s=[],o=[],l=new pi(e,this,a),u=l.pos.indexV(e);if(l.pos.isConstrained(u))return i=this.intersect(l.pos,u,e,t),{found:!0,vi:i,listAB:r,listBA:s,intersectedFaces:o};var c=l.pos.neighbours[At(u)],h=l.pos.neighbours[Nt(u)];r.push([c,c.indexT(l.pos)]),s.unshift([h,h.indexT(l.pos)]),o.unshift(l.pos);var d=l.pos;l.next(),u=l.pos.indexT(d);var v=l.pos.vertices[u],f=!1;while(v!==t&&!f){var p=void 0,y=void 0,g=Ft(n,a,v.point);switch(g){case ri.COLLINEAR:f=!0;break;case ri.LEFT_TURN:case ri.RIGHT_TURN:if(g===ri.LEFT_TURN?(p=At(u),y=Nt(u)):(p=Nt(u),y=At(u)),l.pos.isConstrained(p))return i=this.intersect(l.pos,p,e,t),{found:!0,vi:i,listAB:r,listBA:s,intersectedFaces:o};c=l.pos.neighbours[y],o.unshift(l.pos),g===ri.LEFT_TURN?r.push([c,c.indexT(l.pos)]):s.unshift([c,c.indexT(l.pos)]),d=l.pos,l.next(),u=l.pos.indexT(d),v=l.pos.vertices[u];break}}return i=v,o.unshift(l.pos),c=l.pos.neighbours[Nt(u)],r.push([c,c.indexT(l.pos)]),h=l.pos.neighbours[At(u)],s.unshift([h,h.indexT(l.pos)]),{found:!1,vi:i,listAB:r,listBA:s,intersectedFaces:o}}},{key:"intersect",value:function(e,t,i,n){var a,r=e.vertices[Nt(t)],s=e.vertices[At(t)],o=i.point,l=n.point,u=r.point,c=s.point,h=Qt(o,l,u,c);if(h!==o&&h!==l&&h!==u&&h!==c){var d=new mi(h);d.dilate(4),d.overlaps(new mi(o))&&(h=o),d.overlaps(new mi(l))&&(h=l),d.overlaps(new mi(u))&&(h=u),d.overlaps(new mi(c))&&(h=c)}if(null===h)throw new Error("what");return this.removeConstrainedEdge(e,t),a=this.insert(h,e),a!==r&&a!==s?(this.insertConstraintV(r,a),this.insertConstraintV(a,s)):this.insertConstraintV(r,s),a}},{key:"removeVertex",value:function(e){this.tds.dimension<=1?this.removeConstrainedVertex(e):this.remove2D(e)}},{key:"removeConstrainedVertex",value:function(e){var t=this.tds.numberOfVertices(!1);1===t||2===t?this.tds.removeDimDown(e):1===this.tds.dimension?console.warn("NOT IMPLEMENTED."):this.remove2D(e)}},{key:"remove2D",value:function(e){if(this.testDimDown(e))this.tds.removeDimDown(e);else{var t=[];this.tds.makeHole(e,t);var i=[].concat(t);this.tds.fillHoleDelaunay(t),this.updateConstraints(i),this.tds.deleteVertex(e)}}},{key:"testDimDown",value:function(e){var t=!0,i=!0,n=!1,a=void 0;try{for(var r,s=this.tds.triangles[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var o=r.value;if(!o.isInfinite()&&!o.hasVertex(e)){t=!1;break}}}catch(v){n=!0,a=v}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}var l=new fi(e,null);while(l.t.isInfinite())l.next();l.setDone();var u=l.t,c=u.indexV(e),h=u.vertices[Nt(c)].point,d=u.vertices[At(c)].point;while(t&&l.next())c=l.t.indexV(e),l.t.vertices[At(c)]!==this.tds._infinite&&(t=t&&Ft(h,d,l.t.vertices[At(c)].point)===ri.COLLINEAR);return t}},{key:"updateConstraints",value:function(e){var t,i,n=!0,a=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var l=s.value;t=l[0],i=l[1],t.neighbours[i].constraints[this.tds.mirrorIndex(t,i)]=t.isConstrained(i)}}catch(u){a=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}}},{key:"removeConstrainedEdge",value:function(e,t){e.constraints[t]=!1,2===this.tds.dimension&&(e.neighbours[t].constraints[this.tds.mirrorIndex(e,t)]=!1)}},{key:"removeConstrainedEdgeDelaunay",value:function(e,t){if(this.removeConstrainedEdge(e,t),2===this.tds.dimension){var i=[[e,t]];this.propagatingFlipE(i)}}},{key:"updateConstraintsOpposite",value:function(e){var t,i=e.triangle,n=i;do{t=i.indexV(e),i.neighbours[t].constraints[this.tds.mirrorIndex(i,t)]?i.constraints[t]=!0:i.constraints[t]=!1,i=i.neighbours[At(t)]}while(i!==n)}},{key:"markConstraint",value:function(e,t){1===this.tds.dimension?e.constraints[2]=!0:(e.constraints[t]=!0,e.neighbours[t].constraints[this.tds.mirrorIndex(e,t)]=!0)}},{key:"insert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.locate(e,this.iLocate(e,t)),n=this.insertb(e,i.loc,i.lt,i.li);return this.flipAround(n),n}},{key:"flipAround",value:function(e){if(!(this.tds.dimension<=1)){var t,i,n=e.triangle,a=n;do{t=n.indexV(e),i=n.neighbours[At(t)],this.propagatingFlip(n,t),n=i}while(i!==a)}}},{key:"propagatingFlip",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.isFlipable(e,t)){var n=100;if(i===n)throw new Error("maxde");var a=e.neighbours[t];this.flip(e,t),this.propagatingFlip(e,t,i+1),t=a.indexV(e.vertices[t]),this.propagatingFlip(a,t,i+1)}}},{key:"lessEdge",value:function(e,t){var i=e[1],n=t[1];return e[0].uid<t[0].uid||e[0].uid===t[0].uid&&i<n}},{key:"propagatingFlipE",value:function(e){var t,i,n,a,r,s,o,l=this,u=0,c=[];while(u<e.length)t=e[u][0],i=e[u][1],this.isFlipable(t,i)&&(n=[t.neighbours[i],this.tds.mirrorIndex(t,i)],this.lessEdge(e[u],n)?c.push(e[u]):c.push(n)),++u;var h=[null,null,null,null];while(c.length>0){t=c[0][0],a=c[0][1],r=t.neighbours[a],s=this.tds.mirrorIndex(t,a),o=[t,a],c.splice(c.findIndex(function(e){return e[0]===o[0]&&e[1]===o[1]}),1),h[0]=[t,Nt(a)],h[1]=[t,At(a)],h[2]=[r,Nt(s)],h[3]=[r,At(s)];for(var d=function(){var e=f[v],t=e[0],i=e[1];n=[t.neighbours[i],l.tds.mirrorIndex(t,i)],l.lessEdge(e,n)?c.splice(c.findIndex(function(t){return t[0]===e[0]&&t[1]===e[1]}),1):c.splice(c.findIndex(function(e){return e[0]===n[0]&&e[1]===n[1]}),1)},v=0,f=h;v<f.length;v++)d();this.flip(t,a);for(var p=0,y=h;p<y.length;p++){var g=y[p],m=g[0],b=g[1];this.isFlipable(m,b)&&(n=[m.neighbours[b],this.tds.mirrorIndex(m,b)],this.lessEdge(g,n)?c.push(g):c.push(n))}}}},{key:"flip",value:function(e,t){var i=e.neighbours[t],n=this.tds.mirrorIndex(e,t),a=e.neighbours[Nt(t)],r=this.tds.mirrorIndex(e,Nt(t)),s=e.neighbours[At(t)],o=this.tds.mirrorIndex(e,At(t)),l=i.neighbours[Nt(n)],u=this.tds.mirrorIndex(i,Nt(n)),c=i.neighbours[At(n)],h=this.tds.mirrorIndex(i,At(n));this.tds.flip(e,t),e.constraints[e.indexT(i)]=!1,i.constraints[i.indexT(e)]=!1,a.neighbours[r].constraints[this.tds.mirrorIndex(a,r)]=a.constraints[r],s.neighbours[o].constraints[this.tds.mirrorIndex(s,o)]=s.constraints[o],l.neighbours[u].constraints[this.tds.mirrorIndex(l,u)]=l.constraints[u],c.neighbours[h].constraints[this.tds.mirrorIndex(c,h)]=c.constraints[h]}},{key:"isFlipable",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=e.neighbours[t];return!e.isInfinite()&&!n.isInfinite()&&(!e.constraints[t]&&Bt(n,e.vertices[t].point,i)===ri.ON_POSITIVE_SIDE)}},{key:"insertb",value:function(e,t,i,n){var a,r,s=!1;i===ci.EDGE&&t.isConstrained(n)&&(s=!0,a=t.vertices[At(n)],r=t.vertices[Nt(n)]);var o=this.insertc(e,t,i,n);return s?this.updateConstraintsIncident(o,a,r):i!==ci.VERTEX&&this.clearConstraintsIncident(o),2===this.tds.dimension&&this.updateConstraintsOpposite(o),o}},{key:"updateConstraintsIncident",value:function(e,t,i){if(0!==this.tds.dimension)if(1===this.tds.dimension){var n=new di(e,null);do{n.t.constraints[2]=!0}while(n.next())}else{var a=new fi(e,null);do{var r=a.t.indexV(e),s=Nt(r),o=At(r);a.t.vertices[s]===t||a.t.vertices[s]===i?(a.t.constraints[o]=!0,a.t.constraints[s]=!1):(a.t.constraints[o]=!1,a.t.constraints[s]=!0)}while(a.next())}}},{key:"clearConstraintsIncident",value:function(e){var t=new di(e,null);if(t.valid)do{var i=t.t,n=t.ri;i.constraints[n]=!1,2===this.tds.dimension&&(i.neighbours[n].constraints[this.tds.mirrorIndex(i,n)]=!1)}while(t.next())}},{key:"insertc",value:function(e,t,i,n){if(1===this.tds.vertices.length)return this.insertFirst(e);if(2===this.tds.vertices.length)return i===ci.VERTEX?this.tds.finiteVertex:this.insertSecond(e);switch(i){case ci.VERTEX:return t.vertices[n];case ci.OUTSIDE_AFFINE_HULL:return this.insertOutsideAffineHull(e);case ci.OUTSIDE_CONVEX_HULL:return this.insertOutsideConvexHull(e,t);case ci.EDGE:return this.insertInEdge(e,t,n);case ci.FACE:return this.insertInFace(e,t)}throw new Error("qwe")}},{key:"insertInEdge",value:function(e,t,i){var n=this.tds.insertInEdge(t,i);return n.point=e,n}},{key:"insertInFace",value:function(e,t){var i=this.tds.insertInFace(t);return i.point=e,i}},{key:"insertFirst",value:function(e){var t=this.tds.insertDimUp();return t.point=e,t}},{key:"insertSecond",value:function(e){var t=this.tds.insertDimUp(this.tds._infinite,!0);return t.point=e,t}},{key:"insertOutsideAffineHull",value:function(e){var t=!1;if(1===this.tds.dimension){var i=this.tds.finiteEdge.first,n=Ft(i.vertices[0].point,i.vertices[1].point,e);t=n===ri.COUNTERCLOCKWISE}var a=this.tds.insertDimUp(this.tds._infinite,t);return a.point=e,a}},{key:"insertOutsideConvexHull",value:function(e,t){var i;if(1===this.tds.dimension)throw new Error("sdfasdasd");return i=this.insertOutsideConvexHull2(e,t),i.point=e,i}},{key:"insertOutsideConvexHull2",value:function(e,t){var i=t.indexV(this.tds._infinite),n=[],a=[],r=new fi(this.tds._infinite,t),s=!1;while(!s){r.prev(),i=r.t.indexV(this.tds._infinite);var o=r.t.vertices[At(i)].point,l=r.t.vertices[Nt(i)].point;Ft(e,o,l)===ri.LEFT_TURN?n.push(r.t):s=!0}r=new fi(this.tds._infinite,t),s=!1;while(!s){r.next(),i=r.t.indexV(this.tds._infinite);var u=r.t.vertices[At(i)].point,c=r.t.vertices[Nt(i)].point;Ft(e,u,c)===ri.LEFT_TURN?a.push(r.t):s=!0}var h,d=this.tds.insertInFace(t);d.point=e;while(n.length>0)h=n[0],i=At(h.indexV(this.tds._infinite)),this.tds.flip(h,i),n.shift();while(a.length>0)h=a[0],i=Nt(h.indexV(this.tds._infinite)),this.tds.flip(h,i),a.shift();r=new fi(d,null);while(!r.t.isInfinite())r.next();return this.tds._infinite.triangle=r.t,d}},{key:"locate",value:function(e,t){var i=0,n=0;if(this.tds.dimension<0)return i=ci.OUTSIDE_AFFINE_HULL,n=4,{loc:null,lt:i,li:n};if(0===this.tds.dimension)return i=Gt(e,this.tds.finiteVertex.triangle.vertices[0].point)?ci.VERTEX:ci.OUTSIDE_AFFINE_HULL,n=4,{loc:null,lt:i,li:n};if(1===this.tds.dimension)return this.marchLocate1D(e);if(null===t){var a=this.tds._infinite.triangle;t=a.neighbours[a.indexV(this.tds._infinite)]}else t.isInfinite()&&(t=t.neighbours[t.indexV(this.tds._infinite)]);return this.marchLocate2D(t,e)}},{key:"marchLocate1D",value:function(e){var t=this.tds._infinite.triangle,i=t.indexV(this.tds._infinite),n=t.neighbours[i],a=Ft(n.vertices[0].point,n.vertices[1].point,e);if(a===ri.RIGHT_TURN||a===ri.LEFT_TURN)return{loc:new ui,lt:ci.OUTSIDE_AFFINE_HULL,li:4};var r=n.indexT(t);if(Vt(e,n.vertices[1-r].point,n.vertices[r].point))return{loc:t,lt:ci.OUTSIDE_CONVEX_HULL,li:i};if(Gt(e,n.vertices[1-r].point))return{loc:n,lt:ci.VERTEX,li:1-r};throw new Error("sdfsdf")}},{key:"marchLocate2D",value:function(e,t){var i,n,a=null,r=!0;while(1){if(e.isInfinite())return{loc:e,lt:ci.OUTSIDE_CONVEX_HULL,li:e.indexV(this.tds._infinite)};var s=0,o=e.vertices[0].point,l=e.vertices[1].point,u=e.vertices[2].point,c=void 0,h=void 0,d=void 0;if(r){if(a=e,r=!1,c=Ft(o,l,t),c===ri.NEGATIVE){e=e.neighbours[2];continue}if(h=Ft(l,u,t),h===ri.NEGATIVE){e=e.neighbours[0];continue}if(d=Ft(u,o,t),d===ri.NEGATIVE){e=e.neighbours[1];continue}}else if(s)if(e.neighbours[0]===a){if(a=e,c=Ft(o,l,t),c===ri.NEGATIVE){e=e.neighbours[2];continue}if(d=Ft(u,o,t),d===ri.NEGATIVE){e=e.neighbours[1];continue}h=ri.POSITIVE}else if(e.neighbours[1]===a){if(a=e,h=Ft(l,u,t),h===ri.NEGATIVE){e=e.neighbours[0];continue}if(c=Ft(o,l,t),c===ri.NEGATIVE){e=e.neighbours[2];continue}d=ri.POSITIVE}else{if(a=e,d=Ft(u,o,t),d===ri.NEGATIVE){e=e.neighbours[1];continue}if(h=Ft(l,u,t),h===ri.NEGATIVE){e=e.neighbours[0];continue}c=ri.POSITIVE}else if(e.neighbours[0]===a){if(a=e,d=Ft(u,o,t),d===ri.NEGATIVE){e=e.neighbours[1];continue}if(c=Ft(o,l,t),c===ri.NEGATIVE){e=e.neighbours[2];continue}h=ri.POSITIVE}else if(e.neighbours[1]===a){if(a=e,c=Ft(o,l,t),c===ri.NEGATIVE){e=e.neighbours[2];continue}if(h=Ft(l,u,t),h===ri.NEGATIVE){e=e.neighbours[0];continue}d=ri.POSITIVE}else{if(a=e,h=Ft(l,u,t),h===ri.NEGATIVE){e=e.neighbours[0];continue}if(d=Ft(u,o,t),d===ri.NEGATIVE){e=e.neighbours[1];continue}c=ri.POSITIVE}var v=(c===ri.COLLINEAR?1:0)+(h===ri.COLLINEAR?1:0)+(d===ri.COLLINEAR?1:0);switch(v){case 0:i=ci.FACE,n=4;break;case 1:i=ci.EDGE,n=c===ri.COLLINEAR?2:h===ri.COLLINEAR?0:1;break;case 2:i=ci.VERTEX,n=c!==ri.COLLINEAR?2:h!==ri.COLLINEAR?0:1;break}if(void 0===i||void 0===n)throw new Error("ert");return{loc:e,lt:i,li:n}}}},{key:"iLocate",value:function(e,t){if(this.tds.dimension<2)return t;if(null===t){var i=this.tds._infinite.triangle;t=i.neighbours[i.indexV(this.tds._infinite)]}else t.isInfinite()&&(t=t.neighbours[t.indexV(this.tds._infinite)]);var n=null,a=t,r=!0,s=2500;while(1){if(!s--)return a;if(a.isInfinite())return a;var o=a.vertices[0].point,l=a.vertices[1].point,u=a.vertices[2].point;if(r){if(n=a,r=!1,zt(o,l,e)){a=a.neighbours[2];continue}if(zt(l,u,e)){a=a.neighbours[0];continue}if(zt(u,o,e)){a=a.neighbours[1];continue}}else if(a.neighbours[0]===n){if(n=a,zt(o,l,e)){a=a.neighbours[2];continue}if(zt(u,o,e)){a=a.neighbours[1];continue}}else if(a.neighbours[1]===n){if(n=a,zt(o,l,e)){a=a.neighbours[2];continue}if(zt(l,u,e)){a=a.neighbours[0];continue}}else{if(n=a,zt(u,o,e)){a=a.neighbours[1];continue}if(zt(l,u,e)){a=a.neighbours[0];continue}}break}return a}}]),e}(),wi=function e(t,i){Object(y["a"])(this,e),this.children=[],this.nPrimitives=t,this.bbox=i},ki=function(e){function t(e,i,n){var a;return Object(y["a"])(this,t),a=Object(m["a"])(this,Object(b["a"])(t).call(this,i,n)),a.firstPrimOffset=e,a}return Object(w["a"])(t,e),t}(wi),xi=function(e){function t(e,i,n){var a;return Object(y["a"])(this,t),a=Object(m["a"])(this,Object(b["a"])(t).call(this,0,i.bbox.union(n.bbox))),a.dimension=e,a.children.push(i),a.children.push(n),a}return Object(w["a"])(t,e),t}(wi),Oi=function(){function e(t){if(Object(y["a"])(this,e),this.totalNodes=0,this.buildData=[],this.orderedPrims=[],this.nodes=[],this.offset=0,this.shapes=t,0===this.shapes.length)return this.root=null,void(this.nodes=[]);for(var i=0;i<t.length;i++){var n=It.UUIDMap.get(t[i]);this.buildData.push({index:i,bbox:n.getBoundingBox(),center:new Tt(n.center(),0,0)})}this.root=this.recursiveBuild(0,t.length),this.compact()}return Object(g["a"])(e,[{key:"draw",value:function(){var e=It.getLayer("draw").ctx,t=!0,i=!1,n=void 0;try{for(var a,r=this.nodes[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value,o=s.bbox;e.strokeRect(ct(o.topLeft.x),ht(o.topLeft.y),dt(o.w),dt(o.h))}}catch(l){i=!0,n=l}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}},{key:"recursiveBuild",value:function(e,t){this.totalNodes++;for(var i=this.buildData[e].bbox,n=e+1;n<t;n++)i=i.union(this.buildData[n].bbox);var a=t-e;if(1===a)return this.createLeaf(e,t,a,i);for(var r,s=this.buildData[e].center,o=e;o<t;o++)s=s.union(this.buildData[o].center);var l=s.getMaxExtent();if(s.botRight.get(l)===s.topLeft.get(l))return this.createLeaf(e,t,a,i);var u=.5*(s.topLeft.get(l)+s.botRight.get(l)),c=pe(this.buildData.slice(e,t),function(e){return e.center.center().get(l)<u}),h=[].concat.apply([],c);0!==c[0].length&&0!==c[1].length||console.log("EMPTY"),(r=this.buildData).splice.apply(r,[e,h.length].concat(Object(p["a"])(h)));var d=c[0].length+e;return new xi(l,this.recursiveBuild(e,d),this.recursiveBuild(d,t))}},{key:"intersect",value:function(e,t){if(0===this.nodes.length)return{hit:!1,intersect:e.get(0),tMin:0,tMax:e.tMax};void 0===t&&(t=!1);var i=!1,n=0,a=e.tMax,r=0,s=0,o=[],l=e.direction.inverse(),u=[l.x<0,l.y<0];while(1){var c=this.nodes[s],h=c.bbox.intersectP(e,l,u);if(h.hit)if(c.nPrimitives>0){if(i=!0,n=e.tMax=h.min,a=h.max,0===r||t)break;s=o[--r]}else u[c.dimension]?(o[r++]=s+1,s=c.secondChildOffset):(o[r++]=c.secondChildOffset,s++);else{if(0===r)break;s=o[--r]}}return{hit:i,intersect:e.get(n),tMin:n,tMax:a}}},{key:"compact",value:function(){this.offset=0,null!==this.root&&this.flatten(this.root)}},{key:"flatten",value:function(e){var t=this.offset,i=this.offset++;if(0===e.nPrimitives){this.flatten(e.children[0]);var n=this.flatten(e.children[1]),a={bbox:e.bbox,dimension:e.dimension,nPrimitives:0,secondChildOffset:n};this.nodes[t]=a}else{var r={bbox:e.bbox,primitivesOffset:e.firstPrimOffset,nPrimitives:e.nPrimitives};this.nodes[t]=r}return i}},{key:"createLeaf",value:function(e,t,i,n){for(var a=this.orderedPrims.length,r=e;r<t;r++)this.orderedPrims.push(this.shapes[this.buildData[r].index]);return new ki(a,i,n)}}]),e}(),Si=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.BV=Object.freeze(new Oi([])),e.visionMode="bvh",e.visionBlockers=[],e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"setVisionMode",value:function(e){this.visionMode=e.mode,e.sync&&Je.emit("Location.Options.Set",{vision_mode:e.mode})}},{key:"recalculateVision",value:function(){"triangle"===this.visionMode?Ei(_i.VISION):this.BV=Object.freeze(new Oi(this.visionBlockers))}},{key:"recalculateMovement",value:function(){"triangle"===this.visionMode&&Ei(_i.MOVEMENT)}},{key:"deleteFromTriag",value:function(e){"triangle"===this.visionMode?ji(e.target,e.shape):e.standalone&&this.recalculateVision()}},{key:"addToTriag",value:function(e){"triangle"===this.visionMode?Ti(e.target,e.shape):this.recalculateVision()}},{key:"clear",value:function(){this.context.state.visionBlockers=[],this.context.commit("recalculateVision"),this.context.commit("recalculateMovement")}}]),t}(D["d"]);k["a"]([D["c"]],Si.prototype,"setVisionMode",null),k["a"]([D["c"]],Si.prototype,"recalculateVision",null),k["a"]([D["c"]],Si.prototype,"recalculateMovement",null),k["a"]([D["c"]],Si.prototype,"deleteFromTriag",null),k["a"]([D["c"]],Si.prototype,"addToTriag",null),k["a"]([D["a"]],Si.prototype,"clear",null),Si=k["a"]([Object(D["b"])({dynamic:!0,store:A,name:"visibility",namespaced:!0})],Si);var _i,Ci=Object(D["e"])(Si);(function(e){e["VISION"]="vision",e["MOVEMENT"]="movement"})(_i||(_i={}));var Li={vision:new bi,movement:new bi};function Ei(e){console.warn("RETRIANGULATING ".concat(e)),console.time("TRI");var t,i=new bi;t="vision"===e?Ci.visionBlockers:Lt.movementblockers;var n=!0,a=!1,r=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0)for(var l=s.value,u=It.UUIDMap.get(l),c=0;c<u.points.length;c++){var h=u.points[c],d=u.points[(c+1)%u.points.length],v=i.insertConstraint(h,d),f=v.va,p=v.vb;f.shapes.add(u),p.shapes.add(u),u.addTriagVertices(f,p)}}catch(y){a=!0,r=y}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}i.insertConstraint([-1e8,-1e8],[-1e8,1e8]),i.insertConstraint([-1e8,1e8],[-1e11,1e8]),i.insertConstraint([-1e11,1e8],[-1e11,-1e8]),i.insertConstraint([-1e11,-1e8],[-1e8,-1e8]),i.insertConstraint([-1e8,-1e8],[1e8,-1e8]),i.insertConstraint([1e8,-1e8],[1e8,-1e11]),i.insertConstraint([1e8,-1e11],[-1e8,-1e11]),i.insertConstraint([-1e8,-1e11],[-1e8,-1e8]),i.insertConstraint([1e8,-1e8],[1e8,1e8]),i.insertConstraint([1e8,1e8],[1e11,1e8]),i.insertConstraint([1e11,1e8],[1e11,-1e8]),i.insertConstraint([1e11,-1e8],[1e8,-1e8]),i.insertConstraint([-1e8,1e8],[1e8,1e8]),i.insertConstraint([1e8,1e8],[1e8,1e11]),i.insertConstraint([1e8,1e11],[-1e8,1e11]),i.insertConstraint([-1e8,1e11],[-1e8,1e8]),Li[e]=i,window.CDT=Li,console.timeEnd("TRI")}function Ii(e,t,i,n,a){var r=e.shapes.size>=(a?2:1);r||n.newConstraints.some(function(t){return t.includes(e)})||n.vertices.add(e);var s=Object(p["a"])(e.getIncidentEdges()).filter(function(e){return e.first.constraints[e.second]}),o=[],l=null,u=null,c=!0,h=!1,d=void 0;try{for(var v,f=s[Symbol.iterator]();!(c=(v=f.next()).done);c=!0){var y=v.value,g=y.first.vertices[At(y.second)],m=g.point,b=g.shapes.size>(g===i?1:0);if(St(m,i.point))r&&b||n.edges.push(y);else{if(St(m,t.point))continue;if(Vt(e.point,m,i.point)){if(null!==l&&console.warn("Multiple collinear vertices found?"),b&&3===s.length)if(null===u)u=y;else{var w=u.first.vertices[0===u.second?1:0];w===e&&(w=u.first.vertices[2]),n.edges.push(y,u),n.newConstraints.push([g,w]),u=null}else n.edges.push(y);l=g}else if(3===s.length)if(b)if(null===u)u=y;else{var k=u.first.vertices[0===u.second?1:0];k===e&&(k=u.first.vertices[2]),n.edges.push(y,u),n.newConstraints.push([g,k]),u=null}else n.edges.push(y),0===n.triBridge.length?n.triBridge.push(a?g:e):n.newConstraints.push([n.triBridge.pop(),a?g:e]);else if((!r||!b)&&4===s.length)if(n.edges.push(y),n.vertices.has(g))for(var x=n.newConstraints.length-1;x>=0;x--){var O=Object(Mt["a"])(n.newConstraints[x],2),S=O[0],_=O[1];if(S===e||_===e){var C=n.newConstraints.splice(x,1)[0];o=[].concat(Object(p["a"])(o),Object(p["a"])(C.filter(function(t){return t!==e}))),n.vertices.add(e)}}else n.triBridge.includes(g)?o.push(n.triBridge.pop()):o.push(g)}}}catch(L){h=!0,d=L}finally{try{c||null==f.return||f.return()}finally{if(h)throw d}}return 3!==s.length&&4!==s.length||1!==o.length||1!==n.triBridge.length?4===s.length&&o.length>0&&n.newConstraints.push(o):n.newConstraints.push([o.pop(),n.triBridge.pop()]),null===l?e:Ii(l,e,i,n,!1)}function ji(e,t){console.time("DS");var i=Li[e],n={vertices:new Set,edges:[],newConstraints:[],triBridge:[]},a=t.triagVertices.length,r=t.triagVertices[a-1],s=!0,o=!1,l=void 0;try{for(var u,c=t.triagVertices.entries()[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){var h=Object(Mt["a"])(u.value,2),d=h[0],v=h[1],f=t.triagVertices[(d+1)%a];r=Ii(v,r,f,n,!0)}}catch(N){o=!0,l=N}finally{try{s||null==c.return||c.return()}finally{if(o)throw l}}n.triBridge.length>0&&n.newConstraints.push([n.triBridge.pop(),t.triagVertices[0]]);var y=!0,g=!1,m=void 0;try{for(var b,w=n.edges[Symbol.iterator]();!(y=(b=w.next()).done);y=!0){var k=b.value;i.removeConstrainedEdgeDelaunay(k.first,k.second)}}catch(N){g=!0,m=N}finally{try{y||null==w.return||w.return()}finally{if(g)throw m}}var x=!0,O=!1,S=void 0;try{for(var _,C=n.vertices[Symbol.iterator]();!(x=(_=C.next()).done);x=!0){v=_.value;i.removeVertex(v)}}catch(N){O=!0,S=N}finally{try{x||null==C.return||C.return()}finally{if(O)throw S}}var L=!0,E=!1,I=void 0;try{for(var j,T=n.newConstraints[Symbol.iterator]();!(L=(j=T.next()).done);L=!0){var M=Object(Mt["a"])(j.value,2),P=M[0],D=M[1];i.insertConstraintV(P,D)}}catch(N){E=!0,I=N}finally{try{L||null==T.return||T.return()}finally{if(E)throw I}}t.removeTriagVertices.apply(t,Object(p["a"])(n.vertices)),console.timeEnd("DS")}function Ti(e){for(var t=Li[e],i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];for(var r=0,s=n;r<s.length;r++){var o=s[r],l=!0,u=!1,c=void 0;try{for(var h,d=o.points.entries()[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var v=Object(Mt["a"])(h.value,2),f=v[0],p=v[1],y=o.points[(f+1)%o.points.length],g=t.insertConstraint(p,y),m=g.va,b=g.vb;m.shapes.add(o),b.shapes.add(o),o.addTriagVertices(m,b)}}catch(w){u=!0,c=w}finally{try{l||null==d.return||d.return()}finally{if(u)throw c}}}}var Mi=function(){function e(t,i,n,a){Object(y["a"])(this,e),this.fillColour="#000",this.strokeColour="rgba(0,0,0,0)",this.name="Unknown shape",this.nameVisible=!0,this.trackers=[],this.auras=[],this.labels=[],this._owners=[],this._triagVertices=[],this.visionObstruction=!1,this.movementObstruction=!1,this.isToken=!1,this.showHighlight=!1,this.annotation="",this.globalCompositeOperation="source-over",this.options=new Map,this._refPoint=t,this.uuid=a||ve(),void 0!==i&&(this.fillColour=i),void 0!==n&&(this.strokeColour=n)}return Object(g["a"])(e,[{key:"visibleInCanvas",value:function(e){return!1}},{key:"getPointIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!0,n=!1,a=void 0;try{for(var r,s=this.points.entries()[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var o=Object(Mt["a"])(r.value,2),l=o[0],u=o[1];if(Math.abs(e.x-u[0])<=t&&Math.abs(e.y-u[1])<=t)return l}}catch(c){n=!0,a=c}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return-1}},{key:"getPointOrientation",value:function(e){var t=at.fromArray(this.points[(this.points.length+e-1)%this.points.length]),i=at.fromArray(this.points[e]),n=at.fromArray(this.points[(e+1)%this.points.length]),a=n.subtract(t),r=t.add(a.multiply(.5));return i.subtract(r).normalize()}},{key:"invalidate",value:function(e){var t=It.getLayer(this.layer);t&&t.invalidate(e)}},{key:"checkVisionSources",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!1,i=this,n=Ci.visionBlockers.indexOf(this.uuid);this.visionObstruction&&-1===n?(Ci.visionBlockers.push(this.uuid),e&&(Ci.addToTriag({target:_i.VISION,shape:this}),t=!0)):!this.visionObstruction&&n>=0&&(Ci.visionBlockers.splice(n,1),e&&(Ci.deleteFromTriag({target:_i.VISION,shape:this,standalone:!0}),t=!0)),this.auras.forEach(function(e){var t=Lt.visionSources,n=t.findIndex(function(t){return t.aura===e.uuid});e.visionSource&&-1===n?t.push({shape:i.uuid,aura:e.uuid}):!e.visionSource&&n>=0&&t.splice(n,1)});for(var a=function(e){var t=Lt.visionSources[e];t.shape===i.uuid&&(i.auras.some(function(e){return e.uuid===t.aura&&e.visionSource})||Lt.visionSources.splice(e,1))},r=Lt.visionSources.length-1;r>=0;r--)a(r);return t}},{key:"setMovementBlock",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.movementObstruction=e||!1;var i=Lt.movementblockers.indexOf(this.uuid),n=!1;return this.movementObstruction&&-1===i?(Lt.movementblockers.push(this.uuid),t&&(Ci.addToTriag({target:_i.MOVEMENT,shape:this}),n=!0)):!this.movementObstruction&&i>=0&&(Lt.movementblockers.splice(i,1),t&&(Ci.deleteFromTriag({target:_i.MOVEMENT,shape:this,standalone:!0}),n=!0)),n}},{key:"setIsToken",value:function(e){if(this.isToken=e,this.ownedBy()){var t=Lt.ownedtokens.indexOf(this.uuid);this.isToken&&-1===t?Lt.ownedtokens.push(this.uuid):!this.isToken&&t>=0&&Lt.ownedtokens.splice(t,1)}}},{key:"getBaseDict",value:function(){return{type_:this.type,uuid:this.uuid,x:this.refPoint.x,y:this.refPoint.y,layer:this.layer,draw_operator:this.globalCompositeOperation,movement_obstruction:this.movementObstruction,vision_obstruction:this.visionObstruction,auras:Dt(this.auras),trackers:this.trackers,labels:this.labels,owners:this._owners,fill_colour:this.fillColour,stroke_colour:this.strokeColour,name:this.name,name_visible:this.nameVisible,annotation:this.annotation,is_token:this.isToken,options:JSON.stringify(Object(p["a"])(this.options))}}},{key:"fromDict",value:function(e){this.layer=e.layer,this.globalCompositeOperation=e.draw_operator,this.movementObstruction=e.movement_obstruction,this.visionObstruction=e.vision_obstruction,this.auras=Pt(e.auras),this.trackers=e.trackers,this.labels=e.labels,this._owners=e.owners,this.isToken=e.is_token,this.nameVisible=e.name_visible,e.annotation&&(this.annotation=e.annotation),e.name&&(this.name=e.name),e.options&&(this.options=new Map(JSON.parse(e.options)))}},{key:"draw",value:function(e){if(void 0!==this.globalCompositeOperation?e.globalCompositeOperation=this.globalCompositeOperation:e.globalCompositeOperation="source-over",this.showHighlight){var t=this.getBoundingBox();e.strokeStyle="red",e.strokeRect(ct(t.topLeft.x)-5,ht(t.topLeft.y)-5,dt(t.w)+10,dt(t.h)+10)}}},{key:"drawAuras",value:function(e){var t=!0,i=!1,n=void 0;try{for(var a,r=this.auras[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;if(0===s.value&&0===s.dim)return;e.beginPath();var o=ut(this.center()),l=ft(s.value+s.dim);if(0===s.dim)e.fillStyle=s.colour;else{var u=e.createRadialGradient(o.x,o.y,ft(s.value),o.x,o.y,ft(s.value+s.dim)),c=wt()(s.colour);e.fillStyle=u,u.addColorStop(0,s.colour),u.addColorStop(1,c.setAlpha(0).toRgbString())}if(s.visionSource&&void 0!==s.lastPath)try{e.fill(s.lastPath)}catch(h){e.arc(o.x,o.y,l,0,2*Math.PI),e.fill(),console.warn(h)}else e.arc(o.x,o.y,l,0,2*Math.PI),e.fill()}}catch(d){i=!0,n=d}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}},{key:"getInitiativeRepr",value:function(){return{uuid:this.uuid,visible:!Lt.IS_DM,group:!1,source:this.name,has_img:!1,effects:[],index:1/0}}},{key:"moveLayer",value:function(e,t){var i=It.getLayer(this.layer),n=It.getLayer(e);void 0!==i&&void 0!==n&&(this.layer=e,i.shapes.splice(i.shapes.indexOf(this),1),n.shapes.push(this),i.invalidate(!0),n.invalidate(!1),t&&Je.emit("Shape.Layer.Change",{uuid:this.uuid,layer:e}))}},{key:"ownedBy",value:function(e){return void 0===e&&(e=Lt.username),Lt.IS_DM||this._owners.includes(e)||Lt.FAKE_PLAYER&&Lt.activeTokens.includes(this.uuid)}},{key:"addOwner",value:function(e){this._owners.includes(e)||this._owners.push(e)}},{key:"updateOwner",value:function(e,t){var i=this._owners.findIndex(function(t){return t===e});i>=0?this._owners.splice(i,1,t):this.addOwner(t)}},{key:"removeOwner",value:function(e){var t=this._owners.findIndex(function(t){return t===e});this._owners.splice(t,1)}},{key:"addTriagVertices",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(var n=0,a=t;n<a.length;n++){var r=a[n];this._triagVertices.includes(r)||this._triagVertices.push(r)}}},{key:"removeTriagVertices",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this._triagVertices=this._triagVertices.filter(function(e){return!t.includes(e)})}},{key:"refPoint",get:function(){return this._refPoint},set:function(e){this._refPoint=e}},{key:"owners",get:function(){return Object.freeze(this._owners.slice())}},{key:"triagVertices",get:function(){return Object(p["a"])(this._triagVertices)}}]),e}();function Pi(e,t,i){if(0===e.x&&0===e.y)return e;if("bvh"===Ci.visionMode){void 0===i&&(i=[]);var n=t.getBoundingBox(),a=n.offset(e),r=!1,s=!0,o=!1,l=void 0;try{for(var u,c=Lt.movementblockers[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){var h=u.value;if(!i.includes(h)){var d=It.UUIDMap.get(h),v=d.getBoundingBox(),f=v.intersectsWithInner(a);if(!f){var p=ot.fromPoints(n.topLeft.add(e.normalize()),a.topLeft),y=p.direction.inverse(),g=[y.x<0,y.y<0];f=v.intersectP(p,y,g).hit}if(f){var m=v.center(),b=n.center(),w=b.subtract(m),k=new st(1,0),x=new st(0,1),O=w.dot(k),S=w.dot(x);O>v.w/2&&(O=v.w/2),O<-v.w/2&&(O=-v.w/2),S>v.h/2&&(S=v.h/2),S<-v.h/2&&(S=-v.h/2);var _=m.add(k.multiply(O)).add(x.multiply(S));_.x===n.topLeft.x||_.x===n.topRight.x?e=new st(0,e.y):_.y===n.topLeft.y||_.y===n.botLeft.y?e=new st(e.x,0):_.x<n.topLeft.x?e=new st(_.x-n.topLeft.x,e.y):_.x>n.topRight.x?e=new st(_.x-n.topRight.x,e.y):_.y<n.topLeft.y?e=new st(e.x,_.y-n.topLeft.y):_.y>n.botLeft.y&&(e=new st(e.x,_.y-n.botLeft.y)),r=!0,i.push(h);break}}}}catch(N){o=!0,l=N}finally{try{s||null==c.return||c.return()}finally{if(o)throw l}}return r&&(e=Pi(e,t,i)),e}var C=Li.movement.locate(t.center().asArray(),null).loc,L=!0,E=!1,I=void 0;try{for(var j,T=t.points[Symbol.iterator]();!(L=(j=T.next()).done);L=!0){var M=j.value,P=Li.movement.locate(M,C),D=P.loc;null!==D&&(e=Di(M,D,e))}}catch(N){E=!0,I=N}finally{try{L||null==T.return||T.return()}finally{if(E)throw I}}return e}function Di(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=new at(e[0],e[1]),r=a.add(i).asArray();if(t.contains(r))return i;n.push(t);for(var s=0;s<3;s++)if(!n.includes(t.neighbours[s])){var o=t.vertices[Nt(s)].point,l=t.vertices[At(s)].point,u=Qt(e,r,o,l);if(null!==u){if(!t.isConstrained(s))return Di(e,t.neighbours[s],i,n);if(u[0]===a.x&&u[1]===a.y){var c=Ft(e,r,l);if(c===ri.LEFT_TURN)continue;if(c===ri.ZERO)continue}var h=new at(u[0],u[1]).subtract(a).multiply(.8);h.length()<1&&(h=new st(0,0)),h.length()<i.length()&&(i=h)}}return i}var Ni=function(e){function t(e,i,n,a,r,s){var o;return Object(y["a"])(this,t),o=Object(m["a"])(this,Object(b["a"])(t).call(this,e,a,r,s)),o.w=i,o.h=n,o}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"getBaseDict",value:function(){return Object.assign(Object(it["a"])(Object(b["a"])(t.prototype),"getBaseDict",this).call(this),{width:this.w,height:this.h})}},{key:"getBoundingBox",value:function(){return new Tt(this.refPoint,this.w,this.h)}},{key:"contains",value:function(e){return this.refPoint.x<=e.x&&this.refPoint.x+this.w>=e.x&&this.refPoint.y<=e.y&&this.refPoint.y+this.h>=e.y}},{key:"center",value:function(e){if(void 0===e)return this.refPoint.add(new st(this.w/2,this.h/2));this.refPoint=new at(e.x-this.w/2,e.y-this.h/2)}},{key:"visibleInCanvas",value:function(e){if(Object(it["a"])(Object(b["a"])(t.prototype),"visibleInCanvas",this).call(this,e))return!0;var i=!(ct(this.refPoint.x)>e.width||ht(this.refPoint.y)>e.height||ct(this.refPoint.x+this.w)<0||ht(this.refPoint.y+this.h)<0);return!!i}},{key:"snapToGrid",value:function(){var e,t,i=Lt.gridSize,n=this.center(),a=n.x,r=n.y;e=this.w/i%2===0?Math.round(a/i)*i-this.w/2:(Math.round((a+i/2)/i)-.5)*i-this.w/2,t=this.h/i%2===0?Math.round(r/i)*i-this.h/2:(Math.round((r+i/2)/i)-.5)*i-this.h/2;var s=Pi(new st(e-this.refPoint.x,t-this.refPoint.y),this);this.refPoint=this.refPoint.add(s),this.invalidate(!1)}},{key:"resizeToGrid",value:function(){var e=Lt.gridSize;this.refPoint=new at(Math.round(this.refPoint.x/e)*e,Math.round(this.refPoint.y/e)*e),this.w=Math.max(Math.round(this.w/e)*e,e),this.h=Math.max(Math.round(this.h/e)*e,e),this.invalidate(!1)}},{key:"resize",value:function(e,t){var i=Lt.zoomFactor;switch(e){case 0:this.w=ct(this.refPoint.x)+this.w*i-t.x,this.h=ht(this.refPoint.y)+this.h*i-t.y,this.refPoint=pt(t);break;case 1:this.w=ct(this.refPoint.x)+this.w*i-t.x,this.h=t.y-ht(this.refPoint.y),this.refPoint=new at(yt(t.x),this.refPoint.y);break;case 2:this.w=t.x-ct(this.refPoint.x),this.h=t.y-ht(this.refPoint.y);break;case 3:this.w=t.x-ct(this.refPoint.x),this.h=ht(this.refPoint.y)+this.h*i-t.y,this.refPoint=new at(this.refPoint.x,gt(t.y));break}this.w/=i,this.h/=i,this.w<0&&(this.refPoint=this.refPoint.add(new st(this.w,0)),this.w=Math.abs(this.w)),this.h<0&&(this.refPoint=this.refPoint.add(new st(0,this.h)),this.h=Math.abs(this.h))}},{key:"points",get:function(){if(0===this.w||0===this.h)return[[this.refPoint.x,this.refPoint.y]];var e=this.refPoint.add(new st(0,this.h)),t=this.refPoint.add(new st(this.w,this.h)),i=this.refPoint.add(new st(this.w,0));return[[this.refPoint.x,this.refPoint.y],[e.x,e.y],[t.x,t.y],[i.x,i.y]]}}]),t}(Mi),Ai=function(e){function t(e,i,n,a,r){var s;return Object(y["a"])(this,t),s=Object(m["a"])(this,Object(b["a"])(t).call(this,i,n,a,void 0,void 0,r)),s.type="assetrect",s.src="",s.img=e,s}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{src:this.src})}},{key:"fromDict",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this.src=e.src}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e);try{e.drawImage(this.img,ct(this.refPoint.x),ht(this.refPoint.y),dt(this.w),dt(this.h))}catch(i){console.warn("Shape ".concat(this.uuid," could not load the image ").concat(this.src))}}},{key:"getInitiativeRepr",value:function(){return{uuid:this.uuid,visible:!Lt.IS_DM,group:!1,source:this.src,has_img:!0,effects:[],index:1/0}}}]),t}(Ni),Ri=function(e){function t(e,i,n,a,r){var s;return Object(y["a"])(this,t),s=Object(m["a"])(this,Object(b["a"])(t).call(this,e,n,a,r)),s.type="circle",s.r=i||1,s}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{radius:this.r})}},{key:"fromDict",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this.r=e.radius}},{key:"getBoundingBox",value:function(){return new Tt(new at(this.refPoint.x-this.r,this.refPoint.y-this.r),2*this.r,2*this.r)}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.beginPath(),"fog"===this.fillColour?e.fillStyle=_t():e.fillStyle=this.fillColour;var i=ut(this.refPoint);e.arc(i.x,i.y,dt(this.r),0,2*Math.PI),e.fill(),"rgba(0, 0, 0, 0)"!==this.strokeColour&&(e.beginPath(),e.lineWidth=dt(5),e.strokeStyle=this.strokeColour,e.arc(i.x,i.y,dt(this.r),0,2*Math.PI),e.stroke())}},{key:"contains",value:function(e){return Math.pow(e.x-this.refPoint.x,2)+Math.pow(e.y-this.refPoint.y,2)<Math.pow(this.r,2)}},{key:"center",value:function(e){if(void 0===e)return this.refPoint;this.refPoint=e}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){var e,t,i=Lt.gridSize;e=2*this.r/i%2===0?Math.round(this.refPoint.x/i)*i:Math.round((this.refPoint.x-i/2)/i)*i+this.r,t=2*this.r/i%2===0?Math.round(this.refPoint.y/i)*i:Math.round((this.refPoint.y-i/2)/i)*i+this.r;var n=Pi(new st(e-this.refPoint.x,t-this.refPoint.y),this);this.refPoint=this.refPoint.add(n),this.invalidate(!1)}},{key:"resizeToGrid",value:function(){var e=Lt.gridSize;this.r=Math.max(Math.round(this.r/e)*e,e/2),this.invalidate(!1)}},{key:"resize",value:function(e,t){var i=pt(t).subtract(this.refPoint);this.r=Math.sqrt(Math.pow(i.length(),2)/2)}},{key:"points",get:function(){return this.getBoundingBox().points}}]),t}(Mi),Vi=function(e){function t(e,i,n,a,r,s,o){var l;return Object(y["a"])(this,t),l=Object(m["a"])(this,Object(b["a"])(t).call(this,e,i,r,s,o)),l.type="circulartoken",l.text=n,l.font=a,l}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{radius:this.r,text:this.text,font:this.font})}},{key:"fromDict",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this.r=e.radius,this.text=e.text,this.font=e.font}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.font=this.font,e.save();var i=ut(this.center());e.textAlign="center",e.textBaseline="middle";var n=ye(e,this.text,dt(this.r),dt(this.r)),a=0;e.transform(n,a,-a,n,i.x,i.y),e.fillStyle=bt["mostReadable"](this.fillColour,["#000","#fff"]).toHexString(),e.fillText(this.text,0,0),e.restore()}},{key:"getInitiativeRepr",value:function(){return{uuid:this.uuid,visible:!Lt.IS_DM,group:!1,source:""===this.name||"Unknown shape"===this.name?this.text:this.name,has_img:!1,effects:[],index:1/0}}}]),t}(Ri),Ui=function(e){function t(e,i,n,a,r){var s;return Object(y["a"])(this,t),s=Object(m["a"])(this,Object(b["a"])(t).call(this,e,"rgba(0, 0, 0, 0)",a||"#000",r)),s.type="line",s.endPoint=i,s.lineWidth=void 0===n?1:n,s}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{x2:this.endPoint.x,y2:this.endPoint.y,line_width:this.lineWidth})}},{key:"getBoundingBox",value:function(){return new Tt(new at(Math.min(this.refPoint.x,this.endPoint.x),Math.min(this.refPoint.y,this.endPoint.y)),Math.abs(this.refPoint.x-this.endPoint.x),Math.abs(this.refPoint.y-this.endPoint.y))}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.strokeStyle=this.strokeColour,e.beginPath(),e.moveTo(ct(this.refPoint.x),ht(this.refPoint.y)),e.lineTo(ct(this.endPoint.x),ht(this.endPoint.y)),e.lineWidth=this.lineWidth,e.stroke()}},{key:"contains",value:function(e){return!1}},{key:"center",value:function(e){}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){}},{key:"resizeToGrid",value:function(){}},{key:"resize",value:function(e,t){0===e?this.refPoint=pt(t):this.endPoint=pt(t)}},{key:"points",get:function(){return[[this.refPoint.x,this.refPoint.y],[this.endPoint.x,this.endPoint.y]]}}]),t}(Mi),Fi=function(e){function t(e,i,n,a,r){var s;return Object(y["a"])(this,t),s=Object(m["a"])(this,Object(b["a"])(t).call(this,e,"rgba(0, 0, 0, 0)",a||"#000",r)),s.type="multiline",s._points=[],s._points=i||[],s.lineWidth=n||3,s}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{line_width:this.lineWidth,points:this._points.map(function(e){return{x:e.x,y:e.y}})})}},{key:"fromDict",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this._points=e.points.map(function(e){return new at(e.x,e.y)})}},{key:"getBoundingBox",value:function(){var e=this.refPoint.x,t=this.refPoint.x,i=this.refPoint.y,n=this.refPoint.y,a=!0,r=!1,s=void 0;try{for(var o,l=this._points[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value;u.x<e&&(e=u.x),u.x>t&&(t=u.x),u.y<i&&(i=u.y),u.y>n&&(n=u.y)}}catch(c){r=!0,s=c}finally{try{a||null==l.return||l.return()}finally{if(r)throw s}}return new Tt(new at(e,i),t-e,n-i)}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.beginPath(),e.lineCap="round",e.lineJoin="round",e.moveTo(ct(this.refPoint.x),ht(this.refPoint.y));var i=!0,n=!1,a=void 0;try{for(var r,s=this._points[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var o=r.value;e.lineTo(ct(o.x),ht(o.y))}}catch(l){n=!0,a=l}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}"fog"===this.strokeColour?e.strokeStyle=_t():e.strokeStyle=this.strokeColour,e.lineWidth=dt(this.lineWidth),e.stroke()}},{key:"contains",value:function(e){return this.getBoundingBox().contains(e)}},{key:"center",value:function(e){return this.getBoundingBox().center()}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){}},{key:"resizeToGrid",value:function(){}},{key:"resize",value:function(e,t){0===e?this._refPoint=pt(t):this._points[e-1]=pt(t)}},{key:"refPoint",get:function(){return this._refPoint},set:function(e){var t=e.subtract(this._refPoint);this._refPoint=e;for(var i=0;i<this._points.length;i++)this._points[i]=this._points[i].add(t)}},{key:"points",get:function(){return this._points.map(function(e){return[e.x,e.y]})}}]),t}(Mi),$i=function(e){function t(e,i,n,a,r,s){var o;return Object(y["a"])(this,t),o=Object(m["a"])(this,Object(b["a"])(t).call(this,e,i,n,a,r,s)),o.type="rect",o}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object(it["a"])(Object(b["a"])(t.prototype),"getBaseDict",this).call(this)}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),"fog"===this.fillColour?e.fillStyle=_t():e.fillStyle=this.fillColour;var i=Lt.zoomFactor,n=ut(this.refPoint);e.fillRect(n.x,n.y,this.w*i,this.h*i),"rgba(0, 0, 0, 0)"!==this.strokeColour&&(e.strokeStyle=this.strokeColour,e.lineWidth=5,e.strokeRect(n.x,n.y,this.w*i,this.h*i))}}]),t}(Ni),zi=function(e){function t(e,i,n,a,r,s,o){var l;return Object(y["a"])(this,t),l=Object(m["a"])(this,Object(b["a"])(t).call(this,e,r,s,o)),l.type="text",l.text=i,l.font=n,l.angle=a||0,l}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{text:this.text,font:this.font,angle:this.angle})}},{key:"getBoundingBox",value:function(){return new Tt(this.refPoint,5,5)}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.font=this.font,e.fillStyle=this.fillColour,e.save();var i=ut(this.refPoint);e.translate(i.x,i.y),e.rotate(this.angle),e.textAlign="center",this.getLines(e).map(function(t){return e.fillText(t.text,t.x,t.y)}),e.restore()}},{key:"contains",value:function(e){return!1}},{key:"center",value:function(e){}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){}},{key:"resizeToGrid",value:function(){}},{key:"resize",value:function(e,t){}},{key:"getMaxHeight",value:function(e){var t=this.getLines(e),i=30;return i*t.length}},{key:"getMaxWidth",value:function(e){var t=this.getLines(e),i=t.map(function(t){return e.measureText(t.text).width});return Math.max.apply(Math,Object(p["a"])(i))}},{key:"getLines",value:function(e){var t=this.text.split("\n"),i=[],n=e.canvas.width,a=30,r=0,s=0,o=!0,l=!1,u=void 0;try{for(var c,h=t[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var d=c.value,v="",f=d.split(" "),p=!0,y=!1,g=void 0;try{for(var m,b=f[Symbol.iterator]();!(p=(m=b.next()).done);p=!0){var w=m.value,k=v+w+" ",x=e.measureText(k),O=x.width;O>n?(e.fillText(v,r,s),i.push({text:v,x:r,y:s}),v=w+" ",s+=a):v=k}}catch(S){y=!0,g=S}finally{try{p||null==b.return||b.return()}finally{if(y)throw g}}i.push({text:v,x:r,y:s}),s+=a}}catch(S){l=!0,u=S}finally{try{o||null==h.return||h.return()}finally{if(l)throw u}}return i}},{key:"points",get:function(){return[[this.refPoint.x,this.refPoint.y]]}}]),t}(Mi),Bi=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;return Object(y["a"])(this,t),i=Object(m["a"])(this,Object(b["a"])(t).call(this,e,a,r,s)),i.type="polygon",i._vertices=[],i._vertices=n,i}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{vertices:this._vertices.map(function(e){return{x:e.x,y:e.y}})})}},{key:"fromDict",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this._vertices=e.vertices.map(function(e){return new at(e.x,e.y)})}},{key:"draw",value:function(e){Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.lineCap="round",e.lineJoin="round","fog"===this.strokeColour?e.strokeStyle=_t():2===this.vertices.length?e.strokeStyle=this.fillColour:e.strokeStyle=this.strokeColour,"fog"===this.fillColour?e.fillStyle=_t():e.fillStyle=this.fillColour,e.lineWidth=dt(2),e.beginPath(),e.moveTo(ct(this.vertices[0].x),ht(this.vertices[0].y));for(var i=1;i<=this.vertices.length;i++){var n=this.vertices[i%this.vertices.length];e.lineTo(ct(n.x),ht(n.y))}e.fill(),e.stroke()}},{key:"contains",value:function(e){return this.getBoundingBox().contains(e)}},{key:"center",value:function(e){return this.getBoundingBox().center()}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){}},{key:"resizeToGrid",value:function(){}},{key:"resize",value:function(e,t){0===e?this._refPoint=pt(t):this._vertices[e-1]=pt(t)}},{key:"getBoundingBox",value:function(){var e=this.refPoint.x,t=this.refPoint.x,i=this.refPoint.y,n=this.refPoint.y,a=!0,r=!1,s=void 0;try{for(var o,l=this._vertices[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value;u.x<e&&(e=u.x),u.x>t&&(t=u.x),u.y<i&&(i=u.y),u.y>n&&(n=u.y)}}catch(c){r=!0,s=c}finally{try{a||null==l.return||l.return()}finally{if(r)throw s}}return new Tt(new at(e,i),t-e,n-i)}},{key:"refPoint",get:function(){return this._refPoint},set:function(e){var t=e.subtract(this._refPoint);this._refPoint=e;for(var i=0;i<this._vertices.length;i++)this._vertices[i]=this._vertices[i].add(t)}},{key:"vertices",get:function(){return[this._refPoint].concat(Object(p["a"])(this._vertices))}},{key:"points",get:function(){return this.vertices.map(function(e){return[e.x,e.y]})}}]),t}(Mi);function Hi(e){var t,i=new at(e.x,e.y);if("rect"===e.type_){var n=e;t=new $i(i,n.width,n.height,n.fill_colour,n.stroke_colour,n.uuid)}else if("circle"===e.type_){var a=e;t=new Ri(i,a.radius,a.fill_colour,a.stroke_colour,a.uuid)}else if("circulartoken"===e.type_){var r=e;t=new Vi(i,r.radius,r.text,r.font,r.fill_colour,r.stroke_colour,r.uuid)}else if("line"===e.type_){var s=e;t=new Ui(i,new at(s.x2,s.y2),s.line_width,s.stroke_colour,s.uuid)}else if("multiline"===e.type_){var o=e;t=new Fi(i,o.points.map(function(e){return new at(e.x,e.y)}),o.line_width,o.stroke_colour,o.uuid)}else if("polygon"===e.type_){var l=e;t=new Bi(i,l.vertices.map(function(e){return new at(e.x,e.y)}),l.fill_colour,l.stroke_colour,l.uuid)}else if("text"===e.type_){var u=e;t=new zi(i,u.text,u.font,u.angle,u.fill_colour,u.stroke_colour,u.uuid)}else{if("assetrect"!==e.type_)return;var c=e,h=new Image(c.width,c.height);c.src.startsWith("http")?h.src=new URL(c.src).pathname:h.src=c.src,t=new Ai(h,i,c.width,c.height,c.uuid),h.onload=function(){It.getLayer(e.layer).invalidate(!1)}}return t.fromDict(e),t}var Gi=function(){function e(t,i){Object(y["a"])(this,e),this.selectable=!1,this.playerEditable=!1,this.isVisionLayer=!1,this.valid=!1,this.shapes=[],this.selection=[],this.selectionColor="#CC0000",this.selectionWidth=2,this.canvas=t,this.name=i,this.width=t.width,this.height=t.height,this.ctx=t.getContext("2d")}return Object(g["a"])(e,[{key:"invalidate",value:function(e){this.valid=!1,e||It.invalidateLight()}},{key:"addShape",value:function(e,t,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];void 0===i&&(i=!1),e.layer=this.name,this.shapes.push(e),It.UUIDMap.set(e.uuid,e),e.checkVisionSources(n),e.setMovementBlock(e.movementObstruction,n),e.ownedBy(Lt.username)&&e.isToken&&Lt.ownedtokens.push(e.uuid),e.annotation.length&&Lt.annotations.push(e.uuid),t&&Je.emit("Shape.Add",{shape:e.asDict(),temporary:i}),n&&this.invalidate(!t)}},{key:"setShapes",value:function(e){var t=!0,i=!1,n=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value,o=Hi(s);if(void 0===o)return void console.log("Shape with unknown type ".concat(s.type_," could not be added"));this.addShape(o,!1,!1,!1)}}catch(l){i=!0,n=l}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}this.clearSelection(),this.invalidate(!1)}},{key:"removeShape",value:function(e,t,i){void 0===i&&(i=!1),this.shapes.splice(this.shapes.indexOf(e),1),t&&Je.emit("Shape.Remove",{shape:e.asDict(),temporary:i});var n=Lt.visionSources.findIndex(function(t){return t.shape===e.uuid}),a=Ci.visionBlockers.findIndex(function(t){return t===e.uuid}),r=Lt.movementblockers.findIndex(function(t){return t===e.uuid}),s=Lt.annotations.findIndex(function(t){return t===e.uuid});n>=0&&Lt.visionSources.splice(n,1),a>=0&&Ci.visionBlockers.splice(a,1),r>=0&&Lt.movementblockers.splice(r,1),s>=0&&Lt.annotations.splice(s,1);var o=Lt.annotations.indexOf(e.uuid);o>=0&&Lt.annotations.splice(o,1);var l=Lt.ownedtokens.indexOf(e.uuid);l>=0&&Lt.ownedtokens.splice(l,1),It.UUIDMap.delete(e.uuid);var u=this.selection.indexOf(e);u>=0&&this.selection.splice(u,1),a>=0&&Ci.deleteFromTriag({target:_i.VISION,shape:e,standalone:!0}),r>=0&&Ci.deleteFromTriag({target:_i.MOVEMENT,shape:e,standalone:!0}),this.invalidate(!t)}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.width,this.height)}},{key:"clearSelection",value:function(){this.selection=[],tt.$emit("SelectionInfo.Shape.Set",null)}},{key:"draw",value:function(e){if(!this.valid){var t=this.ctx,i=t.globalCompositeOperation;e=void 0===e||e,e&&this.clear();var n=this;if(this.shapes.forEach(function(e){e.options.has("skipDraw")&&e.options.get("skipDraw")||void 0!==It.getLayer()&&e.visibleInCanvas(n.canvas)&&("fow"===n.name&&e.visionObstruction&&It.getLayer().name!==n.name||e.drawAuras(t))}),this.shapes.forEach(function(e){e.options.has("skipDraw")&&e.options.get("skipDraw")||0===e.labels.length&&Lt.filterNoLabel||e.labels.length&&Lt.labelFilters.length&&!e.labels.some(function(e){return Lt.labelFilters.includes(e.uuid)})||void 0!==It.getLayer()&&e.visibleInCanvas(n.canvas)&&("fow"===n.name&&e.visionObstruction&&It.getLayer().name!==n.name||e.draw(t))}),null!=this.selection){t.fillStyle=this.selectionColor,t.strokeStyle=this.selectionColor,t.lineWidth=this.selectionWidth;var a=Lt.zoomFactor;this.selection.forEach(function(e){t.globalCompositeOperation=e.globalCompositeOperation;var i=e.getBoundingBox();t.strokeRect(ct(i.topLeft.x),ht(i.topLeft.y),i.w*a,i.h*a);var n=!0,r=!1,s=void 0;try{for(var o,l=e.points[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var u=o.value;t.beginPath(),t.arc(ct(u[0]),ht(u[1]),3,0,2*Math.PI),t.fill()}}catch(d){r=!0,s=d}finally{try{n||null==l.return||l.return()}finally{if(r)throw s}}t.beginPath(),t.moveTo(ct(e.points[0][0]),ht(e.points[0][1]));for(var c=1;c<=e.points.length;c++){var h=e.points[c%e.points.length];t.lineTo(ct(h[0]),ht(h[1]))}t.stroke()})}t.globalCompositeOperation=i,this.valid=!0}}},{key:"moveShapeOrder",value:function(e,t,i){var n=this.shapes.indexOf(e);n!==t&&(this.shapes.splice(n,1),this.shapes.splice(t,0,e),i&&Je.emit("Shape.Order.Set",{shape:e.asDict(),index:t}),this.invalidate(!0))}}]),e}(),Wi=function e(){Object(y["a"])(this,e)};function Xi(e,t,i){var n=It.getLayer("draw");if(void 0!==n){var a=n.ctx;a.lineJoin="round",a.strokeStyle=void 0===i?"rgb(".concat(255*Math.random(),", ").concat(255*Math.random(),", ").concat(255*Math.random(),")"):i,a.moveTo(ct(e[0]),ht(e[1])),a.beginPath(),a.arc(ct(e[0]),ht(e[1]),t,0,2*Math.PI),a.closePath(),a.stroke()}}function Yi(e,t){var i=It.getLayer("draw");if(void 0!==i){var n=i.ctx;n.lineJoin="round",n.lineJoin="round",n.beginPath(),n.strokeStyle=void 0===t?"rgb(".concat(255*Math.random(),", ").concat(255*Math.random(),", ").concat(255*Math.random(),")"):t,n.moveTo(ct(e[0][0]),ht(e[0][1]));var a=!0,r=!1,s=void 0;try{for(var o,l=e[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value;n.lineTo(ct(u[0]),ht(u[1]))}}catch(c){r=!0,s=c}finally{try{a||null==l.return||l.return()}finally{if(r)throw s}}n.closePath(),n.stroke()}}function Ki(e,t){var i=It.getLayer("draw");if(void 0!==i){var n=i.ctx;n.lineJoin="round",n.lineJoin="round",n.beginPath(),n.strokeStyle=void 0===t?"rgb(".concat(255*Math.random(),", ").concat(255*Math.random(),", ").concat(255*Math.random(),")"):t,n.moveTo(e[0][0],e[0][1]);var a=!0,r=!1,s=void 0;try{for(var o,l=e[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value;n.lineTo(u[0],u[1])}}catch(c){r=!0,s=c}finally{try{a||null==l.return||l.return()}finally{if(r)throw s}}n.closePath(),n.stroke()}}function qi(e,t){return t?e:ct(e)}function Qi(e,t){return t?e:ht(e)}Wi.angleSteps=4,Wi.drawAngleLines=!1,Wi.drawFirstLightHit=!1,Wi.skipPlayerFOW=!1,Wi.skipLightFOW=!1,Wi.tempFill="fog";var Zi=0,Ji=0;function en(e,t,i,n){var a=It.getLayer("draw");if(void 0!==a){var r=a.ctx;r.beginPath(),r.strokeStyle=i?"rgba(255, 255, 0, 0.30)":"rgba(0, 0, 0, 0.30)",r.moveTo(qi(e[0],n),Qi(e[1],n)),r.lineTo(qi(t[0],n),Qi(t[1],n)),r.closePath(),r.stroke()}}function tn(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Zi=0,Ji=0;var a=0,r=It.getLayer("draw");if(void 0!==r){var s=r.ctx;i&&s.clearRect(0,0,window.innerWidth,window.innerHeight),s.lineJoin="round",s.lineJoin="round";var o=new vi(e);while(!o.valid)o.next();do{var l=o.edge.first.vertices[At(o.edge.second)].point,u=o.edge.first.vertices[Nt(o.edge.second)].point;if(n>0){if(l[0]===-1/0||u[0]===-1/0){o.next();continue}Ji++,o.edge.first.constraints[o.edge.second]?(Zi++,2===n&&console.log("Edge: (*) ".concat(l," > ").concat(u,"   (").concat(o.edge.first.uid,")"))):2===n&&console.log("Edge: ".concat(l," > ").concat(u,"   (").concat(o.edge.first.uid,")"))}o.next()}while(o.valid);var c=!0,h=!1,d=void 0;try{for(var v,f=e.triangles[Symbol.iterator]();!(c=(v=f.next()).done);c=!0){var p,y=v.value;if(!y.isInfinite()){a++;var g=[];s.fillStyle="blue",void 0!==y.vertices[0]&&(g.push(y.vertices[0].point),s.beginPath(),s.arc(qi(y.vertices[0].point[0],t),Qi(y.vertices[0].point[1],t),5,0,2*Math.PI),s.closePath(),s.fill()),void 0!==y.vertices[1]&&(g.push(y.vertices[1].point),s.arc(qi(y.vertices[1].point[0],t),Qi(y.vertices[1].point[1],t),5,0,2*Math.PI),s.closePath(),s.fill()),void 0!==y.vertices[2]&&(g.push(y.vertices[2].point),s.arc(qi(y.vertices[2].point[0],t),Qi(y.vertices[2].point[1],t),5,0,2*Math.PI),s.closePath(),s.fill()),2===n&&(p=console).log.apply(p,["[T ".concat(y.uid,"] ")].concat(g,[y.constraints])),s.moveTo(qi(y.vertices[0].point[0],t),Qi(y.vertices[0].point[1],t)),void 0!==y.vertices[0]&&void 0!==y.vertices[1]&&en(y.vertices[0].point,y.vertices[1].point,y.constraints[2],t),void 0!==y.vertices[1]&&void 0!==y.vertices[2]&&en(y.vertices[1].point,y.vertices[2].point,y.constraints[0],t),void 0!==y.vertices[2]&&void 0!==y.vertices[0]&&en(y.vertices[2].point,y.vertices[0].point,y.constraints[1],t)}}}catch(m){h=!0,d=m}finally{try{c||null==f.return||f.return()}finally{if(h)throw d}}n>0&&(console.log("Edges: ".concat(Zi,"/").concat(Ji)),console.log("Faces: ".concat(a)))}}function nn(e,t,i){void 0===i&&(i=Lt.drawTEContour);var n=[e.x,e.y],a=[],r=Li[t].locate(n,null).loc;return null===r?(console.error("Triangle not found"),[]):(a.push(r.vertices[1].point),r.isConstrained(0)||an(n,r.vertices[2].point,r.vertices[1].point,r,0,a),a.push(r.vertices[2].point),r.isConstrained(1)||an(n,r.vertices[0].point,r.vertices[2].point,r,1,a),a.push(r.vertices[0].point),r.isConstrained(2)||an(n,r.vertices[1].point,r.vertices[0].point,r,2,a),i&&Yi(a,"red"),a)}function an(e,t,i,n,a,r){var s=n.neighbours[a],o=s.indexT(n),l=At(o),u=Nt(o),c=s.vertices[o],h=s.vertices[u],d=s.vertices[l],v=[s,l],f=[s,u],p=Ft(e,i,c.point),y=Ft(e,t,c.point);if(p===ri.COUNTERCLOCKWISE)if(v[0].isConstrained(v[1]))i!==h.point&&r.push(rn(e,i,c.point,h.point)),y===ri.COUNTERCLOCKWISE&&r.push(rn(e,t,c.point,h.point));else{if(y===ri.COUNTERCLOCKWISE)return an(e,t,i,s,l,r);an(e,c.point,i,s,l,r)}if(p!==ri.CLOCKWISE&&y!==ri.COUNTERCLOCKWISE&&r.push(c.point),y===ri.CLOCKWISE)return f[0].isConstrained(f[1])?(p===ri.CLOCKWISE&&r.push(rn(e,i,c.point,d.point)),void(t!==d.point&&r.push(rn(e,t,c.point,d.point)))):p===ri.CLOCKWISE?an(e,t,i,s,u,r):an(e,t,c.point,s,u,r)}function rn(e,t,i,n){var a=(n[1]-i[1])*(t[0]-e[0])-(n[0]-i[0])*(t[1]-e[1]),r=((n[0]-i[0])*(e[1]-i[1])-(n[1]-i[1])*(e[0]-i[0]))/a,s=e[0]+r*(t[0]-e[0]),o=e[1]+r*(t[1]-e[1]);return[s,o]}window.DC=Xi,window.DL=en,window.DP=Yi,window.DPL=Ki,window.DPT=tn;var sn=function(e){function t(e,i){var n;return Object(y["a"])(this,t),n=Object(m["a"])(this,Object(b["a"])(t).call(this,e,i)),n.isVisionLayer=!0,n.preFogShapes=[],n.virtualCanvas=document.createElement("canvas"),n.virtualCanvas.width=window.innerWidth,n.virtualCanvas.height=window.innerHeight,n.vCtx=n.virtualCanvas.getContext("2d"),n}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"addShape",value:function(e,i,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];Object(it["a"])(Object(b["a"])(t.prototype),"addShape",this).call(this,e,i,n,a),e.options.has("preFogShape")&&e.options.get("preFogShape")&&this.preFogShapes.push(e)}},{key:"removeShape",value:function(e,i,n){if(e.options.has("preFogShape")&&e.options.get("preFogShape")){var a=this.preFogShapes.findIndex(function(t){return t.uuid===e.uuid});this.preFogShapes.splice(a,1)}Object(it["a"])(Object(b["a"])(t.prototype),"removeShape",this).call(this,e,i,n)}},{key:"draw",value:function(){var e=this;if(!this.valid){var i=this.ctx;if(Wi.skipLightFOW)return i.clearRect(0,0,this.canvas.width,this.canvas.height),void(this.valid=!0);var n=i.globalCompositeOperation;i.clearRect(0,0,this.canvas.width,this.canvas.height),i.fillStyle="rgba(0, 0, 0, 1)";var a=It.getLayer("draw").ctx;(Wi.drawAngleLines||Wi.drawFirstLightHit)&&a.clearRect(0,0,a.canvas.width,a.canvas.height),Lt.fullFOW&&It.hasLayer("tokens")&&It.getLayer("tokens").shapes.forEach(function(e){if(e.ownedBy()&&e.isToken){var t=e.getBoundingBox(),n=ut(e.center()),a=.8*dt(t.w);i.beginPath(),i.arc(n.x,n.y,a,0,2*Math.PI);var r=i.createRadialGradient(n.x,n.y,a/2,n.x,n.y,a);r.addColorStop(0,"rgba(0, 0, 0, 1)"),r.addColorStop(1,"rgba(0, 0, 0, 0)"),i.fillStyle=r,i.fill()}}),this.vCtx.clearRect(0,0,window.innerWidth,window.innerHeight);var r=!0,s=!1,o=void 0;try{for(var l,u=function(){var t=l.value,n=It.UUIDMap.get(t.shape);if(void 0===n)return"continue";var r=n.auras.find(function(e){return e.uuid===t.aura});if(void 0===r)return"continue";var s=vt(r.value+r.dim),o=n.center(),u=ut(o),c=new Ri(o,s);if(!c.visibleInCanvas(i.canvas))return"continue";if("bvh"===Ci.visionMode){var h,d=-1,v=new Path2D;v.moveTo(u.x,u.y);for(var f=0;f<2*Math.PI;f+=Wi.angleSteps/180*Math.PI){var p=new at(o.x+s*Math.cos(f),o.y+s*Math.sin(f));Wi.drawAngleLines&&(a.beginPath(),a.moveTo(ct(o.x),ht(o.y)),a.lineTo(ct(p.x),ht(p.y)),a.stroke());var y=ot.fromPoints(o,p),g=Ci.BV.intersect(y);if(0===f&&(h=g.hit?g.intersect:p),g.hit)-1!==d&&(v.arc(u.x,u.y,ft(r.value+r.dim),d,f),d=-1),v.lineTo(ct(g.intersect.x),ht(g.intersect.y));else if(-1===d){d=f;var m=ut(p);i.lineTo(m.x,m.y)}}if(-1===d?v.lineTo(ct(h.x),ht(h.y)):v.arc(u.x,u.y,ft(r.value+r.dim),d,2*Math.PI),Lt.fullFOW){if(r.dim>0){var b=i.createRadialGradient(u.x,u.y,ft(r.value),u.x,u.y,ft(r.value+r.dim));b.addColorStop(0,"rgba(0, 0, 0, 1)"),b.addColorStop(1,"rgba(0, 0, 0, 0)"),i.fillStyle=b}else i.fillStyle="rgba(0, 0, 0, 1)";i.fill(v)}r.lastPath=v}else{e.vCtx.globalCompositeOperation="source-over",e.vCtx.fillStyle="rgba(0, 0, 0, 1)";var w=nn(o,_i.VISION);e.vCtx.beginPath(),e.vCtx.moveTo(ct(w[0][0]),ht(w[0][1]));var k=!0,x=!1,O=void 0;try{for(var S,_=w[Symbol.iterator]();!(k=(S=_.next()).done);k=!0){var C=S.value;e.vCtx.lineTo(ct(C[0]),ht(C[1]))}}catch(E){x=!0,O=E}finally{try{k||null==_.return||_.return()}finally{if(x)throw O}}if(e.vCtx.closePath(),e.vCtx.fill(),r.dim>0){var L=e.vCtx.createRadialGradient(u.x,u.y,ft(r.value),u.x,u.y,ft(r.value+r.dim));L.addColorStop(0,"rgba(0, 0, 0, 1)"),L.addColorStop(1,"rgba(0, 0, 0, 0)"),e.vCtx.fillStyle=L}else e.vCtx.fillStyle="rgba(0, 0, 0, 1)";e.vCtx.globalCompositeOperation="source-in",e.vCtx.beginPath(),e.vCtx.arc(u.x,u.y,ft(r.value+r.dim),0,2*Math.PI),e.vCtx.fill(),i.drawImage(e.virtualCanvas,0,0)}},c=Lt.visionSources[Symbol.iterator]();!(r=(l=c.next()).done);r=!0)u()}catch(m){s=!0,o=m}finally{try{r||null==c.return||c.return()}finally{if(s)throw o}}Lt.fowLOS&&(i.globalCompositeOperation="source-in",i.drawImage(It.getLayer("fow-players").canvas,0,0));var h=!0,d=!1,v=void 0;try{for(var f,p=this.preFogShapes[Symbol.iterator]();!(h=(f=p.next()).done);h=!0){var y=f.value;if(y.visibleInCanvas(this.canvas)){var g=y.globalCompositeOperation;Lt.fullFOW||("source-over"===y.globalCompositeOperation?y.globalCompositeOperation="destination-out":"destination-out"===y.globalCompositeOperation&&(y.globalCompositeOperation="source-over")),y.draw(i),y.globalCompositeOperation=g}}}catch(m){d=!0,v=m}finally{try{h||null==p.return||p.return()}finally{if(d)throw v}}Lt.fullFOW&&(i.globalCompositeOperation="source-out",i.fillStyle=_t(),i.fillRect(0,0,i.canvas.width,i.canvas.height)),Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,!1),i.globalCompositeOperation=n}}}]),t}(Gi),on=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.isVisionLayer=!0,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"draw",value:function(){if(!this.valid){var e=this.ctx;if(!Lt.fowLOS||Wi.skipPlayerFOW)return e.clearRect(0,0,this.canvas.width,this.canvas.height),void(this.valid=!0);e.clearRect(0,0,this.canvas.width,this.canvas.height);var i=e.globalCompositeOperation;e.fillStyle="rgba(0, 0, 0, 1)",Lt.IS_DM||Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,!Lt.fullFOW);var n=e.canvas.width+e.canvas.height,a=!0,r=!1,s=void 0;try{for(var o,l=Lt.activeTokens[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value,c=It.UUIDMap.get(u);if(void 0!==c){var h=c.center(),d=ut(h);if("bvh"===Ci.visionMode){e.beginPath();for(var v=-1,f=0;f<2*Math.PI;f+=Wi.angleSteps/2/180*Math.PI){var p=Math.cos(f),y=Math.sin(f),g=new ot(h,new st(p,y)),m=Ci.BV.intersect(g);m.hit?(-1!==v&&(e.arc(d.x,d.y,n,v,f),v=-1),e.lineTo(ct(m.intersect.x),ht(m.intersect.y))):-1===v&&(e.lineTo(d.x+n*p,d.y+n*y),v=f)}-1!==v?e.arc(d.x,d.y,n,v,2*Math.PI):e.closePath(),e.fill()}else{var w=e.createRadialGradient(d.x,d.y,ft(Lt.visionRangeMin),d.x,d.y,ft(Lt.visionRangeMax));w.addColorStop(0,"rgba(0, 0, 0, 1)"),w.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=w;try{var k=nn(c.center(),_i.VISION);e.beginPath(),e.moveTo(ct(k[0][0]),ht(k[0][1]));var x=!0,O=!1,S=void 0;try{for(var _,C=k[Symbol.iterator]();!(x=(_=C.next()).done);x=!0){var L=_.value;e.lineTo(ct(L[0]),ht(L[1]))}}catch(E){O=!0,S=E}finally{try{x||null==C.return||C.return()}finally{if(O)throw S}}e.closePath(),e.fill()}catch(I){}}}}}catch(E){r=!0,s=E}finally{try{a||null==l.return||l.return()}finally{if(r)throw s}}Lt.IS_DM&&Object(it["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,!Lt.fullFOW),e.globalCompositeOperation=i}}}]),t}(Gi),ln=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"invalidate",value:function(){this.valid=!1}},{key:"draw",value:function(e){this.valid||this.drawGrid()}},{key:"drawGrid",value:function(){var e=this.ctx;this.clear(),e.beginPath();for(var t=Lt.gridSize,i=0;i<this.width;i+=t*Lt.zoomFactor)e.moveTo(i+Lt.panX%t*Lt.zoomFactor,0),e.lineTo(i+Lt.panX%t*Lt.zoomFactor,this.height),e.moveTo(0,i+Lt.panY%t*Lt.zoomFactor),e.lineTo(this.width,i+Lt.panY%t*Lt.zoomFactor);e.strokeStyle=Lt.gridColour,e.lineWidth=1,e.stroke(),this.valid=!0}}]),t}(Gi);function un(e){var t,i=document.createElement("canvas");i.style.zIndex=It.layers.length.toString(),i.width=window.innerWidth,i.height=window.innerHeight,t="grid"===e.type_?new ln(i,e.name):"fow"===e.type_?new sn(i,e.name):"fow-players"===e.type_?new on(i,e.name):new Gi(i,e.name),t.selectable=e.selectable,t.playerEditable=e.player_editable,It.addLayer(t);var n=document.getElementById("layers");null!==n?("fow-players"!==e.name&&n.appendChild(i),"grid"===e.type_&&e.size&&Lt.setGridSize({gridSize:e.size,sync:!1}),t.setShapes(e.shapes)):console.warn("Layers div is missing, this will prevent the main game board from loading!")}function cn(e){var t=It.getLayer();if(void 0!==t&&null!==e&&null!==e.dataTransfer){var i=document.createElement("img");i.src=e.dataTransfer.getData("text/plain");var n=new Ai(i,new at(yt(e.clientX),gt(e.clientY)),mt(i.width),mt(i.height));if(n.src=new URL(i.src).pathname,Lt.useGrid){var a=Lt.gridSize;n.refPoint=new at(Math.round(n.refPoint.x/a)*a,Math.round(n.refPoint.y/a)*a),n.w=Math.max(Math.round(n.w/a)*a,a),n.h=Math.max(Math.round(n.h/a)*a,a)}t.addShape(n,!0)}}var hn=function(){function e(){Object(y["a"])(this,e),this.shown=!1;var t=new at(0,0);this.annotationText=new zi(t,"","bold 20px serif",0,"rgba(230, 230, 230, 1)"),this.annotationRect=new $i(t,0,0,"rgba(0, 0, 0, 0.6)")}return Object(g["a"])(e,[{key:"setActiveText",value:function(e){if(void 0===this.layer){if(!It.hasLayer("draw"))return void console.warn("There is no draw layer to draw annotations on!");this.layer=It.getLayer("draw"),this.layer.addShape(this.annotationRect,!1),this.layer.addShape(this.annotationText,!1)}this.shown=""!==e,this.annotationText.refPoint=pt(new rt(this.layer.canvas.width/2,50)),this.annotationText.text=e;var t=this.shown?this.annotationText.getMaxWidth(this.layer.ctx)+10:0,i=this.shown?this.annotationText.getMaxHeight(this.layer.ctx)+10:0;this.annotationRect.refPoint=pt(new rt(this.layer.canvas.width/2-t/2,30)),this.annotationRect.w=t/Lt.zoomFactor,this.annotationRect.h=i/Lt.zoomFactor,this.layer.invalidate(!0)}}]),e}(),dn=function(){function e(){Object(y["a"])(this,e),this.selectedTool=0,this.annotationManager=new hn}return Object(g["a"])(e,[{key:"addShape",value:function(e){if(It.hasLayer(e.layer)){var t=It.getLayer(e.layer),i=Hi(e);void 0!==i?(t.addShape(i,!1),t.invalidate(!1)):console.log("Shape with unknown type ".concat(e.type_," could not be added"))}else console.log("Shape with unknown layer ".concat(e.layer," could not be added"))}},{key:"updateShape",value:function(e){if(It.hasLayer(e.shape.layer)){var t=Hi(e.shape);if(void 0!==t){var i=It.UUIDMap.get(e.shape.uuid);if(void 0!==i){var n=t.owners!==i.owners,a=Object.assign(i,t),r=a.checkVisionSources(),s=a.setMovementBlock(a.movementObstruction);a.setIsToken(a.isToken),e.redraw&&(a.visionObstruction&&!r&&(Ci.deleteFromTriag({target:_i.VISION,shape:a,standalone:!1}),Ci.addToTriag({target:_i.VISION,shape:a})),It.getLayer(e.shape.layer).invalidate(!1),a.movementObstruction&&!s&&(Ci.deleteFromTriag({target:_i.MOVEMENT,shape:a,standalone:!1}),Ci.addToTriag({target:_i.MOVEMENT,shape:a}))),n&&tt.$emit("Initiative.ForceUpdate")}else console.log("Shape with unknown id could not be updated")}else console.log("Shape with unknown type ".concat(e.shape.type_," could not be added"))}else console.log("Shape with unknown layer ".concat(e.shape.layer," could not be added"))}},{key:"setCenterPosition",value:function(e){var t=ut(e);Lt.increasePanX((window.innerWidth/2-t.x)/Lt.zoomFactor),Lt.increasePanY((window.innerHeight/2-t.y)/Lt.zoomFactor),It.invalidate(),lt(Lt.locationOptions)}}]),e}(),vn=new dn;window.gameManager=vn,Je.on("connect",function(){console.log("Connected")}),Je.on("disconnect",function(){console.log("Disconnected")}),Je.on("connect_error",function(e){console.error("Could not connect to game session."),ws.push("/dashboard")}),Je.on("error",function(e){console.error("Game session does not exist."),ws.push("/dashboard")}),Je.on("redirect",function(e){console.log("redirecting"),ws.push(e)}),Je.on("Room.Info.Set",function(e){Lt.setRoomName(e.name),Lt.setRoomCreator(e.creator),Lt.setInvitationCode(e.invitationCode),Lt.setIsLocked({isLocked:e.isLocked,sync:!1}),Lt.setPlayers(e.players)}),Je.on("Room.Info.InvitationCode.Set",function(e){Lt.setInvitationCode(e),tt.$emit("DmSettings.RefreshedInviteCode")}),Je.on("Room.Info.Players.Add",function(e){Lt.addPlayer(e)}),Je.on("Username.Set",function(e){Lt.setUsername(e),Lt.setDM(e===decodeURIComponent(window.location.pathname.split("/")[2]))}),Je.on("Client.Options.Set",function(e){Lt.setGridColour({colour:e.grid_colour,sync:!1}),Lt.setFOWColour({colour:e.fow_colour,sync:!1}),Lt.setRulerColour({colour:e.ruler_colour,sync:!1}),Lt.setPanX(e.pan_x),Lt.setPanY(e.pan_y),Lt.setZoomDisplay(Ot(e.zoom_factor)),e.active_layer&&It.selectLayer(e.active_layer,!1),void 0!==It.getGridLayer()&&It.getGridLayer().invalidate()}),Je.on("Location.Set",function(e){void 0!==e.name&&Lt.setLocationName(e.name),void 0!==e.unit_size&&Lt.setUnitSize({unitSize:e.unit_size,sync:!1}),void 0!==e.use_grid&&Lt.setUseGrid({useGrid:e.use_grid,sync:!1}),void 0!==e.full_fow&&Lt.setFullFOW({fullFOW:e.full_fow,sync:!1}),void 0!==e.fow_opacity&&Lt.setFOWOpacity({fowOpacity:e.fow_opacity,sync:!1}),void 0!==e.fow_los&&Lt.setLineOfSight({fowLOS:e.fow_los,sync:!1}),void 0!==e.vision_min_range&&Lt.setVisionRangeMin({value:e.vision_min_range,sync:!1}),void 0!==e.vision_max_range&&Lt.setVisionRangeMax({value:e.vision_max_range,sync:!1}),void 0!==e.vision_mode&&(Ci.setVisionMode({mode:e.vision_mode,sync:!1}),Ci.recalculateVision(),Ci.recalculateMovement())}),Je.on("Position.Set",function(e){vn.setCenterPosition(new at(e.x,e.y))}),Je.on("Notes.Set",function(e){var t=!0,i=!1,n=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;Lt.newNote({note:s,sync:!1})}}catch(o){i=!0,n=o}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}),Je.on("Asset.List.Set",function(e){Lt.setAssets(e)}),Je.on("Board.Set",function(e){Lt.clear(),Lt.setLocations(e.locations),document.getElementById("layers").innerHTML="",Lt.resetLayerInfo(),It.reset();var t=!0,i=!1,n=void 0;try{for(var a,r=e.layers[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;un(s)}}catch(o){i=!0,n=o}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}It.selectLayer(It.getLayer().name,!1),tt.$emit("Initiative.Clear"),Ci.recalculateVision(),Ci.recalculateMovement(),Lt.setBoardInitialized(!0)}),Je.on("Gridsize.Set",function(e){Lt.setGridSize({gridSize:e,sync:!1})}),Je.on("Shape.Add",function(e){vn.addShape(e)}),Je.on("Shape.Remove",function(e){if(It.UUIDMap.has(e.uuid))if(It.hasLayer(e.layer)){var t=It.getLayer(e.layer);t.removeShape(It.UUIDMap.get(e.uuid),!1),t.invalidate(!1)}else console.log("Attempted to remove shape from an unknown layer ".concat(e.layer));else console.log("Attempted to remove an unknown shape")}),Je.on("Shape.Order.Set",function(e){if(It.UUIDMap.has(e.shape.uuid))if(It.hasLayer(e.shape.layer)){var t=It.UUIDMap.get(e.shape.uuid),i=It.getLayer(t.layer);i.moveShapeOrder(t,e.index,!1)}else console.log("Attempted to remove shape from an unknown layer ".concat(e.shape.layer));else console.log("Attempted to move the shape order of an unknown shape")}),Je.on("Shape.Layer.Change",function(e){var t=It.UUIDMap.get(e.uuid);void 0!==t&&t.moveLayer(e.layer,!1)}),Je.on("Shape.Update",function(e){vn.updateShape(e)}),Je.on("Temp.Clear",function(e){e.forEach(function(e){if(It.UUIDMap.has(e.uuid))if(It.hasLayer(e.layer)){var t=It.UUIDMap.get(e.uuid);It.getLayer(e.layer).removeShape(t,!1)}else console.log("Attempted to remove shape from an unknown layer ".concat(e.layer));else console.log("Attempted to remove an unknown temporary shape")})}),Je.on("Labels.Set",function(e){var t=!0,i=!1,n=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;Lt.addLabel(s)}}catch(o){i=!0,n=o}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}),Je.on("Label.Visibility.Set",function(e){Lt.setLabelVisibility(e)}),Je.on("Label.Add",function(e){Lt.addLabel(e)}),Je.on("Label.Delete",function(e){Lt.deleteLabel(e)}),Je.on("Labels.Filter.Add",function(e){Lt.labelFilters.push(e),It.invalidate()}),Je.on("Labels.Filter.Remove",function(e){var t=Lt.labelFilters.indexOf(e);t>=0&&(Lt.labelFilters.splice(t,1),It.invalidate())}),Je.on("Labels.Filters.Set",function(e){Lt.setLabelFilters(e)});var fn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Initiative")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("draggable",{attrs:{id:"initiative-list",setData:e.fakeSetData,disabled:!e.$store.state.game.IS_DM},on:{change:e.updateOrder},model:{value:e.$store.state.initiative.data,callback:function(t){e.$set(e.$store.state.initiative,"data",t)},expression:"$store.state.initiative.data"}},[e._l(e.$store.state.initiative.data,function(t){return[i("div",{key:t.uuid,staticStyle:{display:"flex","flex-direction":"column","align-items":"flex-end"}},[i("div",{staticClass:"initiative-actor",class:{"initiative-selected":e.$store.state.initiative.currentActor===t.uuid},style:{cursor:e.$store.state.game.IS_DM&&"move"},on:{mouseenter:function(i){return e.toggleHighlight(t,!0)},mouseleave:function(i){return e.toggleHighlight(t,!1)}}},[t.has_img?[i("img",{attrs:{src:t.source,width:"30px",height:"30px"}})]:[i("span",{staticStyle:{width:"auto"}},[e._v(e._s(t.source))])],i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:t.initiative,expression:"actor.initiative",modifiers:{lazy:!0,number:!0}}],class:{notAllowed:!e.owns(t)},attrs:{type:"text",placeholder:"value",disabled:!e.owns(t)},domProps:{value:t.initiative},on:{change:[function(i){e.$set(t,"initiative",e._n(i.target.value))},function(i){return e.syncInitiative(t)}],blur:function(t){return e.$forceUpdate()}}}),i("div",{staticClass:"initiative-effects-icon",class:{notAllowed:!e.owns(t)},staticStyle:{opacity:"0.6"},on:{click:function(i){e.createEffect(t,e.getDefaultEffect(),!0)}}},[i("i",{staticClass:"fas fa-stopwatch"}),t.effects?[e._v("\n                                "+e._s(t.effects.length)+"\n                            ")]:[e._v("\n                                0\n                            ")]],2),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:t.visible?"1.0":"0.3"},on:{click:function(i){return e.toggleOption(t,"visible")}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:t.group?"1.0":"0.3"},on:{click:function(i){return e.toggleOption(t,"group")}}},[i("i",{staticClass:"fas fa-users"})]),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:e.owns(t)?"1.0":"0.3"},on:{click:function(i){return e.removeInitiative(t.uuid,!0,!0)}}},[i("i",{staticClass:"fas fa-trash-alt"})])],2),t.effects?i("div",{staticClass:"initiative-effect"},e._l(t.effects,function(n){return i("div",{key:n.uuid},[i("input",{directives:[{name:"model",rawName:"v-model",value:n.name,expression:"effect.name"}],attrs:{type:"text",size:n.name.length||1},domProps:{value:n.name},on:{change:function(i){return e.updateEffect(t.uuid,n,!0)},input:function(t){t.target.composing||e.$set(n,"name",t.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model",value:n.turns,expression:"effect.turns"}],attrs:{type:"text",size:n.turns.toString().length||1},domProps:{value:n.turns},on:{change:function(i){return e.updateEffect(t.uuid,n,!0)},input:function(t){t.target.composing||e.$set(n,"turns",t.target.value)}}})])}),0):e._e()])]})],2),i("div",{attrs:{id:"initiative-bar"}},[i("div",{attrs:{id:"initiative-round"}},[e._v("Round "+e._s(e.$store.state.initiative.roundCounter))]),i("div",{staticStyle:{display:"flex"}}),i("div",{staticClass:"initiative-bar-button",style:e.visionLock?"background-color: #82c8a0":"",on:{click:e.toggleVisionLock}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{staticClass:"initiative-bar-button",style:e.cameraLock?"background-color: #82c8a0":"",on:{click:function(t){e.cameraLock=!e.cameraLock}}},[i("i",{staticClass:"fas fa-video"})]),i("div",{staticClass:"initiative-bar-button",class:{notAllowed:!e.$store.state.game.IS_DM},on:{click:function(t){e.setRound(0,!0),e.updateTurn(e.$store.state.initiative.data[0].uuid,!0)}}},[i("i",{staticClass:"fas fa-sync-alt"})]),i("div",{staticClass:"initiative-bar-button",class:{notAllowed:!e.$store.state.game.IS_DM},on:{click:e.nextTurn}},[i("i",{staticClass:"fas fa-chevron-right"})])])],1)])},pn=[],yn=i("310e"),gn=i.n(yn),mn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.data=[],e.currentActor=null,e.roundCounter=0,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"syncInitiative",value:function(e){U.emit("Initiative.Update",e)}},{key:"clear",value:function(){this.data=[],this.currentActor=null}},{key:"setData",value:function(e){this.data=e}},{key:"addInitiative",value:function(e){var t=this.data.findIndex(function(t){return t.uuid===e.uuid});t>=0||(void 0===e.initiative&&(e.initiative=0),this.syncInitiative(e))}},{key:"setRoundCounter",value:function(e){this.roundCounter=e}},{key:"setTurn",value:function(e){this.currentActor=e}}]),t}(D["d"]);k["a"]([D["c"]],mn.prototype,"clear",null),k["a"]([D["c"]],mn.prototype,"setData",null),k["a"]([D["c"]],mn.prototype,"addInitiative",null),k["a"]([D["c"]],mn.prototype,"setRoundCounter",null),k["a"]([D["c"]],mn.prototype,"setTurn",null),mn=k["a"]([Object(D["b"])({dynamic:!0,store:A,name:"initiative",namespaced:!0})],mn);var bn=Object(D["e"])(mn);n["default"].component("draggable",gn.a);var wn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.visionLock=!1,e.cameraLock=!1,e._activeTokens=[],e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("Initiative.Clear",bn.clear),tt.$on("Initiative.Remove",function(t){return e.removeInitiative(t)}),tt.$on("Initiative.Show",function(){return e.visible=!0}),tt.$on("Initiative.ForceUpdate",function(){return e.$forceUpdate()}),Je.on("Initiative.Set",bn.setData),Je.on("Initiative.Turn.Set",function(t){return e.setTurn(t)}),Je.on("Initiative.Turn.Update",function(t){return e.updateTurn(t,!1)}),Je.on("Initiative.Round.Update",function(t){return e.setRound(t,!1)}),Je.on("Initiative.Effect.New",function(t){var i=e.getActor(t.actor);void 0!==i&&e.createEffect(i,t.effect,!1)}),Je.on("Initiative.Effect.Update",function(t){return e.updateEffect(t.actor,t.effect,!1)})}},{key:"beforeDestroy",value:function(){tt.$off("Initiative.Clear"),tt.$off("Initiative.Remove"),tt.$off("Initiative.Show")}},{key:"getActor",value:function(e){return bn.data.find(function(t){return t.uuid===e})}},{key:"owns",value:function(e){if(Lt.IS_DM)return!0;var t=It.UUIDMap.get(e.uuid);return void 0!==t&&t.owners.includes(Lt.username)}},{key:"getDefaultEffect",value:function(){return{uuid:ve(),name:"New Effect",turns:10}}},{key:"fakeSetData",value:function(e){e.setData("Hack","")}},{key:"removeInitiative",value:function(e){var t=bn.data.findIndex(function(t){return t.uuid===e});if(!(t<0||bn.data[t].group)){bn.syncInitiative({uuid:e});var i=It.UUIDMap.get(e);void 0!==i&&i.showHighlight&&(i.showHighlight=!1,It.getLayer(i.layer).invalidate(!0))}}},{key:"updateOrder",value:function(){Lt.IS_DM&&Je.emit("Initiative.Set",bn.data.map(function(e){return e.uuid}))}},{key:"updateTurn",value:function(e,t){if(Lt.IS_DM||!t){bn.currentActor=e;var i=bn.data.find(function(t){return t.uuid===e});if(void 0!==i){if(i.effects)for(var n=i.effects.length-1;n>=0;n--)i.effects[n].turns<=0?i.effects.splice(n,1):i.effects[n].turns--;if(this.visionLock&&(null!==e&&Lt.ownedtokens.includes(e)?Lt.setActiveTokens([e]):Lt.setActiveTokens([])),this.cameraLock&&null!==e){var a=It.UUIDMap.get(e);void 0!==a&&a.ownedBy()&&vn.setCenterPosition(a.center())}t&&Je.emit("Initiative.Turn.Update",e)}}}},{key:"setRound",value:function(e,t){!Lt.IS_DM&&t||(bn.setRoundCounter(e),t&&Je.emit("Initiative.Round.Update",e))}},{key:"setTurn",value:function(e){bn.setTurn(e)}},{key:"nextTurn",value:function(){if(Lt.IS_DM){var e=bn.data,t=e[(e.findIndex(function(e){return e.uuid===bn.currentActor})+1)%e.length];bn.data[0].uuid===t.uuid&&this.setRound(bn.roundCounter+1,!0),this.updateTurn(t.uuid,!0)}}},{key:"toggleHighlight",value:function(e,t){var i=It.UUIDMap.get(e.uuid);void 0!==i&&(i.showHighlight=t,It.getLayer(i.layer).invalidate(!0))}},{key:"toggleOption",value:function(e,t){this.owns(e)&&(e[t]=!e[t],bn.syncInitiative(e))}},{key:"createEffect",value:function(e,t,i){this.owns(e)&&(e.effects.push(t),i&&Je.emit("Initiative.Effect.New",{actor:e.uuid,effect:t}))}},{key:"syncEffect",value:function(e,t){this.owns(e)&&Je.emit("Initiative.Effect.Update",{actor:e.uuid,effect:t})}},{key:"updateEffect",value:function(e,t,i){var n=bn.data.find(function(t){return t.uuid===e});if(void 0!==n){var a=n.effects.findIndex(function(e){return e.uuid===t.uuid});void 0!==a&&(n.effects[a]=t,i?this.syncEffect(n,t):this.$forceUpdate())}}},{key:"toggleVisionLock",value:function(){this.visionLock=!this.visionLock,this.visionLock?(this._activeTokens=Object(p["a"])(Lt._activeTokens),null!==bn.currentActor&&Lt.ownedtokens.includes(bn.currentActor)&&Lt.setActiveTokens([bn.currentActor])):Lt.setActiveTokens(this._activeTokens)}}]),t}(n["default"]);wn=k["a"]([Object(x["b"])({components:{Modal:ee,draggable:gn.a}})],wn);var kn=wn,xn=kn,On=(i("291a"),Object(s["a"])(xn,fn,pn,!1,null,"6bbba6d3",null)),Sn=On.exports,_n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Label manager")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("div",{staticClass:"grid"},[i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Category"}},[e._v("Cat.")])]),i("div",{staticClass:"header name"},[e._v("Name")]),i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Visible"}},[e._v("Vis.")])]),i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Delete"}},[e._v("Del.")])]),i("div",{staticClass:"separator spanrow",staticStyle:{margin:"0 0 7px"}}),i("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],ref:"search",staticClass:"spanrow",attrs:{type:"text",placeholder:"search"},domProps:{value:e.search},on:{input:function(t){t.target.composing||(e.search=t.target.value)}}})]),i("div",{staticClass:"grid scroll"},[e._l(e.categories,function(t){return[e._l(e.labels[t],function(t){return[i("div",{key:"row-"+t.uuid,staticClass:"row",on:{click:function(i){return e.selectLabel(t.uuid)}}},[t.category?[i("div",{key:"cat-"+t.uuid},[e._v(e._s(t.category))]),i("div",{key:"name-"+t.uuid,staticClass:"name"},[e._v(e._s(t.name))])]:e._e(),t.category?e._e():[i("div",{key:"cat-"+t.uuid}),i("div",{key:"name-"+t.uuid,staticClass:"name"},[e._v(e._s(t.name))])],i("div",{key:"visible-"+t.uuid,class:{"lower-opacity":!t.visible},style:{textAlign:"center"},on:{click:function(i){return i.stopPropagation(),e.toggleVisibility(t)}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{key:"delete-"+t.uuid,on:{click:function(i){return i.stopPropagation(),e.deleteLabel(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})])],2)]})]}),0===e.labels.length?[i("div",{attrs:{id:"no-labels"}},[e._v("No labels exist yet")])]:e._e()],2),i("div",{staticClass:"grid"},[i("div",{staticClass:"separator spanrow"}),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.newCategory,expression:"newCategory",modifiers:{trim:!0}}],attrs:{type:"text"},domProps:{value:e.newCategory},on:{input:function(t){t.target.composing||(e.newCategory=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.newName,expression:"newName",modifiers:{trim:!0}}],attrs:{type:"text"},domProps:{value:e.newName},on:{input:function(t){t.target.composing||(e.newName=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),i("button",{attrs:{id:"addLabelButton"},on:{click:function(t){return t.stopPropagation(),e.addLabel(t)}}},[e._v("Add")])])])])},Cn=[],Ln=(i("456d"),i("386d"),function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.newCategory="",e.newName="",e.search="",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("LabelManager.Open",function(){e.visible=!0,e.newCategory="",e.newName="",e.$nextTick(function(){return e.$refs.search.focus()})})}},{key:"beforeDestroy",value:function(){tt.$off("LabelManager.Open")}},{key:"selectLabel",value:function(e){tt.$emit("EditDialog.AddLabel",e),this.visible=!1}},{key:"toggleVisibility",value:function(e){e.visible=!e.visible,Je.emit("Label.Visibility.Set",{uuid:e.uuid,visible:e.visible})}},{key:"addLabel",value:function(){if(""!==this.newName){var e={uuid:ve(),category:this.newCategory,name:this.newName,visible:!1,user:Lt.username};Lt.addLabel(e),Je.emit("Label.Add",e),this.newCategory="",this.newName=""}}},{key:"deleteLabel",value:function(e){Lt.deleteLabel({uuid:e,user:Lt.username}),Je.emit("Label.Delete",e)}},{key:"labels",get:function(){for(var e={"":[]},t=0,i=Object.keys(Lt.labels);t<i.length;t++){var n=i[t],a=Lt.labels[n];this.search.length&&"".concat(a.category.toLowerCase()).concat(a.name.toLowerCase()).search(this.search.toLowerCase())<0||a.user===Lt.username&&(a.category?(a.category in e||(e[a.category]=[]),e[a.category].push(a),e[a.category].sort(function(e,t){return e.name.localeCompare(t.name)})):e[""].push(a))}return e}},{key:"categories",get:function(){return Object.keys(this.labels).sort()}}]),t}(n["default"]));Ln=k["a"]([Object(x["b"])({components:{Modal:ee}})],Ln);var En=Ln,In=En,jn=(i("ab66"),Object(s["a"])(In,_n,Cn,!1,null,"3261513c",null)),Tn=jn.exports,Mn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"menuContainer"}},[i("div",{ref:"rm",style:{left:e.visible.settings?"200px":"0",top:e.visible.locations?"100px":"0"},attrs:{id:"radialmenu"}},[i("div",{staticClass:"rm-wrapper"},[i("div",{staticClass:"rm-toggler"},[i("ul",{staticClass:"rm-list",class:{"rm-list-dm":e.IS_DM}},[e.IS_DM?i("li",{staticClass:"rm-item",attrs:{id:"rm-locations"},on:{click:function(t){e.visible.locations=!e.visible.locations}}},[e._m(0)]):e._e(),i("li",{staticClass:"rm-item",attrs:{id:"rm-settings"},on:{click:function(t){e.visible.settings=!e.visible.settings}}},[e._m(1)])])]),e._m(2)])]),i("transition",{attrs:{name:"settings"},on:{enter:function(t){e.$refs.rm.style.transition="left 500ms"}}},[e.visible.settings?i("div",{ref:"settings",attrs:{id:"menu"},on:{click:e.settingsClick}},[i("div",{staticStyle:{width:"200px",height:"90%","overflow-y":"auto","overflow-x":"hidden"}},[e.IS_DM?[i("button",{staticClass:"menu-accordion"},[e._v("Assets")]),i("div",{staticClass:"menu-accordion-panel"},[i("a",{staticClass:"actionButton",attrs:{href:"/assets",target:"blank",title:"Open asset manager"}},[i("i",{staticClass:"fas fa-external-link-alt"})]),i("div",{staticClass:"directory",attrs:{id:"menu-tokens"}},[i("asset-node",{attrs:{asset:e.assets}}),e.assets?e._e():i("div",[e._v("No assets")])],1)]),i("button",{staticClass:"menu-accordion"},[e._v("Notes")]),i("div",{staticClass:"menu-accordion-panel"},[i("div",{staticClass:"menu-accordion-subpanel",attrs:{id:"menu-notes"}},[i("a",{staticClass:"actionButton",on:{click:e.createNote}},[i("i",{staticClass:"far fa-plus-square"})]),e._l(e.notes,function(t){return i("div",{key:t.uuid,staticStyle:{cursor:"pointer"},on:{click:function(i){return e.openNote(t)}}},[e._v("\n                                "+e._s(t.title||"[?]")+"\n                            ")])}),e.notes.length?e._e():i("div",[e._v("No notes")])],2)]),i("button",{staticClass:"menu-accordion",on:{click:e.openDmSettings}},[e._v("DM Options")])]:e._e(),i("button",{staticClass:"menu-accordion"},[e._v("Client Options")]),i("div",{staticClass:"menu-accordion-panel"},[i("div",{staticClass:"menu-accordion-subpanel"},[i("label",{attrs:{for:"gridColour"}},[e._v("Grid Colour:")]),i("color-picker",{attrs:{id:"gridColour",color:e.gridColour},on:{"update:color":function(t){e.gridColour=t}}}),i("label",{attrs:{for:"fowColour"}},[e._v("FOW Colour:")]),i("color-picker",{attrs:{id:"fowColour",color:e.fowColour},on:{"update:color":function(t){e.fowColour=t}}}),i("label",{attrs:{for:"rulerColour"}},[e._v("Ruler Colour:")]),i("color-picker",{attrs:{id:"rulerColour",color:e.rulerColour},on:{"update:color":function(t){e.rulerColour=t}}})],1)])],2),i("router-link",{staticClass:"menu-accordion",staticStyle:{"text-decoration":"none",display:"inline-block",position:"absolute",bottom:"0"},attrs:{to:"/dashboard"}},[e._v("\n                Exit\n            ")])],1):e._e()]),i("transition",{attrs:{name:"locations"},on:{enter:function(t){e.$refs.rm.style.transition="top 500ms"}}},[e.IS_DM&&e.visible.locations?i("div",{attrs:{id:"locations-menu"}},[i("div",[e._l(e.locations,function(t){return i("div",{key:t,on:{click:function(i){return e.changeLocation(t)}}},[e._v("\n                    "+e._s(t)+"\n                ")])}),i("div",{on:{click:e.createLocation}},[i("i",{staticClass:"fas fa-plus"})])],2)]):e._e()]),i("img",{attrs:{id:"dragImage"}})],1)},Pn=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{attrs:{href:"#"}},[i("i",{staticClass:"far fa-compass"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{attrs:{href:"#"}},[i("i",{staticClass:"fas fa-cog"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"rm-topper"},[i("i",{staticClass:"icon-share-alt"})])}],Dn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"outer",on:{click:function(t){return t.target!==t.currentTarget?null:e.open(t)}}},[i("div",{staticClass:"current-color",style:e.transparent?"background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)":"background-color:"+e.color,on:{click:function(t){return t.target!==t.currentTarget?null:e.open(t)}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.display,expression:"display"}],staticClass:"mask",on:{click:function(t){return t.target!==t.currentTarget?null:e.closePicker(t)}}}),i("chrome-picker",{directives:[{name:"show",rawName:"v-show",value:e.display,expression:"display"}],ref:"chromePicker",style:{position:"fixed",left:e.left+"px",top:e.top+"px","z-index":9999},attrs:{value:e.color,tabindex:"-1"},on:{input:e.updateColor}})],1)},Nn=[],An=i("c345"),Rn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.display=!1,e.left=0,e.top=0,e.transparent=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){this.transparent=0===this.$refs.chromePicker.val.rgba.a,this.setPosition()}},{key:"open",value:function(){var e=this;this.display||this.disabled||(this.setPosition(),this.display=!0,this.$nextTick(function(){return e.$children[0].$el.focus()}))}},{key:"updateColor",value:function(e){this.transparent=0===e.rgba.a;var t=wt()(e.rgba).toRgbString();this.$emit("update:color",t),this.$emit("input",t)}},{key:"closePicker",value:function(){this.display=!1,this.$emit("change",this.color)}},{key:"setPosition",value:function(){var e=this.$el.getBoundingClientRect();e.right+224>window.innerWidth?this.left=e.left-224:this.left=e.right,e.bottom+242>window.innerHeight?this.top=e.top-242:this.top=e.bottom}}]),t}(n["default"]);k["a"]([Object(K["a"])(String)],Rn.prototype,"color",void 0),k["a"]([Object(K["a"])(Boolean)],Rn.prototype,"disabled",void 0),Rn=k["a"]([Object(x["b"])({components:{"chrome-picker":An["Chrome"]}})],Rn);var Vn=Rn,Un=Vn,Fn=(i("618b"),Object(s["a"])(Un,Dn,Nn,!1,null,"24ff2c54",null)),$n=Fn.exports,zn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",[e._l(e.folders,function(t){return i("li",{key:t,staticClass:"folder",on:{click:function(t){return t.stopPropagation(),e.toggle(t)}}},[e._v("\n        "+e._s(t)+"\n        "),i("asset-node",{attrs:{asset:e.asset[t]}})],1)}),e._l(e.files,function(t){return i("li",{key:t.name,staticClass:"file draggable token",attrs:{draggable:"true"},on:{mouseover:function(i){e.showImage=t.hash},mouseout:function(t){e.showImage=null},dragstart:function(i){return e.dragStart(i,"/static/assets/"+t.hash)}}},[e._v("\n        "+e._s(t.name)+"\n        "),e.showImage==t.hash?i("div",{staticClass:"preview"},[i("img",{staticClass:"asset-preview-image",attrs:{src:"/static/assets/"+t.hash}})]):e._e()])})],2)},Bn=[],Hn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.showImage=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"toggle",value:function(e){for(var t=0;t<e.target.children.length;t++){var i=e.target.children[t];i.style.display=""===i.style.display?"block":""}}},{key:"dragStart",value:function(e,t){if(this.showImage=null,null!==e&&null!==e.dataTransfer){var i=e.target.querySelector(".preview");e.dataTransfer.setDragImage(i,0,0),e.dataTransfer.setData("text/plain",t)}}},{key:"folders",get:function(){return Object.keys(this.asset).filter(function(e){return!["__files"].includes(e)}).sort(fe)}},{key:"files",get:function(){return this.asset.__files?this.asset.__files.concat().sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}):[]}}]),t}(n["default"]);k["a"]([Object(K["a"])()],Hn.prototype,"asset",void 0),Hn=k["a"]([Object(x["b"])({name:"asset-node"})],Hn);var Gn=Hn,Wn=Gn,Xn=(i("3ba3"),Object(s["a"])(Wn,zn,Bn,!1,null,"03f9ac64",null)),Yn=Xn.exports,Kn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible={settings:!1,locations:!1},e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"settingsClick",value:function(e){if(e.target.classList.contains("menu-accordion")){e.target.classList.toggle("menu-accordion-active");var t=e.target.nextElementSibling;null!==t&&(t.style.display=""===t.style.display?"block":"")}}},{key:"changeLocation",value:function(e){Je.emit("Location.Change",e)}},{key:"createLocation",value:function(){this.$parent.$parent.$refs.prompt.prompt("New location name:","Create new location").then(function(e){Je.emit("Location.New",e)},function(){})}},{key:"createNote",value:function(){var e={title:"New note",text:"",uuid:ve()};Lt.newNote({note:e,sync:!0}),this.openNote(e)}},{key:"openNote",value:function(e){this.$parent.$parent.$refs.note.open(e)}},{key:"openDmSettings",value:function(){tt.$emit("DmSettings.Open")}},{key:"IS_DM",get:function(){return Lt.IS_DM||Lt.FAKE_PLAYER}},{key:"gridColour",get:function(){return Lt.gridColour},set:function(e){Lt.setGridColour({colour:e,sync:!0})}},{key:"fowColour",get:function(){return Lt.fowColour},set:function(e){Lt.setFOWColour({colour:e,sync:!0})}},{key:"rulerColour",get:function(){return Lt.rulerColour},set:function(e){Lt.setRulerColour({colour:e,sync:!0})}}]),t}(n["default"]);Kn=k["a"]([Object(x["b"])({components:{"color-picker":$n,"asset-node":Yn},computed:Object.assign({},Object(N["b"])("game",["locations","assets","notes"]))})],Kn);var qn=Kn,Qn=qn,Zn=(i("6146"),Object(s["a"])(Qn,Mn,Pn,!1,null,"9190ff3e",null)),Jn=Zn.exports,ea=function(){var e=this,t=e.$createElement,i=e._self._c||t;return null!==e.note?i("modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("span",{on:{click:function(t){return e.$refs.title.select()}}},[i("i",{staticClass:"fas fa-pencil-alt",staticStyle:{"font-size":"15px"}})]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.note.title,expression:"note.title"}],ref:"title",domProps:{value:e.note.title},on:{change:e.updateNote,input:function(t){t.target.composing||e.$set(e.note,"title",t.target.value)}}}),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}],null,!1,1320213373)},[i("div",{staticClass:"modal-body"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.note.text,expression:"note.text"}],ref:"textarea",style:{height:e.calcHeight()},domProps:{value:e.note.text},on:{change:e.updateNote,input:function(t){t.target.composing||e.$set(e.note,"text",t.target.value)}}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.removeNote}},[i("i",{staticClass:"far fa-trash-alt"}),e._v("\n            Remove\n        ")])])]):e._e()},ta=[],ia=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.note=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"open",value:function(e){this.visible=!0,this.note=e}},{key:"calcHeight",value:function(){if(this.$refs.textarea){var e=this.$refs.textarea;return e.style.height="auto",e.style.height=e.scrollHeight+"px",e.scrollHeight+"px"}return"100px"}},{key:"updateNote",value:function(){this.note&&Lt.updateNote({note:this.note,sync:!0})}},{key:"removeNote",value:function(){var e=this;this.$parent.$parent.$refs.confirm.open("Are you sure you wish to remove this?").then(function(t){t&&e.note&&(Lt.removeNote({note:e.note,sync:!0}),e.visible=!1)},function(){})}}]),t}(n["default"]);ia=k["a"]([Object(x["b"])({components:{Modal:ee}})],ia);var na=ia,aa=na,ra=(i("57af"),Object(s["a"])(aa,ea,ta,!1,null,"2c1a0e9a",null)),sa=ra.exports,oa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.shapes.length>0,expression:"shapes.length > 0"}]},e._l(e.shapes,function(t){return i("div",{key:t.uuid},[i("div",{attrs:{id:"selection-menu"}},[i("div",{attrs:{id:"selection-edit-button"},on:{click:e.openEditDialog}},[i("i",{staticClass:"fas fa-edit"})]),i("div",{attrs:{id:"selection-name"}},[e._v(e._s(t.name))]),i("div",{attrs:{id:"selection-trackers"}},[e._l(e.visibleTrackers,function(t){return[i("div",{key:"name-"+t.uuid},[e._v(e._s(t.name))]),i("div",{key:"value-"+t.uuid,staticClass:"selection-tracker-value",on:{click:function(i){return e.changeValue(t,!1)}}},[0===t.maxvalue?[e._v("\n                            "+e._s(t.value)+"\n                        ")]:[e._v("\n                            "+e._s(t.value)+" / "+e._s(t.maxvalue)+"\n                        ")]],2)]})],2),i("div",{attrs:{id:"selection-auras"}},[e._l(e.visibleAuras,function(t){return[i("div",{key:"name-"+t.uuid},[e._v(e._s(t.name))]),i("div",{key:"value-"+t.uuid,staticClass:"selection-tracker-value",on:{click:function(i){return e.changeValue(t,!0)}}},[0===t.dim?[e._v("\n                            "+e._s(t.value)+"\n                        ")]:[e._v("\n                            "+e._s(t.value)+" / "+e._s(t.dim)+"\n                        ")]],2)]})],2)]),i("edit-dialog",{ref:"editDialog",refInFor:!0,attrs:{shape:t}})],1)}),0)},la=[],ua=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Edit asset")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("div",{staticClass:"grid"},[i("label",{attrs:{for:"shapeselectiondialog-name"}},[e._v("Name")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.shape.name,expression:"shape.name"}],staticStyle:{"grid-column":"numerator / remove"},attrs:{type:"text",id:"shapeselectiondialog-name",disabled:!e.owned},domProps:{value:e.shape.name},on:{change:function(t){return e.updateShape(!1)},input:function(t){t.target.composing||e.$set(e.shape,"name",t.target.value)}}}),i("div",{style:{opacity:e.shape.nameVisible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(t){e.shape.nameVisible=!e.shape.nameVisible,e.updateShape(!1)}}},[i("i",{staticClass:"fas fa-eye"})]),i("label",{attrs:{for:"shapeselectiondialog-istoken"}},[e._v("Is a token")]),i("input",{staticClass:"styled-checkbox",staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-istoken",disabled:!e.owned},domProps:{checked:e.shape.isToken},on:{click:e.setToken}}),i("label",{attrs:{for:"shapeselectiondialog-visionblocker"}},[e._v("Blocks vision/light")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.shape.visionObstruction,expression:"shape.visionObstruction"}],staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-visionblocker",disabled:!e.owned},domProps:{checked:Array.isArray(e.shape.visionObstruction)?e._i(e.shape.visionObstruction,null)>-1:e.shape.visionObstruction},on:{change:[function(t){var i=e.shape.visionObstruction,n=t.target,a=!!n.checked;if(Array.isArray(i)){var r=null,s=e._i(i,r);n.checked?s<0&&e.$set(e.shape,"visionObstruction",i.concat([r])):s>-1&&e.$set(e.shape,"visionObstruction",i.slice(0,s).concat(i.slice(s+1)))}else e.$set(e.shape,"visionObstruction",a)},e.setVisionBlocker]}}),i("label",{attrs:{for:"shapeselectiondialog-moveblocker"}},[e._v("Blocks movement")]),i("input",{staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-moveblocker",disabled:!e.owned},domProps:{checked:e.shape.movementObstruction},on:{click:e.setMovementBlocker}}),i("label",{attrs:{for:"shapeselectiondialog-strokecolour"}},[e._v("Border colour")]),i("color-picker",{staticStyle:{"grid-column-start":"remove"},attrs:{color:e.shape.strokeColour,disabled:!e.owned},on:{"update:color":function(t){return e.$set(e.shape,"strokeColour",t)},input:function(t){return e.updateShape(!0,!0)},change:function(t){return e.updateShape(!0)}}}),i("label",{attrs:{for:"shapeselectiondialog-fillcolour"}},[e._v("Fill colour")]),i("color-picker",{staticStyle:{"grid-column-start":"remove"},attrs:{color:e.shape.fillColour,disabled:!e.owned},on:{"update:color":function(t){return e.$set(e.shape,"fillColour",t)},input:function(t){return e.updateShape(!0,!0)},change:function(t){return e.updateShape(!0)}}}),i("div",{staticClass:"spanrow header"},[e._v("Access")]),e._l(e.shape.owners,function(t){return[i("input",{key:t,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t},on:{change:function(i){return e.updateOwner(i,t)}}}),""!==t?i("div",{key:"remove-"+t,style:{opacity:e.owned?1:.3,textAlign:"center",gridColumnStart:"remove"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeOwner(t)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]}),i("div",{staticClass:"spanrow header"},[e._v("Trackers")]),e._l(e.shape.trackers,function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"tracker.name"}],key:"name-"+t.uuid,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t.name},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"name",i.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.value,expression:"tracker.value",modifiers:{number:!0}}],key:"value-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.value},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"value",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"fspan-"+t.uuid},[e._v("/")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.maxvalue,expression:"tracker.maxvalue",modifiers:{number:!0}}],key:"maxvalue-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.maxvalue},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"maxvalue",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"sspan-"+t.uuid}),i("div",{key:"visibility-"+t.uuid,style:{opacity:t.visible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){t.visible=!t.visible,e.updateShape(!1)}}},[i("i",{staticClass:"fas fa-eye"})]),i("span",{key:"tspan-"+t.uuid}),""!==t.name||0!==t.value?i("div",{key:"remove-"+t.uuid,style:{opacity:e.owned?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeTracker(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]}),i("div",{staticClass:"spanrow header"},[e._v("Auras")]),e._l(e.shape.auras,function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"aura.name"}],key:"name-"+t.uuid,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t.name},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"name",i.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.value,expression:"aura.value",modifiers:{number:!0}}],key:"value-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.value},on:{change:function(t){return e.updateShape(!0)},input:function(i){i.target.composing||e.$set(t,"value",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"fspan-"+t.uuid},[e._v("/")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.dim,expression:"aura.dim",modifiers:{number:!0}}],key:"dimvalue-"+t.uuid,attrs:{type:"text",title:"Dim value",disabled:!e.owned},domProps:{value:t.dim},on:{change:function(t){return e.updateShape(!0)},input:function(i){i.target.composing||e.$set(t,"dim",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("color-picker",{key:"colour-"+t.uuid,attrs:{color:t.colour,disabled:!e.owned},on:{"update:color":function(i){return e.$set(t,"colour",i)},input:function(i){return e.updateAuraColour(t,i)},change:function(t){return e.updateShape(!0)}}}),i("div",{key:"visibility-"+t.uuid,style:{opacity:t.visible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){t.visible=!t.visible,e.updateShape(!0)}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{key:"visionsource-"+t.uuid,style:{opacity:t.visionSource?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.updateAuraVisionSource(t)}}},[i("i",{staticClass:"fas fa-lightbulb"})]),""!==t.name||0!==t.value?i("div",{key:"remove-"+t.uuid,style:{opacity:e.owned?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeAura(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]}),i("div",{staticClass:"spanrow header"},[e._v("Labels")]),i("div",{staticClass:"spanrow",attrs:{id:"labels"}},[e._l(e.shape.labels,function(t){return i("div",{key:t.uuid,staticClass:"label"},[t.category?[i("div",{staticClass:"label-user"},[e._v(e._s(t.category))]),i("div",{staticClass:"label-main",on:{click:function(i){return e.removeLabel(t.uuid)}}},[e._v(e._s(t.name))])]:e._e(),t.category?e._e():[i("div",{staticClass:"label-main",on:{click:function(i){return e.removeLabel(t.uuid)}}},[e._v(e._s(t.name))])]],2)}),e.owned?i("div",{staticClass:"label",attrs:{id:"label-add"}},[i("div",{staticClass:"label-main",on:{click:e.openLabelManager}},[e._v("+")])]):e._e()],2),i("div",{staticClass:"spanrow header"},[e._v("Annotation")]),i("textarea",{staticClass:"spanrow",attrs:{disabled:!e.owned},domProps:{value:e.shape.annotation},on:{change:e.updateAnnotation}})],2)])])},ca=[],ha=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("EditDialog.Open",function(t){e.shape=t,e.visible=!0}),tt.$on("EditDialog.AddLabel",function(t){e.visible&&(e.shape.labels.push(Lt.labels[t]),e.updateShape(!0))})}},{key:"beforeDestroy",value:function(){tt.$off("EditDialog.Open"),tt.$off("EditDialog.AddLabel")}},{key:"updated",value:function(){this.addEmpty()}},{key:"addEmpty",value:function(){""!==this.shape.owners[this.shape.owners.length-1]&&this.shape.addOwner(""),this.shape.trackers.length&&""===this.shape.trackers[this.shape.trackers.length-1].name&&0===this.shape.trackers[this.shape.trackers.length-1].value||this.shape.trackers.push({uuid:ve(),name:"",value:0,maxvalue:0,visible:!1}),this.shape.auras.length&&""===this.shape.auras[this.shape.auras.length-1].name&&0===this.shape.auras[this.shape.auras.length-1].value||this.shape.auras.push({uuid:ve(),name:"",value:0,dim:0,visionSource:!1,colour:"rgba(0,0,0,0)",visible:!1})}},{key:"updateShape",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.owned&&(Je.emit("Shape.Update",{shape:this.shape.asDict(),redraw:e,temporary:t}),e&&It.invalidate(),this.addEmpty())}},{key:"setToken",value:function(e){this.owned&&(this.shape.setIsToken(e.target.checked),this.updateShape(!0))}},{key:"setVisionBlocker",value:function(e){this.owned&&(this.shape.checkVisionSources(),this.updateShape(!0))}},{key:"setMovementBlocker",value:function(e){this.owned&&(this.shape.setMovementBlock(e.target.checked),this.updateShape(!1))}},{key:"updateAnnotation",value:function(e){var t=this;if(this.owned){var i=""!==this.shape.annotation;this.shape.annotation=e.target.value,""===this.shape.annotation||i?""===this.shape.annotation&&i&&(Lt.annotations.splice(Lt.annotations.findIndex(function(e){return e===t.shape.uuid})),It.hasLayer("draw")&&It.getLayer("draw").invalidate(!0)):(Lt.annotations.push(this.shape.uuid),It.hasLayer("draw")&&It.getLayer("draw").invalidate(!0)),this.updateShape(!1)}}},{key:"updateOwner",value:function(e,t){this.owned&&(this.shape.updateOwner(t,e.target.value),this.updateShape(Lt.fowLOS))}},{key:"removeOwner",value:function(e){this.owned&&(this.shape.removeOwner(e),this.updateShape(Lt.fowLOS))}},{key:"removeTracker",value:function(e){this.owned&&(this.shape.trackers=this.shape.trackers.filter(function(t){return t.uuid!==e}),this.updateShape(!1))}},{key:"removeAura",value:function(e){this.owned&&(this.shape.auras=this.shape.auras.filter(function(t){return t.uuid!==e}),this.shape.checkVisionSources(),this.updateShape(!0))}},{key:"updateAuraVisionSource",value:function(e){if(this.owned){e.visionSource=!e.visionSource;var t=Lt.visionSources.findIndex(function(t){return t.aura===e.uuid});e.visionSource&&-1===t?Lt.visionSources.push({shape:this.shape.uuid,aura:e.uuid}):!e.visionSource&&t>=0&&Lt.visionSources.splice(t,1),this.updateShape(!0)}}},{key:"updateAuraColour",value:function(e,t){if(this.owned){var i=It.getLayer(this.shape.layer);void 0!==i&&i.invalidate(!e.visionSource)}}},{key:"openLabelManager",value:function(){tt.$emit("LabelManager.Open")}},{key:"removeLabel",value:function(e){this.owned&&(this.shape.labels=this.shape.labels.filter(function(t){return t.uuid!==e}),this.updateShape(!0))}},{key:"owned",get:function(){return this.shape.ownedBy()}}]),t}(n["default"]);k["a"]([Object(K["a"])()],ha.prototype,"shape",void 0),ha=k["a"]([Object(x["b"])({components:{Modal:ee,"color-picker":$n}})],ha);var da=ha,va=da,fa=(i("6da0"),Object(s["a"])(va,ua,ca,!1,null,"40314b6e",null)),pa=fa.exports,ya=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.shape=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("SelectionInfo.Shape.Set",function(t){e.shape=t})}},{key:"beforeDestroy",value:function(){tt.$off("SelectionInfo.Shape.Set")}},{key:"openEditDialog",value:function(){this.$refs.editDialog.visible=!0}},{key:"changeValue",value:function(e,t){var i=this;null!==this.shape&&this.$parent.$parent.$refs.prompt.prompt("New  ".concat(e.name," value:"),"Updating ".concat(e.name)).then(function(n){if(null!==i.shape){var a=e.value;"+"===n[0]||"-"===n[0]?e.value+=parseInt(n,10):e.value=parseInt(n,10),isNaN(e.value)&&(e.value=a),Je.emit("Shape.Update",{shape:i.shape.asDict(),redraw:t,temporary:!1}),t&&It.invalidate()}},function(){})}},{key:"shapes",get:function(){return null===this.shape?[]:[this.shape]}},{key:"visibleTrackers",get:function(){return null===this.shape?[]:this.shape.trackers.filter(function(e){return""!==e.name||0!==e.value})}},{key:"visibleAuras",get:function(){return null===this.shape?[]:this.shape.auras.filter(function(e){return""!==e.name||0!==e.value})}}]),t}(n["default"]);ya=k["a"]([Object(x["b"])({components:{"edit-dialog":pa}})],ya);var ga=ya,ma=ga,ba=(i("ae5a"),Object(s["a"])(ma,oa,la,!1,null,"4ce4ab65",null)),wa=ba.exports,ka=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{attrs:{id:"toolselect"}},[i("ul",e._l(e.visibleTools,function(t){return i("li",{directives:[{name:"show",rawName:"v-show",value:e.toolVisible(t),expression:"toolVisible(tool)"}],key:t,ref:t+"-selector",refInFor:!0,class:{"tool-selected":e.currentTool===t},on:{mousedown:function(i){e.currentTool=t}}},[i("a",{attrs:{href:"#"}},[e._v(e._s(t))])])}),0)]),i("div",[[i("select-tool",{directives:[{name:"show",rawName:"v-show",value:"Select"===e.currentTool,expression:"currentTool === 'Select'"}],ref:"selectTool"}),i("pan-tool",{directives:[{name:"show",rawName:"v-show",value:"Pan"===e.currentTool,expression:"currentTool === 'Pan'"}]}),i("keep-alive",[i("draw-tool",{directives:[{name:"show",rawName:"v-show",value:"Draw"===e.currentTool,expression:"currentTool === 'Draw'"}]})],1),i("ruler-tool",{directives:[{name:"show",rawName:"v-show",value:"Ruler"===e.currentTool,expression:"currentTool === 'Ruler'"}]}),i("map-tool",{directives:[{name:"show",rawName:"v-show",value:"Map"===e.currentTool,expression:"currentTool === 'Map'"}]}),i("filter-tool",{directives:[{name:"show",rawName:"v-show",value:"Filter"===e.currentTool,expression:"currentTool === 'Filter'"}]}),i("vision-tool",{directives:[{name:"show",rawName:"v-show",value:"Vision"===e.currentTool,expression:"currentTool === 'Vision'"}]}),i("shape-menu",{ref:"shapecontext"}),i("createtoken-dialog",{ref:"createtokendialog"})]],2)])},xa=[],Oa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return void 0!==e.getActiveLayer()?i("ContextMenu",{attrs:{visible:e.visible,left:e.x+"px",top:e.y+"px"},on:{close:e.close}},[e.getLayers().length>1?i("li",[e._v("\n        Layer\n        "),i("ul",e._l(e.getLayers(),function(t){return i("li",{key:t.name,style:[e.getActiveLayer().name===t.name?{"background-color":"#82c8a0"}:{}],on:{click:function(i){return e.setLayer(t.name)}}},[e._v("\n                "+e._s(t.name)+"\n            ")])}),0)]):e._e(),i("li",{on:{click:e.moveToBack}},[e._v("Move to back")]),i("li",{on:{click:e.moveToFront}},[e._v("Move to front")]),i("li",{on:{click:e.addInitiative}},[e._v(e._s(e.getInitiativeWord())+" initiative")]),i("li",{on:{click:e.openEditDialog}},[e._v("Show properties")])]):e._e()},Sa=[];function _a(e){return bn.data.some(function(t){return t.uuid===e})}var Ca=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.x=0,e.y=0,e.shape=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"open",value:function(e,t){var i=this;this.visible=!0,this.x=e.pageX,this.y=e.pageY,this.shape=t,this.$nextTick(function(){return i.$children[0].$el.focus()})}},{key:"close",value:function(){this.visible=!1,this.shape=null}},{key:"getLayers",value:function(){return It.layers.filter(function(e){return e.selectable&&(Lt.IS_DM||e.playerEditable)})}},{key:"getActiveLayer",value:function(){return It.getLayer()}},{key:"getInitiativeWord",value:function(){return null===this.shape?"":_a(this.shape.uuid)?"Show":"Add"}},{key:"setLayer",value:function(e){null!==this.shape&&(this.shape.moveLayer(e,!0),this.close())}},{key:"moveToBack",value:function(){if(null!==this.shape){var e=this.getActiveLayer();e.moveShapeOrder(this.shape,0,!0),this.close()}}},{key:"moveToFront",value:function(){if(null!==this.shape){var e=this.getActiveLayer();e.moveShapeOrder(this.shape,e.shapes.length-1,!0),this.close()}}},{key:"addInitiative",value:function(){null!==this.shape&&(this.$parent.$parent.$parent,_a(this.shape.uuid)||bn.addInitiative(this.shape.getInitiativeRepr()),tt.$emit("Initiative.Show"),this.close())}},{key:"openEditDialog",value:function(){tt.$emit("EditDialog.Open",this.shape),this.close()}},{key:"activeLayer",get:function(){var e=It.getLayer();return void 0===e?"":e.name}}]),t}(n["default"]);Ca=k["a"]([Object(x["b"])({components:{ContextMenu:T}})],Ca);var La=Ca,Ea=La,Ia=(i("95c9"),Object(s["a"])(Ea,Oa,Sa,!1,null,"d6c7d844",null)),ja=Ia.exports,Ta=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v("\n        Create basic token\n    ")])}}])},[i("div",{staticClass:"modal-body"},[i("label",{attrs:{for:"createtokendialog-text"}},[e._v("Text")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"text"}],attrs:{type:"text",id:"createtokendialog-name"},domProps:{value:e.text},on:{input:function(t){t.target.composing||(e.text=t.target.value)}}}),i("label",[e._v("Colours")]),i("div",{staticClass:"colours"},[i("span",[e._v("Fill:")]),i("color-picker",{attrs:{color:e.fillColour},on:{"update:color":function(t){e.fillColour=t}}}),i("span",[e._v("Border:")]),i("color-picker",{attrs:{color:e.borderColour},on:{"update:color":function(t){e.borderColour=t}}})],1),i("canvas",{ref:"canvas",attrs:{width:"100px",height:"100px"}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.submit}},[e._v("Submit")])])])},Ma=[],Pa=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.x=0,e.y=0,e.visible=!1,e.text="X",e.fillColour="rgba(255, 255, 255, 1)",e.borderColour="rgba(0, 0, 0, 1)",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){this.updatePreview()}},{key:"onTextChange",value:function(e,t){this.updatePreview()}},{key:"onFillChange",value:function(e,t){this.updatePreview()}},{key:"onBorderChange",value:function(e,t){this.updatePreview()}},{key:"open",value:function(e,t){this.visible=!0,this.x=e,this.y=t}},{key:"submit",value:function(){var e=It.getLayer();if(void 0!==e){var t=new Vi(pt(new rt(this.x,this.y)),vt(Lt.unitSize/2),this.text,"10px serif",this.fillColour,this.borderColour);t.addOwner(Lt.username),e.addShape(t,!0),e.invalidate(!1),this.visible=!1}}},{key:"updatePreview",value:function(){var e=this.$refs.canvas.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath();var t={x:e.canvas.width/2,y:e.canvas.height/2},i=.9*Math.min(t.x,t.y);e.fillStyle=this.fillColour,e.arc(t.x,t.y,i,0,2*Math.PI),e.fill(),"rgba(0, 0, 0, 0)"!==this.borderColour&&(e.beginPath(),e.lineWidth=5,e.strokeStyle=this.borderColour,e.arc(t.x,t.y,i,0,2*Math.PI),e.stroke()),e.save(),e.textAlign="center",e.textBaseline="middle";var n=ye(e,this.text,i,i),a=0;e.transform(n,a,-a,n,t.x,t.y),e.fillStyle=bt["mostReadable"](this.fillColour,["#000","#fff"]).toHexString(),e.fillText(this.text,0,0),e.restore()}}]),t}(n["default"]);k["a"]([Object(K["b"])("text")],Pa.prototype,"onTextChange",null),k["a"]([Object(K["b"])("fillColour")],Pa.prototype,"onFillChange",null),k["a"]([Object(K["b"])("borderColour")],Pa.prototype,"onBorderChange",null),Pa=k["a"]([Object(x["b"])({components:{Modal:ee,"color-picker":$n},computed:Object.assign({},Object(N["b"])("game",["unitSize"]))})],Pa);var Da=Pa,Na=Da,Aa=(i("2a75"),Object(s["a"])(Na,Ta,Ma,!1,null,"bf063922",null)),Ra=Aa.exports,Va=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.IS_DM,expression:"IS_DM"}]},[e._v("Mode")]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.IS_DM,expression:"IS_DM"}],staticClass:"selectgroup"},e._l(e.modes,function(t){return i("div",{key:t,staticClass:"option",class:{"option-selected":e.modeSelect===t},on:{click:function(i){e.modeSelect=t}}},[e._v("\n            "+e._s(t)+"\n        ")])}),0),i("div",[e._v("Shape")]),i("div",{staticClass:"selectgroup"},e._l(e.shapes,function(t){return i("div",{key:t,staticClass:"option",class:{"option-selected":e.shapeSelect===t},on:{click:function(i){e.shapeSelect=t}}},[i("i",{staticClass:"fas",class:"fa-"+t})])}),0),i("div",[e._v("Colours")]),i("div",{staticClass:"selectgroup"},[i("color-picker",{staticClass:"option",attrs:{color:e.fillColour},on:{"update:color":function(t){e.fillColour=t}}}),i("color-picker",{staticClass:"option",attrs:{color:e.borderColour},on:{"update:color":function(t){e.borderColour=t}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"paint-brush"===e.shapeSelect,expression:"shapeSelect === 'paint-brush'"}]},[e._v("Brush size")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.brushSize,expression:"brushSize"},{name:"show",rawName:"v-show",value:"paint-brush"===e.shapeSelect,expression:"shapeSelect === 'paint-brush'"}],staticStyle:{"max-width":"100px"},attrs:{type:"text"},domProps:{value:e.brushSize},on:{input:function(t){t.target.composing||(e.brushSize=t.target.value)}}})]):e._e()},Ua=[],Fa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div")},$a=[],za=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="",e.selected=!1,e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"created",value:function(){var e=this;this.$parent.$on("mousedown",function(t,i){i===e.name&&e.onMouseDown(t)}),this.$parent.$on("mouseup",function(t,i){i===e.name&&e.onMouseUp(t)}),this.$parent.$on("mousemove",function(t,i){i===e.name&&e.onMouseMove(t)}),this.$parent.$on("contextmenu",function(t,i){i===e.name&&e.onContextMenu(t)}),this.$parent.$on("tools-select-change",function(t,i){i===e.name?(e.selected=!1,e.onDeselect()):t===e.name&&(e.selected=!0,e.onSelect())})}},{key:"onSelect",value:function(){}},{key:"onDeselect",value:function(){}},{key:"onMouseDown",value:function(e){}},{key:"onMouseUp",value:function(e){}},{key:"onMouseMove",value:function(e){}},{key:"onContextMenu",value:function(e){}},{key:"detailRight",get:function(){var e=this.$parent.$refs[this.name+"-selector"][0].getBoundingClientRect(),t=e.left+e.width/2;return"".concat(window.innerWidth-Math.min(window.innerWidth-25,t+75),"px")}},{key:"detailArrow",get:function(){var e=this.$parent.$refs[this.name+"-selector"][0].getBoundingClientRect(),t=e.left+e.width/2,i=Math.min(window.innerWidth-25,t+75);return"".concat(i-t-14,"px")}}]),t}(n["default"]);za=k["a"]([x["b"]],za);var Ba=za,Ha=Ba,Ga=(i("12d3"),Object(s["a"])(Ha,Fa,$a,!1,null,null,null)),Wa=Ga.exports,Xa=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Draw",e.active=!1,e.startPoint=null,e.shape=null,e.brushHelper=null,e.ruler=null,e.fillColour="rgba(0, 0, 0, 1)",e.borderColour="rgba(255, 255, 255, 0)",e.shapeSelect="square",e.shapes=["square","circle","draw-polygon","paint-brush"],e.modeSelect="normal",e.modes=["normal","reveal","hide"],e.brushSize=vt(Lt.unitSize),e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"onFillChange",value:function(){this.brushHelper&&(this.brushHelper.fillColour=this.fillColour)}},{key:"onModeUpdate",value:function(e,t){this.onModeChange(e,t)}},{key:"setupBrush",value:function(){null!==this.brushHelper&&("reveal"===this.modeSelect||"hide"===this.modeSelect?(this.brushHelper.options.set("preFogShape",!0),this.brushHelper.options.set("skipDraw",!0),this.brushHelper.fillColour="rgba(0, 0, 0, 1)","reveal"===this.modeSelect?this.brushHelper.globalCompositeOperation="source-over":"hide"===this.modeSelect&&(this.brushHelper.globalCompositeOperation="destination-out")):(this.brushHelper.options.delete("preFogShape"),this.brushHelper.options.delete("skipDraw"),this.brushHelper.globalCompositeOperation="source-over",this.brushHelper.fillColour=this.fillColour))}},{key:"onModeChange",value:function(e,t){if(null!==this.brushHelper){var i=It.getLayer("fow"),n=It.getLayer();void 0!==i&&void 0!==n&&(this.setupBrush(),"normal"!==e&&"normal"===t?(n.removeShape(this.brushHelper,!1),i.addShape(this.brushHelper,!1)):"normal"===e&&"normal"!==t&&(n.addShape(this.brushHelper,!1),i.removeShape(this.brushHelper,!1)))}}},{key:"getLayer",value:function(){return"normal"===this.modeSelect?It.getLayer():It.getLayer("fow")}},{key:"onMouseDown",value:function(e){var t=this.getLayer();if(void 0!==t){if(this.active)null!==this.shape&&this.shape instanceof Bi&&this.shape._vertices.push(pt(kt(e)));else{switch(this.startPoint=pt(kt(e)),this.active=!0,this.shapeSelect){case"square":this.shape=new $i(this.startPoint.clone(),0,0,this.fillColour,this.borderColour);break;case"circle":this.shape=new Ri(this.startPoint.clone(),this.helperSize,this.fillColour,this.borderColour);break;case"paint-brush":this.shape=new Fi(this.startPoint.clone(),[],this.brushSize),this.shape.fillColour=this.fillColour;break;case"draw-polygon":this.shape=new Bi(this.startPoint.clone(),[],this.fillColour,this.borderColour);break;default:return}"normal"!==this.modeSelect&&(this.shape.options.set("preFogShape",!0),this.shape.options.set("skipDraw",!0),this.shape.fillColour="rgba(0, 0, 0, 1)"),"reveal"===this.modeSelect?this.shape.globalCompositeOperation="source-over":"hide"===this.modeSelect&&(this.shape.globalCompositeOperation="destination-out"),this.shape.addOwner(Lt.username),"fow"===t.name&&"normal"===this.modeSelect&&(this.shape.visionObstruction=!0),t.addShape(this.shape,!0,!1,!1),this.pushBrushBack()}if(null!==this.shape&&this.shape instanceof Bi){var i=pt(kt(e));null===this.ruler?(this.ruler=new Ui(i,i,3,"black"),t.addShape(this.ruler,!1)):(this.ruler.refPoint=i,this.ruler.endPoint=i),this.shape.visionObstruction&&Li.vision.insertConstraint(this.shape.points[this.shape.points.length-2],this.shape.points[this.shape.points.length-1]),t.invalidate(!1),Je.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!0})}}else console.log("No active layer!")}},{key:"onMouseMove",value:function(e){var t=pt(kt(e)),i=this.getLayer();if(void 0!==i){if(null!==this.brushHelper&&(this.brushHelper.r=this.helperSize,this.brushHelper.refPoint=t,this.active||i.invalidate(!1)),this.active&&null!==this.startPoint&&null!==this.shape){switch(this.shapeSelect){case"square":var n=this.shape,a=Math.abs(t.x-this.startPoint.x),r=Math.abs(t.y-this.startPoint.y);if(a===n.w&&r===n.h)return;n.w=a,n.h=r,(t.x<this.startPoint.x||t.y<this.startPoint.y)&&(this.shape.refPoint=new at(Math.min(this.startPoint.x,t.x),Math.min(this.startPoint.y,t.y)));break;case"circle":var s=this.shape,o=t.subtract(this.startPoint).length();if(s.r===o)return;s.r=o;break;case"paint-brush":var l=this.shape;if(St(l.points[l.points.length-1],[t.x,t.y]))return;l._points.push(t);break;case"draw-polygon":this.ruler.endPoint=t;break}this.shape instanceof Bi||(Je.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!0}),this.shape.visionObstruction&&(this.shape.triagVertices.length>1&&Ci.deleteFromTriag({target:_i.VISION,shape:this.shape,standalone:!1}),Ci.addToTriag({target:_i.VISION,shape:this.shape}))),i.invalidate(!1)}}else console.log("No active layer!")}},{key:"onMouseUp",value:function(e){!this.active||null===this.shape||this.shape instanceof Bi||(!e.altKey&&this.useGrid&&(Ci.deleteFromTriag({target:_i.VISION,shape:this.shape,standalone:!1}),this.shape.resizeToGrid(),Ci.addToTriag({target:_i.VISION,shape:this.shape})),this.finaliseShape())}},{key:"onContextMenu",value:function(e){if(this.active&&null!==this.shape&&this.shape instanceof Bi){var t=this.getLayer();void 0!==t?(t.removeShape(this.ruler,!1),this.ruler=null,this.finaliseShape()):console.log("No active layer!")}}},{key:"finaliseShape",value:function(){null!==this.shape&&(this.shape.visionObstruction&&Ci.recalculateVision(),this.shape.movementObstruction&&Ci.recalculateMovement(),Je.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!1}),this.active=!1)}},{key:"onSelect",value:function(){var e=this.getLayer();void 0!==e&&(this.brushHelper=new Ri(new at(-1e3,-1e3),this.brushSize/2,this.fillColour),this.setupBrush(),e.addShape(this.brushHelper,!1))}},{key:"onDeselect",value:function(){var e=this.getLayer();null!==this.brushHelper&&void 0!==e&&e.removeShape(this.brushHelper,!1),this.active&&void 0!==e&&null!==this.shape&&(e.removeShape(this.shape,!0,!1),this.shape=null,this.active=!1,e.invalidate(!1))}},{key:"pushBrushBack",value:function(){var e=this.getLayer();void 0!==e?(null!==this.brushHelper&&e.removeShape(this.brushHelper,!1),this.brushHelper=new Ri(new at(-1e3,-1e3),this.brushSize/2,this.fillColour),this.setupBrush(),e.addShape(this.brushHelper,!1)):console.log("No active layer!")}},{key:"helperSize",get:function(){return"paint-brush"===this.shapeSelect?this.brushSize/2:vt(this.unitSize)/8}},{key:"IS_DM",get:function(){return Lt.IS_DM}},{key:"unitSize",get:function(){return Lt.unitSize}},{key:"useGrid",get:function(){return Lt.useGrid}}]),t}(Wa);k["a"]([Object(K["b"])("fillColour")],Xa.prototype,"onFillChange",null),k["a"]([Object(K["b"])("modeSelect")],Xa.prototype,"onModeUpdate",null),Xa=k["a"]([Object(x["b"])({components:{"color-picker":$n}})],Xa);var Ya=Xa,Ka=Ya,qa=(i("c65f"),Object(s["a"])(Ka,Va,Ua,!1,null,"4e6b5c5e",null)),Qa=qa.exports,Za=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",{attrs:{id:"accordion-container"}},e._l(e.categories,function(t){return i("accordion",{key:t,attrs:{title:""===t?"no category":t,showArrow:!1,items:e.labels[t],initialValues:e.initalValues[t]},on:{selectionupdate:e.updateSelection}})}),1)]):e._e()},Ja=[],er=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"accordion"},[i("div",{attrs:{id:"header"},on:{click:function(t){return t.preventDefault(),e.toggleDisplay(t)}}},[i("input",{ref:"overall",attrs:{type:"checkbox"},on:{click:function(t){return t.stopPropagation(),e.toggleCategory(t)}}}),i("strong",[e._v(e._s(e.title))]),e.showArrow?[i("span",{directives:[{name:"show",rawName:"v-show",value:e.showArrow&&!e.active,expression:"showArrow && !active"}],staticClass:"down-Arrow"},[e._v("")]),i("span",{directives:[{name:"show",rawName:"v-show",value:e.showArrow&&e.active,expression:"showArrow && active"}],staticClass:"up-Arrow"},[e._v("")])]:e._e()],2),i("div",{directives:[{name:"show",rawName:"v-show",value:e.active,expression:"active"}],attrs:{id:"body"}},e._l(e.items,function(t){return i("div",{key:t[0],staticClass:"item",on:{click:function(i){return e.toggleSelection(t[0])}}},[i("input",{attrs:{type:"checkbox"},domProps:{checked:e.selected.includes(t[0])},on:{click:function(e){e.preventDefault()}}}),e._v("\n            "+e._s(t[1])+"\n        ")])}),0)])},tr=[],ir=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.selected=[],e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){this.selected=this.initialValues,this.updateCategory()}},{key:"toggleDisplay",value:function(e){this.active=!this.active}},{key:"toggleCategory",value:function(){var e=this.$refs.overall;e.checked?this.selected=this.items.map(function(e){return e[0]}):this.selected=[],this.$emit("selectionupdate",{title:this.title,selection:this.selected})}},{key:"updateCategory",value:function(){var e=this.$refs.overall;0===this.selected.length?(e.checked=!1,e.indeterminate=!1):this.selected.length===this.items.length?(e.checked=!0,e.indeterminate=!1):(e.checked=!1,e.indeterminate=!0)}},{key:"toggleSelection",value:function(e){var t=this.selected.indexOf(e);-1===t?this.selected.push(e):this.selected.splice(t,1),this.updateCategory(),this.$emit("selectionupdate",{title:this.title,selection:this.selected})}}]),t}(n["default"]);k["a"]([Object(K["a"])(String)],ir.prototype,"title",void 0),k["a"]([Object(K["a"])({default:!0,type:Boolean})],ir.prototype,"showArrow",void 0),k["a"]([Object(K["a"])({default:function(){return[]}})],ir.prototype,"items",void 0),k["a"]([Object(K["a"])({default:function(){return[]}})],ir.prototype,"initialValues",void 0),ir=k["a"]([x["b"]],ir);var nr=ir,ar=nr,rr=(i("aa79"),Object(s["a"])(ar,er,tr,!1,null,"32e257d0",null)),sr=rr.exports,or=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Filter",e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"isFilter",value:function(e){return Lt.labelFilters.includes(e)}},{key:"toggleFilter",value:function(e){var t=Lt.labelFilters.indexOf(e);t>=0?Lt.labelFilters.splice(t,1):Lt.labelFilters.push(e),It.invalidate()}},{key:"toggleUnlabeled",value:function(){Lt.toggleUnlabeledFilter(),It.invalidate()}},{key:"updateSelection",value:function(e){if(e.title in this.labels){var t=!0,i=!1,n=void 0;try{for(var a,r=this.labels[e.title][Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=Object(Mt["a"])(a.value,2),o=s[0],l=(s[1],Lt.labelFilters.indexOf(o)),u=e.selection.includes(o);l>=0&&!u?(Lt.labelFilters.splice(l,1),Je.emit("Labels.Filter.Remove",o)):l<0&&u&&(Lt.labelFilters.push(o),Je.emit("Labels.Filter.Add",o))}}catch(c){i=!0,n=c}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}It.invalidate()}}},{key:"labels",get:function(){for(var e={"":[]},t=0,i=Object.keys(Lt.labels);t<i.length;t++){var n=i[t],a=Lt.labels[n];a.category?(a.category in e||(e[a.category]=[]),e[a.category].push([a.uuid,a.name]),e[a.category].sort(function(e,t){return e[1].localeCompare(t[1])})):e[""].push([a.uuid,a.name])}return e}},{key:"initalValues",get:function(){for(var e=this,t={},i=function(){var i=a[n];t[i]=Lt.labelFilters.filter(function(t){return e.labels[i].map(function(e){return e[0]}).includes(t)})},n=0,a=Object.keys(this.labels);n<a.length;n++)i();return t}},{key:"categories",get:function(){return Object.keys(this.labels).sort()}}]),t}(Wa);or=k["a"]([Object(x["b"])({components:{accordion:sr}})],or);var lr=or,ur=lr,cr=(i("e3f5"),i("4a14"),Object(s["a"])(ur,Za,Ja,!1,null,"75b63661",null)),hr=cr.exports,dr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",[e._v("#X")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.xCount,expression:"xCount"}],attrs:{type:"text"},domProps:{value:e.xCount},on:{input:function(t){t.target.composing||(e.xCount=t.target.value)}}}),i("div",[e._v("#Y")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.yCount,expression:"yCount"}],attrs:{type:"text"},domProps:{value:e.yCount},on:{input:function(t){t.target.composing||(e.yCount=t.target.value)}}})]):e._e()},vr=[],fr=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Map",e.active=!1,e.xCount=3,e.yCount=3,e.startPoint=null,e.rect=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"onMouseDown",value:function(e){var t=It.getLayer();void 0!==t?(this.active=!0,this.startPoint=pt(kt(e)),this.rect=new $i(this.startPoint.clone(),0,0,"rgba(0,0,0,0)","black"),t.addShape(this.rect,!1,!1)):console.log("No active layer!")}},{key:"onMouseMove",value:function(e){if(this.active&&null!==this.rect&&null!==this.startPoint){var t=It.getLayer();if(void 0!==t){var i=pt(kt(e));this.rect.w=Math.abs(i.x-this.startPoint.x),this.rect.h=Math.abs(i.y-this.startPoint.y),this.rect.refPoint=new at(Math.min(this.startPoint.x,i.x),Math.min(this.startPoint.y,i.y)),t.invalidate(!1)}else console.log("No active layer!")}}},{key:"onMouseUp",value:function(e){if(this.active&&null!==this.rect){var t=It.getLayer();if(void 0!==t)if(this.active=!1,1===t.selection.length){var i=this.rect.w,n=this.rect.h,a=t.selection[0];a instanceof Ni&&(a.w*=this.xCount*Lt.gridSize/i,a.h*=this.yCount*Lt.gridSize/n),t.removeShape(this.rect,!1,!1)}else t.removeShape(this.rect,!1,!1);else console.log("No active layer!")}}}]),t}(Wa);fr=k["a"]([x["b"]],fr);var pr=fr,yr=pr,gr=Object(s["a"])(yr,dr,vr,!1,null,null,null),mr=gr.exports,br=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Pan",e.panStart=new rt(0,0),e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"onMouseDown",value:function(e){this.panStart=kt(e),this.active=!0}},{key:"onMouseMove",value:function(e){if(this.active){var t=kt(e),i=t.subtract(this.panStart).multiply(1/Lt.zoomFactor);Lt.increasePanX(Math.round(i.x)),Lt.increasePanY(Math.round(i.y)),this.panStart=t,It.invalidate()}}},{key:"onMouseUp",value:function(e){this.active=!1,lt(Lt.locationOptions)}}]),t}(Wa);br=k["a"]([x["b"]],br);var wr=br,kr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("SelectContext",{ref:"selectcontext"})},xr=[],Or=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContextMenu",{attrs:{visible:e.visible,left:e.x+"px",top:e.y+"px"},on:{close:e.close}},[e.IS_DM?i("li",{on:{click:e.bringPlayers}},[e._v("Bring players")]):e._e(),i("li",{on:{click:e.createToken}},[e._v("Create basic token")]),i("li",{on:{click:e.showInitiative}},[e._v("Show initiative")])])},Sr=[],_r=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.x=0,e.y=0,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"open",value:function(e){var t=this;this.visible=!0,this.x=e.pageX,this.y=e.pageY,this.$nextTick(function(){return t.$children[0].$el.focus()})}},{key:"close",value:function(){this.visible=!1}},{key:"bringPlayers",value:function(){Lt.IS_DM&&(Je.emit("Players.Bring",{x:yt(this.x),y:gt(this.y)}),this.close())}},{key:"createToken",value:function(){this.$parent.$parent.$refs.createtokendialog.open(this.x,this.y),this.close()}},{key:"showInitiative",value:function(){tt.$emit("Initiative.Show"),this.close()}},{key:"IS_DM",get:function(){return Lt.IS_DM}}]),t}(n["default"]);_r=k["a"]([Object(x["b"])({components:{ContextMenu:T}})],_r);var Cr,Lr=_r,Er=Lr,Ir=(i("9c0f"),Object(s["a"])(Er,Or,Sr,!1,null,"7983fcf6",null)),jr=Ir.exports;(function(e){e[e["Noop"]=0]="Noop",e[e["Resize"]=1]="Resize",e[e["Drag"]=2]="Drag",e[e["GroupSelect"]=3]="GroupSelect"})(Cr||(Cr={}));var Tr=new at(-1e3,-1e3),Mr=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Select",e.showContextMenu=!1,e.active=!1,e.mode=Cr.Noop,e.resizePoint=0,e.deltaChanged=!1,e.dragRay=new ot(new rt(0,0),new st(0,0)),e.selectionStartPoint=Tr,e.selectionHelper=new $i(Tr,0,0),e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"created",value:function(){this.selectionHelper.globalCompositeOperation="source-over",Lt.setSelectionHelperId(this.selectionHelper.uuid)}},{key:"onMouseDown",value:function(e){var t=It.getLayer();if(void 0!==t){this.selectionHelper.owners.includes(Lt.username)||this.selectionHelper.addOwner(Lt.username);var i,n=kt(e),a=pt(n),r=!1;i=t.selection.length?t.shapes.concat(t.selection):t.shapes;for(var s=i.length-1;s>=0;s--){var o=i[s];if(this.resizePoint=o.getPointIndex(a,mt(3)),this.resizePoint>=0){t.selection=[o],tt.$emit("SelectionInfo.Shape.Set",o),this.mode=Cr.Resize,t.invalidate(!0),r=!0;break}if(o.contains(a)){var l=o;-1===t.selection.indexOf(l)&&(t.selection=[l],tt.$emit("SelectionInfo.Shape.Set",l)),this.mode=Cr.Drag;var u=ut(l.refPoint);this.dragRay=new ot(u,n.subtract(u)),t.invalidate(!0),r=!0;break}}if(!r){this.mode=Cr.GroupSelect;var c=!0,h=!1,d=void 0;try{for(var v,f=t.selection[Symbol.iterator]();!(c=(v=f.next()).done);c=!0){var p=v.value;tt.$emit("SelectionInfo.Shape.Set",p)}}catch(y){h=!0,d=y}finally{try{c||null==f.return||f.return()}finally{if(h)throw d}}this.selectionStartPoint=a,this.selectionHelper.refPoint=this.selectionStartPoint,this.selectionHelper.w=0,this.selectionHelper.h=0,t.selection=[this.selectionHelper],t.invalidate(!0)}this.active=!0}else console.log("No active layer!")}},{key:"onMouseMove",value:function(e){var t=It.getLayer();if(void 0!==t){var i=kt(e),n=pt(i);if(this.deltaChanged=!1,this.mode===Cr.GroupSelect){var a=n;this.selectionHelper.w=Math.abs(a.x-this.selectionStartPoint.x),this.selectionHelper.h=Math.abs(a.y-this.selectionStartPoint.y),this.selectionHelper.refPoint=new at(Math.min(this.selectionStartPoint.x,a.x),Math.min(this.selectionStartPoint.y,a.y)),t.invalidate(!0)}else if(t.selection.length){var r=ut(t.selection[t.selection.length-1].refPoint),s=r.add(this.dragRay.direction),o=i.subtract(s).multiply(1/Lt.zoomFactor),l=o;if(this.mode===Cr.Drag){if(0===l.length())return;if("tokens"===t.name&&(!e.shiftKey||!Lt.IS_DM)){var u=!0,c=!1,h=void 0;try{for(var d,v=t.selection[Symbol.iterator]();!(u=(d=v.next()).done);u=!0){var f=d.value;f.ownedBy()&&(f.uuid!==this.selectionHelper.uuid&&(o=Pi(o,f),o!==l&&(this.deltaChanged=!0)))}}catch(L){c=!0,h=L}finally{try{u||null==v.return||v.return()}finally{if(c)throw h}}}var p=!0,y=!1,g=void 0;try{for(var m,b=t.selection[Symbol.iterator]();!(p=(m=b.next()).done);p=!0){var w=m.value;w.ownedBy()&&(w.visionObstruction&&Ci.deleteFromTriag({target:_i.VISION,shape:w,standalone:!1}),w.refPoint=w.refPoint.add(o),w.visionObstruction&&Ci.addToTriag({target:_i.VISION,shape:w}),w!==this.selectionHelper&&Je.emit("Shape.Update",{shape:w.asDict(),redraw:!0,temporary:!0}))}}catch(L){y=!0,g=L}finally{try{p||null==b.return||b.return()}finally{if(y)throw g}}t.invalidate(!1)}else if(this.mode===Cr.Resize){var k=!0,x=!1,O=void 0;try{for(var S,_=t.selection[Symbol.iterator]();!(k=(S=_.next()).done);k=!0){var C=S.value;C.ownedBy()&&(C.visionObstruction&&Ci.deleteFromTriag({target:_i.VISION,shape:C,standalone:!1}),C.resize(this.resizePoint,i),C!==this.selectionHelper&&(C.visionObstruction&&Ci.addToTriag({target:_i.VISION,shape:C}),Je.emit("Shape.Update",{shape:C.asDict(),redraw:!0,temporary:!0})),t.invalidate(!1),this.updateCursor(t,n))}}catch(L){x=!0,O=L}finally{try{k||null==_.return||_.return()}finally{if(x)throw O}}}else this.updateCursor(t,n)}else document.body.style.cursor="default"}else console.log("No active layer!")}},{key:"onMouseUp",value:function(e){var t=this;if(this.active)if(void 0!==It.getLayer()){var i=It.getLayer();this.mode===Cr.GroupSelect?(i.clearSelection(),i.shapes.forEach(function(e){if(e.ownedBy()&&e!==t.selectionHelper){var n=e.getBoundingBox();e.ownedBy()&&t.selectionHelper.refPoint.x<=n.topRight.x&&t.selectionHelper.refPoint.x+t.selectionHelper.w>=n.topLeft.x&&t.selectionHelper.refPoint.y<=n.botLeft.y&&t.selectionHelper.refPoint.y+t.selectionHelper.h>=n.topLeft.y&&i.selection.push(e)}}),i.selection.length>0&&i.selection.push(this.selectionHelper),i.invalidate(!0)):i.selection.length&&i.selection.forEach(function(n){if(n.ownedBy()){if(t.mode===Cr.Drag){if(t.dragRay.origin.x===ct(n.refPoint.x)&&t.dragRay.origin.y===ht(n.refPoint.y))return;!Lt.useGrid||e.altKey||t.deltaChanged||(n.visionObstruction&&Ci.deleteFromTriag({target:_i.VISION,shape:n,standalone:!1}),n.movementObstruction&&Ci.deleteFromTriag({target:_i.MOVEMENT,shape:n,standalone:!1}),n.snapToGrid(),n.visionObstruction&&Ci.addToTriag({target:_i.VISION,shape:n}),n.movementObstruction&&Ci.addToTriag({target:_i.MOVEMENT,shape:n})),n!==t.selectionHelper&&Je.emit("Shape.Update",{shape:n.asDict(),redraw:!0,temporary:!1}),i.invalidate(!1)}t.mode===Cr.Resize&&(Lt.useGrid&&!e.altKey&&(n.visionObstruction&&Ci.deleteFromTriag({target:_i.VISION,shape:n,standalone:!1}),n.movementObstruction&&Ci.deleteFromTriag({target:_i.MOVEMENT,shape:n,standalone:!1}),n.snapToGrid(),n.visionObstruction&&Ci.addToTriag({target:_i.VISION,shape:n}),n.visionObstruction&&Ci.addToTriag({target:_i.VISION,shape:n})),n!==t.selectionHelper&&Je.emit("Shape.Update",{shape:n.asDict(),redraw:!0,temporary:!1}),i.invalidate(!1))}}),this.mode=Cr.Noop,this.active=!1}else console.log("No active layer!")}},{key:"onContextMenu",value:function(e){if(void 0!==It.getLayer()){var t=It.getLayer(),i=kt(e),n=pt(i),a=!0,r=!1,s=void 0;try{for(var o,l=t.selection[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value;if(u.contains(n)&&u!==this.selectionHelper)return t.selection=[u],tt.$emit("SelectionInfo.Shape.Set",u),t.invalidate(!0),void this.$parent.$refs.shapecontext.open(e,u)}}catch(c){r=!0,s=c}finally{try{a||null==l.return||l.return()}finally{if(r)throw s}}this.$refs.selectcontext.open(e)}else console.log("No active layer!")}},{key:"updateCursor",value:function(e,t){var i=!0,n=!1,a=void 0;try{for(var r,s=e.selection[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var o=r.value,l=o.getPointIndex(t,mt(3));if(l<0)document.body.style.cursor="default";else{var u=o.getPointOrientation(l).angle();u<0&&(u+=360);var c=22.5;(u>=315+c||u<c||u>=135+c&&u<225-c)&&(document.body.style.cursor="ew-resize"),(u>=45+c&&u<135-c||u>=225+c&&u<315-c)&&(document.body.style.cursor="ns-resize"),(u>=c&&u<90-c||u>=180+c&&u<270-c)&&(document.body.style.cursor="nwse-resize"),(u>=90+c&&u<180-c||u>=270+c&&u<360-c)&&(document.body.style.cursor="nesw-resize")}}}catch(h){n=!0,a=h}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}}}]),t}(Wa);Mr=k["a"]([Object(x["b"])({components:{SelectContext:jr}})],Mr);var Pr=Mr,Dr=Pr,Nr=Object(s["a"])(Dr,kr,xr,!1,null,null,null),Ar=Nr.exports,Rr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},e._l(e.tokens,function(t){return i("div",{key:t.uuid,staticClass:"token",class:{selected:e.selection.includes(t.uuid)},on:{click:function(i){return e.toggle(t.uuid)}}},[t.src?i("img",{attrs:{src:t.src,width:"30px",height:"30px"}}):e._e(),i("div",[e._v(e._s(t.name))])])}),0):e._e()},Vr=[],Ur=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Vision",e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"toggle",value:function(e){this.selection.includes(e)?Lt.removeActiveToken(e):Lt.addActiveToken(e)}},{key:"selection",get:function(){return Lt.activeTokens}},{key:"tokens",get:function(){return Lt.ownedtokens.map(function(e){return It.UUIDMap.get(e)})}}]),t}(Wa);Ur=k["a"]([x["b"]],Ur);var Fr=Ur,$r=Fr,zr=(i("7392"),Object(s["a"])($r,Rr,Vr,!1,null,"f995dfd4",null)),Br=zr.exports,Hr=(i("0b21"),function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Ruler",e.active=!1,e.startPoint=null,e.ruler=null,e.text=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"onMouseDown",value:function(e){var t=It.getLayer("draw");void 0!==t?(this.active=!0,this.startPoint=pt(kt(e)),this.ruler=new Ui(this.startPoint,this.startPoint,3,Lt.rulerColour),this.text=new zi(this.startPoint.clone(),"","bold 20px serif"),this.ruler.addOwner(Lt.username),this.text.addOwner(Lt.username),t.addShape(this.ruler,!0,!0),t.addShape(this.text,!0,!0)):console.log("No draw layer!")}},{key:"onMouseMove",value:function(e){if(this.active&&null!==this.ruler&&null!==this.startPoint&&null!==this.text){var t=It.getLayer("draw");if(void 0!==t){var i=pt(kt(e));this.ruler.endPoint=i,Je.emit("Shape.Update",{shape:this.ruler.asDict(),redraw:!0,temporary:!0});var n=Math.sign(i.x-this.startPoint.x)*Math.sign(i.y-this.startPoint.y),a=Math.abs(i.x-this.startPoint.x),r=Math.abs(i.y-this.startPoint.y),s=Math.round(Math.sqrt(Math.pow(a,2)+Math.pow(r,2))*Lt.unitSize/Lt.gridSize)+" ft",o=Math.atan2(n*r,a),l=Math.min(this.startPoint.x,i.x)+a/2,u=Math.min(this.startPoint.y,i.y)+r/2;this.text.refPoint=new at(l,u),this.text.text=s,this.text.angle=o,Je.emit("Shape.Update",{shape:this.text.asDict(),redraw:!0,temporary:!0}),t.invalidate(!0)}else console.log("No draw layer!")}}},{key:"onMouseUp",value:function(e){if(this.active&&null!==this.ruler&&null!==this.startPoint&&null!==this.text){var t=It.getLayer("draw");void 0!==t?(this.active=!1,t.removeShape(this.ruler,!0,!0),t.removeShape(this.text,!0,!0),t.invalidate(!0),this.ruler=this.startPoint=this.text=null):console.log("No active layer!")}}}]),t}(Wa));Hr=k["a"]([x["b"]],Hr);var Gr=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.currentTool="Select",e.tools=["Select","Pan","Draw","Ruler","Map","Filter","Vision"],e.dmTools=["Map"],e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"toolVisible",value:function(e){return"Filter"===e?Object.keys(Lt.labels).length>0:"Vision"!==e||Lt.ownedtokens.length>1}},{key:"mousedown",value:function(e){if("CANVAS"===e.target.tagName){var t=this.currentTool;if(1===e.button)t="Pan";else if(0!==e.button)return;this.$emit("mousedown",e,t)}}},{key:"mouseup",value:function(e){if("CANVAS"===e.target.tagName){var t=this.currentTool;if(1===e.button)t="Pan";else if(0!==e.button)return;this.$emit("mouseup",e,t)}}},{key:"mousemove",value:function(e){if("CANVAS"===e.target.tagName){var t=this.currentTool;if(0!==(4&e.buttons))t="Pan";else if((1&e.button)>1)return;this.$emit("mousemove",e,t);var i=!1,n=!0,a=!1,r=void 0;try{for(var s,o=Lt.annotations[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var l=s.value;if(It.UUIDMap.has(l)&&It.hasLayer("draw")){var u=It.UUIDMap.get(l);u.contains(pt(kt(e)))&&(i=!0,vn.annotationManager.setActiveText(u.annotation))}}}catch(c){a=!0,r=c}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}!i&&vn.annotationManager.shown&&vn.annotationManager.setActiveText("")}}},{key:"mouseleave",value:function(e){0!==(1&e.buttons)&&this.$emit("mouseup",e,this.currentTool)}},{key:"contextmenu",value:function(e){"CANVAS"===e.target.tagName&&2===e.button&&"CANVAS"===e.target.tagName&&this.$emit("contextmenu",e,this.currentTool)}},{key:"IS_DM",get:function(){return Lt.IS_DM}},{key:"currentToolComponent",get:function(){return"".concat(this.currentTool.toLowerCase(),"-tool")}},{key:"visibleTools",get:function(){var e=this;return this.tools.filter(function(t){return!e.dmTools.includes(t)||e.IS_DM})}}]),t}(n["default"]);Gr=k["a"]([Object(x["b"])({components:{"select-tool":Ar,"pan-tool":wr,"draw-tool":Qa,"ruler-tool":Hr,"map-tool":mr,"filter-tool":hr,"vision-tool":Br,"shape-menu":ja,"createtoken-dialog":Ra},watch:{currentTool:function(e,t){this.$emit("tools-select-change",e,t)}}})],Gr);var Wr=Gr,Xr=Wr,Yr=(i("4612"),Object(s["a"])(Xr,ka,xa,!1,null,"4302f32a",null)),Kr=Yr.exports;function qr(e){if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)&&("Delete"===e.key||"Del"===e.key||"Backspace"===e.key)){if(void 0===It.getLayer)return void console.log("No active layer selected for delete operation");for(var t=It.getLayer(),i=t.selection.length-1;i>=0;i--){var n=t.selection[i];Lt.selectionHelperID!==n.uuid?(t.removeShape(n,!0,!1),tt.$emit("SelectionInfo.Shape.Set",null),tt.$emit("Initiative.Remove",n.uuid)):t.selection.splice(i,1)}}}function Qr(e){if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)65===e.keyCode&&e.ctrlKey&&e.target.select();else if(e.keyCode>=37&&e.keyCode<=40){var t=Math.round(Lt.gridSize),i=t*(e.keyCode%2),n=t*(e.keyCode%2?0:1);if(It.hasSelection()){var a=It.getSelection();i*=e.keyCode<=38?-1:1,n*=e.keyCode<=38?-1:1;var r=new st(i,n);if(!e.shiftKey||!Lt.IS_DM){var s=!0,o=!1,l=void 0;try{for(var u,c=a[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){var h=u.value;Lt.selectionHelperID!==h.uuid&&(r=Pi(r,h))}}catch(Q){o=!0,l=Q}finally{try{s||null==c.return||c.return()}finally{if(o)throw l}}}if(0===r.length())return;var d=!0,v=!1,f=void 0;try{for(var p,y=a[Symbol.iterator]();!(d=(p=y.next()).done);d=!0){var g=p.value;Lt.selectionHelperID!==g.uuid&&(g.movementObstruction&&Ci.deleteFromTriag({target:_i.MOVEMENT,shape:g,standalone:!1}),g.visionObstruction&&Ci.deleteFromTriag({target:_i.VISION,shape:g,standalone:!1}),g.refPoint=g.refPoint.add(r),g.movementObstruction&&Ci.addToTriag({target:_i.MOVEMENT,shape:g}),g.visionObstruction&&Ci.addToTriag({target:_i.VISION,shape:g}),Je.emit("Shape.Position.Update",{shape:g.asDict(),redraw:!0,temporary:!1}))}}catch(Q){v=!0,f=Q}finally{try{d||null==y.return||y.return()}finally{if(v)throw f}}It.getLayer().invalidate(!1)}else Lt.increasePanX(i*(e.keyCode<=38?1:-1)),Lt.increasePanY(n*(e.keyCode<=38?1:-1)),It.invalidate(),lt(Lt.locationOptions)}else if(68===e.keyCode){var m=It.getLayer();m&&(m.clearSelection(),m.invalidate(!0))}else if("u"===e.key&&e.ctrlKey)e.preventDefault(),e.stopPropagation(),Lt.toggleUI();else if("c"===e.key&&e.ctrlKey){var b=It.getLayer();if(!b)return;if(!b.selection)return;var w=[],k=!0,x=!1,O=void 0;try{for(var S,_=b.selection[Symbol.iterator]();!(k=(S=_.next()).done);k=!0){var C=S.value;Lt.selectionHelperID!==C.uuid&&w.push(C.asDict())}}catch(Q){x=!0,O=Q}finally{try{k||null==_.return||_.return()}finally{if(x)throw O}}Lt.setClipboard(w)}else if("v"===e.key&&e.ctrlKey){var L=It.getLayer();if(!L)return;if(!Lt.clipboard)return;L.selection=[];var E=!0,I=!1,j=void 0;try{for(var T,M=Lt.clipboard[Symbol.iterator]();!(E=(T=M.next()).done);E=!0){var P=T.value;P.x+=10,P.y+=10,P.uuid=ve();var D=P.trackers;P.trackers=[];var N=!0,A=!1,R=void 0;try{for(var V,U=D[Symbol.iterator]();!(N=(V=U.next()).done);N=!0){var F=V.value,$=Object.assign({},F,{uuid:ve()});P.trackers.push($)}}catch(Q){A=!0,R=Q}finally{try{N||null==U.return||U.return()}finally{if(A)throw R}}var z=P.auras;P.auras=[];var B=!0,H=!1,G=void 0;try{for(var W,X=z[Symbol.iterator]();!(B=(W=X.next()).done);B=!0){var Y=W.value,K=Object.assign({},Y,{uuid:ve()});P.auras.push(K)}}catch(Q){H=!0,G=Q}finally{try{B||null==X.return||X.return()}finally{if(H)throw G}}var q=Hi(P);void 0!==q&&(L.addShape(q,!0),L.selection.push(q))}}catch(Q){I=!0,j=Q}finally{try{E||null==M.return||M.return()}finally{if(I)throw j}}1===L.selection.length?tt.$emit("SelectionInfo.Shape.Set",L.selection[0]):tt.$emit("SelectionInfo.Shape.Set",null),L.invalidate(!1)}}function Zr(e){var t;e.target&&e.target.tagName&&"CANVAS"===e.target.tagName&&(t=-1*Math.sign(e.deltaY),Lt.updateZoom({newZoomDisplay:Lt.zoomDisplay-.1*t,zoomLocation:pt(kt(e))}))}var Jr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,colour:"rgba(255, 255, 255, 0.8)",mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("DM Settings")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body",on:{click:e.handleClick}},[i("div",{attrs:{id:"categories"}},e._l(e.categories,function(t,n){return i("div",{key:t,staticClass:"category",class:{selected:e.selection===n},on:{click:function(t){e.selection=n}}},[e._v("\n                "+e._s(t)+"\n            ")])}),0),i("div",{directives:[{name:"show",rawName:"v-show",value:0===e.selection,expression:"selection === 0"}],staticClass:"panel"},[i("div",{staticClass:"spanrow header"},[e._v("Players")]),e._l(e.$store.state.game.players,function(t){return i("div",{key:t.id,staticClass:"row smallrow"},[i("div",[e._v(e._s(t.name))]),i("div",[i("div",{on:{click:function(i){return e.kickPlayer(t.id)}}},[e._v("Kick")])])])}),0===Object.values(e.$store.state.game.players).length?i("div",{staticClass:"row smallrow"},[i("div",{staticClass:"spanrow"},[e._v("There are no players yet, invite some using the link below!")])]):e._e(),i("div",{staticClass:"spanrow header"},[e._v("Invitecode")]),i("div",{staticClass:"row"},[i("div",[e._v("Invitation URL:")]),e.showRefreshState?[i("InputCopyElement",{attrs:{value:e.refreshState}})]:[i("InputCopyElement",{attrs:{value:e.invitationUrl}})]],2),i("div",{staticClass:"row",on:{click:e.refreshInviteCode}},[i("div"),i("div",[i("button",[e._v("Refresh invitation code")])])]),i("div",{staticClass:"spanrow header"},[e._v("DangerZone")]),i("div",{staticClass:"row"},[i("div",[e.locked?[e._v("\n                        Unlock\n                    ")]:[e._v("\n                        Lock\n                    ")],e._v("\n                    Session\n                    "),i("i",[e._v("(DM access only)")])],2),i("div",[i("button",{staticClass:"danger",on:{click:e.toggleSessionLock}},[e.locked?[e._v("\n                            Unlock\n                        ")]:[e._v("\n                            Lock\n                        ")],e._v("\n                        this Session\n                    ")],2)])]),i("div",{staticClass:"row"},[i("div",[e._v("Remove Session")]),i("div",[i("button",{staticClass:"danger",on:{click:e.deleteSession}},[e._v("Delete this Session")])])])],2),i("div",{directives:[{name:"show",rawName:"v-show",value:1===e.selection,expression:"selection === 1"}],staticClass:"panel"},[i("div",{staticClass:"row"},[i("label",{attrs:{for:"useGridInput"}},[e._v("Use grid")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.useGrid,expression:"useGrid"}],attrs:{id:"useGridInput",type:"checkbox"},domProps:{checked:Array.isArray(e.useGrid)?e._i(e.useGrid,null)>-1:e.useGrid},on:{change:function(t){var i=e.useGrid,n=t.target,a=!!n.checked;if(Array.isArray(i)){var r=null,s=e._i(i,r);n.checked?s<0&&(e.useGrid=i.concat([r])):s>-1&&(e.useGrid=i.slice(0,s).concat(i.slice(s+1)))}else e.useGrid=a}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"gridSizeInput"}},[e._v("Grid Size (in pixels):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.gridSize,expression:"gridSize",modifiers:{number:!0}}],attrs:{id:"gridSizeInput",type:"number",min:"0"},domProps:{value:e.gridSize},on:{input:function(t){t.target.composing||(e.gridSize=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"unitSizeInput"}},[e._v("Unit Size (in ft.):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.unitSize,expression:"unitSize",modifiers:{number:!0}}],attrs:{id:"unitSizeInput",type:"number"},domProps:{value:e.unitSize},on:{input:function(t){t.target.composing||(e.unitSize=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:2===e.selection,expression:"selection === 2"}],staticClass:"panel"},[i("div",{staticClass:"spanrow header"},[e._v("Core")]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fakePlayerInput"}},[e._v("Fake player:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fakePlayer,expression:"fakePlayer"}],attrs:{id:"fakePlayerInput",type:"checkbox"},domProps:{checked:Array.isArray(e.fakePlayer)?e._i(e.fakePlayer,null)>-1:e.fakePlayer},on:{change:function(t){var i=e.fakePlayer,n=t.target,a=!!n.checked;if(Array.isArray(i)){var r=null,s=e._i(i,r);n.checked?s<0&&(e.fakePlayer=i.concat([r])):s>-1&&(e.fakePlayer=i.slice(0,s).concat(i.slice(s+1)))}else e.fakePlayer=a}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"useFOWInput"}},[e._v("Fill entire canvas with FOW:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fullFOW,expression:"fullFOW"}],attrs:{id:"useFOWInput",type:"checkbox"},domProps:{checked:Array.isArray(e.fullFOW)?e._i(e.fullFOW,null)>-1:e.fullFOW},on:{change:function(t){var i=e.fullFOW,n=t.target,a=!!n.checked;if(Array.isArray(i)){var r=null,s=e._i(i,r);n.checked?s<0&&(e.fullFOW=i.concat([r])):s>-1&&(e.fullFOW=i.slice(0,s).concat(i.slice(s+1)))}else e.fullFOW=a}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fowLOS"}},[e._v("Only show lights in LoS:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fowLOS,expression:"fowLOS"}],attrs:{id:"fowLOS",type:"checkbox"},domProps:{checked:Array.isArray(e.fowLOS)?e._i(e.fowLOS,null)>-1:e.fowLOS},on:{change:function(t){var i=e.fowLOS,n=t.target,a=!!n.checked;if(Array.isArray(i)){var r=null,s=e._i(i,r);n.checked?s<0&&(e.fowLOS=i.concat([r])):s>-1&&(e.fowLOS=i.slice(0,s).concat(i.slice(s+1)))}else e.fowLOS=a}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fowOpacity"}},[e._v("FOW opacity:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.fowOpacity,expression:"fowOpacity",modifiers:{number:!0}}],attrs:{id:"fowOpacity",type:"number",min:"0",max:"1",step:"0.1"},domProps:{value:e.fowOpacity},on:{input:function(t){t.target.composing||(e.fowOpacity=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"spanrow header"},[e._v("Advanced")]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"visionMode"}},[e._v("Vision Mode:")]),i("div",[i("select",{attrs:{id:"visionMode"},on:{change:e.changeVisionMode}},[i("option",{domProps:{selected:"bvh"===e.$store.state.visibility.visionMode}},[e._v("BVH")]),i("option",{domProps:{selected:"triangle"===e.$store.state.visibility.visionMode}},[e._v("Triangle")])])])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"vmininp"}},[e._v("Minimal full vision (ft):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:e.visionRangeMin,expression:"visionRangeMin",modifiers:{lazy:!0,number:!0}}],attrs:{id:"vmininp",type:"number",min:"0"},domProps:{value:e.visionRangeMin},on:{change:function(t){e.visionRangeMin=e._n(t.target.value)},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"vmaxinp"}},[e._v("Maximal vision (ft):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:e.visionRangeMax,expression:"visionRangeMax",modifiers:{lazy:!0,number:!0}}],attrs:{id:"vmaxinp",type:"number",min:"0"},domProps:{value:e.visionRangeMax},on:{change:function(t){e.visionRangeMax=e._n(t.target.value)},blur:function(t){return e.$forceUpdate()}}})])])])])])},es=[],ts=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"input-copy"},on:{mouseleave:function(t){e.showPopup=!1}}},[i("input",{attrs:{type:"text",disabled:"disabled",id:"input-element"},domProps:{value:e.value}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showPopup,expression:"showPopup"}],attrs:{id:"show-popup"}},[e._v(e._s(e.popupString))]),i("div",{attrs:{id:"copy-button"},on:{click:e.copy}},[i("i",{staticClass:"far fa-copy"})])])},is=[],ns=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.borderColour="lightgray",e.popupString="",e.showPopup=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"copy",value:function(){var e=this;navigator.clipboard.writeText(this.value).then(function(){e.popupString="Copied!",e.showPopup=!0},function(){console.log("Could not copy to clipboard :("),e.popupString="Error!",e.showPopup=!0})}}]),t}(n["default"]);k["a"]([Object(K["a"])()],ns.prototype,"value",void 0),ns=k["a"]([x["b"]],ns);var as=ns,rs=as,ss=(i("e60f"),Object(s["a"])(rs,ts,is,!1,null,"628dde30",null)),os=ss.exports,ls=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.categories=["Admin","Grid","Vision"],e.selection=0,e.showRefreshState=!1,e.refreshState="pending",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("DmSettings.Open",function(){e.visible=!0}),tt.$on("DmSettings.RefreshedInviteCode",function(){e.showRefreshState=!1})}},{key:"beforeDestroy",value:function(){tt.$off("DmSettings.Open"),tt.$off("DmSettings.RefreshedInviteCode")}},{key:"changeVisionMode",value:function(e){var t=e.target.value.toLowerCase();"bvh"!==t&&"triangle"!==t||(Ci.setVisionMode({mode:t,sync:!0}),Ci.recalculateVision(),Ci.recalculateMovement(),It.invalidate())}},{key:"handleClick",value:function(e){var t=e.target.firstElementChild;t instanceof HTMLInputElement&&t.click()}},{key:"refreshInviteCode",value:function(){Je.emit("Room.Info.InviteCode.Refresh"),this.refreshState="pending",this.showRefreshState=!0}},{key:"kickPlayer",value:function(e){Je.emit("Room.Info.Players.Kick",e),Lt.kickPlayer(e)}},{key:"toggleSessionLock",value:function(){Lt.setIsLocked({isLocked:!Lt.isLocked,sync:!0})}},{key:"deleteSession",value:function(){var e=this;this.$parent.$parent.$refs.prompt.prompt("ENTER ".concat(Lt.roomCreator,"/").concat(Lt.roomName," TO CONFIRM SESSION REMOVAL."),"DELETING SESSION").then(function(t){t==="".concat(Lt.roomCreator,"/").concat(Lt.roomName)&&(Je.emit("Room.Delete"),e.$router.push("/"))},function(){})}},{key:"invitationUrl",get:function(){return window.location.protocol+"//"+window.location.host+"/invite/"+Lt.invitationCode}},{key:"locked",get:function(){return Lt.isLocked}},{key:"useGrid",get:function(){return Lt.useGrid},set:function(e){Lt.setUseGrid({useGrid:e,sync:!0})}},{key:"unitSize",get:function(){return Lt.unitSize},set:function(e){"number"===typeof e&&Lt.setUnitSize({unitSize:e,sync:!0})}},{key:"gridSize",get:function(){return Lt.gridSize},set:function(e){"number"===typeof e&&Lt.setGridSize({gridSize:e,sync:!0})}},{key:"fakePlayer",get:function(){return Lt.FAKE_PLAYER},set:function(e){Lt.setFakePlayer(e)}},{key:"fullFOW",get:function(){return Lt.fullFOW},set:function(e){Lt.setFullFOW({fullFOW:e,sync:!0})}},{key:"fowOpacity",get:function(){return Lt.fowOpacity},set:function(e){"number"===typeof e&&Lt.setFOWOpacity({fowOpacity:e,sync:!0})}},{key:"fowLOS",get:function(){return Lt.fowLOS},set:function(e){Lt.setLineOfSight({fowLOS:e,sync:!0})}},{key:"visionRangeMin",get:function(){return Lt.visionRangeMin},set:function(e){"number"===typeof e&&Lt.setVisionRangeMin({value:e,sync:!0})}},{key:"visionRangeMax",get:function(){return Lt.visionRangeMax},set:function(e){"number"===typeof e&&Lt.setVisionRangeMax({value:e,sync:!0})}}]),t}(n["default"]);ls=k["a"]([Object(x["b"])({components:{InputCopyElement:os,Modal:ee},computed:Object.assign({},Object(N["b"])("game",["invitationCode"]))})],ls);var us=ls,cs=us,hs=(i("559e"),Object(s["a"])(cs,Jr,es,!1,null,"261cc18f",null)),ds=hs.exports,vs=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.ready={manager:!1,tools:!1},e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){window.addEventListener("resize",this.resizeWindow),window.addEventListener("keyup",qr),window.addEventListener("keydown",Qr),this.ready.manager=!0}},{key:"destroyed",value:function(){window.removeEventListener("resize",this.resizeWindow),window.removeEventListener("keyup",qr),window.removeEventListener("keydown",Qr),this.ready.manager=!1}},{key:"zoom",value:function(e){qe()(Zr)(e)}},{key:"resizeWindow",value:function(){It.setWidth(window.innerWidth),It.setHeight(window.innerHeight),It.invalidate()}},{key:"mousedown",value:function(e){this.$refs.tools.mousedown(e)}},{key:"mouseup",value:function(e){this.$refs.tools.mouseup(e)}},{key:"mousemove",value:function(e){this.$refs.tools.mousemove(e)}},{key:"mouseleave",value:function(e){this.$refs.tools.mouseleave(e)}},{key:"contextmenu",value:function(e){this.$refs.tools.contextmenu(e)}},{key:"selectLayer",value:function(e){It.selectLayer(e)}},{key:"drop",value:function(e){if(null!==e&&null!==e.dataTransfer)if(e.dataTransfer.files.length>0)this.$refs.confirm.open("Uploading files should be done through the asset manager.","Ok","").then(function(){},function(){});else{if(""===e.dataTransfer.getData("text/plain"))return;cn(e)}}},{key:"showUI",get:function(){return Lt.showUI}},{key:"IS_DM",get:function(){return Lt.IS_DM}},{key:"FAKE_PLAYER",get:function(){return Lt.FAKE_PLAYER}},{key:"layers",get:function(){return Lt.layers}},{key:"selectedLayer",get:function(){return Lt.selectedLayer}},{key:"zoomDisplay",get:function(){return Lt.zoomDisplay},set:function(e){Lt.updateZoom({newZoomDisplay:e,zoomLocation:pt(new rt(window.innerWidth/2,window.innerHeight/2))})}}]),t}(n["default"]);vs=k["a"]([Object(x["b"])({components:{"tool-bar":Kr,"selection-info":wa,"prompt-dialog":de,"confirm-dialog":re,"menu-bar":Jn,"initiative-dialog":Sn,"zoom-slider":Ze.a,"note-dialog":sa,"label-dialog":Tn,"dm-settings":ds},beforeRouteEnter:function(e,t,i){et(e),i()},beforeRouteLeave:function(e,t,i){Je.disconnect(),i()}})],vs);var fs=vs,ps=fs,ys=(i("561b"),i("d3f9"),Object(s["a"])(ps,Xe,Ye,!1,null,"5bd5872f",null)),gs=ys.exports,ms=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"beforeRouteEnter",value:function(e,t,i){h.a.post("/api/invite",{code:e.params.code}).then(function(e){i({path:e.data.sessionUrl})}).catch(function(e){console.error("Invitation code could not be redeemed"),i({path:"/dashboard"})})}}]),t}(n["default"]);ms=k["a"]([Object(x["b"])({template:""})],ms);var bs=ms;n["default"].use(d["a"]);var ws=new d["a"]({mode:"history",base:"/",routes:[{path:"/",redirect:"/dashboard"},{path:"/_load",name:"load",component:Ue},{path:"/assets",component:ke,meta:{auth:!0}},{path:"/auth",component:{template:"<router-view></router-view>"},children:[{path:"login",component:je},{path:"logout",component:Me}]},{path:"/invite/:code",component:bs,meta:{auth:!0}},{path:"/dashboard",component:We,meta:{auth:!0}},{path:"/game/:creator/:room",component:gs,meta:{auth:!0}}]});ws.beforeEach(function(e,t,i){_e.initialized||"/_load"===e.path?e.matched.some(function(e){return e.meta.auth})&&!_e.authenticated?i({path:"/auth/login",query:{redirect:e.path}}):i():(i({path:"/_load"}),h.a.get("/api/auth").then(function(t){t.data.auth&&(_e.setAuthenticated(!0),_e.setUsername(t.data.username)),_e.setInitialized(!0),ws.push(e.path)}).catch(function(){console.error("Authentication check could not be fulfilled.")}))}),i.d(t,"app",function(){return ks}),n["default"].config.productionTip=!1,n["default"].config.devtools=!0,n["default"].config.performance=!0;var ks=new n["default"]({router:ws,store:A,render:function(e){return e(u)}}).$mount("#app");window.app=ks},d3f9:function(e,t,i){"use strict";var n=i("2777"),a=i.n(n);a.a},d450:function(e,t,i){},d9e0:function(e,t,i){"use strict";var n=i("c098"),a=i.n(n);a.a},e1a0:function(e,t,i){},e3f5:function(e,t,i){"use strict";var n=i("a126"),a=i.n(n);a.a},e60f:function(e,t,i){"use strict";var n=i("c4d5"),a=i.n(n);a.a},fb5d:function(e,t,i){"use strict";var n=i("4315"),a=i.n(n);a.a},fce9:function(e,t,i){},fe11:function(e,t,i){}});
//# sourceMappingURL=app-legacy.84bafd50.js.map