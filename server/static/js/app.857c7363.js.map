{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?4241","webpack:///./src/core/components/modals/prompt.vue?41ec","webpack:///./src/game/ui/tools/tool.vue?dd20","webpack:///./src/game/ui/initiative/initiative.vue?62d5","webpack:///./src/game/ui/tools/createtoken_modal.vue?f318","webpack:///./src/game/ui/menu/asset_node.vue?7b18","webpack:///./src/game/ui/tools/tools.vue?8300","webpack:///./src/game/ui/tools/filter.vue?3d47","webpack:///./src/game/ui/dmsettings.vue?5cef","webpack:///./src/game/game.vue?b594","webpack:///./src/game/ui/note.vue?4863","webpack:///./src/game/ui/menu/menu.vue?08fe","webpack:///./src/core/components/colorpicker.vue?053a","webpack:///./src/core/components/modals/modal.vue?050a","webpack:///./src/game/ui/selection/edit_dialog.vue?cea3","webpack:///./src/game/ui/tools/vision.vue?10d1","webpack:///./src/assetManager/manager.vue?b3da","webpack:///./src/core/components/contextmenu.vue?d01f","webpack:///./src/game/ui/selection/shapecontext.vue?9436","webpack:///./src/game/ui/tools/selectcontext.vue?4198","webpack:///./src/core/components/accordion.vue?69fe","webpack:///./src/game/ui/labels.vue?8b76","webpack:///./src/game/ui/selection/selection_info.vue?109b","webpack:///./src/game/ui/tools/draw.vue?9f6b","webpack:///./src/auth/login.vue?d607","webpack:///./src/App.vue?1b31","webpack:///./src/App.vue","webpack:///./src/assetManager/manager.vue?a6cf","webpack:///./src/assetManager/contextMenu.vue?e682","webpack:///./src/core/components/contextmenu.vue?da21","webpack:///./src/core/components/contextmenu.vue","webpack:///./src/core/components/contextmenu.vue?dc0c","webpack:///./src/core/components/contextmenu.vue?d522","webpack:///./src/store.ts","webpack:///./src/assetManager/store.ts","webpack:///./src/assetManager/socket.ts","webpack:///./src/assetManager/contextMenu.vue","webpack:///./src/assetManager/contextMenu.vue?1573","webpack:///./src/assetManager/contextMenu.vue?0751","webpack:///./src/core/components/modals/confirm.vue?b511","webpack:///./src/core/components/modals/modal.vue?e172","webpack:///./src/core/components/modals/modal.vue","webpack:///./src/core/components/modals/modal.vue?1864","webpack:///./src/core/components/modals/modal.vue?1323","webpack:///./src/core/components/modals/confirm.vue","webpack:///./src/core/components/modals/confirm.vue?4a6f","webpack:///./src/core/components/modals/confirm.vue?bc1d","webpack:///./src/core/components/modals/prompt.vue?26e0","webpack:///./src/core/components/modals/prompt.vue","webpack:///./src/core/components/modals/prompt.vue?0b1b","webpack:///./src/core/components/modals/prompt.vue?216a","webpack:///./src/core/utils.ts","webpack:///./src/assetManager/manager.vue","webpack:///./src/assetManager/manager.vue?c963","webpack:///./src/assetManager/manager.vue?2088","webpack:///./src/auth/login.vue?6ea2","webpack:///./src/core/store.ts","webpack:///./src/auth/login.vue","webpack:///./src/auth/login.vue?fd88","webpack:///./src/auth/login.vue?78c2","webpack:///./src/auth/logout.ts","webpack:///./src/core/components/load.vue?e64b","webpack:///./src/core/components/load.vue","webpack:///./src/core/components/load.vue?077f","webpack:///./src/core/components/load.vue?4c80","webpack:///./src/dashboard/main.vue?a12a","webpack:///./src/dashboard/main.vue","webpack:///./src/dashboard/main.vue?d634","webpack:///./src/dashboard/main.vue?e361","webpack:///./src/game/game.vue?5c0a","webpack:///./src/game/api/socket.ts","webpack:///./src/game/event-bus.ts","webpack:///./src/game/geom.ts","webpack:///./src/game/api/utils.ts","webpack:///./src/game/units.ts","webpack:///./src/game/utils.ts","webpack:///./src/game/store.ts","webpack:///./src/game/layers/manager.ts","webpack:///./src/game/shapes/boundingrect.ts","webpack:///./src/game/comm/conversion/aura.ts","webpack:///./src/game/visibility/te/triag.ts","webpack:///./src/game/visibility/te/tds.ts","webpack:///./src/game/visibility/te/cdt.ts","webpack:///./src/game/visibility/bvh/node.ts","webpack:///./src/game/visibility/bvh/bvh.ts","webpack:///./src/game/visibility/store.ts","webpack:///./src/game/visibility/te/pa.ts","webpack:///./src/game/shapes/shape.ts","webpack:///./src/game/ui/tools/utils.ts","webpack:///./src/game/shapes/baserect.ts","webpack:///./src/game/shapes/asset.ts","webpack:///./src/game/shapes/circle.ts","webpack:///./src/game/shapes/circulartoken.ts","webpack:///./src/game/shapes/line.ts","webpack:///./src/game/shapes/multiline.ts","webpack:///./src/game/shapes/rect.ts","webpack:///./src/game/shapes/text.ts","webpack:///./src/game/shapes/polygon.ts","webpack:///./src/game/shapes/utils.ts","webpack:///./src/game/layers/layer.ts","webpack:///./src/game/settings.ts","webpack:///./src/game/visibility/te/draw.ts","webpack:///./src/game/visibility/te/te.ts","webpack:///./src/game/layers/fow.ts","webpack:///./src/game/layers/fowplayers.ts","webpack:///./src/game/layers/grid.ts","webpack:///./src/game/layers/utils.ts","webpack:///./src/game/ui/annotation.ts","webpack:///./src/game/manager.ts","webpack:///./src/game/api/events.ts","webpack:///./src/game/ui/initiative/initiative.vue?f727","webpack:///./src/game/ui/initiative/store.ts","webpack:///./src/game/ui/initiative/initiative.vue","webpack:///./src/game/ui/initiative/initiative.vue?0bb3","webpack:///./src/game/ui/initiative/initiative.vue?a078","webpack:///./src/game/ui/labels.vue?3c0c","webpack:///./src/game/ui/labels.vue","webpack:///./src/game/ui/labels.vue?6343","webpack:///./src/game/ui/labels.vue?ca40","webpack:///./src/game/ui/menu/menu.vue?d91b","webpack:///./src/core/components/colorpicker.vue?19a2","webpack:///./src/core/components/colorpicker.vue","webpack:///./src/core/components/colorpicker.vue?6ea9","webpack:///./src/core/components/colorpicker.vue?c520","webpack:///./src/game/ui/menu/asset_node.vue?a333","webpack:///./src/game/ui/menu/asset_node.vue","webpack:///./src/game/ui/menu/asset_node.vue?2445","webpack:///./src/game/ui/menu/asset_node.vue?5a19","webpack:///./src/game/ui/menu/menu.vue","webpack:///./src/game/ui/menu/menu.vue?f4af","webpack:///./src/game/ui/menu/menu.vue?b559","webpack:///./src/game/ui/note.vue?6452","webpack:///./src/game/ui/note.vue","webpack:///./src/game/ui/note.vue?0f0b","webpack:///./src/game/ui/note.vue?6eea","webpack:///./src/game/ui/selection/selection_info.vue?2018","webpack:///./src/game/ui/selection/edit_dialog.vue?f7fe","webpack:///./src/game/ui/selection/edit_dialog.vue","webpack:///./src/game/ui/selection/edit_dialog.vue?d8af","webpack:///./src/game/ui/selection/edit_dialog.vue?92f4","webpack:///./src/game/ui/selection/selection_info.vue","webpack:///./src/game/ui/selection/selection_info.vue?bb7e","webpack:///./src/game/ui/selection/selection_info.vue?e401","webpack:///./src/game/ui/tools/tools.vue?b1ef","webpack:///./src/game/ui/selection/shapecontext.vue?d8d9","webpack:///./src/game/ui/initiative/utils.ts","webpack:///./src/game/ui/selection/shapecontext.vue","webpack:///./src/game/ui/selection/shapecontext.vue?ca08","webpack:///./src/game/ui/selection/shapecontext.vue?7262","webpack:///./src/game/ui/tools/createtoken_modal.vue?85c5","webpack:///./src/game/ui/tools/createtoken_modal.vue","webpack:///./src/game/ui/tools/createtoken_modal.vue?37bd","webpack:///./src/game/ui/tools/createtoken_modal.vue?3843","webpack:///./src/game/ui/tools/draw.vue?7fe7","webpack:///./src/game/ui/tools/tool.vue?d047","webpack:///./src/game/ui/tools/tool.vue","webpack:///./src/game/ui/tools/tool.vue?61de","webpack:///./src/game/ui/tools/tool.vue?f2ee","webpack:///./src/game/ui/tools/draw.vue","webpack:///./src/game/ui/tools/draw.vue?e0b2","webpack:///./src/game/ui/tools/draw.vue?6c97","webpack:///./src/game/ui/tools/filter.vue?d311","webpack:///./src/core/components/accordion.vue?3b69","webpack:///./src/core/components/accordion.vue","webpack:///./src/core/components/accordion.vue?c2ac","webpack:///./src/core/components/accordion.vue?6e66","webpack:///./src/game/ui/tools/filter.vue","webpack:///./src/game/ui/tools/filter.vue?ebd0","webpack:///./src/game/ui/tools/filter.vue?b8e2","webpack:///./src/game/ui/tools/map.vue?4b2d","webpack:///./src/game/ui/tools/map.vue","webpack:///./src/game/ui/tools/map.vue?181e","webpack:///./src/game/ui/tools/map.vue?44ee","webpack:///./src/game/ui/tools/pan.ts","webpack:///./src/game/ui/tools/select.vue?a2d0","webpack:///./src/game/ui/tools/selectcontext.vue?8f89","webpack:///./src/game/ui/tools/selectcontext.vue","webpack:///./src/game/ui/tools/select.vue","webpack:///./src/game/ui/tools/selectcontext.vue?684a","webpack:///./src/game/ui/tools/selectcontext.vue?2a1a","webpack:///./src/game/ui/tools/select.vue?6a5f","webpack:///./src/game/ui/tools/select.vue?365a","webpack:///./src/game/ui/tools/vision.vue?0802","webpack:///./src/game/ui/tools/vision.vue","webpack:///./src/game/ui/tools/vision.vue?afb5","webpack:///./src/game/ui/tools/vision.vue?f45e","webpack:///./src/game/ui/tools/ruler.ts","webpack:///./src/game/ui/tools/tools.vue","webpack:///./src/game/ui/tools/tools.vue?3d6d","webpack:///./src/game/ui/tools/tools.vue?6b18","webpack:///./src/game/events/keyboard.ts","webpack:///./src/game/events/mouse.ts","webpack:///./src/game/ui/dmsettings.vue?c58e","webpack:///./src/core/components/inputCopy.vue?7ea0","webpack:///./src/core/components/inputCopy.vue","webpack:///./src/core/components/inputCopy.vue?8607","webpack:///./src/core/components/inputCopy.vue?9668","webpack:///./src/game/ui/dmsettings.vue","webpack:///./src/game/ui/dmsettings.vue?f453","webpack:///./src/game/ui/dmsettings.vue?c9bc","webpack:///./src/game/game.vue","webpack:///./src/game/game.vue?fb7e","webpack:///./src/game/game.vue?1caf","webpack:///./src/invitation/invitation.ts","webpack:///./src/router.ts","webpack:///./src/main.ts","webpack:///./src/game/game.vue?d9e5","webpack:///./src/dashboard/main.vue?dc5c","webpack:///./src/game/ui/tools/filter.vue?3555","webpack:///./src/core/components/inputCopy.vue?c78f","webpack:///./src/core/components/modals/confirm.vue?d734"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","render","_vm","this","_h","$createElement","_c","_self","attrs","ref","staticRenderFns","script","component","_v","on","$event","preventDefault","moveDrag","stopPropagation","stopDrag","currentFolder","_l","dir","_s","idMap","upload","createDirectory","staticClass","prepareUpload","path","changeDirectory","leaveDrag","parentFolder","staticStyle","_e","class","selected","includes","select","$refs","cm","open","startDrag","file","file_hash","firstSelectedFile","visible","left","top","close","rename","remove","style","$emit","_t","props","use","rootStore","Store","root","files","folders","Map","console","log","dynamic","store","namespaced","assetStore","socket","location","protocol","host","autoConnect","destination","href","setRoot","folder","clear","children","child","set","id","asset","event","inode","parent","pageX","pageY","$nextTick","$children","$el","focus","$parent","prompt","then","emit","$forceUpdate","confirm","sel","indexOf","clearSelected","components","ContextMenu","scopedSlots","_u","fn","dragStart","dragEnd","title","yes","no","deny","directives","rawName","expression","mask","dragOver","colour","positioned","offsetX","offsetY","screenX","screenY","dragging","updatePosition","_event","container","offsetWidth","offsetHeight","innerWidth","innerHeight","dataTransfer","setData","setDragImage","clientX","clientY","parseInt","display","Boolean","type","default","String","resolve","_ok","reject","Promise","Modal","question","domProps","_k","keyCode","submit","target","composing","answer","_value","uuidv4","replace","Math","random","v","toString","alphSort","a","b","toLowerCase","partition","arr","predicate","ret","forEach","calcFontScale","ctx","text","width","height","points","Number","font","split","fontWidth","measureText","min","draggingSelection","undefined","nextFolder","pop","delete","shiftKey","inodes","start","end","ctrlKey","dropEffect","classList","contains","add","moveInode","document","getElementById","click","fls","CHUNK_SIZE","uuid","slices","ceil","size","fr","FileReader","readAsArrayBuffer","onload","directory","totalSlices","Prompt","ConfirmDialog","AssetContextMenu","to","from","next","connect","disconnect","focusin","focusout","login","username","_m","password","register","error","authenticated","initialized","auth","init","coreStore","post","_response","setUsername","setAuthenticated","$router","$route","query","redirect","catch","response","statusText","nextElementSibling","span","opacity","registerHooks","message","owned","joined","room","encodeURIComponent","createRoom","newSessionName","vm","err","mouseleave","zoom","ready","mousedown","mouseup","mousemove","contextmenu","drop","showUI","layers","layer","selectedLayer","selectLayer","IS_DM","FAKE_PLAYER","zoomDisplay","toFixed","model","callback","$$v","createConnection","route","io","opts","decodeURIComponent","params","creator","EventBus","Point","x","y","point","vec","other","Vector","dimension","GlobalPoint","super","subtract","clone","LocalPoint","sqrt","pow","scale","atan2","PI","Ray","origin","direction","tMax","Infinity","p1","p2","maxT","abs","t1","t2","distance","sendClientOptions","locationOptions","g2l","obj","z","gameStore","zoomFactor","panX","panY","g2lx","g2ly","g2lz","getUnitDistance","unitSize","gridSize","g2lr","l2g","multiply","l2gx","l2gy","l2gz","getMouse","e","zoomValue","exp","equalPoints","getFogColour","opposite","tc","fowColour","setAlpha","fowOpacity","toRgbString","selectedLayerIndex","boardInitialized","locations","assets","notes","isLocked","roomName","roomCreator","invitationCode","players","gridColour","rulerColour","useGrid","fullFOW","fowLOS","locationName","visionSources","annotations","movementblockers","ownedtokens","_activeTokens","drawTEContour","visionRangeMin","visionRangeMax","clipboard","labels","filterNoLabel","labelFilters","selectionHelperID","layerManager","invalidate","label","filters","updatedLayers","Set","shape","UUIDMap","values","getLayer","isDM","code","index","sync","note","newZoomDisplay","oldLoc","zoomLocation","newLoc","diff","getGridLayer","drawGrid","increase","unit_size","gridLayer","canvas","use_grid","invalidateLight","vision_min_range","max","vision_max_range","full_fow","fow_opacity","fow_los","actualNote","find","filter","tokens","token","player","playerId","context","state","interval","drawLoop","draw","requestAnimationFrame","playerEditable","selectable","addLayer","some","found","globalAlpha","clearSelection","selection","getSelection","isVisionLayer","lm","topleft","w","h","topLeft","topRight","botRight","botLeft","vector","xmin","xmax","ymin","ymax","botright","ray","invDir","dirIsNeg","txmin","getDiagCorner","txmax","tymin","tymax","hit","coreVisible","aurasFromServer","auras","aura","visionSource","vision_source","dim","aurasToServer","IntersectionType","cw","ccw","edgeInfo","va","vb","ec","valid","indv","indexV","ri","vertices","infinite","vi","orient","orientation","Sign","COLLINEAR","collinearBetween","q","cPQ","cQR","compare","EQUAL","SMALLER","LARGER","px","py","qx","qy","rx","ry","pqx","pqy","prx","pry","det","determinant","maxX","maxY","aprX","aprY","ZERO","eps","EPSILON","POSITIVE","NEGATIVE","a00","a01","a10","a11","hasInexactNegativeOrientation","sideOfOrientedCircle","perturb","isInfinite","sideOfOrientedCircleP","Error","p0","os","getOrientedSide","ON_ORIENTED_BOUNDARY","sort","reverse","ON_NEGATIVE_SIDE","xyEqual","xySmaller","xyCompare","qpx","qpy","rpx","rpy","tpx","tpy","tqx","tqy","rqx","rqy","maxx","maxy","arpx","arpy","atqx","atqy","atpx","atpy","arqx","arqy","ON_POSITIVE_SIDE","segSegDoIntersectCrossing","p3","p4","LEFT_TURN","RIGHT_TURN","segSegDoIntersectContained","intersection","pa","pb","pc","pd","getIntersectionType","intersectionType","POINT","NO_INTERSECTION","getLine","doIntersect","l1","l2","info","getIntersectionTypeLine","la","lb","denom","nom1","nom2","A1","A2","B1","B2","nextUp","MAX_VALUE","MIN_VALUE","ulp","INFINITE","_INFINITE_VERTEX","LineFaceState","LocateType","newPoint","neighbours","constraints","uid","_counter","vertex","triangle","A","sign","unshift","Vertex","shapes","_point","faces","fc","Edge","_ri","EdgeIterator","tds","filterInfinite","_es","es","pos","triangles","associatedEdge","increment","done","tr","UNDEFINED","_tr","ic","vt","vr","pqr","prev","VERTEX_VERTEX","VERTEX_EDGE","EDGE_VERTEX","indexT","ni","EDGE_EDGE","first","second","_infinite","createVertex","addVertex","v0","v1","v2","n0","n1","n2","f1","i1","f2","i2","f3","i3","v3","trig","t0","i0","ei","edge","onlyConstraint","edges","includeInfinity","setAdjacency","deleteList","copy","neighbour","lfit","reorient","mirrorIndex","deleteTriangle","createTriangle","vCW","vCCW","tri","bl","bli","ff","vv","g","insertInFace","flip","hole","f","inn","firstHole","ii","holeList","createTriangle2","finite","newf","cutAfter","COUNTERCLOCKWISE","indx","createTriangle3","newHole","toDelete","toDowngrade","hasVertex","down","cwPermute","ccwPermute","del","deleteVertex","x1","y1","x2","y2","dist","insert","insertConstraintV","stack","markConstraint","intersectionInfo","findIntersectedFaces","triangulateHole","intersectedFaces","listAB","listBA","triangulateHole2","propagatingFlipE","triangulateHalfHole","fl","conflictBoundaries","iN","iT","iC","current","ind","ind1","ind2","newlf","isConstrained","vaa","vbb","aa","bb","lfc","intersect","lf","rf","previousFace","currentVertex","vcc","vdd","pi","bbox","dilate","overlaps","removeConstrainedEdge","removeConstrainedVertex","remove2D","vertexCount","numberOfVertices","removeDimDown","warn","testDimDown","makeHole","shell","fillHoleDelaunay","updateConstraints","dim1","setDone","iv","edgeList","listEdges","indf","locateInfo","locate","iLocate","insertb","loc","lt","li","flipAround","propagatingFlip","depth","isFlipable","maxDepth","e1","e2","eni","eI","edgeSet","lessEdge","indn","findIndex","ed","tt","u","t3","t4","i4","insertInConstrainedEdge","EDGE","insertc","updateConstraintsIncident","VERTEX","clearConstraintsIncident","updateConstraintsOpposite","c1","c2","cwi","ccwi","insertFirst","finiteVertex","insertSecond","OUTSIDE_AFFINE_HULL","insertOutsideAffineHull","OUTSIDE_CONVEX_HULL","insertOutsideConvexHull","insertInEdge","FACE","insertDimUp","conform","finiteEdge","insertOutsideConvexHull2","ccwlist","cwlist","th","marchLocate1D","marchLocate2D","pqt","leftFirst","o0","o1","o2","sum","nTurns","BoundingNode","nPrimitives","LeafNode","firstPrimOffset","InteriorNode","union","totalNodes","buildData","orderedPrims","nodes","offset","getBoundingBox","center","recursiveBuild","compact","node","strokeRect","createLeaf","centroidBbox","getMaxExtent","pMid","partitionedData","flattened","concat","mid","stopOnFirstHit","tMin","todoOffset","nodeNum","todo","inverse","dirIsNegative","intersectP","secondChildOffset","flatten","myOffset","secondOffset","linearNode","leafNode","primitivesOffset","BV","freeze","visionMode","visionBlockers","vision_mode","triangulate","TriangulationTarget","VISION","MOVEMENT","deleteShapeFromTriag","standalone","recalculateVision","addShapesToTriag","commit","visibilityStore","PA_CDT","vision","movement","time","cdt","sh","insertConstraint","addTriagVertices","CDT","timeEnd","deleteIntersectVertex","queues","isCorner","sharesVertex","newConstraints","nc","getIncidentEdges","fixBridge","nextIntersect","constrainedEdgeKept","ccwv","ccwp","sharesCCWP","otherConstrainedEdgeVertex","triBridge","has","from_","brokenBridge","np","triagVertices","entries","removeConstrainedEdgeDelaunay","removeVertex","removeTriagVertices","refPoint","fillColour","strokeColour","nameVisible","trackers","_owners","_triagVertices","visionObstruction","movementObstruction","isToken","showHighlight","annotation","globalCompositeOperation","options","_refPoint","_canvas","delta","idx","fromArray","normalize","skipLightUpdate","recalculate","alteredVision","self","obstructionIndex","addToTriag","deleteFromTriag","au","ls","blocksMovement","alteredMovement","ownedBy","type_","draw_operator","movement_obstruction","vision_obstruction","owners","fill_colour","stroke_colour","name_visible","is_token","JSON","stringify","parse","strokeStyle","beginPath","innerRange","fillStyle","gradient","createRadialGradient","addColorStop","lastPath","fill","arc","group","source","has_img","effects","oldLayer","newLayer","activeTokens","owner","oldValue","newValue","ownerIndex","addOwner","calculateDelta","ogSelBBox","newSelBBox","refine","movementBlocker","blocker","blockerBBox","intersectsWithInner","fromPoints","bCenter","sCenter","ux","uy","dx","dot","dy","centerTriangle","asArray","checkTriangle","skip","endpoint","_cw","_ccw","ix","newDelta","assign","getBaseDict","topright","botleft","centerPoint","visibleInCanvas","gs","mx","my","targetX","targetY","round","resizePoint","img","src","fromDict","drawImage","radius","lineWidth","stroke","save","dest","textAlign","textBaseline","xs","ys","transform","tinycolor","toHexString","fillText","restore","startPoint","endPoint","line_width","moveTo","lineTo","_centerPoint","_points","map","minx","miny","lineCap","lineJoin","fillRect","position","angle","translate","rotate","getLines","line","_resizePoint","lines","lineHeight","widths","allLines","maxWidth","targetLine","words","word","testLine","metrics","testWidth","_vertices","createShapeFromDict","rect","circ","multiline","polygon","Image","startsWith","URL","pathname","selectionColor","selectionWidth","getContext","temporary","checkVisionSources","setMovementBlock","asDict","serverShape","addShape","lsI","lbI","mbI","anI","annotationIndex","ownedIndex","clearRect","doClear","ogOP","drawAuras","destinationIndex","oldIdx","Settings","drawPoint","dl","closePath","drawPolygon","drawPolygonL","xx","local","yy","angleSteps","drawAngleLines","drawFirstLightHit","skipPlayerFOW","skipLightFOW","tempFill","I","J","drl","constrained","drawPolygonT","logs","T","fromP","toP","po","computeVisibility","drawt","Q","rawOutput","expandEdge","right","fh","nfh","nIndex","rIndex","lIndex","nvh","rvh","lvh","re","le","ro","lo","raySegIntersection","CLOCKWISE","denominator","ua","DC","DL","DP","DPL","DPT","preFogShapes","virtualCanvas","createElement","vCtx","removeShape","originalOperation","dctx","hasLayer","lcenter","alm","light","auraLength","auraCircle","lastArcAngle","Path2D","firstPoint","anglePoint","cos","sin","lightRay","hitResult","preShape","ogComposite","maxLength","tokenId","_doClear","createLayer","layerInfo","zIndex","player_editable","appendChild","setGridSize","setShapes","dropAsset","image","getData","shown","annotationText","annotationRect","getMaxWidth","getMaxHeight","selectedTool","annotationManager","oldShape","redrawInitiative","setIsToken","redraw","localPos","increasePanX","increasePanY","gameManager","_error","router","setRoomName","setRoomCreator","setInvitationCode","setIsLocked","setPlayers","addPlayer","setDM","setGridColour","grid_colour","setFOWColour","fow_colour","setRulerColour","ruler_colour","setPanX","pan_x","setPanY","pan_y","setZoomDisplay","zoom_factor","active_layer","setLocationName","setUnitSize","setUseGrid","setFullFOW","setFOWOpacity","setLineOfSight","setVisionRangeMin","setVisionRangeMax","setVisionMode","recalculateMovement","setCenterPosition","newNote","setAssets","locationInfo","setLocations","innerHTML","resetLayerInfo","reset","setBoardInitialized","moveShapeOrder","moveLayer","updateShape","realShape","addLabel","setLabelVisibility","deleteLabel","setLabelFilters","fakeSetData","$store","game","updateOrder","initiative","$set","actor","currentActor","cursor","toggleHighlight","modifiers","notAllowed","owns","_n","syncInitiative","createEffect","getDefaultEffect","toggleOption","removeInitiative","effect","updateEffect","turns","roundCounter","visionLock","toggleVisionLock","cameraLock","setRound","updateTurn","nextTurn","actorId","initiativeStore","$on","setTurn","getActor","$off","setActiveTokens","setRoundCounter","order","show","option","effectIndex","syncEffect","draggable","search","category","selectLabel","toggleVisibility","newCategory","trim","newName","cat","keys","user","localeCompare","settings","rm","transition","settingsClick","createNote","openNote","openDmSettings","changeLocation","createLocation","currentTarget","transparent","color","closePicker","updateColor","chromePicker","val","rgba","setPosition","disabled","newColor","getBoundingClientRect","bottom","toggle","showImage","hash","el","__files","imageSource","querySelector","computed","updateNote","calcHeight","removeNote","textarea","scrollHeight","openEditDialog","tracker","changeValue","maxvalue","refInFor","setToken","Array","isArray","_i","$$a","$$el","$$c","checked","$$i","setVisionBlocker","setMovementBlocker","updateOwner","gridColumnStart","removeOwner","removeTracker","updateAuraColour","updateAuraVisionSource","removeAura","removeLabel","openLabelManager","updateAnnotation","addEmpty","hadAnnotation","an","_colour","editDialog","ogValue","isNaN","tool","toolVisible","currentTool","getActiveLayer","getLayers","setLayer","moveToBack","moveToFront","addInitiative","getInitiativeWord","inInitiative","getInitiativeRepr","borderColour","updatePreview","_newValue","_oldValue","detailRight","detailArrow","modeSelect","shapeSelect","brushSize","active","onMouseDown","onMouseUp","onMouseMove","onContextMenu","onDeselect","onSelect","brushHelper","ruler","modes","onModeChange","fowLayer","normalLayer","setupBrush","helperSize","pushBrushBack","lastPoint","newW","newH","newR","br","altKey","resizeToGrid","finaliseShape","initalValues","updateSelection","toggleDisplay","toggleCategory","showArrow","item","toggleSelection","initialValues","updateCategory","overall","items","indeterminate","toggleUnlabeledFilter","accordion","xCount","yCount","panStart","mouse","bringPlayers","createToken","showInitiative","createtokendialog","SelectOperations","showContextMenu","Noop","deltaChanged","dragRay","selectionStartPoint","selectionHelper","setSelectionHelperId","globalMouse","selectionStack","getPointIndex","Resize","Drag","localRefPoint","GroupSelect","og","ogDelta","resize","updateCursor","body","snapToGrid","shapecontext","selectcontext","getPointOrientation","SelectContext","removeActiveToken","addActiveToken","diffsign","xdiff","ydiff","xmid","ymid","tools","dmTools","tagName","targetTool","button","buttons","setActiveText","watch","onKeyUp","HTMLInputElement","HTMLTextAreaElement","onKeyDown","hasSelection","toggleUI","setClipboard","clip","oldTrackers","newTracker","oldAuras","newAura","scrollZoom","deltaY","updateZoom","handleClick","kickPlayer","refreshState","invitationUrl","refreshInviteCode","toggleSessionLock","deleteSession","fakePlayer","changeVisionMode","visibility","showPopup","popupString","navigator","writeText","categories","showRefreshState","setFakePlayer","firstElementChild","InputCopyElement","manager","addEventListener","resizeWindow","removeEventListener","setWidth","setHeight","sessionUrl","template","base","routes","meta","beforeEach","matched","record","setInitialized","config","productionTip","devtools","performance","app","App","$mount"],"mappings":"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","file":"static/js/app.857c7363.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./prompt.vue?vue&type=style&index=0&id=391b52fc&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./prompt.vue?vue&type=style&index=0&id=391b52fc&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tool.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tool.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./initiative.vue?vue&type=style&index=0&id=6bbba6d3&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./initiative.vue?vue&type=style&index=0&id=6bbba6d3&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./createtoken_modal.vue?vue&type=style&index=0&id=bf063922&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./createtoken_modal.vue?vue&type=style&index=0&id=bf063922&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./asset_node.vue?vue&type=style&index=0&id=03f9ac64&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./asset_node.vue?vue&type=style&index=0&id=03f9ac64&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tools.vue?vue&type=style&index=0&id=4302f32a&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tools.vue?vue&type=style&index=0&id=4302f32a&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./filter.vue?vue&type=style&index=1&id=75b63661&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./filter.vue?vue&type=style&index=1&id=75b63661&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dmsettings.vue?vue&type=style&index=0&id=261cc18f&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dmsettings.vue?vue&type=style&index=0&id=261cc18f&scoped=true&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./game.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./game.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./note.vue?vue&type=style&index=0&id=2c1a0e9a&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./note.vue?vue&type=style&index=0&id=2c1a0e9a&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./menu.vue?vue&type=style&index=0&id=9190ff3e&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./menu.vue?vue&type=style&index=0&id=9190ff3e&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./colorpicker.vue?vue&type=style&index=0&id=24ff2c54&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./colorpicker.vue?vue&type=style&index=0&id=24ff2c54&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./modal.vue?vue&type=style&index=0&id=2098e4f8&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./modal.vue?vue&type=style&index=0&id=2098e4f8&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./edit_dialog.vue?vue&type=style&index=0&id=40314b6e&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./edit_dialog.vue?vue&type=style&index=0&id=40314b6e&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./vision.vue?vue&type=style&index=0&id=f995dfd4&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./vision.vue?vue&type=style&index=0&id=f995dfd4&scoped=true&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./manager.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./manager.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./contextmenu.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./contextmenu.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./shapecontext.vue?vue&type=style&index=0&id=d6c7d844&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./shapecontext.vue?vue&type=style&index=0&id=d6c7d844&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selectcontext.vue?vue&type=style&index=0&id=7983fcf6&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selectcontext.vue?vue&type=style&index=0&id=7983fcf6&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accordion.vue?vue&type=style&index=0&id=32e257d0&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accordion.vue?vue&type=style&index=0&id=32e257d0&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./labels.vue?vue&type=style&index=0&id=3261513c&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./labels.vue?vue&type=style&index=0&id=3261513c&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection_info.vue?vue&type=style&index=0&id=4ce4ab65&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection_info.vue?vue&type=style&index=0&id=4ce4ab65&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./draw.vue?vue&type=style&index=0&id=4e6b5c5e&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./draw.vue?vue&type=style&index=0&id=4e6b5c5e&scoped=true&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=style&index=0&id=6062c8f4&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=style&index=0&id=6062c8f4&scoped=true&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('router-view',{ref:\"activeComponent\"})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=b8715fa6&\"\nvar script = {}\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"AssetManager\"}},[_c('div',{attrs:{\"id\":\"titlebar\"}},[_vm._v(\"Asset Manager\")]),_c('div',{attrs:{\"id\":\"main\"}},[_c('div',{attrs:{\"id\":\"assets\"},on:{\"dragover\":function($event){$event.preventDefault();return _vm.moveDrag($event)},\"drop\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.stopDrag($event, _vm.currentFolder)}}},[_c('div',{attrs:{\"id\":\"breadcrumbs\"}},[_c('div',[_vm._v(\"/\")]),_vm._l((_vm.path),function(dir){return _c('div',{key:dir},[_vm._v(_vm._s(_vm.idMap.get(dir).name))])})],2),_c('div',{attrs:{\"id\":\"actionbar\"}},[_c('input',{attrs:{\"id\":\"files\",\"type\":\"file\",\"multiple\":\"\",\"hidden\":\"\"},on:{\"change\":function($event){return _vm.upload()}}}),_c('div',{attrs:{\"title\":\"Create folder\"},on:{\"click\":_vm.createDirectory}},[_c('i',{staticClass:\"fas fa-plus-square\"})]),_c('div',{attrs:{\"title\":\"Upload files\"},on:{\"click\":_vm.prepareUpload}},[_c('i',{staticClass:\"fas fa-upload\"})])]),_c('div',{attrs:{\"id\":\"explorer\"}},[(_vm.path.length)?_c('div',{staticClass:\"inode folder\",on:{\"dblclick\":function($event){return _vm.changeDirectory(-1)},\"dragover\":function($event){$event.preventDefault();return _vm.moveDrag($event)},\"dragleave\":function($event){$event.preventDefault();return _vm.leaveDrag($event)},\"drop\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.stopDrag($event, _vm.parentFolder)}}},[_c('i',{staticClass:\"fas fa-folder\",staticStyle:{\"font-size\":\"50px\"}}),_c('div',{staticClass:\"title\"},[_vm._v(\"..\")])]):_vm._e(),_vm._l((_vm.folders),function(key){return _c('div',{key:key,staticClass:\"inode folder\",class:{ 'inode-selected': _vm.selected.includes(key) },attrs:{\"draggable\":\"true\"},on:{\"click\":function($event){return _vm.select($event, key)},\"dblclick\":function($event){return _vm.changeDirectory(key)},\"contextmenu\":function($event){$event.preventDefault();return _vm.$refs.cm.open($event, key)},\"dragstart\":function($event){return _vm.startDrag($event, key)},\"dragover\":function($event){$event.preventDefault();return _vm.moveDrag($event)},\"dragleave\":function($event){$event.preventDefault();return _vm.leaveDrag($event)},\"drop\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.stopDrag($event, key)}}},[_c('i',{staticClass:\"fas fa-folder\",staticStyle:{\"font-size\":\"50px\"}}),_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.idMap.get(key).name))])])}),_vm._l((_vm.files),function(file){return _c('div',{key:file,staticClass:\"inode file\",class:{ 'inode-selected': _vm.selected.includes(file) },attrs:{\"draggable\":\"true\"},on:{\"click\":function($event){return _vm.select($event, file)},\"contextmenu\":function($event){$event.preventDefault();return _vm.$refs.cm.open($event, file)},\"dragstart\":function($event){return _vm.startDrag($event, file)}}},[_c('img',{attrs:{\"src\":'/static/assets/' + _vm.idMap.get(file).file_hash,\"width\":\"50\"}}),_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.idMap.get(file).name))])])})],2)]),(_vm.firstSelectedFile)?_c('div',{attrs:{\"id\":\"asset-details\"}},[_c('div',{attrs:{\"id\":\"asset-detail-title\"}},[_vm._v(_vm._s(_vm.firstSelectedFile.name))]),_c('img',{attrs:{\"src\":'/static/assets/' + _vm.firstSelectedFile.file_hash}})]):_vm._e()]),_c('AssetContextMenu',{ref:\"cm\"}),_c('Prompt',{ref:\"prompt\"}),_c('ConfirmDialog',{ref:\"confirm\"})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContextMenu',{attrs:{\"visible\":_vm.visible,\"left\":_vm.left + 'px',\"top\":_vm.top + 'px'},on:{\"close\":_vm.close}},[_c('li',{on:{\"click\":_vm.rename}},[_vm._v(\"Rename\")]),_c('li',{on:{\"click\":_vm.remove}},[_vm._v(\"Remove\")])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.visible)?_c('div',{staticClass:\"ContextMenu\",style:({ left: _vm.left, top: _vm.top }),attrs:{\"tabindex\":\"-1\"},on:{\"blur\":function($event){return _vm.$emit('close')}}},[_c('ul',[_vm._t(\"default\")],2)]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\n@Component({\r\n    props: [\"visible\", \"left\", \"top\"],\r\n})\r\nexport default class ContextMenu extends Vue {}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./contextmenu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./contextmenu.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./contextmenu.vue?vue&type=template&id=67c4d20e&\"\nimport script from \"./contextmenu.vue?vue&type=script&lang=ts&\"\nexport * from \"./contextmenu.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./contextmenu.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Vue from \"vue\";\r\nimport Vuex from \"vuex\";\r\n\r\nimport { AssetState } from \"@/assetManager/store\";\r\nimport { CoreState } from \"@/core/store\";\r\nimport { GameState } from \"@/game/store\";\r\nimport { VisibilityState } from \"@/game/visibility/store\";\r\nimport { InitiativeState } from \"./game/ui/initiative/store\";\r\n\r\nVue.use(Vuex);\r\n\r\nexport interface RootState {\r\n    assets: AssetState;\r\n    core: CoreState;\r\n    game: GameState;\r\n    visibility: VisibilityState;\r\n    initiative: InitiativeState;\r\n}\r\n\r\nexport const rootStore = new Vuex.Store<RootState>({});\r\n","// import Vuex from \"vuex\";\r\nimport { getModule, Module, Mutation, VuexModule } from \"vuex-module-decorators\";\r\n\r\nimport { Asset } from \"@/core/comm/types\";\r\nimport { rootStore } from \"@/store\";\r\n\r\nexport interface AssetState {\r\n    root: number;\r\n    files: number[];\r\n    folders: number[];\r\n    idMap: Map<number, Asset>;\r\n    selected: number[];\r\n}\r\n\r\n@Module({ dynamic: true, store: rootStore, name: \"assets\", namespaced: true })\r\nclass AssetStore extends VuexModule {\r\n    root = -1;\r\n    files: number[] = [];\r\n    folders: number[] = [];\r\n    idMap: Map<number, Asset> = new Map();\r\n    selected: number[] = [];\r\n\r\n    @Mutation\r\n    clear(): void {\r\n        this.folders = [];\r\n        this.files = [];\r\n    }\r\n\r\n    @Mutation\r\n    clearSelected(): void {\r\n        console.log(\"Cleared\");\r\n        this.selected = [];\r\n    }\r\n\r\n    @Mutation\r\n    setRoot(root: number): void {\r\n        this.root = root;\r\n    }\r\n}\r\n\r\nexport const assetStore = getModule(AssetStore);\r\n","import io from \"socket.io-client\";\r\n\r\nimport { Asset } from \"@/core/comm/types\";\r\nimport { assetStore } from \"./store\";\r\n\r\nexport const socket = io(location.protocol + \"//\" + location.host + \"/pa_assetmgmt\", { autoConnect: false });\r\n\r\n// export const socket = io.connect(location.protocol + \"//\" + location.host + \"/pa_assetmgmt\");\r\nsocket.on(\"connect\", () => {\r\n    console.log(\"Connected\");\r\n});\r\nsocket.on(\"disconnect\", () => {\r\n    console.log(\"Disconnected\");\r\n});\r\nsocket.on(\"redirect\", (destination: string) => {\r\n    console.log(\"redirecting\");\r\n    window.location.href = destination;\r\n});\r\nsocket.on(\"Folder.Root.Set\", (root: number) => {\r\n    assetStore.setRoot(root);\r\n});\r\nsocket.on(\"Folder.Set\", (folder: Asset) => {\r\n    assetStore.clear();\r\n    if (folder.children) {\r\n        for (const child of folder.children) {\r\n            assetStore.idMap.set(child.id, child);\r\n            if (child.file_hash) {\r\n                assetStore.files.push(child.id);\r\n            } else {\r\n                assetStore.folders.push(child.id);\r\n            }\r\n        }\r\n    }\r\n});\r\nsocket.on(\"Folder.Create\", (folder: Asset) => {\r\n    assetStore.folders.push(folder.id);\r\n    assetStore.idMap.set(folder.id, folder);\r\n});\r\nsocket.on(\"Asset.Upload.Finish\", (asset: Asset) => {\r\n    assetStore.idMap.set(asset.id, asset);\r\n    assetStore.files.push(asset.id);\r\n});\r\n","\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\n\r\nimport Component from \"vue-class-component\";\r\n\r\nimport ContextMenu from \"@/core/components/contextmenu.vue\";\r\nimport ConfirmDialog from \"@/core/components/modals/confirm.vue\";\r\nimport Prompt from \"@/core/components/modals/prompt.vue\";\r\n\r\nimport { socket } from \"@/assetManager/socket\";\r\nimport { assetStore } from \"@/assetManager/store\";\r\nimport AssetManager from \"./manager.vue\";\r\n\r\n@Component({\r\n    components: {\r\n        ContextMenu,\r\n    },\r\n})\r\nexport default class AssetContextMenu extends Vue {\r\n    visible = false;\r\n    left = 0;\r\n    top = 0;\r\n    open(event: MouseEvent, inode: number) {\r\n        if (!assetStore.selected.includes(inode)) this.parent.select(event, inode);\r\n\r\n        this.visible = true;\r\n        this.left = event.pageX;\r\n        this.top = event.pageY;\r\n        this.$nextTick(() => {\r\n            (<HTMLElement>this.$children[0].$el).focus();\r\n        });\r\n    }\r\n    close() {\r\n        this.visible = false;\r\n    }\r\n    get parent(): AssetManager {\r\n        return <AssetManager>this.$parent;\r\n    }\r\n    rename() {\r\n        if (assetStore.selected.length !== 1) return;\r\n        const asset = assetStore.idMap.get(assetStore.selected[0])!;\r\n\r\n        (<Prompt>this.parent.$refs.prompt).prompt(\"New name:\", `Renaming ${asset.name}`).then(\r\n            (name: string) => {\r\n                socket.emit(\"Asset.Rename\", {\r\n                    asset: asset.id,\r\n                    name,\r\n                });\r\n                asset.name = name;\r\n                this.parent.$forceUpdate();\r\n            },\r\n            () => {},\r\n        );\r\n        this.close();\r\n    }\r\n    remove() {\r\n        if (assetStore.selected.length === 0) return;\r\n        (<ConfirmDialog>this.parent.$refs.confirm).open(\"Are you sure you wish to remove this?\").then(\r\n            (result: boolean) => {\r\n                if (result) {\r\n                    for (const sel of assetStore.selected) {\r\n                        socket.emit(\"Asset.Remove\", sel);\r\n                        if (assetStore.files.includes(sel)) assetStore.files.splice(assetStore.files.indexOf(sel), 1);\r\n                        else assetStore.folders.splice(assetStore.folders.indexOf(sel), 1);\r\n                    }\r\n                    assetStore.clearSelected();\r\n                }\r\n            },\r\n            () => {},\r\n        );\r\n        this.close();\r\n    }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./contextMenu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./contextMenu.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./contextMenu.vue?vue&type=template&id=3d2b4b88&\"\nimport script from \"./contextMenu.vue?vue&type=script&lang=ts&\"\nexport * from \"./contextMenu.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('modal',{attrs:{\"visible\":_vm.visible},on:{\"close\":_vm.close},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_vm._v(\"\\n        \"+_vm._s(_vm.title)+\"\\n    \")])}}])},[_c('div',{staticClass:\"modal-body\"},[_c('button',{ref:\"confirm\",on:{\"click\":_vm.confirm}},[_vm._v(_vm._s(_vm.yes))]),(!!_vm.no)?_c('button',{on:{\"click\":_vm.deny}},[_vm._v(_vm._s(_vm.no))]):_vm._e()])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('transition',{attrs:{\"name\":\"modal\"}},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.visible),expression:\"visible\"}],staticClass:\"mask\",class:{ 'modal-mask': _vm.mask, 'dialog-mask': !_vm.mask },on:{\"click\":_vm.close,\"dragover\":function($event){$event.preventDefault();return _vm.dragOver($event)}}},[_c('div',{ref:\"container\",staticClass:\"modal-container\",style:({ 'background-color': _vm.colour }),on:{\"click\":function($event){$event.stopPropagation();}}},[_vm._t(\"header\",null,{\"dragStart\":_vm.dragStart,\"dragEnd\":_vm.dragEnd}),_vm._t(\"default\")],2)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport { Prop } from \"vue-property-decorator\";\r\n\r\n@Component\r\nexport default class Modal extends Vue {\r\n    @Prop(Boolean) visible!: boolean;\r\n    @Prop({ type: Boolean, default: true }) mask!: boolean;\r\n    @Prop({ type: String, default: \"white\" }) colour!: string;\r\n\r\n    $refs!: {\r\n        container: HTMLElement;\r\n    };\r\n\r\n    positioned = false;\r\n    offsetX = 0;\r\n    offsetY = 0;\r\n    screenX = 0;\r\n    screenY = 0;\r\n    dragging = false;\r\n\r\n    // Example of mounted required: opening note\r\n    mounted() {\r\n        this.updatePosition();\r\n    }\r\n    // Example of updated required: opening initiative\r\n    updated() {\r\n        this.updatePosition();\r\n    }\r\n\r\n    close(_event: MouseEvent) {\r\n        this.$emit(\"close\");\r\n    }\r\n    updatePosition() {\r\n        if (!this.positioned) {\r\n            const container = <any>this.$refs.container;\r\n            if (container.offsetWidth === 0 && container.offsetHeight === 0) return;\r\n            this.$refs.container.style.left = (window.innerWidth - container.offsetWidth) / 2 + \"px\";\r\n            this.$refs.container.style.top = (window.innerHeight - container.offsetHeight) / 2 + \"px\";\r\n            this.positioned = true;\r\n        }\r\n    }\r\n    dragStart(event: DragEvent) {\r\n        if (event === null || event.dataTransfer === null) return;\r\n        event.dataTransfer.setData(\"Hack\", \"\");\r\n        // Because the drag event is happening on the header, we have to change the drag image\r\n        // in order to give the impression that the entire modal is dragged.\r\n        event.dataTransfer.setDragImage(<Element>this.$refs.container, event.offsetX, event.offsetY);\r\n        this.offsetX = event.offsetX;\r\n        this.offsetY = event.offsetY;\r\n        this.screenX = event.screenX;\r\n        this.screenY = event.screenY;\r\n        this.dragging = true;\r\n    }\r\n    dragEnd(event: DragEvent) {\r\n        this.dragging = false;\r\n        let left = event.clientX - this.offsetX;\r\n        let top = event.clientY - this.offsetY;\r\n        if (event.clientX === 0 && event.clientY === 0 && event.pageX === 0 && event.pageY === 0) {\r\n            left = parseInt(this.$refs.container.style.left!, 10) - (this.screenX - event.screenX);\r\n            top = parseInt(this.$refs.container.style.top!, 10) - (this.screenY - event.screenY);\r\n        }\r\n        if (left < 0) left = 0;\r\n        if (left > window.innerWidth - 100) left = window.innerWidth - 100;\r\n        if (top < 0) top = 0;\r\n        if (top > window.innerHeight - 100) top = window.innerHeight - 100;\r\n        this.$refs.container.style.left = left + \"px\";\r\n        this.$refs.container.style.top = top + \"px\";\r\n        this.$refs.container.style.display = \"block\";\r\n    }\r\n    dragOver(_event: DragEvent) {\r\n        if (this.dragging) this.$refs.container.style.display = \"none\";\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./modal.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./modal.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./modal.vue?vue&type=template&id=2098e4f8&scoped=true&\"\nimport script from \"./modal.vue?vue&type=script&lang=ts&\"\nexport * from \"./modal.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./modal.vue?vue&type=style&index=0&id=2098e4f8&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2098e4f8\",\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n    },\r\n})\r\nexport default class ConfirmDialog extends Vue {\r\n    $refs!: {\r\n        confirm: HTMLButtonElement;\r\n    };\r\n\r\n    visible = false;\r\n    yes = \"Yes\";\r\n    no = \"No\";\r\n    title = \"\";\r\n\r\n    resolve = (_ok: boolean) => {};\r\n    reject = () => {};\r\n\r\n    confirm() {\r\n        this.resolve(true);\r\n        this.close();\r\n    }\r\n    deny() {\r\n        this.resolve(false);\r\n        this.close();\r\n    }\r\n    close() {\r\n        this.reject();\r\n        this.visible = false;\r\n        this.title = \"\";\r\n    }\r\n    open(title: string, yes = \"yes\", no = \"no\"): Promise<boolean> {\r\n        this.yes = yes;\r\n        this.no = no;\r\n        this.title = title;\r\n\r\n        this.visible = true;\r\n        this.$nextTick(() => {\r\n            this.$refs.confirm.focus();\r\n        });\r\n\r\n        return new Promise((resolve, reject) => {\r\n            this.resolve = resolve;\r\n            this.reject = reject;\r\n        });\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./confirm.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./confirm.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./confirm.vue?vue&type=template&id=46dc898b&scoped=true&\"\nimport script from \"./confirm.vue?vue&type=script&lang=ts&\"\nexport * from \"./confirm.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./confirm.vue?vue&type=style&index=0&id=46dc898b&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"46dc898b\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Modal',{attrs:{\"visible\":_vm.visible},on:{\"close\":_vm.close},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_vm._v(\"\\n        \"+_vm._s(_vm.title)+\"\\n    \")])}}])},[_c('div',{staticClass:\"modal-body\"},[_vm._v(\"\\n        \"+_vm._s(_vm.question)+\"\\n        \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.answer),expression:\"answer\"}],ref:\"answer\",attrs:{\"type\":\"text\"},domProps:{\"value\":(_vm.answer)},on:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.submit($event)},\"input\":function($event){if($event.target.composing){ return; }_vm.answer=$event.target.value}}})]),_c('div',{staticClass:\"modal-footer\"},[_c('button',{on:{\"click\":_vm.submit}},[_vm._v(\"Submit\")])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n    },\r\n})\r\nexport default class Prompt extends Vue {\r\n    $refs!: {\r\n        answer: HTMLElement;\r\n    };\r\n\r\n    visible = false;\r\n    question = \"\";\r\n    answer = \"\";\r\n    title = \"\";\r\n\r\n    resolve = (_value: string) => {};\r\n    reject = () => {};\r\n\r\n    submit() {\r\n        this.resolve(this.answer);\r\n        this.close();\r\n    }\r\n    close() {\r\n        this.reject();\r\n        this.visible = false;\r\n        this.question = \"\";\r\n        this.answer = \"\";\r\n        this.title = \"\";\r\n    }\r\n    prompt(question: string, title: string): Promise<string> {\r\n        this.question = question;\r\n        this.title = title;\r\n        this.visible = true;\r\n        this.$nextTick(() => {\r\n            this.$refs.answer.focus();\r\n        });\r\n        return new Promise((resolve, reject) => {\r\n            this.resolve = resolve;\r\n            this.reject = reject;\r\n        });\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./prompt.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./prompt.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./prompt.vue?vue&type=template&id=391b52fc&scoped=true&\"\nimport script from \"./prompt.vue?vue&type=script&lang=ts&\"\nexport * from \"./prompt.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./prompt.vue?vue&type=style&index=0&id=391b52fc&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"391b52fc\",\n  null\n  \n)\n\nexport default component.exports","// Reference: https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\r\nexport function uuidv4(): string {\r\n    return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, c => {\r\n        const r = (Math.random() * 16) | 0;\r\n        const v = c === \"x\" ? r : (r & 0x3) | 0x8;\r\n        return v.toString(16);\r\n    });\r\n}\r\n\r\nexport function capitalize(text: string): string {\r\n    return text.charAt(0).toUpperCase() + text.slice(1);\r\n}\r\n\r\nexport function alphSort(a: string, b: string): number {\r\n    if (a.toLowerCase() < b.toLowerCase()) return -1;\r\n    else return 1;\r\n}\r\n\r\nexport function getHTMLFont(element: HTMLElement): string {\r\n    let font = element.style.font;\r\n    while (font === null && element.parentElement !== null) {\r\n        element = element.parentElement;\r\n        font = element.style.font;\r\n    }\r\n    if (font === null) font = window.getComputedStyle(document.body).getPropertyValue(\"font\");\r\n    return font;\r\n}\r\n\r\nexport function getHTMLTextWidth(text: string, font: string): number {\r\n    let fakeElement = <HTMLCanvasElement>document.getElementById(\"emptycanvas\");\r\n    if (fakeElement === null) {\r\n        fakeElement = document.createElement(\"canvas\");\r\n        fakeElement.id = \"emptycanvas\";\r\n        fakeElement.style.display = \"\";\r\n        document.body.appendChild(fakeElement);\r\n    }\r\n    const ctx = fakeElement.getContext(\"2d\")!;\r\n    ctx.font = font;\r\n    return Math.ceil(ctx.measureText(text).width);\r\n}\r\n\r\nexport function partition<T>(arr: T[], predicate: (n: T) => boolean): T[][] {\r\n    const ret: T[][] = [[], []];\r\n    arr.forEach(n => (predicate(n) ? ret[1].push(n) : ret[0].push(n)));\r\n    return ret;\r\n}\r\n\r\nexport function calcFontScale(ctx: CanvasRenderingContext2D, text: string, width: number, height: number): number {\r\n    const points = Number(ctx.font.split(\"px\")[0]) * 0.2;\r\n    const fontWidth = ctx.measureText(text).width;\r\n    return Math.min(width / fontWidth, height / points);\r\n}\r\n\r\nexport function fixedEncodeURIComponent(str: string): string {\r\n    return encodeURIComponent(str).replace(/[!'()*]/g, c => {\r\n        return \"%\" + c.charCodeAt(0).toString(16);\r\n    });\r\n}\r\n\r\nexport class OrderedMap<K, V> {\r\n    keys: K[] = [];\r\n    values: V[] = [];\r\n\r\n    get length(): number {\r\n        return this.keys.length;\r\n    }\r\n\r\n    get(key: K): V {\r\n        return this.values[this.keys.indexOf(key)];\r\n    }\r\n    getIndexValue(idx: number): V {\r\n        return this.values[idx];\r\n    }\r\n    getIndexKey(idx: number): K {\r\n        return this.keys[idx];\r\n    }\r\n    set(key: K, value: V): void {\r\n        this.keys.push(key);\r\n        this.values.push(value);\r\n    }\r\n    has(key: K): boolean {\r\n        return this.indexOf(key) >= 0;\r\n    }\r\n    indexOf(element: K): number {\r\n        return this.keys.indexOf(element);\r\n    }\r\n    remove(element: K): void {\r\n        const idx = this.indexOf(element);\r\n        this.keys.splice(idx, 1);\r\n        this.values.splice(idx, 1);\r\n    }\r\n}\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport AssetContextMenu from \"@/assetManager/contextMenu.vue\";\r\nimport ConfirmDialog from \"@/core/components/modals/confirm.vue\";\r\nimport Prompt from \"@/core/components/modals/prompt.vue\";\r\n\r\nimport { socket } from \"@/assetManager/socket\";\r\nimport { assetStore } from \"@/assetManager/store\";\r\nimport { Asset } from \"@/core/comm/types\";\r\nimport { uuidv4 } from \"@/core/utils\";\r\n\r\n@Component({\r\n    components: {\r\n        Prompt,\r\n        ConfirmDialog,\r\n        AssetContextMenu,\r\n    },\r\n    beforeRouteEnter(to, from, next) {\r\n        socket.connect();\r\n        next();\r\n    },\r\n    beforeRouteLeave(to, from, next) {\r\n        socket.disconnect();\r\n        next();\r\n    },\r\n})\r\nexport default class AssetManager extends Vue {\r\n    path: number[] = [];\r\n    draggingSelection = false;\r\n\r\n    get folders(): number[] {\r\n        return assetStore.folders;\r\n    }\r\n\r\n    get files(): number[] {\r\n        return assetStore.files;\r\n    }\r\n\r\n    get selected(): number[] {\r\n        return assetStore.selected;\r\n    }\r\n\r\n    get idMap() {\r\n        return assetStore.idMap;\r\n    }\r\n\r\n    get currentFolder(): number {\r\n        if (this.path.length) return this.path[this.path.length - 1];\r\n        return assetStore.root;\r\n    }\r\n    get parentFolder(): number {\r\n        let parent = this.path[this.path.length - 2];\r\n        if (parent === undefined) parent = assetStore.root;\r\n        return parent;\r\n    }\r\n    get firstSelectedFile(): Asset | null {\r\n        for (const sel of assetStore.selected) {\r\n            if (assetStore.idMap.get(sel)!.file_hash) {\r\n                return assetStore.idMap.get(sel)!;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    changeDirectory(nextFolder: number) {\r\n        if (nextFolder < 0) this.path.pop();\r\n        else this.path.push(nextFolder);\r\n        assetStore.clearSelected();\r\n        socket.emit(\"Folder.Get\", this.currentFolder);\r\n    }\r\n    createDirectory() {\r\n        const name = window.prompt(\"New folder name\");\r\n        if (name !== null) {\r\n            socket.emit(\"Folder.Create\", { name, parent: this.currentFolder });\r\n        }\r\n    }\r\n    moveInode(inode: number, target: number) {\r\n        if (assetStore.files.includes(inode)) assetStore.files.splice(assetStore.files.indexOf(inode), 1);\r\n        else assetStore.folders.splice(assetStore.folders.indexOf(inode), 1);\r\n        assetStore.idMap.delete(inode);\r\n        socket.emit(\"Inode.Move\", { inode, target });\r\n    }\r\n    select(event: MouseEvent, inode: number) {\r\n        if (event.shiftKey && assetStore.selected.length > 0) {\r\n            const inodes = [...assetStore.files, ...assetStore.folders];\r\n            const start = inodes.indexOf(assetStore.selected[assetStore.selected.length - 1]);\r\n            const end = inodes.indexOf(inode);\r\n            for (let i = start; i !== end; start < end ? i++ : i--) {\r\n                if (i === start) continue;\r\n                assetStore.selected.push(inodes[i]);\r\n            }\r\n            assetStore.selected.push(inodes[end]);\r\n        } else {\r\n            if (!event.ctrlKey) {\r\n                assetStore.clearSelected();\r\n            }\r\n            assetStore.selected.push(inode);\r\n        }\r\n    }\r\n    startDrag(event: DragEvent, file: number) {\r\n        if (event.dataTransfer === null) return;\r\n        event.dataTransfer.setData(\"Hack\", \"ittyHack\");\r\n        event.dataTransfer.dropEffect = \"move\";\r\n        if (!assetStore.selected.includes(file)) assetStore.selected.push(file);\r\n        this.draggingSelection = true;\r\n    }\r\n    moveDrag(event: DragEvent) {\r\n        if ((<HTMLElement>event.target).classList.contains(\"folder\"))\r\n            (<HTMLElement>event.target).classList.add(\"inode-selected\");\r\n    }\r\n    leaveDrag(event: DragEvent) {\r\n        if ((<HTMLElement>event.target).classList.contains(\"folder\"))\r\n            (<HTMLElement>event.target).classList.remove(\"inode-selected\");\r\n    }\r\n    stopDrag(event: DragEvent, target: number) {\r\n        (<HTMLElement>event.target).classList.remove(\"inode-selected\");\r\n        if (this.draggingSelection) {\r\n            if (\r\n                (target === assetStore.root || assetStore.folders.includes(target)) &&\r\n                !assetStore.selected.includes(target)\r\n            ) {\r\n                for (const inode of assetStore.selected) {\r\n                    this.moveInode(inode, target);\r\n                }\r\n            }\r\n            assetStore.clearSelected();\r\n        } else if (event.dataTransfer && event.dataTransfer.files.length > 0) {\r\n            this.upload(event.dataTransfer.files, target);\r\n        }\r\n        this.draggingSelection = false;\r\n    }\r\n    prepareUpload() {\r\n        document.getElementById(\"files\")!.click();\r\n    }\r\n    upload(fls?: FileList, target?: number) {\r\n        const files = (<HTMLInputElement>document.getElementById(\"files\")!).files;\r\n        if (fls === undefined) {\r\n            if (files) fls = files;\r\n            else return;\r\n        }\r\n        if (target === undefined) target = this.currentFolder;\r\n        const CHUNK_SIZE = 100000;\r\n        for (const file of fls) {\r\n            const uuid = uuidv4();\r\n            const slices = Math.ceil(file.size / CHUNK_SIZE);\r\n            for (let slice = 0; slice < slices; slice++) {\r\n                const fr = new FileReader();\r\n                fr.readAsArrayBuffer(\r\n                    file.slice(\r\n                        slice * CHUNK_SIZE,\r\n                        slice * CHUNK_SIZE + Math.min(CHUNK_SIZE, file.size - slice * CHUNK_SIZE),\r\n                    ),\r\n                );\r\n                fr.onload = _e => {\r\n                    socket.emit(\"Asset.Upload\", {\r\n                        name: file.name,\r\n                        directory: target,\r\n                        data: fr.result,\r\n                        slice,\r\n                        totalSlices: slices,\r\n                        uuid,\r\n                    });\r\n                };\r\n            }\r\n        }\r\n    }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./manager.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./manager.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./manager.vue?vue&type=template&id=299e7717&\"\nimport script from \"./manager.vue?vue&type=script&lang=ts&\"\nexport * from \"./manager.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./manager.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('form',{on:{\"focusin\":_vm.focusin,\"focusout\":_vm.focusout,\"submit\":function($event){$event.preventDefault();return _vm.login($event)}}},[_c('fieldset',[_c('legend',{staticClass:\"legend\"},[_vm._v(\"PlanarAlly\")]),_c('div',{staticClass:\"input\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.username),expression:\"username\"}],attrs:{\"type\":\"text\",\"name\":\"username\",\"placeholder\":\"Username\",\"autocomplete\":\"username\",\"required\":\"\"},domProps:{\"value\":(_vm.username)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.username=$event.target.value}}}),_vm._m(0)]),_c('div',{staticClass:\"input\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.password),expression:\"password\"}],attrs:{\"type\":\"password\",\"name\":\"password\",\"placeholder\":\"Password\",\"autocomplete\":\"current-password\",\"required\":\"\"},domProps:{\"value\":(_vm.password)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.password=$event.target.value}}}),_vm._m(1)]),_c('div',{staticStyle:{\"display\":\"flex\"}},[_c('button',{staticStyle:{\"visibility\":\"hidden\",\"display\":\"none\"},attrs:{\"type\":\"submit\",\"name\":\"login\"}}),_c('button',{staticClass:\"submit\",attrs:{\"type\":\"button\",\"name\":\"register\",\"title\":\"Register\"},on:{\"click\":_vm.register}},[_c('i',{staticClass:\"fas fa-plus\"})]),_vm._m(2)])]),(_vm.error)?_c('div',{staticClass:\"feedback\"},[_c('p',{staticClass:\"error\"},[_c('strong',[_vm._v(\"Error:\")]),_vm._v(\"\\n            \"+_vm._s(_vm.error)+\"\\n        \")])]):_vm._e()])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',[_c('i',{staticClass:\"fas fa-user-circle\"})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',[_c('i',{staticClass:\"fas fa-lock\"})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('button',{staticClass:\"submit\",attrs:{\"type\":\"submit\",\"name\":\"login\",\"title\":\"Login\"}},[_c('i',{staticClass:\"fas fa-arrow-right\"})])}]\n\nexport { render, staticRenderFns }","import { getModule, Module, Mutation, VuexModule } from \"vuex-module-decorators\";\r\n\r\nimport { rootStore } from \"@/store\";\r\n\r\nexport interface CoreState {\r\n    authenticated: boolean;\r\n    initialized: boolean;\r\n    username: string;\r\n}\r\n\r\n@Module({ dynamic: true, store: rootStore, name: \"core\" })\r\nclass CoreStore extends VuexModule implements CoreState {\r\n    authenticated = false;\r\n    initialized = false;\r\n    username = \"\";\r\n\r\n    @Mutation\r\n    setAuthenticated(auth: boolean): void {\r\n        this.authenticated = auth;\r\n    }\r\n\r\n    @Mutation\r\n    setInitialized(init: boolean): void {\r\n        this.initialized = init;\r\n    }\r\n\r\n    @Mutation\r\n    setUsername(username: string): void {\r\n        this.username = username;\r\n    }\r\n}\r\n\r\nexport const coreStore = getModule(CoreStore);\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport axios, { AxiosError, AxiosResponse } from \"axios\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { coreStore } from \"@/core/store\";\r\n\r\n@Component\r\nexport default class Login extends Vue {\r\n    username = \"\";\r\n    password = \"\";\r\n    error = \"\";\r\n\r\n    login() {\r\n        axios\r\n            .post(\"/api/login\", {\r\n                username: this.username,\r\n                password: this.password,\r\n            })\r\n            .then((_response: AxiosResponse) => {\r\n                coreStore.setUsername(this.username);\r\n                coreStore.setAuthenticated(true);\r\n                this.$router.push(<string>this.$route.query.redirect || \"/\");\r\n            })\r\n            .catch((error: AxiosError) => {\r\n                if (error.response) this.error = error.response.statusText;\r\n                else this.error = \"Unknown error occured\";\r\n            });\r\n    }\r\n\r\n    register() {\r\n        axios\r\n            .post(\"/api/register\", {\r\n                username: this.username,\r\n                password: this.password,\r\n            })\r\n            .then((_response: AxiosResponse) => {\r\n                coreStore.setUsername(this.username);\r\n                coreStore.setAuthenticated(true);\r\n                this.$router.push(<string>this.$route.query.redirect || \"/\");\r\n            })\r\n            .catch((error: AxiosError) => {\r\n                if (error.response) this.error = error.response.statusText;\r\n                else this.error = \"Unknown error occured\";\r\n            });\r\n    }\r\n\r\n    focusin(event: { target?: { nextElementSibling?: HTMLElement } }) {\r\n        if (event.target && event.target.nextElementSibling) {\r\n            const span = event.target.nextElementSibling;\r\n            span.style.opacity = \"0\";\r\n        }\r\n    }\r\n\r\n    focusout(event: { target?: { nextElementSibling?: HTMLElement } }) {\r\n        if (event.target && event.target.nextElementSibling) {\r\n            const span = event.target.nextElementSibling;\r\n            span.style.opacity = \"1\";\r\n        }\r\n    }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./login.vue?vue&type=template&id=6062c8f4&scoped=true&\"\nimport script from \"./login.vue?vue&type=script&lang=ts&\"\nexport * from \"./login.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./login.vue?vue&type=style&index=0&id=6062c8f4&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6062c8f4\",\n  null\n  \n)\n\nexport default component.exports","import Axios from \"axios\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport { Route } from \"vue-router\";\r\n\r\nimport { coreStore } from \"@/core/store\";\r\n\r\nComponent.registerHooks([\"beforeRouteEnter\"]);\r\n\r\n@Component({})\r\nexport default class Logout extends Vue {\r\n    // eslint-disable-next-line no-empty-pattern\r\n    beforeRouteEnter(to: Route, from: Route, next: ({}) => {}): void {\r\n        Axios.post(\"/api/logout\").then(() => {\r\n            coreStore.setAuthenticated(false);\r\n            coreStore.setUsername(\"\");\r\n            next({ path: \"/auth/login\" });\r\n        });\r\n    }\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_vm._v(_vm._s(_vm.message))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\n@Component\r\nexport default class LoadComponent extends Vue {\r\n    message = \"Loading...\";\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./load.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./load.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./load.vue?vue&type=template&id=6d2dfb9c&\"\nimport script from \"./load.vue?vue&type=script&lang=ts&\"\nexport * from \"./load.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"formcontainer\"}},[(_vm.owned || _vm.joined)?_c('form',[_c('fieldset',[_c('legend',{staticClass:\"legend\"},[_vm._v(\"Your sessions\")]),_c('div',{staticClass:\"input\"},[_vm._l((_vm.owned),function(room,i){return _c('router-link',{key:'o-' + i,attrs:{\"to\":'/game/' + encodeURIComponent(room[1]) + '/' + encodeURIComponent(room[0])}},[_vm._v(\"\\n                    \"+_vm._s(room[0])+\"\\n                \")])}),_vm._l((_vm.joined),function(room,i){return _c('router-link',{key:'j-' + i,attrs:{\"to\":'/game/' + encodeURIComponent(room[1]) + '/' + encodeURIComponent(room[0])}},[_vm._v(\"\\n                    \"+_vm._s(room[1])+\"/\"+_vm._s(room[0])+\"\\n                \")])})],2),(_vm.owned.length === 0)?_c('div',{staticClass:\"input\"},[_vm._v(\"No active sessions\")]):_vm._e()])]):_vm._e(),_vm._m(0),_c('form',{on:{\"submit\":function($event){$event.preventDefault();return _vm.createRoom($event)}}},[_c('fieldset',[(!_vm.owned && !_vm.joined)?_c('legend',{staticClass:\"legend\"},[_vm._v(\"Create a session\")]):_c('div',{staticClass:\"input\"},[_vm._v(\"Create a new session\")]),_c('div',{staticClass:\"input\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.newSessionName),expression:\"newSessionName\"}],attrs:{\"type\":\"text\",\"name\":\"room_name\",\"placeholder\":\"Session Name\"},domProps:{\"value\":(_vm.newSessionName)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.newSessionName=$event.target.value}}}),_vm._m(1)]),_vm._m(2)])]),_c('div',{attrs:{\"id\":\"account-options\"}},[_c('form',{on:{\"submit\":function($event){$event.preventDefault();}}},[_c('router-link',{staticClass:\"submit\",attrs:{\"tag\":\"button\",\"title\":\"Account Settings\",\"to\":\"/account\"}},[_c('i',{staticClass:\"fas fa-cog\"})])],1),_c('form',{on:{\"submit\":function($event){$event.preventDefault();}}},[_c('router-link',{staticClass:\"submit\",attrs:{\"tag\":\"button\",\"title\":\"Logout\",\"to\":\"/auth/logout\"}},[_c('i',{staticClass:\"fas fa-sign-out-alt\"})])],1)])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h4',[_c('span',[_vm._v(\"OR\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',[_c('i',{staticClass:\"fab fa-d-and-d\"})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('button',{staticClass:\"submit\",attrs:{\"type\":\"submit\",\"title\":\"Create\"}},[_c('i',{staticClass:\"fas fa-arrow-right\"})])}]\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport axios, { AxiosError, AxiosResponse } from \"axios\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport { Route } from \"vue-router\";\r\n\r\nimport { coreStore } from \"@/core/store\";\r\n\r\nComponent.registerHooks([\"beforeRouteEnter\"]);\r\n\r\n@Component\r\nexport default class Dashboard extends Vue {\r\n    owned = [];\r\n    joined = [];\r\n    error = \"\";\r\n\r\n    newSessionName = \"\";\r\n\r\n    // eslint-disable-next-line no-empty-pattern\r\n    beforeRouteEnter(to: Route, from: Route, next: ({}) => {}) {\r\n        axios\r\n            .get(\"/api/rooms\")\r\n            .then((response: AxiosResponse) => {\r\n                next((vm: this) => {\r\n                    vm.owned = response.data.owned;\r\n                    vm.joined = response.data.joined;\r\n                });\r\n            })\r\n            .catch((err: AxiosError) => {\r\n                next((vm: this) => {\r\n                    vm.error = err.message;\r\n                });\r\n            });\r\n    }\r\n\r\n    createRoom(_event: Event) {\r\n        axios\r\n            .post(\"/api/rooms\", {\r\n                name: this.newSessionName,\r\n            })\r\n            .then((_response: AxiosResponse) => {\r\n                this.$router.push(\r\n                    `/game/${encodeURIComponent(coreStore.username)}/${encodeURIComponent(this.newSessionName)}`,\r\n                );\r\n            })\r\n            .catch((err: AxiosError) => {\r\n                this.error = err.message;\r\n            });\r\n    }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./main.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./main.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./main.vue?vue&type=template&id=f34c77ee&scoped=true&\"\nimport script from \"./main.vue?vue&type=script&lang=ts&\"\nexport * from \"./main.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./main.vue?vue&type=style&index=0&id=f34c77ee&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f34c77ee\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"main\"},on:{\"mouseleave\":_vm.mouseleave,\"wheel\":_vm.zoom}},[(_vm.showUI)?_c('menu-bar'):_vm._e(),_c('div',{attrs:{\"id\":\"board\"}},[(_vm.ready.manager)?[_c('tool-bar',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showUI),expression:\"showUI\"}],ref:\"tools\"})]:_vm._e(),_c('div',{attrs:{\"id\":\"layers\"},on:{\"mousedown\":_vm.mousedown,\"mouseup\":_vm.mouseup,\"mousemove\":_vm.mousemove,\"contextmenu\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.contextmenu($event)},\"dragover\":function($event){$event.preventDefault();},\"drop\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.drop($event)}}}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showUI && _vm.layers.length > 1),expression:\"showUI && layers.length > 1\"}],attrs:{\"id\":\"layerselect\"}},[_c('ul',_vm._l((_vm.layers),function(layer){return _c('li',{key:layer.name,class:{ 'layer-selected': layer === _vm.selectedLayer },on:{\"mousedown\":function($event){return _vm.selectLayer(layer)}}},[_c('a',{attrs:{\"href\":\"#\"}},[_vm._v(_vm._s(layer))])])}),0)])],2),_c('selection-info',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showUI),expression:\"showUI\"}],ref:\"selectionInfo\"}),_c('initiative-dialog',{ref:\"initiative\",attrs:{\"id\":\"initiativedialog\"}}),_c('note-dialog',{ref:\"note\"}),_c('label-dialog',{ref:\"labels\"}),(_vm.IS_DM || _vm.FAKE_PLAYER)?_c('dm-settings',{ref:\"dmsettings\"}):_vm._e(),_c('div',{attrs:{\"id\":\"zoomer\"}},[_c('zoom-slider',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showUI),expression:\"showUI\"}],attrs:{\"id\":\"zoomer\",\"height\":6,\"width\":200,\"min\":0,\"max\":1,\"interval\":0.1,\"dot-size\":[8, 20],\"dot-options\":{ style: { 'border-radius': '15%', 'z-index': 11 } },\"tooltip-placement\":'bottom',\"tooltip\":'focus',\"tooltip-formatter\":_vm.zoomDisplay.toFixed(1),\"rail-style\":{ 'background-color': '#fff', 'box-shadow': '0.5px 0.5px 3px 1px rgba(0, 0, 0, .36)' },\"process-style\":{ 'background-color': '#fff' }},model:{value:(_vm.zoomDisplay),callback:function ($$v) {_vm.zoomDisplay=$$v},expression:\"zoomDisplay\"}})],1),_c('prompt-dialog',{ref:\"prompt\"}),_c('confirm-dialog',{ref:\"confirm\"})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import io from \"socket.io-client\";\r\nimport { Route } from \"vue-router\";\r\n\r\nexport const socket = io(location.protocol + \"//\" + location.host + \"/planarally\", { autoConnect: false });\r\n\r\nexport function createConnection(route: Route): void {\r\n    socket.io.opts.query = `user=${decodeURIComponent(route.params.creator)}&room=${decodeURIComponent(\r\n        route.params.room,\r\n    )}`;\r\n    socket.connect();\r\n}\r\n","import Vue from \"vue\";\r\nexport const EventBus = new Vue();\r\n","/*\r\nThis module defines some Point classes.\r\nA strong focus is made to ensure that at no time a global and a local point are mixed up with each other.\r\nAt first glance this adds weird looking hacks as ts does not support nominal typing.\r\n*/\r\n\r\nexport function getPointDistance(p1: Point, p2: Point): number {\r\n    const a = p1.x - p2.x;\r\n    const b = p1.y - p2.y;\r\n    return Math.sqrt(a * a + b * b);\r\n}\r\n\r\nexport class Point {\r\n    readonly x: number;\r\n    readonly y: number;\r\n    constructor(x: number, y: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n    static fromArray(point: number[]): Point {\r\n        return new Point(point[0], point[1]);\r\n    }\r\n    add(vec: Vector): Point {\r\n        return new Point(this.x + vec.x, this.y + vec.y);\r\n    }\r\n    subtract(other: Point): Vector {\r\n        return new Vector(this.x - other.x, this.y - other.y);\r\n    }\r\n    clone(): Point {\r\n        return new Point(this.x, this.y);\r\n    }\r\n    get(dimension: 0 | 1): number {\r\n        if (dimension === 0) return this.x;\r\n        return this.y;\r\n    }\r\n    asArray(): number[] {\r\n        return [this.x, this.y];\r\n    }\r\n}\r\nexport class GlobalPoint extends Point {\r\n    // This is to differentiate with LocalPoint, is actually never used\r\n    // We do ! to prevent errors that it never gets initialized\r\n    // tslint:disable-next-line:variable-name\r\n    _GlobalPoint!: string;\r\n    add(vec: Vector): GlobalPoint {\r\n        return <GlobalPoint>super.add(vec);\r\n    }\r\n    subtract(other: GlobalPoint): Vector {\r\n        return super.subtract(other);\r\n    }\r\n    clone(): GlobalPoint {\r\n        return <GlobalPoint>super.clone();\r\n    }\r\n    static fromArray(point: number[]): GlobalPoint {\r\n        return new GlobalPoint(point[0], point[1]);\r\n    }\r\n}\r\n\r\nexport class LocalPoint extends Point {\r\n    // This is to differentiate with GlobalPoint, is actually never used\r\n    // We do ! to prevent errors that it never gets initialized\r\n    // tslint:disable-next-line:variable-name\r\n    _LocalPoint!: string;\r\n    add(vec: Vector): LocalPoint {\r\n        return <LocalPoint>super.add(vec);\r\n    }\r\n    subtract(other: LocalPoint): Vector {\r\n        return super.subtract(other);\r\n    }\r\n    clone(): LocalPoint {\r\n        return <LocalPoint>super.clone();\r\n    }\r\n}\r\n\r\nexport class Vector {\r\n    readonly x: number;\r\n    readonly y: number;\r\n    constructor(x: number, y: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n    dot(other: Vector): number {\r\n        return this.x * other.x + this.y * other.y;\r\n    }\r\n    inverse(): Vector {\r\n        return new Vector(this.x === 0 ? 0 : 1 / this.x, this.y === 0 ? 0 : 1 / this.y);\r\n    }\r\n    length(): number {\r\n        return Math.sqrt(Math.pow(this.x, 2) + Math.pow(this.y, 2));\r\n    }\r\n    normalize(): Vector {\r\n        const l = this.length();\r\n        return new Vector(this.x / l, this.y / l);\r\n    }\r\n    reverse(): Vector {\r\n        return new Vector(-this.x, -this.y);\r\n    }\r\n    multiply(scale: number): Vector {\r\n        return new Vector(this.x * scale, this.y * scale);\r\n    }\r\n    angle(): number {\r\n        return (Math.atan2(this.y, this.x) * 180) / Math.PI;\r\n    }\r\n}\r\n\r\nexport class Ray<T extends Point> {\r\n    readonly direction: Vector;\r\n    readonly origin: T;\r\n    tMax: number;\r\n    constructor(origin: T, direction: Vector, tMax?: number) {\r\n        this.direction = direction;\r\n        this.origin = origin;\r\n        if (tMax === undefined) tMax = Infinity;\r\n        this.tMax = tMax;\r\n    }\r\n    static fromPoints<T extends Point>(p1: T, p2: T): Ray<T> {\r\n        const vec = new Vector(p2.x - p1.x, p2.y - p1.y);\r\n        let maxT;\r\n        if (Math.abs(vec.x) > 0.01) maxT = (p2.x - p1.x) / vec.x;\r\n        else maxT = (p2.y - p1.y) / vec.y;\r\n        return new Ray(p1, vec, maxT);\r\n    }\r\n    get(t: number): T {\r\n        return <T>new Point(this.origin.x + t * this.direction.x, this.origin.y + t * this.direction.y);\r\n    }\r\n    getDistance(t1: number, t2: number): number {\r\n        return Math.sqrt(Math.pow(t2 - t1, 2) * (Math.pow(this.direction.x, 2) + Math.pow(this.direction.y, 2)));\r\n    }\r\n    getT(t1: number, distance: number): number {\r\n        return t1 + Math.sqrt(Math.pow(distance, 2) / (Math.pow(this.direction.x, 2) + Math.pow(this.direction.y, 2)));\r\n    }\r\n}\r\n","import { socket } from \"@/game/api/socket\";\r\n\r\nexport function sendClientOptions(locationOptions: { panX: number; panY: number; zoomFactor: number }): void {\r\n    socket.emit(\"Client.Options.Set\", { locationOptions });\r\n}\r\n","import { GlobalPoint, LocalPoint, Ray } from \"@/game/geom\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\nexport function g2l(obj: GlobalPoint): LocalPoint {\r\n    const z = gameStore.zoomFactor;\r\n    const panX = gameStore.panX;\r\n    const panY = gameStore.panY;\r\n    return new LocalPoint((obj.x + panX) * z, (obj.y + panY) * z);\r\n}\r\n\r\nexport function g2lx(x: number): number {\r\n    return g2l(new GlobalPoint(x, 0)).x;\r\n}\r\n\r\nexport function g2ly(y: number): number {\r\n    return g2l(new GlobalPoint(0, y)).y;\r\n}\r\n\r\nexport function g2lz(z: number): number {\r\n    return z * gameStore.zoomFactor;\r\n}\r\n\r\nexport function getUnitDistance(r: number): number {\r\n    return (r / gameStore.unitSize) * gameStore.gridSize;\r\n}\r\n\r\nexport function g2lr(r: number): number {\r\n    return g2lz(getUnitDistance(r));\r\n}\r\n\r\nexport function l2g(obj: LocalPoint): GlobalPoint;\r\nexport function l2g(obj: Ray<LocalPoint>): Ray<GlobalPoint>;\r\nexport function l2g(obj: LocalPoint | Ray<LocalPoint>): GlobalPoint | Ray<GlobalPoint> {\r\n    const z = gameStore.zoomFactor;\r\n    const panX = gameStore.panX;\r\n    const panY = gameStore.panY;\r\n    if (obj instanceof LocalPoint) {\r\n        return new GlobalPoint(obj.x / z - panX, obj.y / z - panY);\r\n    } else {\r\n        return new Ray<GlobalPoint>(l2g(obj.origin), obj.direction.multiply(1 / z), obj.tMax);\r\n    }\r\n}\r\n\r\nexport function l2gx(x: number): number {\r\n    return l2g(new LocalPoint(x, 0)).x;\r\n}\r\n\r\nexport function l2gy(y: number): number {\r\n    return l2g(new LocalPoint(0, y)).y;\r\n}\r\n\r\nexport function l2gz(z: number): number {\r\n    return z / gameStore.zoomFactor;\r\n}\r\n\r\nexport function l2gr(r: number): number {\r\n    return l2gz(getUnitDistance(r));\r\n}\r\n\r\n(<any>window).g2lx = g2lx;\r\n(<any>window).g2ly = g2ly;\r\n","import tinycolor from \"tinycolor2\";\r\n\r\nimport { LocalPoint } from \"@/game/geom\";\r\nimport { gameStore } from \"./store\";\r\n\r\nexport function getMouse(e: MouseEvent): LocalPoint {\r\n    return new LocalPoint(e.pageX, e.pageY);\r\n}\r\n\r\nexport function zoomValue(display: number): number {\r\n    // Powercurve 0.2/3/10\r\n    // Based on https://stackoverflow.com/a/17102320\r\n    return 1 / (-5 / 3 + (28 / 15) * Math.exp(1.83 * display));\r\n}\r\n\r\nexport function zoomDisplay(value: number): number {\r\n    return Math.log((1 / value + 5 / 3) * (15 / 28)) / 1.83;\r\n}\r\n\r\nexport function equalPoints(a: number[], b: number[]): boolean {\r\n    return a[0] === b[0] && a[1] === b[1];\r\n}\r\n\r\nexport function getFogColour(opposite: boolean = false): string {\r\n    const tc = tinycolor(gameStore.fowColour);\r\n    if (gameStore.IS_DM) tc.setAlpha(opposite ? 1 : gameStore.fowOpacity);\r\n    else tc.setAlpha(1);\r\n    return tc.toRgbString();\r\n}\r\n","import Vue from \"vue\";\r\nimport { rootStore } from \"@/store\";\r\nimport { Action, getModule, Module, Mutation, VuexModule } from \"vuex-module-decorators\";\r\n\r\nimport { AssetList } from \"@/core/comm/types\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { sendClientOptions } from \"@/game/api/utils\";\r\nimport { Note } from \"@/game/comm/types/general\";\r\nimport { ServerShape } from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { g2l, l2g } from \"@/game/units\";\r\nimport { zoomValue } from \"@/game/utils\";\r\n\r\nexport interface LocationOptions {\r\n    panX: number;\r\n    panY: number;\r\n    zoomFactor: number;\r\n}\r\n\r\nexport interface GameState {\r\n    boardInitialized: boolean;\r\n}\r\n\r\n@Module({ dynamic: true, store: rootStore, name: \"game\", namespaced: true })\r\nclass GameStore extends VuexModule implements GameState {\r\n    // This is a limited view of selectable layers that is used to generate the layer selection UI and ability to switch layers\r\n    // See the layerManager for proper layer management tools\r\n    layers: string[] = [];\r\n    selectedLayerIndex = -1;\r\n    boardInitialized = false;\r\n\r\n    locations: string[] = [];\r\n\r\n    assets: AssetList = {};\r\n\r\n    notes: Note[] = [];\r\n\r\n    IS_DM = false;\r\n    FAKE_PLAYER = false;\r\n    isLocked = false;\r\n    gridSize = 50;\r\n    username = \"\";\r\n    roomName = \"\";\r\n    roomCreator = \"\";\r\n    invitationCode = \"\";\r\n    players: { id: number; name: string }[] = [];\r\n\r\n    gridColour = \"rgba(0, 0, 0, 1)\";\r\n    fowColour = \"rgba(0, 0, 0, 1)\";\r\n    rulerColour = \"rgba(255, 0, 0, 1)\";\r\n    panX = 0;\r\n    panY = 0;\r\n\r\n    zoomDisplay = 0.5;\r\n    // zoomFactor = 1;\r\n\r\n    unitSize = 5;\r\n    useGrid = true;\r\n    fullFOW = false;\r\n    fowOpacity = 0.3;\r\n    fowLOS = false;\r\n    locationName = \"\";\r\n\r\n    visionSources: { shape: string; aura: string }[] = [];\r\n    annotations: string[] = [];\r\n    movementblockers: string[] = [];\r\n    ownedtokens: string[] = [];\r\n    _activeTokens: string[] = [];\r\n\r\n    drawTEContour = false;\r\n    visionRangeMin = 1640;\r\n    visionRangeMax = 3281;\r\n\r\n    clipboard: ServerShape[] = [];\r\n\r\n    // Maps are not yet supported in Vue untill 3.X, so for now we're using a plain old object\r\n    labels: { [uuid: string]: Label } = {};\r\n\r\n    filterNoLabel = false;\r\n    labelFilters: string[] = [];\r\n\r\n    showUI = true;\r\n\r\n    selectionHelperID: string | null = null;\r\n\r\n    get selectedLayer(): string {\r\n        return this.layers[this.selectedLayerIndex];\r\n    }\r\n\r\n    get zoomFactor(): number {\r\n        return zoomValue(this.zoomDisplay);\r\n    }\r\n\r\n    get locationOptions(): LocationOptions {\r\n        return {\r\n            panX: gameStore.panX,\r\n            panY: gameStore.panY,\r\n            zoomFactor: gameStore.zoomFactor,\r\n        };\r\n    }\r\n\r\n    get activeTokens(): string[] {\r\n        if (this._activeTokens.length === 0) return this.ownedtokens;\r\n        return this._activeTokens;\r\n    }\r\n\r\n    @Mutation\r\n    setSelectionHelperId(id: string): void {\r\n        this.selectionHelperID = id;\r\n    }\r\n\r\n    @Mutation\r\n    setFakePlayer(value: boolean): void {\r\n        this.FAKE_PLAYER = value;\r\n        this.IS_DM = !value;\r\n        layerManager.invalidate();\r\n    }\r\n\r\n    @Mutation\r\n    setZoomDisplay(zoom: number): void {\r\n        if (zoom === this.zoomDisplay) return;\r\n        if (zoom < 0) zoom = 0;\r\n        if (zoom > 1) zoom = 1;\r\n        this.zoomDisplay = zoom;\r\n        layerManager.invalidate();\r\n    }\r\n\r\n    @Mutation\r\n    setBoardInitialized(boardInitialized: boolean): void {\r\n        this.boardInitialized = boardInitialized;\r\n    }\r\n\r\n    @Mutation\r\n    toggleUnlabeledFilter(): void {\r\n        this.filterNoLabel = !this.filterNoLabel;\r\n    }\r\n\r\n    @Mutation\r\n    addLabel(label: Label): void {\r\n        Vue.set(this.labels, label.uuid, label);\r\n    }\r\n\r\n    @Mutation\r\n    setLabelFilters(filters: string[]): void {\r\n        this.labelFilters = filters;\r\n    }\r\n\r\n    @Mutation\r\n    setLabelVisibility(data: { user: string; uuid: string; visible: boolean }): void {\r\n        if (!(data.uuid in this.labels)) return;\r\n        this.labels[data.uuid].visible = data.visible;\r\n    }\r\n\r\n    @Mutation\r\n    deleteLabel(data: { uuid: string; user: string }): void {\r\n        if (!(data.uuid in this.labels)) return;\r\n        const label = this.labels[data.uuid];\r\n        const updatedLayers: Set<string> = new Set();\r\n        for (const shape of layerManager.UUIDMap.values()) {\r\n            const i = shape.labels.indexOf(label);\r\n            if (i >= 0) {\r\n                shape.labels.splice(i, 1);\r\n                updatedLayers.add(shape.layer);\r\n            }\r\n        }\r\n        for (const layer of updatedLayers) layerManager.getLayer(layer)!.invalidate(false);\r\n        Vue.delete(this.labels, data.uuid);\r\n    }\r\n\r\n    @Mutation\r\n    setDM(isDM: boolean): void {\r\n        this.IS_DM = isDM;\r\n    }\r\n\r\n    @Mutation\r\n    setUsername(username: string): void {\r\n        this.username = username;\r\n    }\r\n\r\n    @Mutation\r\n    setRoomName(name: string): void {\r\n        this.roomName = name;\r\n    }\r\n\r\n    @Mutation\r\n    setRoomCreator(name: string): void {\r\n        this.roomCreator = name;\r\n    }\r\n\r\n    @Mutation\r\n    setInvitationCode(code: string): void {\r\n        this.invitationCode = code;\r\n    }\r\n\r\n    @Mutation\r\n    addLayer(name: string): void {\r\n        this.layers.push(name);\r\n        if (this.selectedLayerIndex === -1) this.selectedLayerIndex = this.layers.indexOf(name);\r\n    }\r\n\r\n    @Mutation\r\n    selectLayer(data: { name: string; sync: boolean }): void {\r\n        const index = this.layers.indexOf(data.name);\r\n        if (index >= 0) this.selectedLayerIndex = index;\r\n        if (data.sync) socket.emit(\"Client.ActiveLayer.Set\", data.name);\r\n    }\r\n\r\n    @Mutation\r\n    newNote(data: { note: Note; sync: boolean }): void {\r\n        this.notes.push(data.note);\r\n        if (data.sync) socket.emit(\"Note.New\", data.note);\r\n    }\r\n\r\n    @Mutation\r\n    setAssets(assets: AssetList): void {\r\n        this.assets = assets;\r\n    }\r\n\r\n    @Mutation\r\n    setLocations(locations: string[]): void {\r\n        this.locations = locations;\r\n    }\r\n\r\n    @Mutation\r\n    resetLayerInfo(): void {\r\n        this.layers = [];\r\n        this.selectedLayerIndex = -1;\r\n    }\r\n\r\n    @Mutation\r\n    updateZoom(data: { newZoomDisplay: number; zoomLocation: GlobalPoint }): void {\r\n        if (data.newZoomDisplay === this.zoomDisplay) return;\r\n        if (data.newZoomDisplay < 0) data.newZoomDisplay = 0;\r\n        if (data.newZoomDisplay > 1) data.newZoomDisplay = 1;\r\n        const oldLoc = g2l(data.zoomLocation);\r\n        this.zoomDisplay = data.newZoomDisplay;\r\n        const newLoc = l2g(oldLoc);\r\n        // Change the pan settings to keep the zoomLocation in the same exact location before and after the zoom.\r\n        const diff = newLoc.subtract(data.zoomLocation);\r\n        this.panX += diff.x;\r\n        this.panY += diff.y;\r\n        layerManager.invalidate();\r\n        sendClientOptions(this.locationOptions);\r\n    }\r\n\r\n    @Mutation\r\n    setGridColour(data: { colour: string; sync: boolean }): void {\r\n        this.gridColour = data.colour;\r\n        layerManager.getGridLayer()!.drawGrid();\r\n        if (data.sync) socket.emit(\"Client.Options.Set\", { gridColour: data.colour });\r\n    }\r\n\r\n    @Mutation\r\n    setFOWColour(data: { colour: string; sync: boolean }): void {\r\n        this.fowColour = data.colour;\r\n        layerManager.invalidate();\r\n        if (data.sync) socket.emit(\"Client.Options.Set\", { fowColour: data.colour });\r\n    }\r\n\r\n    @Mutation\r\n    setRulerColour(data: { colour: string; sync: boolean }): void {\r\n        this.rulerColour = data.colour;\r\n        if (data.sync) socket.emit(\"Client.Options.Set\", { rulerColour: data.colour });\r\n    }\r\n\r\n    @Mutation\r\n    setPanX(x: number): void {\r\n        this.panX = x;\r\n    }\r\n\r\n    @Mutation\r\n    setPanY(y: number): void {\r\n        this.panY = y;\r\n    }\r\n\r\n    @Mutation\r\n    increasePanX(increase: number): void {\r\n        this.panX += increase;\r\n    }\r\n\r\n    @Mutation\r\n    increasePanY(increase: number): void {\r\n        this.panY += increase;\r\n    }\r\n\r\n    @Mutation\r\n    setUnitSize(data: { unitSize: number; sync: boolean }): void {\r\n        if (this.unitSize !== data.unitSize && data.unitSize > 0 && data.unitSize < Infinity) {\r\n            this.unitSize = data.unitSize;\r\n            layerManager.invalidate();\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            if (data.sync) socket.emit(\"Location.Options.Set\", { unit_size: data.unitSize });\r\n        }\r\n    }\r\n\r\n    @Mutation\r\n    setUseGrid(data: { useGrid: boolean; sync: boolean }): void {\r\n        if (this.useGrid !== data.useGrid) {\r\n            this.useGrid = data.useGrid;\r\n            const gridLayer = layerManager.getGridLayer()!;\r\n            if (data.useGrid) gridLayer.canvas.style.display = \"block\";\r\n            else gridLayer.canvas.style.display = \"none\";\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            if (data.sync) socket.emit(\"Location.Options.Set\", { use_grid: data.useGrid });\r\n        }\r\n    }\r\n\r\n    @Mutation\r\n    setGridSize(data: { gridSize: number; sync: boolean }): void {\r\n        if (this.gridSize !== data.gridSize && data.gridSize > 0) {\r\n            this.gridSize = data.gridSize;\r\n            const gridLayer = layerManager.getGridLayer();\r\n            if (gridLayer !== undefined) gridLayer.drawGrid();\r\n            if (data.sync) socket.emit(\"Gridsize.Set\", data.gridSize);\r\n        }\r\n    }\r\n\r\n    @Mutation\r\n    setVisionRangeMin(data: { value: number; sync: boolean }): void {\r\n        this.visionRangeMin = data.value;\r\n        layerManager.invalidateLight();\r\n        // eslint-disable-next-line @typescript-eslint/camelcase\r\n        if (data.sync) socket.emit(\"Location.Options.Set\", { vision_min_range: data.value });\r\n    }\r\n\r\n    @Mutation\r\n    setVisionRangeMax(data: { value: number; sync: boolean }): void {\r\n        this.visionRangeMax = Math.max(data.value, this.visionRangeMin);\r\n        layerManager.invalidateLight();\r\n        // eslint-disable-next-line @typescript-eslint/camelcase\r\n        if (data.sync) socket.emit(\"Location.Options.Set\", { vision_max_range: this.visionRangeMax });\r\n    }\r\n\r\n    @Mutation\r\n    setFullFOW(data: { fullFOW: boolean; sync: boolean }): void {\r\n        if (this.fullFOW !== data.fullFOW) {\r\n            this.fullFOW = data.fullFOW;\r\n            layerManager.invalidateLight();\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            if (data.sync) socket.emit(\"Location.Options.Set\", { full_fow: data.fullFOW });\r\n        }\r\n    }\r\n\r\n    @Mutation\r\n    setFOWOpacity(data: { fowOpacity: number; sync: boolean }): void {\r\n        this.fowOpacity = data.fowOpacity;\r\n        layerManager.invalidateLight();\r\n        // eslint-disable-next-line @typescript-eslint/camelcase\r\n        if (data.sync) socket.emit(\"Location.Options.Set\", { fow_opacity: data.fowOpacity });\r\n    }\r\n\r\n    @Mutation\r\n    setLineOfSight(data: { fowLOS: boolean; sync: boolean }): void {\r\n        if (this.fowLOS !== data.fowLOS) {\r\n            this.fowLOS = data.fowLOS;\r\n            layerManager.invalidate();\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            if (data.sync) socket.emit(\"Location.Options.Set\", { fow_los: data.fowLOS });\r\n        }\r\n    }\r\n\r\n    @Mutation\r\n    setLocationName(name: string): void {\r\n        this.locationName = name;\r\n    }\r\n\r\n    @Mutation\r\n    updateNote(data: { note: Note; sync: boolean }): void {\r\n        const actualNote = this.notes.find(n => n.uuid === data.note.uuid);\r\n        if (actualNote === undefined) return;\r\n        actualNote.title = data.note.title;\r\n        actualNote.text = data.note.text;\r\n        if (data.sync) socket.emit(\"Note.Update\", actualNote);\r\n    }\r\n\r\n    @Mutation\r\n    removeNote(data: { note: Note; sync: boolean }): void {\r\n        this.notes = this.notes.filter(n => n.uuid !== data.note.uuid);\r\n        if (data.sync) socket.emit(\"Note.Remove\", data.note.uuid);\r\n    }\r\n\r\n    @Mutation\r\n    toggleUI(): void {\r\n        this.showUI = !this.showUI;\r\n    }\r\n\r\n    @Mutation\r\n    setClipboard(clipboard: ServerShape[]): void {\r\n        this.clipboard = clipboard;\r\n    }\r\n\r\n    @Mutation\r\n    setActiveTokens(tokens: string[]): void {\r\n        this._activeTokens = tokens;\r\n        layerManager.invalidateLight();\r\n    }\r\n\r\n    @Mutation\r\n    addActiveToken(token: string): void {\r\n        this._activeTokens.push(token);\r\n        layerManager.invalidateLight();\r\n    }\r\n\r\n    @Mutation\r\n    removeActiveToken(token: string): void {\r\n        if (this._activeTokens.length === 0) {\r\n            this._activeTokens = [...this.ownedtokens];\r\n        }\r\n        this._activeTokens.splice(this._activeTokens.indexOf(token), 1);\r\n        layerManager.invalidateLight();\r\n    }\r\n\r\n    @Mutation\r\n    setPlayers(players: { id: number; name: string }[]): void {\r\n        this.players = players;\r\n    }\r\n\r\n    @Mutation\r\n    addPlayer(player: { id: number; name: string }): void {\r\n        this.players.push(player);\r\n    }\r\n\r\n    @Mutation\r\n    kickPlayer(playerId: number): void {\r\n        this.players = this.players.filter(p => p.id !== playerId);\r\n    }\r\n\r\n    @Mutation\r\n    setIsLocked(data: { isLocked: boolean; sync: boolean }): void {\r\n        this.isLocked = data.isLocked;\r\n        if (data.sync) {\r\n            socket.emit(\"Room.Info.Set.Locked\", this.isLocked);\r\n        }\r\n    }\r\n\r\n    @Action\r\n    clear(): void {\r\n        (<any>this.context.state).visionSources = [];\r\n        (<any>this.context.state).ownedtokens = [];\r\n        (<any>this.context.state).annotations = [];\r\n        (<any>this.context.state).movementblockers = [];\r\n        (<any>this.context.state).notes = [];\r\n    }\r\n}\r\n\r\nexport const gameStore = getModule(GameStore);\r\n","import { GridLayer } from \"@/game/layers/grid\";\r\nimport { Layer } from \"@/game/layers/layer\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\nclass LayerManager {\r\n    layers: Layer[] = [];\r\n    width = window.innerWidth;\r\n    height = window.innerHeight;\r\n\r\n    UUIDMap: Map<string, Shape> = new Map();\r\n\r\n    // Refresh interval and redraw setter.\r\n    interval = 30;\r\n\r\n    constructor() {\r\n        requestAnimationFrame(this.drawLoop);\r\n    }\r\n\r\n    reset(): void {\r\n        this.layers = [];\r\n        this.UUIDMap = new Map();\r\n    }\r\n\r\n    drawLoop = () => {\r\n        for (let i = this.layers.length - 1; i >= 0; i--) {\r\n            this.layers[i].draw();\r\n        }\r\n        requestAnimationFrame(this.drawLoop);\r\n    };\r\n\r\n    setWidth(width: number): void {\r\n        this.width = width;\r\n        for (const layer of this.layers) {\r\n            layer.canvas.width = width;\r\n            layer.width = width;\r\n        }\r\n    }\r\n\r\n    setHeight(height: number): void {\r\n        this.height = height;\r\n        for (const layer of this.layers) {\r\n            layer.canvas.height = height;\r\n            layer.height = height;\r\n        }\r\n    }\r\n\r\n    addLayer(layer: Layer): void {\r\n        this.layers.push(layer);\r\n        if (!gameStore.IS_DM && !layer.playerEditable) return;\r\n        if (layer.selectable) gameStore.addLayer(layer.name);\r\n    }\r\n\r\n    hasLayer(name: string): boolean {\r\n        return this.layers.some(l => l.name === name);\r\n    }\r\n\r\n    getLayer(name?: string): Layer | undefined {\r\n        name = name === undefined ? gameStore.selectedLayer : name;\r\n        for (const layer of this.layers) {\r\n            if (layer.name === name) return layer;\r\n        }\r\n    }\r\n\r\n    selectLayer(name: string, sync: boolean = true): void {\r\n        let found = false;\r\n        for (const layer of this.layers) {\r\n            if (!layer.selectable) continue;\r\n            if (found && layer.name !== \"fow\") layer.ctx.globalAlpha = 0.3;\r\n            else layer.ctx.globalAlpha = 1.0;\r\n\r\n            if (name === layer.name) {\r\n                gameStore.selectLayer({ name, sync });\r\n                found = true;\r\n            }\r\n\r\n            layer.clearSelection();\r\n            layer.invalidate(true);\r\n        }\r\n    }\r\n\r\n    getGridLayer(): GridLayer | undefined {\r\n        return <GridLayer>this.getLayer(\"grid\");\r\n    }\r\n\r\n    hasSelection(): boolean {\r\n        const selection = this.getSelection();\r\n        return selection !== undefined && selection.length > 0;\r\n    }\r\n\r\n    // THIS INCLUDES POTENTIALLY THE SelectTool.SelectionHelper !!!\r\n    getSelection(): Shape[] | undefined {\r\n        const layer = this.getLayer();\r\n        if (layer === undefined) return undefined;\r\n        return layer.selection;\r\n    }\r\n\r\n    invalidate(): void {\r\n        for (let i = this.layers.length - 1; i >= 0; i--) {\r\n            this.layers[i].invalidate(true);\r\n        }\r\n    }\r\n\r\n    invalidateLight(): void {\r\n        for (let i = this.layers.length - 1; i >= 0; i--)\r\n            if (this.layers[i].isVisionLayer) this.layers[i].invalidate(true);\r\n    }\r\n}\r\n\r\nexport const layerManager = new LayerManager();\r\n(<any>window).lm = layerManager;\r\n","import { GlobalPoint, Point, Ray, Vector } from \"@/game/geom\";\r\nimport { g2lx, g2ly } from \"../units\";\r\n\r\nexport class BoundingRect {\r\n    readonly w: number;\r\n    readonly h: number;\r\n    readonly topLeft: GlobalPoint;\r\n    readonly topRight: GlobalPoint;\r\n    readonly botRight: GlobalPoint;\r\n    readonly botLeft: GlobalPoint;\r\n\r\n    constructor(topleft: GlobalPoint, w: number, h: number) {\r\n        this.w = w;\r\n        this.h = h;\r\n        this.topLeft = topleft;\r\n        this.topRight = new GlobalPoint(topleft.x + w, topleft.y);\r\n        this.botRight = new GlobalPoint(topleft.x + w, topleft.y + h);\r\n        this.botLeft = new GlobalPoint(topleft.x, topleft.y + h);\r\n    }\r\n\r\n    contains(point: GlobalPoint): boolean {\r\n        return (\r\n            this.topLeft.x <= point.x &&\r\n            this.topRight.x >= point.x &&\r\n            this.topLeft.y <= point.y &&\r\n            this.botLeft.y >= point.y\r\n        );\r\n    }\r\n\r\n    get points(): number[][] {\r\n        if (this.w === 0 || this.h === 0) return [[this.topLeft.x, this.topLeft.y]];\r\n        return [\r\n            [this.topLeft.x, this.topLeft.y],\r\n            [this.botLeft.x, this.botLeft.y],\r\n            [this.botRight.x, this.botRight.y],\r\n            [this.topRight.x, this.topRight.y],\r\n        ];\r\n    }\r\n\r\n    offset(vector: Vector): BoundingRect {\r\n        return new BoundingRect(this.topLeft.add(vector), this.w, this.h);\r\n    }\r\n\r\n    union(other: BoundingRect): BoundingRect {\r\n        const xmin = Math.min(this.topLeft.x, other.topLeft.x);\r\n        const xmax = Math.max(this.topRight.x, other.topRight.x);\r\n        const ymin = Math.min(this.topLeft.y, other.topLeft.y);\r\n        const ymax = Math.max(this.botLeft.y, other.botLeft.y);\r\n        return new BoundingRect(new GlobalPoint(xmin, ymin), xmax - xmin, ymax - ymin);\r\n    }\r\n\r\n    getDiagCorner(botright: boolean): GlobalPoint {\r\n        return botright ? this.botRight : this.topLeft;\r\n    }\r\n\r\n    intersectsWith(other: BoundingRect): boolean {\r\n        return !(\r\n            other.topLeft.x > this.topRight.x ||\r\n            other.topRight.x < this.topLeft.x ||\r\n            other.topLeft.y > this.botLeft.y ||\r\n            other.botLeft.y < this.topLeft.y\r\n        );\r\n    }\r\n\r\n    intersectsWithInner(other: BoundingRect): boolean {\r\n        return !(\r\n            other.topLeft.x >= this.topRight.x ||\r\n            other.topRight.x <= this.topLeft.x ||\r\n            other.topLeft.y >= this.botLeft.y ||\r\n            other.botLeft.y <= this.topLeft.y\r\n        );\r\n    }\r\n\r\n    intersectP(ray: Ray<Point>, invDir: Vector, dirIsNeg: boolean[]): { hit: boolean; min: number; max: number } {\r\n        let txmin = invDir.x * (this.getDiagCorner(dirIsNeg[0]).x - ray.origin!.x);\r\n        let txmax = invDir.x * (this.getDiagCorner(!dirIsNeg[0]).x - ray.origin!.x);\r\n        const tymin = invDir.y * (this.getDiagCorner(dirIsNeg[1]).y - ray.origin!.y);\r\n        const tymax = invDir.y * (this.getDiagCorner(!dirIsNeg[1]).y - ray.origin!.y);\r\n        if (txmin > tymax || tymin > txmax) return { hit: false, min: txmin, max: txmax };\r\n        if (tymin > txmin) txmin = tymin;\r\n        if (tymax < txmax) txmax = tymax;\r\n        return { hit: txmin < ray.tMax! && txmax > 0, min: txmin, max: txmax };\r\n    }\r\n\r\n    center(): GlobalPoint {\r\n        return this.topLeft.add(new Vector(this.w / 2, this.h / 2));\r\n    }\r\n\r\n    getMaxExtent(): 0 | 1 {\r\n        return this.w > this.h ? 0 : 1;\r\n    }\r\n    visibleInCanvas(canvas: HTMLCanvasElement): boolean {\r\n        const coreVisible = !(\r\n            g2lx(this.topLeft.x) > canvas.width ||\r\n            g2ly(this.topLeft.y) > canvas.height ||\r\n            g2lx(this.topRight.x) < 0 ||\r\n            g2ly(this.botRight.y) < 0\r\n        );\r\n        if (coreVisible) return true;\r\n        return false;\r\n    }\r\n}\r\n","import { ServerAura } from \"@/game/comm/types/shapes\";\r\n\r\nexport const aurasFromServer = (auras: ServerAura[]): Aura[] => {\r\n    const result = [];\r\n    for (const aura of auras) {\r\n        result.push({\r\n            uuid: aura.uuid,\r\n            visionSource: aura.vision_source,\r\n            visible: aura.visible,\r\n            name: aura.name,\r\n            value: aura.value,\r\n            dim: aura.dim,\r\n            colour: aura.colour,\r\n        });\r\n    }\r\n    return result;\r\n};\r\n\r\nexport const aurasToServer = (auras: Aura[]): ServerAura[] => {\r\n    const result = [];\r\n    for (const aura of auras) {\r\n        result.push({\r\n            uuid: aura.uuid,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            vision_source: aura.visionSource,\r\n            visible: aura.visible,\r\n            name: aura.name,\r\n            value: aura.value,\r\n            dim: aura.dim,\r\n            colour: aura.colour,\r\n        });\r\n    }\r\n    return result;\r\n};\r\n","import { EdgeCirculator, Point, Sign, Triangle, Vertex } from \"./tds\";\r\n\r\ntype Line = number[];\r\n\r\nexport function cw(index: number): number {\r\n    return (index + 2) % 3;\r\n}\r\n\r\nexport function ccw(index: number): number {\r\n    return (index + 1) % 3;\r\n}\r\n\r\nexport function edgeInfo(\r\n    va: Vertex,\r\n    vb: Vertex,\r\n): { includes: false } | { includes: true; vi: Vertex; fr: Triangle; i: number } {\r\n    const ec = new EdgeCirculator(va, null);\r\n    if (ec.valid) {\r\n        do {\r\n            const indv = 3 - ec.t!.indexV(va) - ec.ri;\r\n            const v = ec.t!.vertices[indv]!;\r\n            if (!v.infinite) {\r\n                if (v === vb) {\r\n                    return { includes: true, vi: vb, fr: ec.t!, i: ec.ri };\r\n                } else {\r\n                    const orient = orientation(va.point!, vb.point!, v.point!);\r\n                    if (orient === Sign.COLLINEAR && collinearBetween(va.point!, v.point!, vb.point!)) {\r\n                        return { includes: true, vi: v, fr: ec.t!, i: ec.ri };\r\n                    }\r\n                }\r\n            }\r\n        } while (ec.next());\r\n    }\r\n    return { includes: false };\r\n}\r\n\r\nexport function collinearBetween(p: Point, q: Point, r: Point): boolean {\r\n    let cPQ: Sign;\r\n    let cQR: Sign;\r\n    if (compare(0, p, r) === Sign.EQUAL) {\r\n        cPQ = compare(1, p, q);\r\n        cQR = compare(1, q, r);\r\n    } else {\r\n        cPQ = compare(0, p, q);\r\n        cQR = compare(0, q, r);\r\n    }\r\n    return (cPQ === Sign.SMALLER && cQR === Sign.SMALLER) || (cPQ === Sign.LARGER && cQR === Sign.LARGER);\r\n}\r\n\r\nfunction compare(index: number, a: Point, b: Point): Sign {\r\n    if (a[index] < b[index]) return Sign.SMALLER;\r\n    if (a[index] > b[index]) return Sign.LARGER;\r\n    return Sign.EQUAL;\r\n}\r\n\r\nexport function orientation(p: Point, q: Point, r: Point): Sign {\r\n    const px = p[0];\r\n    const py = p[1];\r\n    const qx = q[0];\r\n    const qy = q[1];\r\n    const rx = r[0];\r\n    const ry = r[1];\r\n    const pqx = qx - px;\r\n    const pqy = qy - py;\r\n    const prx = rx - px;\r\n    const pry = ry - py;\r\n    const det = determinant(pqx, pqy, prx, pry);\r\n    let maxX = Math.abs(pqx);\r\n    let maxY = Math.abs(pqy);\r\n    const aprX = Math.abs(prx);\r\n    const aprY = Math.abs(pry);\r\n    if (maxX < aprX) maxX = aprX;\r\n    if (maxY < aprY) maxY = aprY;\r\n    if (maxX > maxY) [maxX, maxY] = [maxY, maxX];\r\n    // underflow proection in eps computation?? Math.sqrt(Number.MIN_VALUE, Number.EPSILON)\r\n    if (maxX < 2e-162 && maxX === 0) {\r\n        return Sign.ZERO;\r\n    }\r\n    // overflow protection in det computation\r\n    if (maxY < 1e153) {\r\n        const eps = Number.EPSILON * maxX * maxY;\r\n        if (det > eps) return Sign.POSITIVE;\r\n        if (det < -eps) return Sign.NEGATIVE;\r\n    }\r\n    return Sign.ZERO;\r\n}\r\n\r\nexport function determinant(a00: number, a01: number, a10: number, a11: number): number {\r\n    return a00 * a11 - a01 * a10;\r\n}\r\n\r\nexport function hasInexactNegativeOrientation(p: Point, q: Point, r: Point): boolean {\r\n    return determinant(q[0] - p[0], q[1] - p[1], r[0] - p[0], r[1] - p[1]) < 0;\r\n}\r\n\r\nexport function sideOfOrientedCircle(t: Triangle, p: Point, perturb: boolean): Sign {\r\n    if (!t.isInfinite())\r\n        return sideOfOrientedCircleP(t.vertices[0]!.point!, t.vertices[1]!.point!, t.vertices[2]!.point!, p, perturb);\r\n    throw new Error(\"SSS\");\r\n}\r\n\r\nexport function sideOfOrientedCircleP(p0: Point, p1: Point, p2: Point, p: Point, perturb: boolean): Sign {\r\n    const os = getOrientedSide(p0, p1, p2, p);\r\n    if (os !== Sign.ON_ORIENTED_BOUNDARY || !perturb) return os;\r\n    const points = [p0, p1, p2, p];\r\n    points.sort((a, b) => a[0] - b[0] || a[1] - b[1]);\r\n    for (const point of points.reverse()) {\r\n        if (point === p) return Sign.ON_NEGATIVE_SIDE;\r\n        let o = orientation(p0, p1, p);\r\n        if (point === p2 && o !== Sign.COLLINEAR) return o;\r\n        o = orientation(p0, p, p2);\r\n        if (point === p1 && o !== Sign.COLLINEAR) return o;\r\n        o = orientation(p, p1, p2);\r\n        if (point === p0 && o !== Sign.COLLINEAR) return o;\r\n    }\r\n    return Sign.ON_NEGATIVE_SIDE;\r\n}\r\n\r\nexport function xyEqual(p: Point, q: Point): boolean {\r\n    return p[0] === q[0] && p[1] === q[1];\r\n}\r\n\r\nexport function xySmaller(p: Point, q: Point): boolean {\r\n    return p[0] < q[0] || (p[0] === q[0] && p[1] < q[1]);\r\n}\r\n\r\nexport function xyCompare(p: Point, q: Point): Sign {\r\n    if (xySmaller(p, q)) return Sign.SMALLER;\r\n    if (xyEqual(p, q)) return Sign.EQUAL;\r\n    return Sign.LARGER;\r\n}\r\n\r\nfunction getOrientedSide(p: Point, q: Point, r: Point, t: Point): Sign {\r\n    const qpx = q[0] - p[0];\r\n    const qpy = q[1] - p[1];\r\n    const rpx = r[0] - p[0];\r\n    const rpy = r[1] - p[1];\r\n    const tpx = t[0] - p[0];\r\n    const tpy = t[1] - p[1];\r\n    const tqx = t[0] - q[0];\r\n    const tqy = t[1] - q[1];\r\n    const rqx = r[0] - q[0];\r\n    const rqy = r[1] - q[1];\r\n\r\n    const det = determinant(qpx * tpy - qpy * tpx, tpx * tqx + tpy * tqy, qpx * rpy - qpy * rpx, rpx * rqx + rpy * rqy);\r\n    let maxx = Math.abs(qpx);\r\n    let maxy = Math.abs(qpy);\r\n    const arpx = Math.abs(rpx);\r\n    const arpy = Math.abs(rpy);\r\n    const atqx = Math.abs(tqx);\r\n    const atqy = Math.abs(tqy);\r\n    const atpx = Math.abs(tpx);\r\n    const atpy = Math.abs(tpy);\r\n    const arqx = Math.abs(rqx);\r\n    const arqy = Math.abs(rqy);\r\n\r\n    if (maxx < arpx) maxx = arpx;\r\n    if (maxx < atpx) maxx = atpx;\r\n    if (maxx < atqx) maxx = atqx;\r\n    if (maxx < arqx) maxx = arqx;\r\n\r\n    if (maxy < arpy) maxy = arpy;\r\n    if (maxy < atpy) maxy = atpy;\r\n    if (maxy < atqy) maxy = atqy;\r\n    if (maxy < arqy) maxy = arqy;\r\n\r\n    if (maxx > maxy) [maxx, maxy] = [maxy, maxx];\r\n\r\n    if (maxx < 1e-73 && maxx === 0) return Sign.ON_ORIENTED_BOUNDARY;\r\n    // sqrt(sqrt(max_double/16\r\n    else if (maxy < 1e76) {\r\n        const eps = Number.EPSILON * maxx * maxy * (maxy * maxy);\r\n        if (det > eps) return Sign.ON_POSITIVE_SIDE;\r\n        if (det < -eps) return Sign.ON_NEGATIVE_SIDE;\r\n    }\r\n\r\n    return Sign.ZERO;\r\n}\r\n\r\nfunction segSegDoIntersectCrossing(p1: Point, p2: Point, p3: Point, p4: Point): boolean {\r\n    switch (orientation(p1, p2, p3)) {\r\n        case Sign.LEFT_TURN:\r\n            return orientation(p3, p4, p2) !== Sign.RIGHT_TURN;\r\n        case Sign.RIGHT_TURN:\r\n            return orientation(p3, p4, p2) !== Sign.LEFT_TURN;\r\n        case Sign.COLLINEAR:\r\n            return true;\r\n    }\r\n}\r\n\r\nfunction segSegDoIntersectContained(p1: Point, p2: Point, p3: Point, p4: Point): boolean {\r\n    switch (orientation(p1, p2, p3)) {\r\n        case Sign.LEFT_TURN:\r\n            return orientation(p1, p2, p4) !== Sign.LEFT_TURN;\r\n        case Sign.RIGHT_TURN:\r\n            return orientation(p1, p2, p4) !== Sign.RIGHT_TURN;\r\n        case Sign.COLLINEAR:\r\n            return true;\r\n    }\r\n}\r\n\r\nexport function intersection(pa: Point, pb: Point, pc: Point, pd: Point): Point | null {\r\n    const i = getIntersectionType(pa, pb, pc, pd);\r\n    switch (i.intersectionType) {\r\n        case IntersectionType.POINT:\r\n            return i.point!;\r\n        case IntersectionType.NO_INTERSECTION:\r\n            return null;\r\n    }\r\n    throw new Error(\"sdfgighowen\");\r\n}\r\n\r\nenum IntersectionType {\r\n    NO_INTERSECTION,\r\n    POINT,\r\n    SEGMENT,\r\n}\r\n\r\nfunction getLine(p0: Point, p1: Point): Line {\r\n    if (p0[0] === p1[0]) return [1, 0, -p0[0]];\r\n    if (p0[1] === p1[1]) return [0, 1, -p0[1]];\r\n    const x = p1[0] - p0[0];\r\n    const y = p1[1] - p0[1];\r\n    return [-y, x, -x * p0[1] + y * p0[0]];\r\n}\r\n\r\nfunction getIntersectionType(\r\n    pa: Point,\r\n    pb: Point,\r\n    pc: Point,\r\n    pd: Point,\r\n): { intersectionType: IntersectionType; point: Point | null } {\r\n    if (!doIntersect(pa, pb, pc, pd)) return { intersectionType: IntersectionType.NO_INTERSECTION, point: null };\r\n    const l1 = getLine(pa, pb);\r\n    const l2 = getLine(pc, pd);\r\n    const info = getIntersectionTypeLine(l1, l2);\r\n    switch (info.intersectionType) {\r\n        case IntersectionType.POINT: {\r\n            return info;\r\n        }\r\n    }\r\n    throw new Error(\"gzseuihgpib\");\r\n}\r\n\r\nfunction getIntersectionTypeLine(la: Line, lb: Line): { intersectionType: IntersectionType; point: Point } {\r\n    const denom = la[0] * lb[1] - lb[0] * la[1];\r\n    const nom1 = la[1] * lb[2] - lb[1] * la[2];\r\n    const nom2 = lb[0] * la[2] - la[0] * lb[2];\r\n    return {\r\n        intersectionType: IntersectionType.POINT,\r\n        point: [nom1 / denom, nom2 / denom],\r\n    };\r\n}\r\n\r\nfunction doIntersect(A1: Point, A2: Point, B1: Point, B2: Point): boolean {\r\n    if (xySmaller(A1, A2)) {\r\n        if (xySmaller(B1, B2)) {\r\n            if (xySmaller(A2, B1) || xySmaller(B2, A1)) return false;\r\n        } else {\r\n            if (xySmaller(A2, B2) || xySmaller(B1, A1)) return false;\r\n        }\r\n    } else {\r\n        if (xySmaller(B1, B2)) {\r\n            if (xySmaller(A1, B1) || xySmaller(B2, A2)) return false;\r\n        } else {\r\n            if (xySmaller(A1, B2) || xySmaller(B1, A2)) return false;\r\n        }\r\n    }\r\n    if (xySmaller(A1, A2)) {\r\n        if (xySmaller(B1, B2)) {\r\n            switch (xyCompare(A1, B1)) {\r\n                case Sign.SMALLER: {\r\n                    switch (xyCompare(A2, B1)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(A2, B2)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(A1, A2, B1, B2);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(A1, A2, B1, B2);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                case Sign.EQUAL:\r\n                    return true;\r\n                default:\r\n                    switch (xyCompare(B2, A1)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(B2, A2)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(B1, B2, A1, A2);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(B1, B2, A1, A2);\r\n                            }\r\n                        }\r\n                    }\r\n            }\r\n        } else {\r\n            switch (xyCompare(A1, B2)) {\r\n                case Sign.SMALLER: {\r\n                    switch (xyCompare(A2, B2)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(A2, B1)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(A1, A2, B2, B1);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(A1, A2, B2, B1);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                case Sign.EQUAL:\r\n                    return true;\r\n                default:\r\n                    switch (xyCompare(B1, A1)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(B1, A2)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(B2, B1, A1, A2);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(B2, B1, A1, A2);\r\n                            }\r\n                        }\r\n                    }\r\n            }\r\n        }\r\n    } else {\r\n        if (xySmaller(B1, B2)) {\r\n            switch (xyCompare(A2, B1)) {\r\n                case Sign.SMALLER: {\r\n                    switch (xyCompare(A1, B1)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(A1, B2)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(A2, A1, B1, B2);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(A2, A1, B1, B2);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                case Sign.EQUAL:\r\n                    return true;\r\n                default:\r\n                    switch (xyCompare(B2, A2)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(B2, A1)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(B1, B2, A2, A1);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(B1, B2, A2, A1);\r\n                            }\r\n                        }\r\n                    }\r\n            }\r\n        } else {\r\n            switch (xyCompare(A2, B2)) {\r\n                case Sign.SMALLER: {\r\n                    switch (xyCompare(A1, B2)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(A1, B1)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(A2, A1, B2, B1);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(A2, A1, B2, B1);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                case Sign.EQUAL:\r\n                    return true;\r\n                default:\r\n                    switch (xyCompare(B1, A2)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(B1, A1)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(B2, B1, A2, A1);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(B2, B1, A2, A1);\r\n                            }\r\n                        }\r\n                    }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction nextUp(x: number): number {\r\n    if (x !== x) {\r\n        return x;\r\n    }\r\n    if (x === -1 / 0) {\r\n        return -Number.MAX_VALUE;\r\n    }\r\n    if (x === +1 / 0) {\r\n        return +1 / 0;\r\n    }\r\n    if (x === +Number.MAX_VALUE) {\r\n        return +1 / 0;\r\n    }\r\n    let y = x * (x < 0 ? 1 - Number.EPSILON / 2 : 1 + Number.EPSILON);\r\n    if (y === x) {\r\n        y = Number.MIN_VALUE * Number.EPSILON > 0 ? x + Number.MIN_VALUE * Number.EPSILON : x + Number.MIN_VALUE;\r\n    }\r\n    if (y === +1 / 0) {\r\n        y = +Number.MAX_VALUE;\r\n    }\r\n    const b = x + (y - x) / 2;\r\n    if (x < b && b < y) {\r\n        y = b;\r\n    }\r\n    const c = (y + x) / 2;\r\n    if (x < c && c < y) {\r\n        y = c;\r\n    }\r\n    return y === 0 ? -0 : y;\r\n}\r\n\r\nexport function ulp(x: number): number {\r\n    return x < 0 ? nextUp(x) - x : x + nextUp(-x);\r\n}\r\n","import { Shape } from \"@/game/shapes/shape\";\r\nimport { CDT } from \"./cdt\";\r\nimport { ccw, cw, orientation, sideOfOrientedCircleP, ulp } from \"./triag\";\r\n\r\nexport type Point = number[];\r\n\r\nexport const INFINITE = -7e310;\r\n\r\nlet _INFINITE_VERTEX: Vertex;\r\n\r\nexport enum Sign {\r\n    NEGATIVE = -1,\r\n    ZERO = 0,\r\n    POSITIVE = 1,\r\n\r\n    RIGHT_TURN = -1,\r\n    LEFT_TURN = 1,\r\n\r\n    SMALLER = -1,\r\n    EQUAL = 0,\r\n    LARGER = 1,\r\n\r\n    CLOCKWISE = -1,\r\n    COUNTERCLOCKWISE = 1,\r\n\r\n    COLLINEAR = 0,\r\n    COPLANAR = 0,\r\n    DEGENERATE = 0,\r\n\r\n    ON_NEGATIVE_SIDE = -1,\r\n    ON_ORIENTED_BOUNDARY = 0,\r\n    ON_POSITIVE_SIDE = 1,\r\n}\r\n\r\nenum LineFaceState {\r\n    UNDEFINED = -1,\r\n    VERTEX_VERTEX = 0,\r\n    VERTEX_EDGE = 1,\r\n    EDGE_VERTEX = 2,\r\n    EDGE_EDGE = 3,\r\n}\r\n\r\nfunction newPoint(): Point {\r\n    return [INFINITE, INFINITE];\r\n}\r\n\r\nexport class Triangle {\r\n    vertices: (Vertex | null)[] = [];\r\n    neighbours: (Triangle | null)[] = [null, null, null];\r\n    constraints = [false, false, false];\r\n    static _counter = 0;\r\n    uid = Triangle._counter++;\r\n\r\n    constructor(...vertices: (Vertex | null)[]) {\r\n        this.vertices = vertices;\r\n    }\r\n\r\n    from(t: Triangle): this {\r\n        this.vertices = t.vertices.slice(0, t.vertices.length);\r\n        this.neighbours = t.neighbours.slice(0, t.neighbours.length);\r\n        this.constraints = t.constraints.slice(0, t.constraints.length);\r\n        return this;\r\n    }\r\n\r\n    get center(): number[] {\r\n        return [\r\n            (this.vertices[0]!.point![0] + this.vertices[1]!.point![0] + this.vertices[2]!.point![0]) / 3,\r\n            (this.vertices[0]!.point![1] + this.vertices[1]!.point![1] + this.vertices[2]!.point![1]) / 3,\r\n        ];\r\n    }\r\n\r\n    get dimension(): number {\r\n        return this.vertices.length - 1;\r\n    }\r\n\r\n    addVertex(vertex: Vertex): void {\r\n        if (vertex === undefined) {\r\n            console.log(\"UNDEFINED HIERE\");\r\n        }\r\n        this.vertices.push(vertex);\r\n        vertex.triangle = this;\r\n    }\r\n\r\n    isConstrained(index: number): boolean {\r\n        return this.constraints[index];\r\n    }\r\n\r\n    reorient(): void {\r\n        // If certain indices do not exist yet thay will append faulty undefined's, thus we slice them\r\n        this.vertices = [this.vertices[1], this.vertices[0], this.vertices[2]].slice(0, this.vertices.length);\r\n        this.neighbours = [this.neighbours[1], this.neighbours[0], this.neighbours[2]];\r\n        this.constraints = [this.constraints[1], this.constraints[0], this.constraints[2]];\r\n    }\r\n\r\n    hasVertex(v: Vertex): boolean {\r\n        return this.vertices.includes(v);\r\n    }\r\n\r\n    indexV(v: Vertex): number {\r\n        return this.vertices.indexOf(v);\r\n    }\r\n\r\n    indexT(t: Triangle): number {\r\n        return this.neighbours.indexOf(t);\r\n    }\r\n\r\n    isInfinite(index?: number): boolean {\r\n        if (index === undefined) {\r\n            // return this.vertices.includes(_INFINITE_VERTEX);\r\n            return this.vertices.some(v => v!.infinite);\r\n        } else {\r\n            return this.vertices[ccw(index)]!.infinite || this.vertices[cw(index)]!.infinite;\r\n        }\r\n    }\r\n\r\n    contains(point: Point): boolean {\r\n        const A =\r\n            -this.vertices[1]!.point![1] * this.vertices[2]!.point![0] +\r\n            this.vertices[0]!.point![1] * (-this.vertices[1]!.point![0] + this.vertices[2]!.point![0]) +\r\n            this.vertices[0]!.point![0] * (this.vertices[1]!.point![1] - this.vertices[2]!.point![1]) +\r\n            this.vertices[1]!.point![0] * this.vertices[2]!.point![1];\r\n        const sign = A < 0 ? -1 : 1;\r\n        const s =\r\n            (this.vertices[0]!.point![1] * this.vertices[2]!.point![0] -\r\n                this.vertices[0]!.point![0] * this.vertices[2]!.point![1] +\r\n                (this.vertices[2]!.point![1] - this.vertices[0]!.point![1]) * point[0] +\r\n                (this.vertices[0]!.point![0] - this.vertices[2]!.point![0]) * point[1]) *\r\n            sign;\r\n        if (s < 0) return false;\r\n        const t =\r\n            (this.vertices[0]!.point![0] * this.vertices[1]!.point![1] -\r\n                this.vertices[0]!.point![1] * this.vertices[1]!.point![0] +\r\n                (this.vertices[0]!.point![1] - this.vertices[1]!.point![1]) * point[0] +\r\n                (this.vertices[1]!.point![0] - this.vertices[0]!.point![0]) * point[1]) *\r\n            sign;\r\n\r\n        return t > 0 && s + t < A * sign;\r\n    }\r\n\r\n    cwPermute(): void {\r\n        this.vertices.push(this.vertices.shift()!);\r\n        this.neighbours.push(this.neighbours.shift()!);\r\n        this.constraints.push(this.constraints.shift()!);\r\n    }\r\n\r\n    ccwPermute(): void {\r\n        this.vertices.unshift(this.vertices.pop()!);\r\n        this.neighbours.unshift(this.neighbours.pop()!);\r\n        this.constraints.unshift(this.constraints.pop()!);\r\n    }\r\n}\r\n\r\nexport class Vertex {\r\n    infinite = false;\r\n    private _point: Point | undefined;\r\n    triangle: Triangle | undefined;\r\n    shapes: Set<Shape> = new Set();\r\n\r\n    constructor(point?: Point) {\r\n        this._point = point;\r\n    }\r\n\r\n    get point(): Point | undefined {\r\n        return this._point;\r\n    }\r\n\r\n    set point(point: Point | undefined) {\r\n        this._point = point;\r\n        this.infinite = false;\r\n    }\r\n\r\n    getIncidentFaces(): Triangle[] {\r\n        const faces: Triangle[] = [];\r\n        const fc = new FaceCirculator(this, null);\r\n        do {\r\n            faces.push(fc.t!);\r\n        } while (fc.next());\r\n        return faces;\r\n    }\r\n\r\n    *getIncidentEdges(): IterableIterator<Edge> {\r\n        // const edges: Edge[] = [];\r\n        const ec = new EdgeCirculator(this, null);\r\n        do {\r\n            yield new Edge(ec.t, ec.ri);\r\n        } while (ec.valid && ec.next());\r\n        // return edges;\r\n    }\r\n}\r\n\r\nexport class EdgeCirculator {\r\n    ri: number;\r\n    v: Vertex | null;\r\n    t: Triangle | null;\r\n    _ri: number;\r\n    _v: Vertex | null;\r\n    _t: Triangle | null;\r\n\r\n    constructor(v: Vertex | null, t: Triangle | null) {\r\n        this.v = v;\r\n        this.t = t;\r\n        if (v === null) {\r\n            this.t = null;\r\n        } else if (t === null) {\r\n            this.t = v.triangle!;\r\n        }\r\n        if (this.t == null || this.t.dimension < 1) {\r\n            this.ri = 0;\r\n            this.v = null;\r\n            this.t = null;\r\n        } else {\r\n            const i = this.t.indexV(v!);\r\n            if (this.t.dimension === 2) this.ri = ccw(i);\r\n            else this.ri = 2;\r\n        }\r\n        this._ri = this.ri;\r\n        this._v = this.v;\r\n        this._t = this.t;\r\n    }\r\n\r\n    get valid(): boolean {\r\n        return this.t !== null && this.v !== null;\r\n    }\r\n\r\n    next(): boolean {\r\n        let i = this.t!.indexV(this.v!);\r\n        if (this.t!.dimension === 1) {\r\n            this.t = this.t!.neighbours[i === 0 ? 1 : 0];\r\n        } else {\r\n            this.t = this.t!.neighbours[ccw(i)];\r\n            i = this.t!.indexV(this.v!);\r\n            this.ri = ccw(i);\r\n        }\r\n        return this.ri !== this._ri || this.v !== this._v || this.t !== this._t;\r\n    }\r\n}\r\n\r\nexport class EdgeIterator {\r\n    private i = 0;\r\n    pos: Triangle | null;\r\n    es: number;\r\n    tds: TDS;\r\n    _es = 0;\r\n    filterInfinite: boolean;\r\n    constructor(tds: TDS, filterInfinite = true) {\r\n        this.tds = tds;\r\n        this.filterInfinite = filterInfinite;\r\n        this.es = 0;\r\n        if (tds.dimension <= 0) {\r\n            this.pos = null;\r\n            return;\r\n        }\r\n        this.pos = tds.triangles[0];\r\n        if (tds.dimension === 1) this.es = 2;\r\n        while (this.pos !== null && !this.associatedEdge()) {\r\n            throw new Error(\"[poi\");\r\n        }\r\n\r\n        if (tds.dimension === 1) this._es = 2;\r\n    }\r\n\r\n    get valid(): boolean {\r\n        return (this.pos !== null || this._es !== this.es) && !this.predicate();\r\n    }\r\n\r\n    next(): void {\r\n        do {\r\n            do {\r\n                this.increment();\r\n            } while (this.pos !== null && !this.associatedEdge());\r\n        } while (this.pos !== null && this.predicate());\r\n    }\r\n\r\n    // Returns true if the current element should be skipped\r\n    predicate(): boolean {\r\n        if (this.filterInfinite) {\r\n            return this.pos!.isInfinite(this.es);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    get edge(): Edge {\r\n        return new Edge(this.pos, this.es);\r\n    }\r\n\r\n    associatedEdge(): boolean {\r\n        if (this.tds.dimension === 1) return true;\r\n        return this.tds.triangles.indexOf(this.pos!) < this.tds.triangles.indexOf(this.pos!.neighbours[this.es]!);\r\n    }\r\n\r\n    increment(): void {\r\n        if (this.tds.dimension === 1) {\r\n            this.i++;\r\n            if (this.tds.triangles.length <= this.i) this.pos = null;\r\n            else this.pos = this.tds.triangles[this.i];\r\n        } else if (this.es === 2) {\r\n            this.es = 0;\r\n            this.i++;\r\n            if (this.tds.triangles.length <= this.i) this.pos = null;\r\n            else this.pos = this.tds.triangles[this.i];\r\n        } else {\r\n            this.es++;\r\n        }\r\n    }\r\n}\r\n\r\nexport class FaceCirculator {\r\n    v: Vertex | null;\r\n    t: Triangle | null;\r\n    _v: Vertex | null;\r\n    _t: Triangle | null;\r\n\r\n    constructor(v: Vertex | null, t: Triangle | null) {\r\n        this.v = v;\r\n        this.t = t;\r\n        if (v === null) {\r\n            this.t = null;\r\n        } else if (t === null) {\r\n            this.t = v.triangle!;\r\n        }\r\n        if (this.t == null || this.t.dimension < 2) {\r\n            this.v = null;\r\n            this.t = null;\r\n        }\r\n        this._v = this.v;\r\n        this._t = this.t;\r\n    }\r\n\r\n    get valid(): boolean {\r\n        return this.t !== null && this.v !== null;\r\n    }\r\n\r\n    get done(): boolean {\r\n        return this.v === this._v && this.t === this._t;\r\n    }\r\n\r\n    setDone(): void {\r\n        this._v = this.v;\r\n        this._t = this.t;\r\n    }\r\n\r\n    prev(): void {\r\n        const i = this.t!.indexV(this.v!);\r\n        this.t = this.t!.neighbours[cw(i)];\r\n    }\r\n\r\n    next(): boolean {\r\n        const i = this.t!.indexV(this.v!);\r\n        this.t = this.t!.neighbours[ccw(i)];\r\n        return !this.done;\r\n    }\r\n}\r\n\r\nexport class LineFaceCirculator {\r\n    private i = 0;\r\n    pos: Triangle | null = null;\r\n    _tr: CDT;\r\n    s: LineFaceState = LineFaceState.UNDEFINED;\r\n    p: Point;\r\n    q: Point;\r\n\r\n    constructor(v: Vertex, tr: CDT, dir: Point) {\r\n        this._tr = tr;\r\n        this.p = v.point!;\r\n        this.q = dir;\r\n\r\n        const fc = new FaceCirculator(v, null);\r\n        let ic = fc.t!.indexV(v);\r\n        let vt = fc.t!.vertices[cw(ic)]!;\r\n        while (v === _INFINITE_VERTEX || orientation(this.p, this.q, vt.point!) !== Sign.LEFT_TURN) {\r\n            fc.next();\r\n            ic = fc.t!.indexV(v);\r\n            vt = fc.t!.vertices[cw(ic)]!;\r\n            if (!fc.valid) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        let vr = fc.t!.vertices[ccw(ic)]!;\r\n        let pqr: Sign = Sign.RIGHT_TURN;\r\n        // tslint:disable:no-conditional-assignment\r\n        while (vr !== _INFINITE_VERTEX && (pqr = orientation(this.p, this.q, vr.point!)) === Sign.LEFT_TURN) {\r\n            fc.prev();\r\n            ic = fc.t!.indexV(v);\r\n            vr = fc.t!.vertices[ccw(ic)]!;\r\n        }\r\n\r\n        ic = fc.t!.indexV(v);\r\n        vt = fc.t!.vertices[cw(ic)]!;\r\n\r\n        if (vr === _INFINITE_VERTEX) {\r\n            fc.prev();\r\n            ic = fc.t!.indexV(v);\r\n            vr = fc.t!.vertices[ccw(ic)]!;\r\n            pqr = orientation(this.p, this.q, vr.point!);\r\n            switch (pqr) {\r\n                case Sign.RIGHT_TURN:\r\n                case Sign.COLLINEAR: {\r\n                    fc.next();\r\n                    ic = fc.t!.indexV(_INFINITE_VERTEX);\r\n                    this.pos = fc.t!;\r\n                    this.s = LineFaceState.VERTEX_VERTEX;\r\n                    this.i = ic;\r\n                    break;\r\n                }\r\n                case Sign.LEFT_TURN: {\r\n                    break;\r\n                }\r\n            }\r\n        } else if (pqr === Sign.COLLINEAR) {\r\n            this.pos = fc.t!;\r\n            this.s = LineFaceState.VERTEX_VERTEX;\r\n            this.i = ccw(ic);\r\n        } else {\r\n            this.pos = fc.t!;\r\n            this.s = LineFaceState.VERTEX_EDGE;\r\n            this.i = ic;\r\n        }\r\n    }\r\n\r\n    next(): void {\r\n        this.increment();\r\n    }\r\n\r\n    increment(): void {\r\n        let o: Sign;\r\n        if (this.s === LineFaceState.VERTEX_VERTEX || this.s === LineFaceState.EDGE_VERTEX) {\r\n            do {\r\n                const n = this.pos!.neighbours[cw(this.i)]!;\r\n                this.i = n.indexT(this.pos!);\r\n                this.pos = n;\r\n                if (this.pos!.vertices[this.i] === _INFINITE_VERTEX) {\r\n                    o = Sign.COLLINEAR;\r\n                    this.i = cw(this.i);\r\n                    break;\r\n                }\r\n                o = orientation(this.p, this.q, this.pos!.vertices[this.i]!.point!);\r\n                this.i = cw(this.i);\r\n            } while (o === Sign.LEFT_TURN);\r\n            if (o === Sign.COLLINEAR) {\r\n                this.s = LineFaceState.VERTEX_VERTEX;\r\n                this.i = ccw(this.i);\r\n            } else {\r\n                this.s = LineFaceState.VERTEX_EDGE;\r\n            }\r\n        } else {\r\n            const n = this.pos!.neighbours[this.i]!;\r\n            const ni = n.indexT(this.pos!);\r\n            this.pos = n;\r\n            o =\r\n                this.pos!.vertices[ni]! === _INFINITE_VERTEX\r\n                    ? Sign.COLLINEAR\r\n                    : orientation(this.p, this.q, this.pos!.vertices[ni]!.point!);\r\n            switch (o) {\r\n                case Sign.LEFT_TURN: {\r\n                    this.s = LineFaceState.EDGE_EDGE;\r\n                    this.i = ccw(ni);\r\n                    break;\r\n                }\r\n                case Sign.RIGHT_TURN: {\r\n                    this.s = LineFaceState.EDGE_EDGE;\r\n                    this.i = cw(ni);\r\n                    break;\r\n                }\r\n                default: {\r\n                    this.s = LineFaceState.EDGE_VERTEX;\r\n                    this.i = ni;\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class Edge {\r\n    first: Triangle | null = null;\r\n    second: number = 0;\r\n\r\n    constructor(first: Triangle | null = null, second: number = 0) {\r\n        this.first = first;\r\n        this.second = second;\r\n    }\r\n\r\n    toString(): string {\r\n        return `${this.first!.vertices[this.second === 1 ? 0 : 1]!.point} - ${\r\n            this.first!.vertices[this.second === 1 ? 2 : 1]!.point\r\n        }`;\r\n    }\r\n}\r\n\r\nexport enum LocateType {\r\n    VERTEX,\r\n    EDGE,\r\n    FACE,\r\n    OUTSIDE_CONVEX_HULL,\r\n    OUTSIDE_AFFINE_HULL,\r\n}\r\n\r\nexport class TDS {\r\n    dimension = -1;\r\n    vertices: Vertex[] = [];\r\n    triangles: Triangle[] = [];\r\n    _infinite: Vertex;\r\n\r\n    constructor() {\r\n        this._infinite = this.createVertex();\r\n        _INFINITE_VERTEX = this._infinite;\r\n        const t = new Triangle();\r\n        t.addVertex(this._infinite);\r\n        this.triangles.push(t);\r\n    }\r\n\r\n    createVertex(): Vertex {\r\n        const v = new Vertex(newPoint());\r\n        v.infinite = true;\r\n        this.vertices.push(v);\r\n        return v;\r\n    }\r\n\r\n    deleteVertex(vertex: Vertex): void {\r\n        this.vertices = this.vertices.filter(v => v !== vertex);\r\n    }\r\n\r\n    createTriangle(\r\n        v0: Vertex | null,\r\n        v1: Vertex | null,\r\n        v2: Vertex | null,\r\n        n0: Triangle | null,\r\n        n1: Triangle | null,\r\n        n2: Triangle | null,\r\n    ): Triangle {\r\n        const t = new Triangle(v0, v1, v2);\r\n        t.neighbours[0] = n0;\r\n        t.neighbours[1] = n1;\r\n        t.neighbours[2] = n2;\r\n        this.triangles.push(t);\r\n        return t;\r\n    }\r\n\r\n    createTriangle2(\r\n        f1: Triangle,\r\n        i1: number,\r\n        f2: Triangle,\r\n        i2: number,\r\n        f3: Triangle | null = null,\r\n        i3: number | null = null,\r\n    ): Triangle {\r\n        const v3 = f3 === null || i3 === null ? f2.vertices[ccw(i2)] : f3.vertices[cw(i3)];\r\n        const t = new Triangle(f1.vertices[cw(i1)], f2.vertices[cw(i2)], v3);\r\n        f1.neighbours[i1] = t;\r\n        f2.neighbours[i2] = t;\r\n        if (f3 !== null && i3 !== null) f3.neighbours[i3] = t;\r\n        t.neighbours[0] = f2;\r\n        if (f3 !== null) t.neighbours[1] = f3;\r\n        t.neighbours[2] = f1;\r\n        this.triangles.push(t);\r\n        return t;\r\n    }\r\n\r\n    createTriangle3(f1: Triangle, i1: number, v: Vertex): Triangle {\r\n        const t = new Triangle(f1.vertices[cw(i1)], f1.vertices[ccw(i1)], v);\r\n        t.neighbours[2] = f1;\r\n        // not sure if I should create new Triangle() in the other neighbor spots or leave them as null\r\n        f1.neighbours[i1] = t;\r\n        this.triangles.push(t);\r\n        return t;\r\n    }\r\n\r\n    deleteTriangle(trig: Triangle): void {\r\n        this.triangles = this.triangles.filter(t => t !== trig);\r\n    }\r\n\r\n    setAdjacency(t0: Triangle, i0: number, t1: Triangle, i1: number): void {\r\n        t0.neighbours[i0] = t1;\r\n        t1.neighbours[i1] = t0;\r\n    }\r\n\r\n    get finiteVertex(): Vertex {\r\n        return this.vertices[1];\r\n    }\r\n\r\n    get finiteEdge(): Edge {\r\n        if (this.dimension < 1) throw new Error(\"aspo\");\r\n        const ei = new EdgeIterator(this, true);\r\n        while (!ei.valid) ei.next();\r\n        return ei.edge;\r\n    }\r\n\r\n    getEdges(onlyConstraint: boolean = false): Edge[] {\r\n        const ei = new EdgeIterator(this);\r\n        const edges: Edge[] = [];\r\n        if (ei.edge.first === null) return edges;\r\n        while (!ei.valid) ei.next();\r\n        do {\r\n            const edge = ei.edge;\r\n            if (onlyConstraint) {\r\n                if (edge.first!.constraints[edge.second]) {\r\n                    edges.push(edge);\r\n                }\r\n            } else {\r\n                edges.push(edge);\r\n            }\r\n            ei.next();\r\n        } while (ei.valid);\r\n        return edges;\r\n    }\r\n\r\n    numberOfEdges(onlyConstraint: boolean = false): number {\r\n        let i = 0;\r\n        let j = 0;\r\n        const ei = new EdgeIterator(this);\r\n        if (ei.edge.first === null) return 0;\r\n        while (!ei.valid) ei.next();\r\n        do {\r\n            j++;\r\n            const edge = ei.edge;\r\n            if (edge.first!.constraints[edge.second]) {\r\n                i++;\r\n            }\r\n            ei.next();\r\n        } while (ei.valid);\r\n        if (onlyConstraint) return i;\r\n        return j;\r\n    }\r\n\r\n    numberOfVertices(includeInfinity: boolean): number {\r\n        // -1 for the infinity vertex\r\n        return this.vertices.length - (includeInfinity ? 0 : 1);\r\n    }\r\n\r\n    insertDimUp(w: Vertex = new Vertex(), orient: boolean = true): Vertex {\r\n        const v = this.createVertex();\r\n        this.dimension++;\r\n        let t1: Triangle;\r\n        let t2: Triangle;\r\n        switch (this.dimension) {\r\n            case 0: {\r\n                t1 = this.triangles[0];\r\n                t2 = new Triangle(v);\r\n                this.triangles.push(t2);\r\n                this.setAdjacency(t1, 0, t2, 0);\r\n                v.triangle = t2;\r\n                break;\r\n            }\r\n            case 1:\r\n            case 2: {\r\n                const deleteList: Triangle[] = [];\r\n                const triangles = this.triangles.slice(0, this.triangles.length);\r\n                for (const trig of triangles) {\r\n                    const copy = new Triangle().from(trig);\r\n                    this.triangles.push(copy);\r\n                    trig.vertices[this.dimension] = v;\r\n                    copy.vertices[this.dimension] = w;\r\n                    this.setAdjacency(trig, this.dimension, copy, this.dimension);\r\n                    if (trig.vertices.includes(w)) deleteList.push(copy);\r\n                }\r\n                for (const trig of triangles) {\r\n                    const neighbour = trig.neighbours[this.dimension];\r\n                    for (let j = 0; j < this.dimension; ++j) {\r\n                        neighbour!.neighbours[j] = trig.neighbours[j]!.neighbours[this.dimension];\r\n                    }\r\n                }\r\n\r\n                let lfit = 0;\r\n                if (this.dimension === 1) {\r\n                    if (orient) {\r\n                        triangles[lfit].reorient();\r\n                        lfit++;\r\n                        triangles[lfit].neighbours[1]!.reorient();\r\n                    } else {\r\n                        triangles[lfit].neighbours[1]!.reorient();\r\n                        lfit++;\r\n                        triangles[lfit].reorient();\r\n                    }\r\n                } else {\r\n                    for (const trig of triangles) {\r\n                        if (orient) trig.neighbours[2]!.reorient();\r\n                        else trig.reorient();\r\n                    }\r\n                }\r\n\r\n                for (const trig of deleteList) {\r\n                    let j = 1;\r\n                    if (trig.vertices[0] === w) j = 0;\r\n                    t1 = trig.neighbours[this.dimension]!;\r\n                    const i1 = this.mirrorIndex(trig, this.dimension);\r\n                    t2 = trig.neighbours[j]!;\r\n                    const i2 = this.mirrorIndex(trig, j);\r\n                    this.setAdjacency(t1, i1, t2, i2);\r\n                    this.deleteTriangle(trig);\r\n                }\r\n                v.triangle = triangles[0];\r\n                break;\r\n            }\r\n            default: {\r\n                throw new Error(\"Dimension unknown\");\r\n            }\r\n        }\r\n        return v;\r\n    }\r\n\r\n    mirrorIndex(t: Triangle, i: number): number {\r\n        if (t.dimension === 1) {\r\n            const j = t.neighbours[i]!.indexV(t.vertices[i === 0 ? 1 : 0]!);\r\n            return j === 0 ? 1 : 0;\r\n        }\r\n        return ccw(t.neighbours[i]!.indexV(t.vertices[ccw(i)]!));\r\n    }\r\n\r\n    insertInFace(t: Triangle): Vertex {\r\n        const v = this.createVertex();\r\n        const v0 = t.vertices[0]!;\r\n        const v1 = t.vertices[1]!;\r\n        const v2 = t.vertices[2]!;\r\n        const n1 = t.neighbours[1]!;\r\n        const n2 = t.neighbours[2]!;\r\n        const t1 = this.createTriangle(v0, v, v2, t, n1, null);\r\n        const t2 = this.createTriangle(v0, v1, v, t, null, n2);\r\n        this.setAdjacency(t1, 2, t2, 1);\r\n        if (n1 !== null) {\r\n            const i1 = this.mirrorIndex(t, 1);\r\n            n1.neighbours[i1] = t1;\r\n        }\r\n        if (n2 !== null) {\r\n            const i2 = this.mirrorIndex(t, 2);\r\n            n2.neighbours[i2] = t2;\r\n        }\r\n        t.vertices[0] = v;\r\n        t.neighbours[1] = t1;\r\n        t.neighbours[2] = t2;\r\n        if (v0.triangle === t) v0.triangle = t2;\r\n        v.triangle = t;\r\n        return v;\r\n    }\r\n\r\n    flip(t: Triangle, i: number): void {\r\n        const n = t.neighbours[i]!;\r\n        const ni = this.mirrorIndex(t, i);\r\n        const vCW = t.vertices[cw(i)]!;\r\n        const vCCW = t.vertices[ccw(i)]!;\r\n        const tr = t.neighbours[ccw(i)]!;\r\n        const tri = this.mirrorIndex(t, ccw(i));\r\n        const bl = n.neighbours[ccw(ni)]!;\r\n        const bli = this.mirrorIndex(n, ccw(ni));\r\n\r\n        t.vertices[cw(i)] = n.vertices[ni]!;\r\n        n.vertices[cw(ni)] = t.vertices[i]!;\r\n\r\n        this.setAdjacency(t, i, bl, bli);\r\n        this.setAdjacency(t, ccw(i), n, ccw(ni));\r\n        this.setAdjacency(n, ni, tr, tri);\r\n\r\n        if (vCW.triangle! === t) vCW.triangle = n;\r\n        if (vCCW.triangle! === n) vCCW.triangle = t;\r\n    }\r\n\r\n    insertInEdge(t: Triangle, i: number): Vertex {\r\n        let v: Vertex;\r\n        if (this.dimension === 1) {\r\n            v = this.createVertex();\r\n            const ff = t.neighbours[0]!;\r\n            const vv = t.vertices[1]!;\r\n            const g = this.createTriangle(v, vv, null, ff, t, null);\r\n            t.vertices[1] = v;\r\n            t.neighbours[0] = g;\r\n            ff.neighbours[1] = g;\r\n            v.triangle = g;\r\n            vv.triangle = ff;\r\n        } else {\r\n            const n = t.neighbours[i]!;\r\n            const ni = this.mirrorIndex(t, i);\r\n            v = this.insertInFace(t);\r\n            this.flip(n, ni);\r\n        }\r\n        return v;\r\n    }\r\n\r\n    makeHole(v: Vertex, hole: [Triangle, number][]): void {\r\n        const deleteList: Triangle[] = [];\r\n        let f: Triangle;\r\n        let fn: Triangle;\r\n        let i: number;\r\n        let inn: number;\r\n        let vv: Vertex;\r\n        const fc = new FaceCirculator(v, null);\r\n        do {\r\n            f = fc.t!;\r\n            fc.next();\r\n            i = f.indexV(v);\r\n            fn = f.neighbours[i]!;\r\n            inn = fn.indexT(f);\r\n            vv = f.vertices[cw(i)]!;\r\n            vv.triangle = fn;\r\n            vv = f.vertices[ccw(i)]!;\r\n            vv.triangle = fn;\r\n            fn.neighbours[inn] = null;\r\n            hole.push([fn, inn]);\r\n            deleteList.push(f);\r\n        } while (!fc.done);\r\n        for (const t of deleteList) {\r\n            this.deleteTriangle(t);\r\n        }\r\n    }\r\n\r\n    fillHoleDelaunay(firstHole: [Triangle, number][]): void {\r\n        let f: Triangle;\r\n        let ff: Triangle;\r\n        let fn: Triangle;\r\n        let i: number;\r\n        let ii: number;\r\n        let inn: number;\r\n        const holeList: [Triangle, number][][] = [];\r\n        holeList.push(firstHole);\r\n        while (holeList.length > 0) {\r\n            const hole = holeList[0];\r\n            let hit: number;\r\n\r\n            if (hole.length === 3) {\r\n                hit = 0;\r\n                f = hole[hit][0];\r\n                i = hole[hit][1];\r\n                ff = hole[++hit][0];\r\n                ii = hole[hit][1];\r\n                fn = hole[++hit][0];\r\n                inn = hole[hit][1];\r\n                this.createTriangle2(f, i, ff, ii, fn, inn);\r\n                holeList.shift();\r\n                continue;\r\n            }\r\n\r\n            let finite = false;\r\n            while (!finite) {\r\n                ff = hole[0][0];\r\n                ii = hole[0][1];\r\n                if (ff.vertices[cw(ii)]!.infinite || ff.vertices[ccw(ii)]!.infinite) {\r\n                    hole.push(hole.shift()!);\r\n                } else {\r\n                    finite = true;\r\n                }\r\n            }\r\n\r\n            ff = hole[0][0];\r\n            ii = hole[0][1];\r\n            hole.shift();\r\n\r\n            const v0 = ff.vertices[cw(ii)]!;\r\n            const v1 = ff.vertices[ccw(ii)]!;\r\n            let v2 = this._infinite;\r\n            let v3: Vertex;\r\n\r\n            const p0 = v0.point!;\r\n            const p1 = v1.point!;\r\n            hit = 0;\r\n            let cutAfter = 0;\r\n\r\n            while (hit !== hole.length - 1) {\r\n                fn = hole[hit][0];\r\n                inn = hole[hit][1];\r\n                const vv = fn.vertices[ccw(inn)]!;\r\n                if (vv.infinite && v2.infinite) cutAfter = hit;\r\n                else {\r\n                    const p = vv.point!;\r\n                    if (orientation(p0, p1, p) === Sign.COUNTERCLOCKWISE) {\r\n                        if (v2.infinite) {\r\n                            v2 = vv;\r\n                            v3 = vv;\r\n                            cutAfter = hit;\r\n                        } else if (sideOfOrientedCircleP(p0, p1, v3!.point!, p, true) === Sign.ON_POSITIVE_SIDE) {\r\n                            v2 = vv;\r\n                            v3 = vv;\r\n                            cutAfter = hit;\r\n                        }\r\n                    }\r\n                }\r\n                hit++;\r\n            }\r\n            let newf: Triangle;\r\n\r\n            fn = hole[0][0];\r\n            inn = hole[0][1];\r\n            if (fn.vertices[ccw(inn)] === v2) {\r\n                newf = this.createTriangle2(ff, ii, fn, inn);\r\n                hole.shift();\r\n                hole.unshift([newf, 1]);\r\n            } else {\r\n                fn = hole[hole.length - 1][0];\r\n                inn = hole[hole.length - 1][1];\r\n                const indx = fn.indexV(v2);\r\n                if (indx >= 0 && indx === cw(inn)) {\r\n                    newf = this.createTriangle2(fn, inn, ff, ii);\r\n                    hole.pop();\r\n                    hole.push([newf, 1]);\r\n                } else {\r\n                    // split the hole in two holes\r\n                    newf = this.createTriangle3(ff, ii, v2);\r\n                    const newHole: [Triangle, number][] = [];\r\n                    ++cutAfter;\r\n                    // while (hole.begin !== cut_after)\r\n                    while (hole[0] !== hole[cutAfter--]) {\r\n                        newHole.push(hole.shift()!);\r\n                    }\r\n\r\n                    hole.unshift([newf, 1]);\r\n                    newHole.unshift([newf, 0]);\r\n                    holeList.unshift(newHole);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    removeDimDown(v: Vertex): void {\r\n        let f: Triangle;\r\n        switch (this.dimension) {\r\n            case -1: {\r\n                this.deleteTriangle(v.triangle!);\r\n                break;\r\n            }\r\n            case 0: {\r\n                f = v.triangle!;\r\n                f.neighbours[0]!.neighbours[0] = null;\r\n                this.deleteTriangle(v.triangle!);\r\n                break;\r\n            }\r\n            case 1:\r\n            case 2: {\r\n                const toDelete: Triangle[] = [];\r\n                const toDowngrade: Triangle[] = [];\r\n                for (const triangle of this.triangles) {\r\n                    if (!triangle.hasVertex(v)) toDelete.push(triangle);\r\n                    else toDowngrade.push(triangle);\r\n                }\r\n                for (const down of toDowngrade) {\r\n                    const j = down.indexV(v);\r\n                    if (this.dimension === 1) {\r\n                        if (j === 0) down.reorient();\r\n                        down.vertices[1] = null;\r\n                        down.neighbours[1] = null;\r\n                    } else {\r\n                        if (j === 0) down.cwPermute();\r\n                        else if (j === 1) down.ccwPermute();\r\n                        down.vertices[2] = null;\r\n                        down.neighbours[2] = null;\r\n                    }\r\n                    down.vertices[0]!.triangle = down;\r\n                }\r\n                for (const del of toDelete) this.deleteTriangle(del);\r\n            }\r\n        }\r\n        this.deleteVertex(v);\r\n        this.dimension--;\r\n    }\r\n}\r\n\r\nexport class BoundingBox {\r\n    x1: number;\r\n    x2: number;\r\n    y1: number;\r\n    y2: number;\r\n    constructor(p: Point) {\r\n        this.x1 = p[0];\r\n        this.y1 = p[1];\r\n        this.x2 = p[0];\r\n        this.y2 = p[1];\r\n    }\r\n\r\n    dilate(dist: number): void {\r\n        this.x1 -= dist * ulp(this.x1);\r\n        this.y1 -= dist * ulp(this.y1);\r\n        this.x2 += dist * ulp(this.x2);\r\n        this.y2 += dist * ulp(this.y2);\r\n    }\r\n\r\n    overlaps(other: BoundingBox): boolean {\r\n        if (this.x2 < other.x1 || other.x2 < this.x1) return false;\r\n        if (this.y2 < other.y1 || other.y2 < this.y1) return false;\r\n        return true;\r\n    }\r\n}\r\n","import {\r\n    BoundingBox,\r\n    EdgeCirculator,\r\n    FaceCirculator,\r\n    LineFaceCirculator,\r\n    LocateType,\r\n    Point,\r\n    Sign,\r\n    TDS,\r\n    Triangle,\r\n    Vertex,\r\n} from \"./tds\";\r\nimport {\r\n    ccw,\r\n    collinearBetween,\r\n    cw,\r\n    edgeInfo,\r\n    hasInexactNegativeOrientation,\r\n    intersection,\r\n    orientation,\r\n    sideOfOrientedCircle,\r\n    xyEqual,\r\n} from \"./triag\";\r\n\r\nexport type Edge = [Triangle, number];\r\n\r\nexport class CDT {\r\n    tds: TDS;\r\n    constructor() {\r\n        this.tds = new TDS();\r\n    }\r\n    insertConstraint(a: Point, b: Point): { va: Vertex; vb: Vertex } {\r\n        const va = this.insert(a);\r\n        const vb = this.insert(b);\r\n        if (va !== vb) this.insertConstraintV(va, vb);\r\n        return { va, vb };\r\n    }\r\n\r\n    insertConstraintV(va: Vertex, vb: Vertex): void {\r\n        const stack = [[va, vb]];\r\n        while (stack.length > 0) {\r\n            const v = stack.pop()!;\r\n            const info = edgeInfo(v[0], v[1]);\r\n            if (info.includes) {\r\n                this.markConstraint(info.fr!, info.i!);\r\n                if (info.vi! !== v[1]) {\r\n                    stack.push([info.vi!, v[1]]);\r\n                }\r\n                continue;\r\n            }\r\n            const intersectionInfo = this.findIntersectedFaces(v[0], v[1]);\r\n            if (intersectionInfo.found) {\r\n                if (intersectionInfo.vi !== v[0] && intersectionInfo.vi !== v[1]) {\r\n                    stack.push([v[0], intersectionInfo.vi]);\r\n                    stack.push([intersectionInfo.vi, v[1]]);\r\n                } else {\r\n                    stack.push(v);\r\n                }\r\n                continue;\r\n            }\r\n            this.triangulateHole(intersectionInfo.intersectedFaces, intersectionInfo.listAB, intersectionInfo.listBA);\r\n            if (intersectionInfo.vi !== v[1]) {\r\n                stack.push([intersectionInfo.vi, v[1]]);\r\n            }\r\n        }\r\n    }\r\n\r\n    triangulateHole(intersectedFaces: Triangle[], listAB: Edge[], listBA: Edge[]): void {\r\n        const edges: Edge[] = [];\r\n        this.triangulateHole2(intersectedFaces, listAB, listBA, edges);\r\n        this.propagatingFlipE(edges);\r\n    }\r\n\r\n    triangulateHole2(intersectedFaces: Triangle[], listAB: Edge[], listBA: Edge[], edges: Edge[]): void {\r\n        if (listAB.length > 0) {\r\n            this.triangulateHalfHole(listAB, edges);\r\n            this.triangulateHalfHole(listBA, edges);\r\n            const fl = listAB[0][0];\r\n            const fr = listBA[0][0];\r\n            fl.neighbours[2] = fr;\r\n            fr.neighbours[2] = fl;\r\n            fl.constraints[2] = true;\r\n            fr.constraints[2] = true;\r\n\r\n            while (intersectedFaces.length > 0) {\r\n                this.tds.deleteTriangle(intersectedFaces.shift()!);\r\n            }\r\n        }\r\n    }\r\n\r\n    triangulateHalfHole(conflictBoundaries: Edge[], edges: Edge[]): void {\r\n        let iC = 0;\r\n        let iN: number;\r\n        let iT: number;\r\n        const current = (): [Triangle, number] => conflictBoundaries[iC];\r\n        const next = (): [Triangle, number] => conflictBoundaries[iN];\r\n        // const tempo = (): [Triangle, number] => conflictBoundaries[iT];\r\n\r\n        const va = current()[0].vertices[ccw(current()[1])]!;\r\n        iN = iC;\r\n        ++iN;\r\n\r\n        let n: Triangle;\r\n        let n1: Triangle;\r\n        let n2: Triangle;\r\n        let ind: number;\r\n        let ind1: number;\r\n        let ind2: number;\r\n        do {\r\n            n1 = current()[0];\r\n            ind1 = current()[1];\r\n            if (n1.neighbours[ind1] !== null) {\r\n                n = n1.neighbours[ind1]!;\r\n                ind = cw(n.indexV(n1.vertices[cw(ind1)]!));\r\n                n1 = n.neighbours[ind]!;\r\n                ind1 = this.tds.mirrorIndex(n, ind);\r\n            }\r\n            n2 = next()[0];\r\n            ind2 = next()[1];\r\n            if (n2.neighbours[ind2] !== null) {\r\n                n = n2.neighbours[ind2]!;\r\n                ind = cw(n.indexV(n2.vertices[cw(ind2)]!));\r\n                n2 = n.neighbours[ind]!;\r\n                ind2 = this.tds.mirrorIndex(n, ind);\r\n            }\r\n            const v0 = n1.vertices[ccw(ind1)]!;\r\n            const v1 = n1.vertices[cw(ind1)]!;\r\n            const v2 = n2.vertices[cw(ind2)]!;\r\n            const orient = orientation(v0.point!, v1.point!, v2.point!);\r\n            switch (orient) {\r\n                case Sign.RIGHT_TURN: {\r\n                    const newlf = this.tds.createTriangle(v0, v2, v1, null, null, null);\r\n                    edges.push([newlf, 2]);\r\n                    newlf.neighbours[1] = n1;\r\n                    newlf.neighbours[0] = n2;\r\n                    n1.neighbours[ind1] = newlf;\r\n                    n2.neighbours[ind2] = newlf;\r\n                    if (n1.isConstrained(ind1)) newlf.constraints[1] = true;\r\n                    if (n2.isConstrained(ind2)) newlf.constraints[0] = true;\r\n                    v0.triangle = newlf;\r\n                    v1.triangle = newlf;\r\n                    v2.triangle = newlf;\r\n                    iT = iC + 1;\r\n                    conflictBoundaries.splice(iC, 0, [newlf, 2]);\r\n                    conflictBoundaries.splice(Math.max(iT, iN), 1);\r\n                    conflictBoundaries.splice(Math.min(iT, iN), 1);\r\n                    iN = iC;\r\n                    if (v0 !== va) --iC;\r\n                    else ++iN;\r\n                    break;\r\n                }\r\n                case Sign.LEFT_TURN:\r\n                case Sign.COLLINEAR: {\r\n                    ++iC;\r\n                    ++iN;\r\n                    break;\r\n                }\r\n            }\r\n        } while (iN < conflictBoundaries.length);\r\n    }\r\n\r\n    findIntersectedFaces(\r\n        vaa: Vertex,\r\n        vbb: Vertex,\r\n    ): { found: boolean; vi: Vertex; listAB: Edge[]; listBA: Edge[]; intersectedFaces: Triangle[] } {\r\n        const aa = vaa.point!;\r\n        const bb = vbb.point!;\r\n        const listAB: Edge[] = [];\r\n        const listBA: Edge[] = [];\r\n        const intersectedFaces: Triangle[] = [];\r\n        const lfc = new LineFaceCirculator(vaa, this, bb);\r\n        let ind = lfc.pos!.indexV(vaa);\r\n        let vi: Vertex;\r\n        if (lfc.pos!.isConstrained(ind)) {\r\n            vi = this.intersect(lfc.pos!, ind, vaa, vbb);\r\n            return { found: true, vi, listAB, listBA, intersectedFaces };\r\n        }\r\n        let lf = lfc.pos!.neighbours[ccw(ind)]!;\r\n        let rf = lfc.pos!.neighbours[cw(ind)]!;\r\n        listAB.push([lf, lf.indexT(lfc.pos!)]);\r\n        listBA.unshift([rf, rf.indexT(lfc.pos!)]);\r\n        intersectedFaces.unshift(lfc.pos!);\r\n        let previousFace = lfc.pos!;\r\n        lfc.next();\r\n        ind = lfc.pos!.indexT(previousFace);\r\n        let currentVertex = lfc.pos!.vertices[ind]!;\r\n        let done = false;\r\n        while (currentVertex !== vbb && !done) {\r\n            let i1: number;\r\n            let i2: number;\r\n            const orient = orientation(aa, bb, currentVertex.point!);\r\n            switch (orient) {\r\n                case Sign.COLLINEAR: {\r\n                    done = true;\r\n                    break;\r\n                }\r\n                case Sign.LEFT_TURN:\r\n                case Sign.RIGHT_TURN: {\r\n                    if (orient === Sign.LEFT_TURN) {\r\n                        i1 = ccw(ind);\r\n                        i2 = cw(ind);\r\n                    } else {\r\n                        i1 = cw(ind);\r\n                        i2 = ccw(ind);\r\n                    }\r\n                    if (lfc.pos!.isConstrained(i1)) {\r\n                        vi = this.intersect(lfc.pos!, i1, vaa, vbb);\r\n                        return { found: true, vi, listAB, listBA, intersectedFaces };\r\n                    } else {\r\n                        lf = lfc.pos!.neighbours[i2]!;\r\n                        intersectedFaces.unshift(lfc.pos!);\r\n                        if (orient === Sign.LEFT_TURN) listAB.push([lf, lf.indexT(lfc.pos!)]);\r\n                        else listBA.unshift([lf, lf.indexT(lfc.pos!)]);\r\n                        previousFace = lfc.pos!;\r\n                        lfc.next();\r\n                        ind = lfc.pos!.indexT(previousFace);\r\n                        currentVertex = lfc.pos!.vertices[ind]!;\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        vi = currentVertex;\r\n        intersectedFaces.unshift(lfc.pos!);\r\n        lf = lfc.pos!.neighbours[cw(ind)]!;\r\n        listAB.push([lf, lf.indexT(lfc.pos!)]);\r\n        rf = lfc.pos!.neighbours[ccw(ind)]!;\r\n        listBA.unshift([rf, rf.indexT(lfc.pos!)]);\r\n        return { found: false, vi, listAB, listBA, intersectedFaces };\r\n    }\r\n\r\n    intersect(t: Triangle, i: number, vaa: Vertex, vbb: Vertex): Vertex {\r\n        const vcc = t.vertices[cw(i)]!;\r\n        const vdd = t.vertices[ccw(i)]!;\r\n        const pa = vaa.point!;\r\n        const pb = vbb.point!;\r\n        const pc = vcc.point!;\r\n        const pd = vdd.point!;\r\n        let pi = intersection(pa, pb, pc, pd);\r\n        if (pi !== pa && pi !== pb && pi !== pc && pi !== pd) {\r\n            const bbox = new BoundingBox(pi!);\r\n            bbox.dilate(4);\r\n            if (bbox.overlaps(new BoundingBox(pa))) pi = pa;\r\n            if (bbox.overlaps(new BoundingBox(pb))) pi = pb;\r\n            if (bbox.overlaps(new BoundingBox(pc))) pi = pc;\r\n            if (bbox.overlaps(new BoundingBox(pd))) pi = pd;\r\n        }\r\n        let vi: Vertex;\r\n        if (pi === null) throw new Error(\"what\");\r\n        else {\r\n            this.removeConstrainedEdge(t, i);\r\n            vi = this.insert(pi, t);\r\n        }\r\n\r\n        if (vi !== vcc && vi !== vdd) {\r\n            this.insertConstraintV(vcc, vi);\r\n            this.insertConstraintV(vi, vdd);\r\n        } else {\r\n            this.insertConstraintV(vcc, vdd);\r\n        }\r\n        return vi;\r\n    }\r\n\r\n    // This is the Constrained Delaunay version\r\n    removeVertex(v: Vertex): void {\r\n        if (this.tds.dimension <= 1) this.removeConstrainedVertex(v);\r\n        else this.remove2D(v);\r\n    }\r\n\r\n    // This is the normal Constrained version\r\n    private removeConstrainedVertex(v: Vertex): void {\r\n        const vertexCount = this.tds.numberOfVertices(false);\r\n        if (vertexCount === 1 || vertexCount === 2) this.tds.removeDimDown(v);\r\n        else if (this.tds.dimension === 1) console.warn(\"NOT IMPLEMENTED.\");\r\n        // this.remove1D(v)\r\n        else this.remove2D(v);\r\n    }\r\n\r\n    remove2D(v: Vertex): void {\r\n        if (this.testDimDown(v)) this.tds.removeDimDown(v);\r\n        else {\r\n            const hole: Edge[] = [];\r\n            this.tds.makeHole(v, hole);\r\n            const shell: Edge[] = [...hole];\r\n            this.tds.fillHoleDelaunay(hole);\r\n            this.updateConstraints(shell);\r\n            this.tds.deleteVertex(v);\r\n        }\r\n    }\r\n\r\n    testDimDown(v: Vertex): boolean {\r\n        let dim1 = true;\r\n        for (const triangle of this.tds.triangles) {\r\n            if (triangle.isInfinite()) continue;\r\n            if (!triangle.hasVertex(v)) {\r\n                dim1 = false;\r\n                break;\r\n            }\r\n        }\r\n        const fc = new FaceCirculator(v, null);\r\n        while (fc.t!.isInfinite()) fc.next();\r\n        fc.setDone();\r\n        const start = fc.t!;\r\n        let iv = start.indexV(v);\r\n        const p = start.vertices[cw(iv)]!.point!;\r\n        const q = start.vertices[ccw(iv)]!.point!;\r\n        while (dim1 && fc.next()) {\r\n            iv = fc.t!.indexV(v);\r\n            if (fc.t!.vertices[ccw(iv)] !== this.tds._infinite) {\r\n                dim1 = dim1 && orientation(p, q, fc.t!.vertices[ccw(iv)]!.point!) === Sign.COLLINEAR;\r\n            }\r\n        }\r\n        return dim1;\r\n    }\r\n\r\n    updateConstraints(edgeList: Edge[]): void {\r\n        let f: Triangle;\r\n        let i: number;\r\n        for (const edge of edgeList) {\r\n            f = edge[0];\r\n            i = edge[1];\r\n            f.neighbours[i]!.constraints[this.tds.mirrorIndex(f, i)] = f.isConstrained(i);\r\n        }\r\n    }\r\n\r\n    removeConstrainedEdge(t: Triangle, i: number): void {\r\n        t.constraints[i] = false;\r\n        if (this.tds.dimension === 2) t.neighbours[i]!.constraints[this.tds.mirrorIndex(t, i)] = false;\r\n    }\r\n\r\n    removeConstrainedEdgeDelaunay(t: Triangle, i: number): void {\r\n        this.removeConstrainedEdge(t, i);\r\n        if (this.tds.dimension === 2) {\r\n            const listEdges: Edge[] = [[t, i]];\r\n            this.propagatingFlipE(listEdges);\r\n        }\r\n    }\r\n\r\n    updateConstraintsOpposite(v: Vertex): void {\r\n        let t = v.triangle!;\r\n        const start = t;\r\n        let indf: number;\r\n        do {\r\n            indf = t.indexV(v);\r\n            if (t.neighbours[indf]!.constraints[this.tds.mirrorIndex(t, indf)]) t.constraints[indf] = true;\r\n            else t.constraints[indf] = false;\r\n            t = t.neighbours[ccw(indf)]!;\r\n        } while (t !== start);\r\n    }\r\n\r\n    markConstraint(t: Triangle, i: number): void {\r\n        if (this.tds.dimension === 1) t.constraints[2] = true;\r\n        else {\r\n            t.constraints[i] = true;\r\n            t.neighbours[i]!.constraints[this.tds.mirrorIndex(t, i)] = true;\r\n        }\r\n    }\r\n\r\n    insert(p: Point, start: Triangle | null = null): Vertex {\r\n        const locateInfo = this.locate(p, this.iLocate(p, start));\r\n        const va = this.insertb(p, locateInfo.loc, locateInfo.lt, locateInfo.li);\r\n        this.flipAround(va);\r\n        return va;\r\n    }\r\n\r\n    flipAround(v: Vertex): void {\r\n        if (this.tds.dimension <= 1) return;\r\n        let t = v.triangle!;\r\n        let i: number;\r\n        let next: Triangle;\r\n        const start = t;\r\n        do {\r\n            i = t.indexV(v);\r\n            next = t.neighbours[ccw(i)]!;\r\n            this.propagatingFlip(t, i);\r\n            t = next;\r\n        } while (next !== start);\r\n    }\r\n\r\n    propagatingFlip(t: Triangle, i: number, depth = 0): void {\r\n        if (!this.isFlipable(t, i)) return;\r\n        const maxDepth = 100;\r\n        if (depth === maxDepth) {\r\n            throw new Error(\"maxde\");\r\n        }\r\n        const ni = t.neighbours[i]!;\r\n        this.flip(t, i);\r\n        this.propagatingFlip(t, i, depth + 1);\r\n        i = ni.indexV(t.vertices[i]!);\r\n        this.propagatingFlip(ni, i, depth + 1);\r\n    }\r\n\r\n    lessEdge(e1: Edge, e2: Edge): boolean {\r\n        const ind1 = e1[1];\r\n        const ind2 = e2[1];\r\n        return e1[0].uid < e2[0].uid || (e1[0].uid === e2[0].uid && ind1 < ind2);\r\n    }\r\n\r\n    propagatingFlipE(edges: Edge[]): void {\r\n        let eI = 0;\r\n        let t: Triangle;\r\n        let i: number;\r\n        let eni: Edge;\r\n        const edgeSet: Edge[] = [];\r\n        while (eI < edges.length) {\r\n            t = edges[eI][0];\r\n            i = edges[eI][1];\r\n            if (this.isFlipable(t, i)) {\r\n                eni = [t.neighbours[i]!, this.tds.mirrorIndex(t, i)];\r\n                if (this.lessEdge(edges[eI], eni)) edgeSet.push(edges[eI]);\r\n                else edgeSet.push(eni);\r\n            }\r\n            ++eI;\r\n        }\r\n        let indf: number;\r\n        let ni: Triangle;\r\n        let indn: number;\r\n        let ei: Edge;\r\n        const e: (Edge | null)[] = [null, null, null, null];\r\n        while (edgeSet.length > 0) {\r\n            t = edgeSet[0][0];\r\n            indf = edgeSet[0][1];\r\n            ni = t.neighbours[indf]!;\r\n            indn = this.tds.mirrorIndex(t, indf);\r\n            ei = [t, indf];\r\n            edgeSet.splice(edgeSet.findIndex(ed => ed[0] === ei[0] && ed[1] === ei[1]), 1);\r\n            e[0] = [t, cw(indf)];\r\n            e[1] = [t, ccw(indf)];\r\n            e[2] = [ni, cw(indn)];\r\n            e[3] = [ni, ccw(indn)];\r\n\r\n            for (const edge of e) {\r\n                const tt = edge![0];\r\n                const ii = edge![1];\r\n                eni = [tt.neighbours[ii]!, this.tds.mirrorIndex(tt, ii)];\r\n                if (this.lessEdge(edge!, eni))\r\n                    edgeSet.splice(edgeSet.findIndex(ed => ed[0] === edge![0] && ed[1] === edge![1]), 1);\r\n                else edgeSet.splice(edgeSet.findIndex(ed => ed[0] === eni[0] && ed[1] === eni[1]), 1);\r\n            }\r\n\r\n            this.flip(t, indf);\r\n\r\n            for (const edge of e) {\r\n                const tt = edge![0];\r\n                const ii = edge![1];\r\n                if (this.isFlipable(tt, ii)) {\r\n                    eni = [tt.neighbours[ii]!, this.tds.mirrorIndex(tt, ii)];\r\n                    if (this.lessEdge(edge!, eni)) edgeSet.push(edge!);\r\n                    else edgeSet.push(eni);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    flip(t: Triangle, i: number): void {\r\n        const u = t.neighbours[i]!;\r\n        const j = this.tds.mirrorIndex(t, i);\r\n        const t1 = t.neighbours[cw(i)]!;\r\n        const i1 = this.tds.mirrorIndex(t, cw(i));\r\n        const t2 = t.neighbours[ccw(i)]!;\r\n        const i2 = this.tds.mirrorIndex(t, ccw(i));\r\n        const t3 = u.neighbours[cw(j)]!;\r\n        const i3 = this.tds.mirrorIndex(u, cw(j));\r\n        const t4 = u.neighbours[ccw(j)]!;\r\n        const i4 = this.tds.mirrorIndex(u, ccw(j));\r\n        this.tds.flip(t, i);\r\n        t.constraints[t.indexT(u)] = false;\r\n        u.constraints[u.indexT(t)] = false;\r\n        t1.neighbours[i1]!.constraints[this.tds.mirrorIndex(t1, i1)] = t1.constraints[i1];\r\n        t2.neighbours[i2]!.constraints[this.tds.mirrorIndex(t2, i2)] = t2.constraints[i2];\r\n        t3.neighbours[i3]!.constraints[this.tds.mirrorIndex(t3, i3)] = t3.constraints[i3];\r\n        t4.neighbours[i4]!.constraints[this.tds.mirrorIndex(t4, i4)] = t4.constraints[i4];\r\n    }\r\n\r\n    isFlipable(t: Triangle, i: number, perturb = true): boolean {\r\n        const ni = t.neighbours[i]!;\r\n        if (t.isInfinite() || ni.isInfinite()) return false;\r\n        if (t.constraints[i]) return false;\r\n        return sideOfOrientedCircle(ni, t.vertices[i]!.point!, perturb) === Sign.ON_POSITIVE_SIDE;\r\n    }\r\n\r\n    insertb(a: Point, loc: Triangle | null, lt: LocateType, li: number): Vertex {\r\n        let insertInConstrainedEdge = false;\r\n        let v1: Vertex;\r\n        let v2: Vertex;\r\n        if (lt === LocateType.EDGE && loc!.isConstrained(li)) {\r\n            insertInConstrainedEdge = true;\r\n            v1 = loc!.vertices[ccw(li)]!;\r\n            v2 = loc!.vertices[cw(li)]!;\r\n        }\r\n        const va = this.insertc(a, loc, lt, li);\r\n        if (insertInConstrainedEdge) this.updateConstraintsIncident(va, v1!, v2!);\r\n        else if (lt !== LocateType.VERTEX) this.clearConstraintsIncident(va);\r\n        if (this.tds.dimension === 2) this.updateConstraintsOpposite(va);\r\n        return va;\r\n    }\r\n\r\n    updateConstraintsIncident(va: Vertex, c1: Vertex, c2: Vertex): void {\r\n        if (this.tds.dimension === 0) return;\r\n        if (this.tds.dimension === 1) {\r\n            const ec = new EdgeCirculator(va, null);\r\n            do {\r\n                ec.t!.constraints[2] = true;\r\n            } while (ec.next());\r\n        } else {\r\n            const fc = new FaceCirculator(va, null);\r\n            do {\r\n                const indf = fc.t!.indexV(va);\r\n                const cwi = cw(indf);\r\n                const ccwi = ccw(indf);\r\n                if (fc.t!.vertices[cwi] === c1 || fc.t!.vertices[cwi] === c2) {\r\n                    fc.t!.constraints[ccwi] = true;\r\n                    fc.t!.constraints[cwi] = false;\r\n                } else {\r\n                    fc.t!.constraints[ccwi] = false;\r\n                    fc.t!.constraints[cwi] = true;\r\n                }\r\n            } while (fc.next());\r\n        }\r\n    }\r\n\r\n    clearConstraintsIncident(v: Vertex): void {\r\n        const ec = new EdgeCirculator(v, null);\r\n        if (ec.valid) {\r\n            do {\r\n                const t = ec.t!;\r\n                const indf = ec.ri;\r\n                t.constraints[indf] = false;\r\n                if (this.tds.dimension === 2) t.neighbours[indf]!.constraints[this.tds.mirrorIndex(t, indf)] = false;\r\n            } while (ec.next());\r\n        }\r\n    }\r\n\r\n    insertc(p: Point, loc: Triangle | null, lt: LocateType, li: number): Vertex {\r\n        if (this.tds.vertices.length === 1) {\r\n            return this.insertFirst(p);\r\n        } else if (this.tds.vertices.length === 2) {\r\n            if (lt === LocateType.VERTEX) return this.tds.finiteVertex;\r\n            else return this.insertSecond(p);\r\n        }\r\n        switch (lt) {\r\n            case LocateType.VERTEX: {\r\n                return loc!.vertices[li]!;\r\n            }\r\n            case LocateType.OUTSIDE_AFFINE_HULL: {\r\n                return this.insertOutsideAffineHull(p);\r\n            }\r\n            case LocateType.OUTSIDE_CONVEX_HULL: {\r\n                return this.insertOutsideConvexHull(p, loc!);\r\n            }\r\n            case LocateType.EDGE: {\r\n                return this.insertInEdge(p, loc!, li);\r\n            }\r\n            case LocateType.FACE: {\r\n                return this.insertInFace(p, loc!);\r\n            }\r\n        }\r\n        throw new Error(\"qwe\");\r\n    }\r\n\r\n    insertInEdge(p: Point, loc: Triangle, li: number): Vertex {\r\n        const v = this.tds.insertInEdge(loc, li);\r\n        v.point = p;\r\n        return v;\r\n    }\r\n\r\n    insertInFace(p: Point, loc: Triangle): Vertex {\r\n        const v = this.tds.insertInFace(loc);\r\n        v.point = p;\r\n        return v;\r\n    }\r\n\r\n    insertFirst(p: Point): Vertex {\r\n        const v = this.tds.insertDimUp();\r\n        v.point = p;\r\n        return v;\r\n    }\r\n\r\n    insertSecond(p: Point): Vertex {\r\n        const v = this.tds.insertDimUp(this.tds._infinite, true);\r\n        v.point = p;\r\n        return v;\r\n    }\r\n\r\n    insertOutsideAffineHull(p: Point): Vertex {\r\n        let conform = false;\r\n        if (this.tds.dimension === 1) {\r\n            const t = this.tds.finiteEdge.first!;\r\n            const orient = orientation(t.vertices[0]!.point!, t.vertices[1]!.point!, p);\r\n            conform = orient === Sign.COUNTERCLOCKWISE;\r\n        }\r\n        const v = this.tds.insertDimUp(this.tds._infinite, conform);\r\n        v.point = p;\r\n        return v;\r\n    }\r\n\r\n    insertOutsideConvexHull(p: Point, t: Triangle): Vertex {\r\n        let v: Vertex;\r\n        if (this.tds.dimension === 1) {\r\n            throw new Error(\"sdfasdasd\");\r\n        } else {\r\n            v = this.insertOutsideConvexHull2(p, t);\r\n        }\r\n        v.point = p;\r\n        return v;\r\n    }\r\n\r\n    insertOutsideConvexHull2(p: Point, t: Triangle): Vertex {\r\n        let li = t.indexV(this.tds._infinite);\r\n        const ccwlist: Triangle[] = [];\r\n        const cwlist: Triangle[] = [];\r\n        let fc = new FaceCirculator(this.tds._infinite, t);\r\n        let done = false;\r\n        while (!done) {\r\n            fc.prev();\r\n            li = fc.t!.indexV(this.tds._infinite);\r\n            const q = fc.t!.vertices[ccw(li)]!.point!;\r\n            const r = fc.t!.vertices[cw(li)]!.point!;\r\n            if (orientation(p, q, r) === Sign.LEFT_TURN) ccwlist.push(fc.t!);\r\n            else done = true;\r\n        }\r\n        fc = new FaceCirculator(this.tds._infinite, t);\r\n        done = false;\r\n        while (!done) {\r\n            fc.next();\r\n            li = fc.t!.indexV(this.tds._infinite);\r\n            const q = fc.t!.vertices[ccw(li)]!.point!;\r\n            const r = fc.t!.vertices[cw(li)]!.point!;\r\n            if (orientation(p, q, r) === Sign.LEFT_TURN) cwlist.push(fc.t!);\r\n            else done = true;\r\n        }\r\n        const v = this.tds.insertInFace(t);\r\n        v.point = p;\r\n        let th;\r\n        while (ccwlist.length > 0) {\r\n            th = ccwlist[0];\r\n            li = ccw(th.indexV(this.tds._infinite));\r\n            this.tds.flip(th, li);\r\n            ccwlist.shift();\r\n        }\r\n        while (cwlist.length > 0) {\r\n            th = cwlist[0];\r\n            li = cw(th.indexV(this.tds._infinite));\r\n            this.tds.flip(th, li);\r\n            cwlist.shift();\r\n        }\r\n        fc = new FaceCirculator(v, null);\r\n        while (!fc.t!.isInfinite()) fc.next();\r\n        this.tds._infinite.triangle = fc.t!;\r\n        return v;\r\n    }\r\n\r\n    locate(\r\n        p: Point,\r\n        start: Triangle | null,\r\n    ): { loc: Triangle; lt: LocateType; li: number } | { loc: null; lt: number; li: number } {\r\n        let lt = 0;\r\n        let li = 0;\r\n        if (this.tds.dimension < 0) {\r\n            lt = LocateType.OUTSIDE_AFFINE_HULL;\r\n            li = 4;\r\n            return { loc: null, lt, li };\r\n        } else if (this.tds.dimension === 0) {\r\n            if (xyEqual(p, this.tds.finiteVertex.triangle!.vertices[0]!.point!)) {\r\n                lt = LocateType.VERTEX;\r\n            } else {\r\n                lt = LocateType.OUTSIDE_AFFINE_HULL;\r\n            }\r\n            li = 4;\r\n            return { loc: null, lt, li };\r\n        } else if (this.tds.dimension === 1) {\r\n            return this.marchLocate1D(p);\r\n        }\r\n        if (start === null) {\r\n            const t = this.tds._infinite.triangle!;\r\n            start = t.neighbours[t.indexV(this.tds._infinite)]!;\r\n        } else if (start.isInfinite()) {\r\n            start = start.neighbours[start.indexV(this.tds._infinite)]!;\r\n        }\r\n        return this.marchLocate2D(start, p);\r\n    }\r\n\r\n    marchLocate1D(p: Point): { loc: Triangle; lt: LocateType; li: number } {\r\n        const ff = this.tds._infinite.triangle!;\r\n        const iv = ff.indexV(this.tds._infinite);\r\n        const t = ff.neighbours[iv]!;\r\n        const pqt = orientation(t.vertices[0]!.point!, t.vertices[1]!.point!, p);\r\n        if (pqt === Sign.RIGHT_TURN || pqt === Sign.LEFT_TURN) {\r\n            return { loc: new Triangle(), lt: LocateType.OUTSIDE_AFFINE_HULL, li: 4 };\r\n        }\r\n        const i = t.indexT(ff);\r\n        if (collinearBetween(p, t.vertices[1 - i]!.point!, t.vertices[i]!.point!))\r\n            return { loc: ff, lt: LocateType.OUTSIDE_CONVEX_HULL, li: iv };\r\n\r\n        if (xyEqual(p, t.vertices[1 - i]!.point!)) return { loc: t, lt: LocateType.VERTEX, li: 1 - i };\r\n        throw new Error(\"sdfsdf\");\r\n    }\r\n\r\n    marchLocate2D(c: Triangle, p: Point): { loc: Triangle; lt: LocateType; li: number } {\r\n        let prev = null;\r\n        let first = true;\r\n        let lt: LocateType | undefined;\r\n        let li: number | undefined;\r\n        while (true) {\r\n            if (c.isInfinite()) {\r\n                return { loc: c, lt: LocateType.OUTSIDE_CONVEX_HULL, li: c.indexV(this.tds._infinite) };\r\n            }\r\n            const leftFirst = 0; // Math.round(Math.random());\r\n            const p0 = c.vertices[0]!.point!;\r\n            const p1 = c.vertices[1]!.point!;\r\n            const p2 = c.vertices[2]!.point!;\r\n            let o0: Sign;\r\n            let o1: Sign;\r\n            let o2: Sign;\r\n            if (first) {\r\n                prev = c;\r\n                first = false;\r\n                o0 = orientation(p0, p1, p);\r\n                if (o0 === Sign.NEGATIVE) {\r\n                    c = c.neighbours[2]!;\r\n                    continue;\r\n                }\r\n                o1 = orientation(p1, p2, p);\r\n                if (o1 === Sign.NEGATIVE) {\r\n                    c = c.neighbours[0]!;\r\n                    continue;\r\n                }\r\n                o2 = orientation(p2, p0, p);\r\n                if (o2 === Sign.NEGATIVE) {\r\n                    c = c.neighbours[1]!;\r\n                    continue;\r\n                }\r\n            } else if (leftFirst) {\r\n                if (c.neighbours[0]! === prev) {\r\n                    prev = c;\r\n                    o0 = orientation(p0, p1, p);\r\n                    if (o0 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[2]!;\r\n                        continue;\r\n                    }\r\n                    o2 = orientation(p2, p0, p);\r\n                    if (o2 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[1]!;\r\n                        continue;\r\n                    }\r\n                    o1 = Sign.POSITIVE;\r\n                } else if (c.neighbours[1]! === prev) {\r\n                    prev = c;\r\n                    o1 = orientation(p1, p2, p);\r\n                    if (o1 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[0]!;\r\n                        continue;\r\n                    }\r\n                    o0 = orientation(p0, p1, p);\r\n                    if (o0 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[2]!;\r\n                        continue;\r\n                    }\r\n                    o2 = Sign.POSITIVE;\r\n                } else {\r\n                    prev = c;\r\n                    o2 = orientation(p2, p0, p);\r\n                    if (o2 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[1]!;\r\n                        continue;\r\n                    }\r\n                    o1 = orientation(p1, p2, p);\r\n                    if (o1 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[0]!;\r\n                        continue;\r\n                    }\r\n                    o0 = Sign.POSITIVE;\r\n                }\r\n            } else {\r\n                if (c.neighbours[0] === prev) {\r\n                    prev = c;\r\n                    o2 = orientation(p2, p0, p);\r\n                    if (o2 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[1]!;\r\n                        continue;\r\n                    }\r\n                    o0 = orientation(p0, p1, p);\r\n                    if (o0 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[2]!;\r\n                        continue;\r\n                    }\r\n                    o1 = Sign.POSITIVE;\r\n                } else if (c.neighbours[1] === prev) {\r\n                    prev = c;\r\n                    o0 = orientation(p0, p1, p);\r\n                    if (o0 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[2]!;\r\n                        continue;\r\n                    }\r\n                    o1 = orientation(p1, p2, p);\r\n                    if (o1 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[0]!;\r\n                        continue;\r\n                    }\r\n                    o2 = Sign.POSITIVE;\r\n                } else {\r\n                    prev = c;\r\n                    o1 = orientation(p1, p2, p);\r\n                    if (o1 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[0]!;\r\n                        continue;\r\n                    }\r\n                    o2 = orientation(p2, p0, p);\r\n                    if (o2 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[1]!;\r\n                        continue;\r\n                    }\r\n                    o0 = Sign.POSITIVE;\r\n                }\r\n            }\r\n            const sum =\r\n                (o0 === Sign.COLLINEAR ? 1 : 0) + (o1 === Sign.COLLINEAR ? 1 : 0) + (o2 === Sign.COLLINEAR ? 1 : 0);\r\n            switch (sum) {\r\n                case 0: {\r\n                    lt = LocateType.FACE;\r\n                    li = 4;\r\n                    break;\r\n                }\r\n                case 1: {\r\n                    lt = LocateType.EDGE;\r\n                    li = o0 === Sign.COLLINEAR ? 2 : o1 === Sign.COLLINEAR ? 0 : 1;\r\n                    break;\r\n                }\r\n                case 2: {\r\n                    lt = LocateType.VERTEX;\r\n                    li = o0 !== Sign.COLLINEAR ? 2 : o1 !== Sign.COLLINEAR ? 0 : 1;\r\n                    break;\r\n                }\r\n            }\r\n            if (lt === undefined || li === undefined) throw new Error(\"ert\");\r\n            return { loc: c, lt, li };\r\n        }\r\n    }\r\n\r\n    iLocate(p: Point, start: Triangle | null): Triangle | null {\r\n        if (this.tds.dimension < 2) return start;\r\n        if (start === null) {\r\n            const t = this.tds._infinite.triangle!;\r\n            start = t.neighbours[t.indexV(this.tds._infinite)];\r\n        } else if (start.isInfinite()) {\r\n            start = start.neighbours[start.indexV(this.tds._infinite)];\r\n        }\r\n        let prev = null;\r\n        let c = start!;\r\n        let first = true;\r\n        let nTurns = 2500;\r\n        while (true) {\r\n            if (!nTurns--) return c;\r\n            if (c.isInfinite()) return c;\r\n            const p0 = c.vertices[0]!.point!;\r\n            const p1 = c.vertices[1]!.point!;\r\n            const p2 = c.vertices[2]!.point!;\r\n            if (first) {\r\n                prev = c;\r\n                first = false;\r\n                if (hasInexactNegativeOrientation(p0, p1, p)) {\r\n                    c = c.neighbours[2]!;\r\n                    continue;\r\n                }\r\n                if (hasInexactNegativeOrientation(p1, p2, p)) {\r\n                    c = c.neighbours[0]!;\r\n                    continue;\r\n                }\r\n                if (hasInexactNegativeOrientation(p2, p0, p)) {\r\n                    c = c.neighbours[1]!;\r\n                    continue;\r\n                }\r\n            } else {\r\n                if (c.neighbours[0] === prev) {\r\n                    prev = c;\r\n                    if (hasInexactNegativeOrientation(p0, p1, p)) {\r\n                        c = c.neighbours[2]!;\r\n                        continue;\r\n                    }\r\n                    if (hasInexactNegativeOrientation(p2, p0, p)) {\r\n                        c = c.neighbours[1]!;\r\n                        continue;\r\n                    }\r\n                } else if (c.neighbours[1] === prev) {\r\n                    prev = c;\r\n                    if (hasInexactNegativeOrientation(p0, p1, p)) {\r\n                        c = c.neighbours[2]!;\r\n                        continue;\r\n                    }\r\n                    if (hasInexactNegativeOrientation(p1, p2, p)) {\r\n                        c = c.neighbours[0]!;\r\n                        continue;\r\n                    }\r\n                } else {\r\n                    prev = c;\r\n                    if (hasInexactNegativeOrientation(p2, p0, p)) {\r\n                        c = c.neighbours[1]!;\r\n                        continue;\r\n                    }\r\n                    if (hasInexactNegativeOrientation(p1, p2, p)) {\r\n                        c = c.neighbours[0]!;\r\n                        continue;\r\n                    }\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        return c;\r\n    }\r\n}\r\n","import { BoundingRect } from \"@/game/shapes/boundingrect\";\r\n\r\nexport class BoundingNode {\r\n    bbox: BoundingRect;\r\n    nPrimitives: number;\r\n    children: BoundingNode[] = [];\r\n    constructor(nPrimitives: number, bbox: BoundingRect) {\r\n        this.nPrimitives = nPrimitives;\r\n        this.bbox = bbox;\r\n    }\r\n}\r\n\r\nexport class LeafNode extends BoundingNode {\r\n    firstPrimOffset: number;\r\n    constructor(first: number, n: number, bbox: BoundingRect) {\r\n        super(n, bbox);\r\n        this.firstPrimOffset = first;\r\n    }\r\n}\r\n\r\nexport class InteriorNode extends BoundingNode {\r\n    dimension: number;\r\n    constructor(dimension: number, c1: BoundingNode, c2: BoundingNode) {\r\n        super(0, c1.bbox.union(c2.bbox));\r\n        this.dimension = dimension;\r\n        this.children.push(c1);\r\n        this.children.push(c2);\r\n    }\r\n}\r\n","import { partition } from \"@/core/utils\";\r\nimport { GlobalPoint, Ray } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { BoundingRect } from \"@/game/shapes/boundingrect\";\r\nimport { g2lx, g2ly, g2lz } from \"@/game/units\";\r\nimport { BoundingNode, InteriorNode, LeafNode } from \"@/game/visibility/bvh/node\";\r\n\r\ninterface BuildInfo {\r\n    index: number;\r\n    bbox: BoundingRect;\r\n    center: BoundingRect;\r\n}\r\ninterface LinearBHVNode {\r\n    bbox: BoundingRect;\r\n    nPrimitives: number;\r\n}\r\ninterface LinearLeafNode extends LinearBHVNode {\r\n    primitivesOffset: number;\r\n}\r\ninterface LinearInternalNode extends LinearBHVNode {\r\n    secondChildOffset: number;\r\n    dimension: number;\r\n}\r\n\r\nexport class BoundingVolume {\r\n    totalNodes = 0;\r\n    buildData: BuildInfo[] = [];\r\n    shapes: string[];\r\n    orderedPrims: string[] = [];\r\n    root: BoundingNode | null;\r\n    nodes: LinearBHVNode[] = [];\r\n\r\n    offset = 0;\r\n\r\n    constructor(shapes: string[]) {\r\n        this.shapes = shapes;\r\n        if (this.shapes.length === 0) {\r\n            this.root = null;\r\n            this.nodes = [];\r\n            return;\r\n        }\r\n        for (let i = 0; i < shapes.length; i++) {\r\n            const shape = layerManager.UUIDMap.get(shapes[i])!;\r\n            this.buildData.push({\r\n                index: i,\r\n                bbox: shape.getBoundingBox(),\r\n                center: new BoundingRect(shape.center(), 0, 0),\r\n            });\r\n        }\r\n        this.root = this.recursiveBuild(0, shapes.length);\r\n        this.compact();\r\n    }\r\n\r\n    draw(): void {\r\n        const ctx = layerManager.getLayer(\"draw\")!.ctx;\r\n        for (const node of this.nodes) {\r\n            const b = node.bbox;\r\n            ctx.strokeRect(g2lx(b.topLeft.x), g2ly(b.topLeft.y), g2lz(b.w), g2lz(b.h));\r\n        }\r\n    }\r\n\r\n    recursiveBuild(start: number, end: number): BoundingNode {\r\n        this.totalNodes++;\r\n        let bbox = this.buildData[start].bbox;\r\n        for (let i = start + 1; i < end; i++) bbox = bbox.union(this.buildData[i].bbox);\r\n        const nPrimitives = end - start;\r\n        if (nPrimitives === 1) {\r\n            return this.createLeaf(start, end, nPrimitives, bbox);\r\n        } else {\r\n            let centroidBbox = this.buildData[start].center;\r\n            for (let i = start; i < end; i++) centroidBbox = centroidBbox.union(this.buildData[i].center);\r\n            const dimension = centroidBbox.getMaxExtent();\r\n            if (centroidBbox.botRight.get(dimension) === centroidBbox.topLeft.get(dimension)) {\r\n                return this.createLeaf(start, end, nPrimitives, bbox);\r\n            }\r\n            // Use shitty Middle thingy until an introselect js algo is added\r\n            const pMid = 0.5 * (centroidBbox.topLeft.get(dimension) + centroidBbox.botRight.get(dimension));\r\n            const partitionedData = partition(\r\n                this.buildData.slice(start, end),\r\n                (n: BuildInfo) => n.center.center().get(dimension) < pMid,\r\n            );\r\n            const flattened = (<BuildInfo[]>[]).concat.apply([], partitionedData);\r\n            if (partitionedData[0].length === 0 || partitionedData[1].length === 0) console.log(\"EMPTY\");\r\n            this.buildData.splice(start, flattened.length, ...flattened);\r\n            const mid = partitionedData[0].length + start;\r\n            return new InteriorNode(dimension, this.recursiveBuild(start, mid), this.recursiveBuild(mid, end));\r\n        }\r\n    }\r\n\r\n    intersect(\r\n        ray: Ray<GlobalPoint>,\r\n        stopOnFirstHit?: boolean,\r\n    ): { hit: boolean; intersect: GlobalPoint; tMin: number; tMax: number } {\r\n        if (this.nodes.length === 0) return { hit: false, intersect: ray.get(0), tMin: 0, tMax: ray.tMax };\r\n        if (stopOnFirstHit === undefined) stopOnFirstHit = false;\r\n        // Initialize return values\r\n        let hit = false;\r\n        let tMin = 0;\r\n        let tMax = ray.tMax;\r\n\r\n        // Initialize work variables\r\n        let todoOffset = 0;\r\n        let nodeNum = 0;\r\n        const todo: number[] = [];\r\n\r\n        // Precalculate intersection vectors\r\n        const invDir = ray.direction.inverse();\r\n        const dirIsNegative = [invDir.x < 0, invDir.y < 0];\r\n\r\n        while (true) {\r\n            const node = this.nodes[nodeNum];\r\n\r\n            const i = node.bbox.intersectP(ray, invDir, dirIsNegative);\r\n            if (i.hit) {\r\n                if (node.nPrimitives > 0) {\r\n                    // TODO: nPrimitives is currently always 1 , this could be generalised\r\n                    // for (let i=0; i < node.nPrimitives; i++) {\r\n                    //     if (this.shapes[(<LinearLeafNode>node).primitivesOffset + i])\r\n                    // }\r\n                    hit = true;\r\n                    tMin = ray.tMax = i.min;\r\n                    tMax = i.max;\r\n                    if (todoOffset === 0 || stopOnFirstHit) break;\r\n                    nodeNum = todo[--todoOffset];\r\n                } else {\r\n                    if (dirIsNegative[(<LinearInternalNode>node).dimension]) {\r\n                        todo[todoOffset++] = nodeNum + 1;\r\n                        nodeNum = (<LinearInternalNode>node).secondChildOffset;\r\n                    } else {\r\n                        todo[todoOffset++] = (<LinearInternalNode>node).secondChildOffset;\r\n                        nodeNum++;\r\n                    }\r\n                }\r\n            } else {\r\n                if (todoOffset === 0) break;\r\n                nodeNum = todo[--todoOffset];\r\n            }\r\n        }\r\n        return { hit, intersect: ray.get(tMin), tMin, tMax };\r\n    }\r\n\r\n    private compact(): void {\r\n        this.offset = 0;\r\n        if (this.root !== null) this.flatten(this.root);\r\n    }\r\n\r\n    private flatten(node: BoundingNode): number {\r\n        const index = this.offset;\r\n        const myOffset = this.offset++;\r\n        if (node.nPrimitives === 0) {\r\n            this.flatten(node.children[0]);\r\n            const secondOffset = this.flatten(node.children[1]);\r\n            const linearNode: LinearInternalNode = {\r\n                bbox: node.bbox,\r\n                dimension: (<InteriorNode>node).dimension,\r\n                nPrimitives: 0,\r\n                secondChildOffset: secondOffset,\r\n            };\r\n            this.nodes[index] = linearNode;\r\n        } else {\r\n            const leafNode: LinearLeafNode = {\r\n                bbox: node.bbox,\r\n                primitivesOffset: (<LeafNode>node).firstPrimOffset,\r\n                nPrimitives: node.nPrimitives,\r\n            };\r\n            this.nodes[index] = leafNode;\r\n        }\r\n        return myOffset;\r\n    }\r\n\r\n    private createLeaf(start: number, end: number, nPrimitives: number, bbox: BoundingRect): LeafNode {\r\n        const size = this.orderedPrims.length;\r\n        for (let i = start; i < end; i++) this.orderedPrims.push(this.shapes[this.buildData[i].index]);\r\n        return new LeafNode(size, nPrimitives, bbox);\r\n    }\r\n}\r\n","import { socket } from \"@/game/api/socket\";\r\nimport { rootStore } from \"@/store\";\r\nimport { Action, getModule, Module, Mutation, VuexModule } from \"vuex-module-decorators\";\r\nimport { Shape } from \"../shapes/shape\";\r\nimport { BoundingVolume } from \"./bvh/bvh\";\r\nimport { deleteShapeFromTriag, triangulate, TriangulationTarget, addShapesToTriag } from \"./te/pa\";\r\n\r\nexport interface VisibilityState {\r\n    visionMode: \"bvh\" | \"triangle\";\r\n    visionBlockers: string[];\r\n}\r\n\r\n@Module({ dynamic: true, store: rootStore, name: \"visibility\", namespaced: true })\r\nclass VisibilityStore extends VuexModule implements VisibilityState {\r\n    BV = Object.freeze(new BoundingVolume([]));\r\n\r\n    visionMode: \"bvh\" | \"triangle\" = \"bvh\";\r\n    visionBlockers: string[] = [];\r\n\r\n    @Mutation\r\n    setVisionMode(data: { mode: \"bvh\" | \"triangle\"; sync: boolean }): void {\r\n        this.visionMode = data.mode;\r\n        // eslint-disable-next-line @typescript-eslint/camelcase\r\n        if (data.sync) socket.emit(\"Location.Options.Set\", { vision_mode: data.mode });\r\n    }\r\n\r\n    @Mutation\r\n    recalculateVision(): void {\r\n        if (this.visionMode === \"triangle\") triangulate(TriangulationTarget.VISION);\r\n        else this.BV = Object.freeze(new BoundingVolume(this.visionBlockers));\r\n    }\r\n\r\n    @Mutation\r\n    recalculateMovement(): void {\r\n        if (this.visionMode === \"triangle\") triangulate(TriangulationTarget.MOVEMENT);\r\n    }\r\n\r\n    @Mutation\r\n    deleteFromTriag(data: { target: TriangulationTarget; shape: Shape; standalone: boolean }): void {\r\n        if (this.visionMode === \"triangle\") {\r\n            deleteShapeFromTriag(data.target, data.shape);\r\n        } else if (data.standalone) {\r\n            this.recalculateVision();\r\n        }\r\n    }\r\n\r\n    @Mutation\r\n    addToTriag(data: { target: TriangulationTarget; shape: Shape }): void {\r\n        if (this.visionMode === \"triangle\") addShapesToTriag(data.target, data.shape);\r\n        else this.recalculateVision();\r\n    }\r\n\r\n    @Action\r\n    clear(): void {\r\n        (<any>this.context.state).visionBlockers = [];\r\n        this.context.commit(\"recalculateVision\");\r\n        this.context.commit(\"recalculateMovement\");\r\n    }\r\n}\r\n\r\nexport const visibilityStore = getModule(VisibilityStore);\r\n","import { layerManager } from \"@/game/layers/manager\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { equalPoints } from \"@/game/utils\";\r\nimport { CDT } from \"./cdt\";\r\nimport { Edge, Vertex } from \"./tds\";\r\nimport { ccw, collinearBetween } from \"./triag\";\r\n\r\nexport enum TriangulationTarget {\r\n    VISION = \"vision\",\r\n    MOVEMENT = \"movement\",\r\n}\r\nimport { visibilityStore } from \"../store\";\r\n\r\nexport let PA_CDT = {\r\n    vision: new CDT(),\r\n    movement: new CDT(),\r\n};\r\n\r\nexport function triangulate(target: TriangulationTarget): void {\r\n    console.warn(`RETRIANGULATING ${target}`);\r\n    console.time(\"TRI\");\r\n    const cdt = new CDT();\r\n\r\n    let shapes;\r\n    if (target === \"vision\") shapes = visibilityStore.visionBlockers;\r\n    else shapes = gameStore.movementblockers;\r\n\r\n    for (const sh of shapes) {\r\n        const shape = layerManager.UUIDMap.get(sh)!;\r\n        for (let i = 0; i < shape.points.length; i++) {\r\n            const pa = shape.points[i];\r\n            const pb = shape.points[(i + 1) % shape.points.length];\r\n            const { va, vb } = cdt.insertConstraint(pa, pb);\r\n            va.shapes.add(shape);\r\n            vb.shapes.add(shape);\r\n            shape.addTriagVertices(va, vb);\r\n        }\r\n    }\r\n    // console.log(s);\r\n    // LEFT WALL\r\n    cdt.insertConstraint([-1e8, -1e8], [-1e8, 1e8]);\r\n    cdt.insertConstraint([-1e8, 1e8], [-1e11, 1e8]);\r\n    cdt.insertConstraint([-1e11, 1e8], [-1e11, -1e8]);\r\n    cdt.insertConstraint([-1e11, -1e8], [-1e8, -1e8]);\r\n    // TOP WALL\r\n    cdt.insertConstraint([-1e8, -1e8], [1e8, -1e8]);\r\n    cdt.insertConstraint([1e8, -1e8], [1e8, -1e11]);\r\n    cdt.insertConstraint([1e8, -1e11], [-1e8, -1e11]);\r\n    cdt.insertConstraint([-1e8, -1e11], [-1e8, -1e8]);\r\n    // RIGHT WALL\r\n    cdt.insertConstraint([1e8, -1e8], [1e8, 1e8]);\r\n    cdt.insertConstraint([1e8, 1e8], [1e11, 1e8]);\r\n    cdt.insertConstraint([1e11, 1e8], [1e11, -1e8]);\r\n    cdt.insertConstraint([1e11, -1e8], [1e8, -1e8]);\r\n    // BOT WALL\r\n    cdt.insertConstraint([-1e8, 1e8], [1e8, 1e8]);\r\n    cdt.insertConstraint([1e8, 1e8], [1e8, 1e11]);\r\n    cdt.insertConstraint([1e8, 1e11], [-1e8, 1e11]);\r\n    cdt.insertConstraint([-1e8, 1e11], [-1e8, 1e8]);\r\n    PA_CDT[target] = cdt;\r\n    (<any>window).CDT = PA_CDT;\r\n    console.timeEnd(\"TRI\");\r\n}\r\n\r\ninterface DeleteQueue {\r\n    vertices: Set<Vertex>;\r\n    edges: Edge[];\r\n    newConstraints: Vertex[][];\r\n    triBridge: Vertex[];\r\n}\r\n\r\nfunction deleteIntersectVertex(\r\n    vertex: Vertex,\r\n    from: Vertex,\r\n    target: Vertex,\r\n    queues: DeleteQueue,\r\n    isCorner: boolean,\r\n): Vertex {\r\n    const sharesVertex = vertex.shapes.size >= (isCorner ? 2 : 1);\r\n    if (!sharesVertex && !queues.newConstraints.some(nc => nc.includes(vertex))) queues.vertices.add(vertex);\r\n    const edges = [...vertex.getIncidentEdges()].filter(e => e.first!.constraints[e.second]);\r\n    let fixBridge: Vertex[] = [];\r\n    let nextIntersect: Vertex | null = null;\r\n    let constrainedEdgeKept: Edge | null = null;\r\n    for (const edge of edges) {\r\n        const ccwv = edge.first!.vertices[ccw(edge.second)]!;\r\n        const ccwp = ccwv.point!;\r\n        const sharesCCWP = ccwv.shapes.size > (ccwv === target ? 1 : 0);\r\n        if (equalPoints(ccwp, target.point!)) {\r\n            if (!(sharesVertex && sharesCCWP)) queues.edges.push(edge);\r\n        } else if (equalPoints(ccwp, from.point!)) continue;\r\n        else if (collinearBetween(vertex.point!, ccwp, target.point!)) {\r\n            if (nextIntersect !== null) console.warn(\"Multiple collinear vertices found?\");\r\n            if (sharesCCWP && edges.length === 3) {\r\n                if (constrainedEdgeKept === null) constrainedEdgeKept = edge;\r\n                else {\r\n                    let otherConstrainedEdgeVertex = constrainedEdgeKept.first!.vertices[\r\n                        constrainedEdgeKept.second === 0 ? 1 : 0\r\n                    ]!;\r\n                    if (otherConstrainedEdgeVertex === vertex)\r\n                        otherConstrainedEdgeVertex = constrainedEdgeKept.first!.vertices[2]!;\r\n                    queues.edges.push(edge, constrainedEdgeKept);\r\n                    queues.newConstraints.push([ccwv, otherConstrainedEdgeVertex]);\r\n                    constrainedEdgeKept = null;\r\n                }\r\n            } else queues.edges.push(edge);\r\n            nextIntersect = ccwv;\r\n        } else if (edges.length === 3) {\r\n            if (sharesCCWP) {\r\n                if (constrainedEdgeKept === null) constrainedEdgeKept = edge;\r\n                else {\r\n                    let otherConstrainedEdgeVertex = constrainedEdgeKept.first!.vertices[\r\n                        constrainedEdgeKept.second === 0 ? 1 : 0\r\n                    ]!;\r\n                    if (otherConstrainedEdgeVertex === vertex)\r\n                        otherConstrainedEdgeVertex = constrainedEdgeKept.first!.vertices[2]!;\r\n                    queues.edges.push(edge, constrainedEdgeKept);\r\n                    queues.newConstraints.push([ccwv, otherConstrainedEdgeVertex]);\r\n                    constrainedEdgeKept = null;\r\n                }\r\n            } else {\r\n                queues.edges.push(edge);\r\n                if (queues.triBridge.length === 0) queues.triBridge.push(isCorner ? ccwv : vertex);\r\n                else queues.newConstraints.push([queues.triBridge.pop()!, isCorner ? ccwv : vertex]);\r\n            }\r\n        } else if (!(sharesVertex && sharesCCWP) && edges.length === 4) {\r\n            queues.edges.push(edge);\r\n            if (queues.vertices.has(ccwv)) {\r\n                for (let i = queues.newConstraints.length - 1; i >= 0; i--) {\r\n                    const [from_, to] = queues.newConstraints[i];\r\n                    if (from_ === vertex || to === vertex) {\r\n                        const brokenBridge = queues.newConstraints.splice(i, 1)[0];\r\n                        fixBridge = [...fixBridge, ...brokenBridge.filter(v => v !== vertex)];\r\n                        queues.vertices.add(vertex);\r\n                    }\r\n                }\r\n            } else if (queues.triBridge.includes(ccwv)) {\r\n                fixBridge.push(queues.triBridge.pop()!);\r\n            } else fixBridge.push(ccwv);\r\n        }\r\n    }\r\n    if ((edges.length === 3 || edges.length === 4) && fixBridge.length === 1 && queues.triBridge.length === 1) {\r\n        queues.newConstraints.push([fixBridge.pop()!, queues.triBridge.pop()!]);\r\n    } else if (edges.length === 4 && fixBridge.length > 0) queues.newConstraints.push(fixBridge);\r\n    if (nextIntersect === null) return vertex;\r\n    return deleteIntersectVertex(nextIntersect, vertex, target, queues, false);\r\n}\r\n\r\nexport function deleteShapeFromTriag(target: TriangulationTarget, shape: Shape): void {\r\n    console.time(\"DS\");\r\n    const cdt = PA_CDT[target];\r\n    const queues: DeleteQueue = {\r\n        vertices: new Set(),\r\n        edges: [],\r\n        newConstraints: [],\r\n        triBridge: [],\r\n    };\r\n    const np = shape.triagVertices.length;\r\n    let from = shape.triagVertices[np - 1];\r\n    for (const [i, vertex] of shape.triagVertices.entries()) {\r\n        const n = shape.triagVertices[(i + 1) % np];\r\n        from = deleteIntersectVertex(vertex, from, n, queues, true);\r\n    }\r\n    // Clear up leftover tribridge from last iteration\r\n    if (queues.triBridge.length > 0) queues.newConstraints.push([queues.triBridge.pop()!, shape.triagVertices[0]]);\r\n\r\n    for (const edge of queues.edges) cdt.removeConstrainedEdgeDelaunay(edge.first!, edge.second);\r\n    for (const vertex of queues.vertices) cdt.removeVertex(vertex);\r\n    for (const [from_, to] of queues.newConstraints) cdt.insertConstraintV(from_, to);\r\n    shape.removeTriagVertices(...queues.vertices);\r\n    console.timeEnd(\"DS\");\r\n}\r\n\r\nexport function addShapesToTriag(target: TriangulationTarget, ...shapes: Shape[]): void {\r\n    const cdt = PA_CDT[target];\r\n    for (const shape of shapes) {\r\n        for (const [i, pa] of shape.points.entries()) {\r\n            const pb = shape.points[(i + 1) % shape.points.length];\r\n            const { va, vb } = cdt.insertConstraint(pa, pb);\r\n            va.shapes.add(shape);\r\n            vb.shapes.add(shape);\r\n            shape.addTriagVertices(va, vb);\r\n        }\r\n    }\r\n}\r\n","import tinycolor from \"tinycolor2\";\r\n\r\nimport { uuidv4 } from \"@/core/utils\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { aurasFromServer, aurasToServer } from \"@/game/comm/conversion/aura\";\r\nimport { InitiativeData } from \"@/game/comm/types/general\";\r\nimport { ServerShape } from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint, LocalPoint, Vector } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { BoundingRect } from \"@/game/shapes/boundingrect\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { g2l, g2lr, g2lx, g2ly, g2lz } from \"@/game/units\";\r\nimport { TriangulationTarget } from \"../visibility/te/pa\";\r\nimport { Vertex } from \"../visibility/te/tds\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\n\r\nexport abstract class Shape {\r\n    // Used to create class instance from server shape data\r\n    abstract readonly type: string;\r\n    // The unique ID of this shape\r\n    readonly uuid: string;\r\n    // The layer the shape is currently on\r\n    layer!: string;\r\n\r\n    // A reference point regarding that specific shape's structure\r\n    protected _refPoint: GlobalPoint;\r\n\r\n    // Fill colour of the shape\r\n    fillColour: string = \"#000\";\r\n    strokeColour: string = \"rgba(0,0,0,0)\";\r\n    // The optional name associated with the shape\r\n    name = \"Unknown shape\";\r\n    nameVisible = true;\r\n\r\n    // Associated trackers/auras/owners\r\n    trackers: Tracker[] = [];\r\n    auras: Aura[] = [];\r\n    labels: Label[] = [];\r\n    protected _owners: string[] = [];\r\n    protected _triagVertices: Vertex[] = [];\r\n\r\n    // Block light sources\r\n    visionObstruction = false;\r\n    // Prevent shapes from overlapping with this shape\r\n    movementObstruction = false;\r\n    // Does this shape represent a playable token\r\n    isToken = false;\r\n    // Show a highlight box\r\n    showHighlight = false;\r\n\r\n    // Mouseover annotation\r\n    annotation: string = \"\";\r\n\r\n    // Draw modus to use\r\n    globalCompositeOperation: string = \"source-over\";\r\n\r\n    // Additional options for specialized uses\r\n    options: Map<string, any> = new Map();\r\n\r\n    constructor(refPoint: GlobalPoint, fillColour?: string, strokeColour?: string, uuid?: string) {\r\n        this._refPoint = refPoint;\r\n        this.uuid = uuid || uuidv4();\r\n        if (fillColour !== undefined) this.fillColour = fillColour;\r\n        if (strokeColour !== undefined) this.strokeColour = strokeColour;\r\n    }\r\n\r\n    get refPoint(): GlobalPoint {\r\n        return this._refPoint;\r\n    }\r\n    set refPoint(point: GlobalPoint) {\r\n        this._refPoint = point;\r\n    }\r\n\r\n    abstract getBoundingBox(): BoundingRect;\r\n\r\n    // If inWorldCoord is\r\n    abstract contains(point: GlobalPoint): boolean;\r\n\r\n    abstract center(): GlobalPoint;\r\n    abstract center(centerPoint: GlobalPoint): void;\r\n    visibleInCanvas(_canvas: HTMLCanvasElement): boolean {\r\n        // for (const aura of this.auras) {\r\n        //     if (aura.value > 0) {\r\n        //         const auraCircle = new Circle(this.center(), aura.value);\r\n        //         if (auraCircle.visibleInCanvas(canvas)) return true;\r\n        //     }\r\n        // }\r\n        return false;\r\n    }\r\n\r\n    // Code to snap a shape to the grid\r\n    // This is shape dependent as the shape refPoints are shape specific in\r\n    abstract snapToGrid(): void;\r\n    abstract resizeToGrid(): void;\r\n    abstract resize(resizePoint: number, point: LocalPoint): void;\r\n\r\n    abstract get points(): number[][];\r\n\r\n    getPointIndex(p: GlobalPoint, delta = 0): number {\r\n        for (const [idx, point] of this.points.entries()) {\r\n            if (Math.abs(p.x - point[0]) <= delta && Math.abs(p.y - point[1]) <= delta) return idx;\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    getPointOrientation(i: number): Vector {\r\n        const prev = GlobalPoint.fromArray(this.points[(this.points.length + i - 1) % this.points.length]);\r\n        const point = GlobalPoint.fromArray(this.points[i]);\r\n        const next = GlobalPoint.fromArray(this.points[(i + 1) % this.points.length]);\r\n        const vec = next.subtract(prev);\r\n        const mid = prev.add(vec.multiply(0.5));\r\n        return point.subtract(mid).normalize();\r\n    }\r\n\r\n    invalidate(skipLightUpdate: boolean): void {\r\n        const l = layerManager.getLayer(this.layer);\r\n        if (l) l.invalidate(skipLightUpdate);\r\n    }\r\n\r\n    checkVisionSources(recalculate = true): boolean {\r\n        let alteredVision = false;\r\n        const self = this;\r\n        const obstructionIndex = visibilityStore.visionBlockers.indexOf(this.uuid);\r\n        if (this.visionObstruction && obstructionIndex === -1) {\r\n            visibilityStore.visionBlockers.push(this.uuid);\r\n            if (recalculate) {\r\n                visibilityStore.addToTriag({ target: TriangulationTarget.VISION, shape: this });\r\n                alteredVision = true;\r\n            }\r\n        } else if (!this.visionObstruction && obstructionIndex >= 0) {\r\n            visibilityStore.visionBlockers.splice(obstructionIndex, 1);\r\n            if (recalculate) {\r\n                visibilityStore.deleteFromTriag({\r\n                    target: TriangulationTarget.VISION,\r\n                    shape: this,\r\n                    standalone: true,\r\n                });\r\n                alteredVision = true;\r\n            }\r\n        }\r\n\r\n        // Check if the visionsource auras are in the gameManager\r\n        this.auras.forEach(au => {\r\n            const ls = gameStore.visionSources;\r\n            const i = ls.findIndex(o => o.aura === au.uuid);\r\n            if (au.visionSource && i === -1) {\r\n                ls.push({ shape: self.uuid, aura: au.uuid });\r\n            } else if (!au.visionSource && i >= 0) {\r\n                ls.splice(i, 1);\r\n            }\r\n        });\r\n        // Check if anything in the gameManager referencing this shape is in fact still a visionsource\r\n        for (let i = gameStore.visionSources.length - 1; i >= 0; i--) {\r\n            const ls = gameStore.visionSources[i];\r\n            if (ls.shape === self.uuid) {\r\n                if (!self.auras.some(a => a.uuid === ls.aura && a.visionSource)) gameStore.visionSources.splice(i, 1);\r\n            }\r\n        }\r\n        return alteredVision;\r\n    }\r\n\r\n    setMovementBlock(blocksMovement: boolean, recalculate = true): boolean {\r\n        this.movementObstruction = blocksMovement || false;\r\n        const obstructionIndex = gameStore.movementblockers.indexOf(this.uuid);\r\n        let alteredMovement = false;\r\n        if (this.movementObstruction && obstructionIndex === -1) {\r\n            gameStore.movementblockers.push(this.uuid);\r\n            if (recalculate) {\r\n                visibilityStore.addToTriag({ target: TriangulationTarget.MOVEMENT, shape: this });\r\n                alteredMovement = true;\r\n            }\r\n        } else if (!this.movementObstruction && obstructionIndex >= 0) {\r\n            gameStore.movementblockers.splice(obstructionIndex, 1);\r\n            if (recalculate) {\r\n                visibilityStore.deleteFromTriag({\r\n                    target: TriangulationTarget.MOVEMENT,\r\n                    shape: this,\r\n                    standalone: true,\r\n                });\r\n                alteredMovement = true;\r\n            }\r\n        }\r\n        return alteredMovement;\r\n    }\r\n\r\n    setIsToken(isToken: boolean): void {\r\n        this.isToken = isToken;\r\n        if (this.ownedBy()) {\r\n            const i = gameStore.ownedtokens.indexOf(this.uuid);\r\n            if (this.isToken && i === -1) gameStore.ownedtokens.push(this.uuid);\r\n            else if (!this.isToken && i >= 0) gameStore.ownedtokens.splice(i, 1);\r\n        }\r\n    }\r\n\r\n    abstract asDict(): ServerShape;\r\n    getBaseDict(): ServerShape {\r\n        return {\r\n            type_: this.type,\r\n            uuid: this.uuid,\r\n            x: this.refPoint.x,\r\n            y: this.refPoint.y,\r\n            layer: this.layer,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            draw_operator: this.globalCompositeOperation,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            movement_obstruction: this.movementObstruction,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            vision_obstruction: this.visionObstruction,\r\n            auras: aurasToServer(this.auras),\r\n            trackers: this.trackers,\r\n            labels: this.labels,\r\n            owners: this._owners,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            fill_colour: this.fillColour,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            stroke_colour: this.strokeColour,\r\n            name: this.name,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            name_visible: this.nameVisible,\r\n            annotation: this.annotation,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            is_token: this.isToken,\r\n            options: JSON.stringify([...this.options]),\r\n        };\r\n    }\r\n    fromDict(data: ServerShape): void {\r\n        this.layer = data.layer;\r\n        this.globalCompositeOperation = data.draw_operator;\r\n        this.movementObstruction = data.movement_obstruction;\r\n        this.visionObstruction = data.vision_obstruction;\r\n        this.auras = aurasFromServer(data.auras);\r\n        this.trackers = data.trackers;\r\n        this.labels = data.labels;\r\n        this._owners = data.owners;\r\n        this.isToken = data.is_token;\r\n        this.nameVisible = data.name_visible;\r\n        if (data.annotation) this.annotation = data.annotation;\r\n        if (data.name) this.name = data.name;\r\n        if (data.options) this.options = new Map(JSON.parse(data.options));\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        if (this.globalCompositeOperation !== undefined) ctx.globalCompositeOperation = this.globalCompositeOperation;\r\n        else ctx.globalCompositeOperation = \"source-over\";\r\n        if (this.showHighlight) {\r\n            const bbox = this.getBoundingBox();\r\n            ctx.strokeStyle = \"red\";\r\n            ctx.strokeRect(g2lx(bbox.topLeft.x) - 5, g2ly(bbox.topLeft.y) - 5, g2lz(bbox.w) + 10, g2lz(bbox.h) + 10);\r\n        }\r\n    }\r\n\r\n    drawAuras(ctx: CanvasRenderingContext2D): void {\r\n        for (const aura of this.auras) {\r\n            if (aura.value === 0 && aura.dim === 0) return;\r\n            ctx.beginPath();\r\n\r\n            const loc = g2l(this.center());\r\n            const innerRange = g2lr(aura.value + aura.dim);\r\n\r\n            if (aura.dim === 0) ctx.fillStyle = aura.colour;\r\n            else {\r\n                const gradient = ctx.createRadialGradient(\r\n                    loc.x,\r\n                    loc.y,\r\n                    g2lr(aura.value),\r\n                    loc.x,\r\n                    loc.y,\r\n                    g2lr(aura.value + aura.dim),\r\n                );\r\n                const tc = tinycolor(aura.colour);\r\n                ctx.fillStyle = gradient;\r\n                gradient.addColorStop(0, aura.colour);\r\n                gradient.addColorStop(1, tc.setAlpha(0).toRgbString());\r\n            }\r\n            if (!aura.visionSource || aura.lastPath === undefined) {\r\n                ctx.arc(loc.x, loc.y, innerRange, 0, 2 * Math.PI);\r\n                ctx.fill();\r\n            } else {\r\n                try {\r\n                    ctx.fill(aura.lastPath);\r\n                } catch (e) {\r\n                    ctx.arc(loc.x, loc.y, innerRange, 0, 2 * Math.PI);\r\n                    ctx.fill();\r\n                    console.warn(e);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    getInitiativeRepr(): InitiativeData {\r\n        return {\r\n            uuid: this.uuid,\r\n            visible: !gameStore.IS_DM,\r\n            group: false,\r\n            source: this.name,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            has_img: false,\r\n            effects: [],\r\n            index: Infinity,\r\n        };\r\n    }\r\n\r\n    moveLayer(layer: string, sync: boolean): void {\r\n        const oldLayer = layerManager.getLayer(this.layer);\r\n        const newLayer = layerManager.getLayer(layer);\r\n        if (oldLayer === undefined || newLayer === undefined) return;\r\n        this.layer = layer;\r\n        // Update layer shapes\r\n        oldLayer.shapes.splice(oldLayer.shapes.indexOf(this), 1);\r\n        newLayer.shapes.push(this);\r\n        // Revalidate layers  (light should at most be redone once)\r\n        oldLayer.invalidate(true);\r\n        newLayer.invalidate(false);\r\n        // Sync!\r\n        if (sync) socket.emit(\"Shape.Layer.Change\", { uuid: this.uuid, layer });\r\n    }\r\n\r\n    // This screws up vetur if typed as `readonly string[]`\r\n    // eslint-disable-next-line @typescript-eslint/array-type\r\n    get owners(): ReadonlyArray<string> {\r\n        return Object.freeze(this._owners.slice());\r\n    }\r\n\r\n    ownedBy(username?: string): boolean {\r\n        if (username === undefined) username = gameStore.username;\r\n        return (\r\n            gameStore.IS_DM ||\r\n            this._owners.includes(username) ||\r\n            (gameStore.FAKE_PLAYER && gameStore.activeTokens.includes(this.uuid))\r\n        );\r\n    }\r\n\r\n    addOwner(owner: string): void {\r\n        if (!this._owners.includes(owner)) this._owners.push(owner);\r\n    }\r\n\r\n    updateOwner(oldValue: string, newValue: string): void {\r\n        const ownerIndex = this._owners.findIndex(o => o === oldValue);\r\n        if (ownerIndex >= 0) this._owners.splice(ownerIndex, 1, newValue);\r\n        else this.addOwner(newValue);\r\n    }\r\n\r\n    removeOwner(owner: string): void {\r\n        const ownerIndex = this._owners.findIndex(o => o === owner);\r\n        this._owners.splice(ownerIndex, 1);\r\n    }\r\n\r\n    addTriagVertices(...vertices: Vertex[]): void {\r\n        for (const vertex of vertices) {\r\n            if (this._triagVertices.includes(vertex)) continue;\r\n            this._triagVertices.push(vertex);\r\n        }\r\n    }\r\n\r\n    removeTriagVertices(...vertices: Vertex[]): void {\r\n        this._triagVertices = this._triagVertices.filter(v => !vertices.includes(v));\r\n    }\r\n\r\n    get triagVertices(): Vertex[] {\r\n        return [...this._triagVertices];\r\n    }\r\n}\r\n","import { GlobalPoint, Ray, Vector } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { PA_CDT } from \"@/game/visibility/te/pa\";\r\nimport { Point, Sign, Triangle } from \"@/game/visibility/te/tds\";\r\nimport { ccw, cw, intersection, orientation } from \"@/game/visibility/te/triag\";\r\nimport { visibilityStore } from \"@/game/visibility/store\";\r\n\r\n// First go through each shape in the selection and see if the delta has to be truncated due to movement blockers\r\n\r\n// This is definitely super convoluted and inefficient but I was tired and really wanted the smooth wall sliding collision stuff to work\r\n// And it does now, so hey \\_()_/\r\nexport function calculateDelta(delta: Vector, sel: Shape, done?: string[]): Vector {\r\n    if (delta.x === 0 && delta.y === 0) return delta;\r\n    if (visibilityStore.visionMode === \"bvh\") {\r\n        if (done === undefined) done = [];\r\n        const ogSelBBox = sel.getBoundingBox();\r\n        const newSelBBox = ogSelBBox.offset(delta);\r\n        let refine = false;\r\n        for (const movementBlocker of gameStore.movementblockers) {\r\n            if (done.includes(movementBlocker)) continue;\r\n            const blocker = layerManager.UUIDMap.get(movementBlocker)!;\r\n            const blockerBBox = blocker.getBoundingBox();\r\n            let found = blockerBBox.intersectsWithInner(newSelBBox);\r\n            if (!found) {\r\n                // This is an edge case, precalculating the rays is not worth in this case.\r\n                const ray = Ray.fromPoints(ogSelBBox.topLeft.add(delta.normalize()), newSelBBox.topLeft);\r\n                const invDir = ray.direction.inverse();\r\n                const dirIsNegative = [invDir.x < 0, invDir.y < 0];\r\n                found = blockerBBox.intersectP(ray, invDir, dirIsNegative).hit;\r\n            }\r\n            // Check if the bounding box of our destination would intersect with the bounding box of the movementblocker\r\n            if (found) {\r\n                const bCenter = blockerBBox.center();\r\n                const sCenter = ogSelBBox.center();\r\n\r\n                const d = sCenter.subtract(bCenter);\r\n                const ux = new Vector(1, 0);\r\n                const uy = new Vector(0, 1);\r\n                let dx = d.dot(ux);\r\n                let dy = d.dot(uy);\r\n                if (dx > blockerBBox.w / 2) dx = blockerBBox.w / 2;\r\n                if (dx < -blockerBBox.w / 2) dx = -blockerBBox.w / 2;\r\n                if (dy > blockerBBox.h / 2) dy = blockerBBox.h / 2;\r\n                if (dy < -blockerBBox.h / 2) dy = -blockerBBox.h / 2;\r\n\r\n                // Closest point / intersection point between the two bboxes.  Not the delta intersect!\r\n                const p = bCenter.add(ux.multiply(dx)).add(uy.multiply(dy));\r\n\r\n                if (p.x === ogSelBBox.topLeft.x || p.x === ogSelBBox.topRight.x) delta = new Vector(0, delta.y);\r\n                else if (p.y === ogSelBBox.topLeft.y || p.y === ogSelBBox.botLeft.y) delta = new Vector(delta.x, 0);\r\n                else {\r\n                    if (p.x < ogSelBBox.topLeft.x) delta = new Vector(p.x - ogSelBBox.topLeft.x, delta.y);\r\n                    else if (p.x > ogSelBBox.topRight.x) delta = new Vector(p.x - ogSelBBox.topRight.x, delta.y);\r\n                    else if (p.y < ogSelBBox.topLeft.y) delta = new Vector(delta.x, p.y - ogSelBBox.topLeft.y);\r\n                    else if (p.y > ogSelBBox.botLeft.y) delta = new Vector(delta.x, p.y - ogSelBBox.botLeft.y);\r\n                }\r\n                refine = true;\r\n                done.push(movementBlocker);\r\n                break;\r\n            }\r\n        }\r\n        if (refine) delta = calculateDelta(delta, sel, done);\r\n        return delta;\r\n    } else {\r\n        const centerTriangle = PA_CDT.movement.locate(sel.center().asArray(), null).loc;\r\n        for (const point of sel.points) {\r\n            const lt = PA_CDT.movement.locate(point, centerTriangle);\r\n            const triangle = lt.loc;\r\n            if (triangle === null) continue;\r\n            delta = checkTriangle(point, triangle, delta);\r\n        }\r\n        return delta;\r\n    }\r\n}\r\n\r\nfunction checkTriangle(point: Point, triangle: Triangle, delta: Vector, skip: Triangle[] = []): Vector {\r\n    const p = new GlobalPoint(point[0], point[1]);\r\n    const endpoint = p.add(delta).asArray();\r\n    if (triangle.contains(endpoint)) return delta;\r\n    skip.push(triangle);\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n        if (skip.includes(triangle.neighbours[i]!)) continue;\r\n\r\n        const _cw = triangle.vertices[cw(i)]!.point!;\r\n        const _ccw = triangle.vertices[ccw(i)]!.point!;\r\n        const ix = intersection(point, endpoint, _cw, _ccw);\r\n\r\n        if (ix === null) continue;\r\n\r\n        if (!triangle.isConstrained(i)) return checkTriangle(point, triangle.neighbours[i]!, delta, skip);\r\n\r\n        if (ix[0] === p.x && ix[1] === p.y) {\r\n            const o = orientation(point, endpoint, _ccw);\r\n            // Remember: canvas y axis is inverted\r\n            if (o === Sign.LEFT_TURN) continue;\r\n            if (o === Sign.ZERO) continue;\r\n        }\r\n        let newDelta = new GlobalPoint(ix[0], ix[1]).subtract(p).multiply(0.8);\r\n        if (newDelta.length() < 1) newDelta = new Vector(0, 0);\r\n        if (newDelta.length() < delta.length()) delta = newDelta;\r\n    }\r\n    return delta;\r\n}\r\n","import { GlobalPoint, LocalPoint, Vector } from \"@/game/geom\";\r\nimport { BoundingRect } from \"@/game/shapes/boundingrect\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { calculateDelta } from \"@/game/ui/tools/utils\";\r\nimport { g2lx, g2ly, l2g, l2gx, l2gy } from \"@/game/units\";\r\nimport { ServerShape } from \"../comm/types/shapes\";\r\n\r\nexport abstract class BaseRect extends Shape {\r\n    w: number;\r\n    h: number;\r\n    constructor(topleft: GlobalPoint, w: number, h: number, fillColour?: string, strokeColour?: string, uuid?: string) {\r\n        super(topleft, fillColour, strokeColour, uuid);\r\n        this.w = w;\r\n        this.h = h;\r\n    }\r\n    getBaseDict(): ServerShape & { width: number; height: number } {\r\n        return Object.assign(super.getBaseDict(), {\r\n            width: this.w,\r\n            height: this.h,\r\n        });\r\n    }\r\n    getBoundingBox(): BoundingRect {\r\n        return new BoundingRect(this.refPoint, this.w, this.h);\r\n    }\r\n\r\n    get points(): number[][] {\r\n        if (this.w === 0 || this.h === 0) return [[this.refPoint.x, this.refPoint.y]];\r\n        // note to self: topright and botleft are swapped because I'm retarded.\r\n        const topright = this.refPoint.add(new Vector(0, this.h));\r\n        const botright = this.refPoint.add(new Vector(this.w, this.h));\r\n        const botleft = this.refPoint.add(new Vector(this.w, 0));\r\n        return [\r\n            [this.refPoint.x, this.refPoint.y],\r\n            [topright.x, topright.y],\r\n            [botright.x, botright.y],\r\n            [botleft.x, botleft.y],\r\n        ];\r\n    }\r\n\r\n    contains(point: GlobalPoint): boolean {\r\n        return (\r\n            this.refPoint.x <= point.x &&\r\n            this.refPoint.x + this.w >= point.x &&\r\n            this.refPoint.y <= point.y &&\r\n            this.refPoint.y + this.h >= point.y\r\n        );\r\n    }\r\n    center(): GlobalPoint;\r\n    center(centerPoint: GlobalPoint): void;\r\n    center(centerPoint?: GlobalPoint): GlobalPoint | void {\r\n        if (centerPoint === undefined) return this.refPoint.add(new Vector(this.w / 2, this.h / 2));\r\n        this.refPoint = new GlobalPoint(centerPoint.x - this.w / 2, centerPoint.y - this.h / 2);\r\n    }\r\n\r\n    visibleInCanvas(canvas: HTMLCanvasElement): boolean {\r\n        if (super.visibleInCanvas(canvas)) return true;\r\n        const coreVisible = !(\r\n            g2lx(this.refPoint.x) > canvas.width ||\r\n            g2ly(this.refPoint.y) > canvas.height ||\r\n            g2lx(this.refPoint.x + this.w) < 0 ||\r\n            g2ly(this.refPoint.y + this.h) < 0\r\n        );\r\n        if (coreVisible) return true;\r\n        return false;\r\n    }\r\n    snapToGrid(): void {\r\n        const gs = gameStore.gridSize;\r\n        const center = this.center();\r\n        const mx = center.x;\r\n        const my = center.y;\r\n\r\n        let targetX;\r\n        let targetY;\r\n\r\n        if ((this.w / gs) % 2 === 0) {\r\n            targetX = Math.round(mx / gs) * gs - this.w / 2;\r\n        } else {\r\n            targetX = (Math.round((mx + gs / 2) / gs) - 1 / 2) * gs - this.w / 2;\r\n        }\r\n        if ((this.h / gs) % 2 === 0) {\r\n            targetY = Math.round(my / gs) * gs - this.h / 2;\r\n        } else {\r\n            targetY = (Math.round((my + gs / 2) / gs) - 1 / 2) * gs - this.h / 2;\r\n        }\r\n\r\n        const delta = calculateDelta(new Vector(targetX - this.refPoint.x, targetY - this.refPoint.y), this);\r\n        this.refPoint = this.refPoint.add(delta);\r\n\r\n        this.invalidate(false);\r\n    }\r\n    resizeToGrid(): void {\r\n        const gs = gameStore.gridSize;\r\n        this.refPoint = new GlobalPoint(Math.round(this.refPoint.x / gs) * gs, Math.round(this.refPoint.y / gs) * gs);\r\n        this.w = Math.max(Math.round(this.w / gs) * gs, gs);\r\n        this.h = Math.max(Math.round(this.h / gs) * gs, gs);\r\n        this.invalidate(false);\r\n    }\r\n    resize(resizePoint: number, point: LocalPoint): void {\r\n        const z = gameStore.zoomFactor;\r\n        switch (resizePoint) {\r\n            case 0: {\r\n                this.w = g2lx(this.refPoint.x) + this.w * z - point.x;\r\n                this.h = g2ly(this.refPoint.y) + this.h * z - point.y;\r\n                this.refPoint = l2g(point);\r\n                break;\r\n            }\r\n            case 1: {\r\n                this.w = g2lx(this.refPoint.x) + this.w * z - point.x;\r\n                this.h = point.y - g2ly(this.refPoint.y);\r\n                this.refPoint = new GlobalPoint(l2gx(point.x), this.refPoint.y);\r\n                break;\r\n            }\r\n            case 2: {\r\n                this.w = point.x - g2lx(this.refPoint.x);\r\n                this.h = point.y - g2ly(this.refPoint.y);\r\n                break;\r\n            }\r\n            case 3: {\r\n                this.w = point.x - g2lx(this.refPoint.x);\r\n                this.h = g2ly(this.refPoint.y) + this.h * z - point.y;\r\n                this.refPoint = new GlobalPoint(this.refPoint.x, l2gy(point.y));\r\n                break;\r\n            }\r\n        }\r\n\r\n        this.w /= z;\r\n        this.h /= z;\r\n\r\n        if (this.w < 0) {\r\n            this.refPoint = this.refPoint.add(new Vector(this.w, 0));\r\n            this.w = Math.abs(this.w);\r\n        }\r\n        if (this.h < 0) {\r\n            this.refPoint = this.refPoint.add(new Vector(0, this.h));\r\n            this.h = Math.abs(this.h);\r\n        }\r\n    }\r\n}\r\n","import { InitiativeData } from \"@/game/comm/types/general\";\r\nimport { ServerAsset } from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { BaseRect } from \"@/game/shapes/baserect\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { g2lx, g2ly, g2lz } from \"@/game/units\";\r\n\r\nexport class Asset extends BaseRect {\r\n    type = \"assetrect\";\r\n    img: HTMLImageElement;\r\n    src: string = \"\";\r\n    constructor(img: HTMLImageElement, topleft: GlobalPoint, w: number, h: number, uuid?: string) {\r\n        super(topleft, w, h, undefined, undefined, uuid);\r\n        this.img = img;\r\n    }\r\n    asDict(): ServerAsset {\r\n        return Object.assign(this.getBaseDict(), {\r\n            src: this.src,\r\n        });\r\n    }\r\n    fromDict(data: ServerAsset): void {\r\n        super.fromDict(data);\r\n        this.src = data.src;\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        try {\r\n            ctx.drawImage(this.img, g2lx(this.refPoint.x), g2ly(this.refPoint.y), g2lz(this.w), g2lz(this.h));\r\n        } catch (error) {\r\n            console.warn(`Shape ${this.uuid} could not load the image ${this.src}`);\r\n        }\r\n    }\r\n    getInitiativeRepr(): InitiativeData {\r\n        return {\r\n            uuid: this.uuid,\r\n            visible: !gameStore.IS_DM,\r\n            group: false,\r\n            source: this.src,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            has_img: true,\r\n            effects: [],\r\n            index: Infinity,\r\n        };\r\n    }\r\n}\r\n","import { ServerCircle } from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint, LocalPoint, Vector } from \"@/game/geom\";\r\nimport { BoundingRect } from \"@/game/shapes/boundingrect\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { calculateDelta } from \"@/game/ui/tools/utils\";\r\nimport { g2l, g2lz, l2g } from \"@/game/units\";\r\nimport { getFogColour } from \"../utils\";\r\n\r\nexport class Circle extends Shape {\r\n    type = \"circle\";\r\n    r: number;\r\n    constructor(center: GlobalPoint, r: number, fillColour?: string, strokeColour?: string, uuid?: string) {\r\n        super(center, fillColour, strokeColour, uuid);\r\n        this.r = r || 1;\r\n    }\r\n    asDict(): ServerCircle {\r\n        // const base = <ServerCircle>this.getBaseDict();\r\n        // base.r = this.r;\r\n        // base.border = this.border;\r\n        // return base;\r\n        return Object.assign(this.getBaseDict(), {\r\n            radius: this.r,\r\n        });\r\n    }\r\n    fromDict(data: ServerCircle): void {\r\n        super.fromDict(data);\r\n        this.r = data.radius;\r\n    }\r\n    getBoundingBox(): BoundingRect {\r\n        return new BoundingRect(\r\n            new GlobalPoint(this.refPoint.x - this.r, this.refPoint.y - this.r),\r\n            this.r * 2,\r\n            this.r * 2,\r\n        );\r\n    }\r\n\r\n    get points(): number[][] {\r\n        return this.getBoundingBox().points;\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        ctx.beginPath();\r\n        if (this.fillColour === \"fog\") ctx.fillStyle = getFogColour();\r\n        else ctx.fillStyle = this.fillColour;\r\n        const loc = g2l(this.refPoint);\r\n        ctx.arc(loc.x, loc.y, g2lz(this.r), 0, 2 * Math.PI);\r\n        ctx.fill();\r\n        if (this.strokeColour !== \"rgba(0, 0, 0, 0)\") {\r\n            ctx.beginPath();\r\n            ctx.lineWidth = g2lz(5);\r\n            ctx.strokeStyle = this.strokeColour;\r\n            ctx.arc(loc.x, loc.y, g2lz(this.r), 0, 2 * Math.PI);\r\n            ctx.stroke();\r\n        }\r\n    }\r\n    contains(point: GlobalPoint): boolean {\r\n        return (point.x - this.refPoint.x) ** 2 + (point.y - this.refPoint.y) ** 2 < this.r ** 2;\r\n    }\r\n    center(): GlobalPoint;\r\n    center(centerPoint: GlobalPoint): void;\r\n    center(centerPoint?: GlobalPoint): GlobalPoint | void {\r\n        if (centerPoint === undefined) return this.refPoint;\r\n        this.refPoint = centerPoint;\r\n    }\r\n    visibleInCanvas(canvas: HTMLCanvasElement): boolean {\r\n        return this.getBoundingBox().visibleInCanvas(canvas);\r\n    } // TODO\r\n    snapToGrid(): void {\r\n        const gs = gameStore.gridSize;\r\n        let targetX;\r\n        let targetY;\r\n        if (((2 * this.r) / gs) % 2 === 0) {\r\n            targetX = Math.round(this.refPoint.x / gs) * gs;\r\n        } else {\r\n            targetX = Math.round((this.refPoint.x - gs / 2) / gs) * gs + this.r;\r\n        }\r\n        if (((2 * this.r) / gs) % 2 === 0) {\r\n            targetY = Math.round(this.refPoint.y / gs) * gs;\r\n        } else {\r\n            targetY = Math.round((this.refPoint.y - gs / 2) / gs) * gs + this.r;\r\n        }\r\n        const delta = calculateDelta(new Vector(targetX - this.refPoint.x, targetY - this.refPoint.y), this);\r\n        this.refPoint = this.refPoint.add(delta);\r\n        this.invalidate(false);\r\n    }\r\n    resizeToGrid(): void {\r\n        const gs = gameStore.gridSize;\r\n        this.r = Math.max(Math.round(this.r / gs) * gs, gs / 2);\r\n        this.invalidate(false);\r\n    }\r\n    resize(resizePoint: number, point: LocalPoint): void {\r\n        const diff = l2g(point).subtract(this.refPoint);\r\n        this.r = Math.sqrt(Math.pow(diff.length(), 2) / 2);\r\n    }\r\n}\r\n","import * as tinycolor from \"tinycolor2\";\r\n\r\nimport { calcFontScale } from \"@/core/utils\";\r\nimport { InitiativeData } from \"@/game/comm/types/general\";\r\nimport { ServerCircularToken } from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { Circle } from \"@/game/shapes/circle\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { g2l, g2lz } from \"@/game/units\";\r\n\r\nexport class CircularToken extends Circle {\r\n    type = \"circulartoken\";\r\n    text: string;\r\n    font: string;\r\n    constructor(\r\n        center: GlobalPoint,\r\n        r: number,\r\n        text: string,\r\n        font: string,\r\n        fillColour?: string,\r\n        strokeColour?: string,\r\n        uuid?: string,\r\n    ) {\r\n        super(center, r, fillColour, strokeColour, uuid);\r\n        this.text = text;\r\n        this.font = font;\r\n    }\r\n    asDict(): ServerCircularToken {\r\n        return Object.assign(this.getBaseDict(), {\r\n            radius: this.r,\r\n            text: this.text,\r\n            font: this.font,\r\n        });\r\n    }\r\n    fromDict(data: ServerCircularToken): void {\r\n        super.fromDict(data);\r\n        this.r = data.radius;\r\n        this.text = data.text;\r\n        this.font = data.font;\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        ctx.font = this.font;\r\n        ctx.save();\r\n        const dest = g2l(this.center());\r\n        ctx.textAlign = \"center\";\r\n        ctx.textBaseline = \"middle\";\r\n        const xs = calcFontScale(ctx, this.text, g2lz(this.r), g2lz(this.r));\r\n        const ys = 0;\r\n        ctx.transform(xs, ys, -ys, xs, dest.x, dest.y);\r\n        ctx.fillStyle = tinycolor.mostReadable(this.fillColour, [\"#000\", \"#fff\"]).toHexString();\r\n        ctx.fillText(this.text, 0, 0);\r\n        ctx.restore();\r\n    }\r\n    getInitiativeRepr(): InitiativeData {\r\n        return {\r\n            uuid: this.uuid,\r\n            visible: !gameStore.IS_DM,\r\n            group: false,\r\n            source: this.name === \"\" || this.name === \"Unknown shape\" ? this.text : this.name,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            has_img: false,\r\n            effects: [],\r\n            index: Infinity,\r\n        };\r\n    }\r\n}\r\n","import { GlobalPoint, LocalPoint } from \"@/game/geom\";\r\nimport { BoundingRect } from \"@/game/shapes/boundingrect\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { g2lx, g2ly, l2g } from \"@/game/units\";\r\nimport { ServerLine } from \"../comm/types/shapes\";\r\n\r\nexport class Line extends Shape {\r\n    type = \"line\";\r\n    endPoint: GlobalPoint;\r\n    lineWidth: number;\r\n    constructor(\r\n        startPoint: GlobalPoint,\r\n        endPoint: GlobalPoint,\r\n        lineWidth?: number,\r\n        strokeColour?: string,\r\n        uuid?: string,\r\n    ) {\r\n        super(startPoint, \"rgba(0, 0, 0, 0)\", strokeColour || \"#000\", uuid);\r\n        this.endPoint = endPoint;\r\n        this.lineWidth = lineWidth === undefined ? 1 : lineWidth;\r\n    }\r\n    asDict(): ServerLine {\r\n        return Object.assign(this.getBaseDict(), {\r\n            x2: this.endPoint.x,\r\n            y2: this.endPoint.y,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            line_width: this.lineWidth,\r\n        });\r\n    }\r\n    get points(): number[][] {\r\n        return [[this.refPoint.x, this.refPoint.y], [this.endPoint.x, this.endPoint.y]];\r\n    }\r\n    getBoundingBox(): BoundingRect {\r\n        return new BoundingRect(\r\n            new GlobalPoint(Math.min(this.refPoint.x, this.endPoint.x), Math.min(this.refPoint.y, this.endPoint.y)),\r\n            Math.abs(this.refPoint.x - this.endPoint.x),\r\n            Math.abs(this.refPoint.y - this.endPoint.y),\r\n        );\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        ctx.strokeStyle = this.strokeColour;\r\n        ctx.beginPath();\r\n        ctx.moveTo(g2lx(this.refPoint.x), g2ly(this.refPoint.y));\r\n        ctx.lineTo(g2lx(this.endPoint.x), g2ly(this.endPoint.y));\r\n        ctx.lineWidth = this.lineWidth;\r\n        ctx.stroke();\r\n    }\r\n    contains(_point: GlobalPoint): boolean {\r\n        return false; // TODO\r\n    }\r\n\r\n    center(): GlobalPoint;\r\n    center(centerPoint: GlobalPoint): void;\r\n    center(_centerPoint?: GlobalPoint): GlobalPoint | void {} // TODO\r\n    visibleInCanvas(canvas: HTMLCanvasElement): boolean {\r\n        return this.getBoundingBox().visibleInCanvas(canvas);\r\n    } // TODO\r\n    snapToGrid(): void {}\r\n    resizeToGrid(): void {}\r\n    resize(resizePoint: number, point: LocalPoint): void {\r\n        if (resizePoint === 0) this.refPoint = l2g(point);\r\n        else this.endPoint = l2g(point);\r\n    }\r\n}\r\n","import { GlobalPoint, LocalPoint } from \"@/game/geom\";\r\nimport { BoundingRect } from \"@/game/shapes/boundingrect\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { g2lx, g2ly, g2lz, l2g } from \"@/game/units\";\r\nimport { ServerMultiLine } from \"../comm/types/shapes\";\r\nimport { getFogColour } from \"../utils\";\r\n\r\nexport class MultiLine extends Shape {\r\n    type = \"multiline\";\r\n    _points: GlobalPoint[] = [];\r\n    lineWidth: number;\r\n    constructor(\r\n        startPoint: GlobalPoint,\r\n        points?: GlobalPoint[],\r\n        lineWidth?: number,\r\n        strokeColour?: string,\r\n        uuid?: string,\r\n    ) {\r\n        super(startPoint, \"rgba(0, 0, 0, 0)\", strokeColour || \"#000\", uuid);\r\n        this._points = points || [];\r\n        this.lineWidth = lineWidth || 3;\r\n    }\r\n\r\n    get refPoint(): GlobalPoint {\r\n        return this._refPoint;\r\n    }\r\n    set refPoint(point: GlobalPoint) {\r\n        const delta = point.subtract(this._refPoint);\r\n        this._refPoint = point;\r\n        for (let i = 0; i < this._points.length; i++) this._points[i] = this._points[i].add(delta);\r\n    }\r\n\r\n    asDict(): ServerMultiLine {\r\n        return Object.assign(this.getBaseDict(), {\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            line_width: this.lineWidth,\r\n            points: this._points.map(p => ({ x: p.x, y: p.y })),\r\n        });\r\n    }\r\n    fromDict(data: ServerMultiLine): void {\r\n        super.fromDict(data);\r\n        this._points = data.points.map(p => new GlobalPoint(p.x, p.y));\r\n    }\r\n    get points(): number[][] {\r\n        return this._points.map(point => [point.x, point.y]);\r\n    }\r\n    getBoundingBox(): BoundingRect {\r\n        let minx: number = this.refPoint.x;\r\n        let maxx: number = this.refPoint.x;\r\n        let miny: number = this.refPoint.y;\r\n        let maxy: number = this.refPoint.y;\r\n        for (const p of this._points) {\r\n            if (p.x < minx) minx = p.x;\r\n            if (p.x > maxx) maxx = p.x;\r\n            if (p.y < miny) miny = p.y;\r\n            if (p.y > maxy) maxy = p.y;\r\n        }\r\n        return new BoundingRect(new GlobalPoint(minx, miny), maxx - minx, maxy - miny);\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        ctx.beginPath();\r\n        ctx.lineCap = \"round\";\r\n        ctx.lineJoin = \"round\";\r\n        ctx.moveTo(g2lx(this.refPoint.x), g2ly(this.refPoint.y));\r\n        for (const p of this._points) ctx.lineTo(g2lx(p.x), g2ly(p.y));\r\n        if (this.strokeColour === \"fog\") ctx.strokeStyle = getFogColour();\r\n        else ctx.strokeStyle = this.strokeColour;\r\n        ctx.lineWidth = g2lz(this.lineWidth);\r\n        ctx.stroke();\r\n    }\r\n    contains(point: GlobalPoint): boolean {\r\n        return this.getBoundingBox().contains(point);\r\n    }\r\n\r\n    center(): GlobalPoint;\r\n    center(centerPoint: GlobalPoint): void;\r\n    center(_centerPoint?: GlobalPoint): GlobalPoint | void {\r\n        return this.getBoundingBox().center();\r\n    }\r\n    visibleInCanvas(canvas: HTMLCanvasElement): boolean {\r\n        return this.getBoundingBox().visibleInCanvas(canvas);\r\n    } // TODO\r\n    snapToGrid(): void {}\r\n    resizeToGrid(): void {}\r\n    resize(resizePoint: number, point: LocalPoint): void {\r\n        if (resizePoint === 0) this._refPoint = l2g(point);\r\n        else this._points[resizePoint - 1] = l2g(point);\r\n    }\r\n}\r\n","import { GlobalPoint } from \"@/game/geom\";\r\nimport { BaseRect } from \"@/game/shapes/baserect\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { g2l } from \"@/game/units\";\r\nimport { ServerShape } from \"../comm/types/shapes\";\r\nimport { getFogColour } from \"../utils\";\r\n\r\nexport class Rect extends BaseRect {\r\n    type = \"rect\";\r\n    constructor(topleft: GlobalPoint, w: number, h: number, fillColour?: string, strokeColour?: string, uuid?: string) {\r\n        super(topleft, w, h, fillColour, strokeColour, uuid);\r\n    }\r\n    asDict(): ServerShape {\r\n        return super.getBaseDict();\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        if (this.fillColour === \"fog\") ctx.fillStyle = getFogColour();\r\n        else ctx.fillStyle = this.fillColour;\r\n        const z = gameStore.zoomFactor;\r\n        const loc = g2l(this.refPoint);\r\n        ctx.fillRect(loc.x, loc.y, this.w * z, this.h * z);\r\n        if (this.strokeColour !== \"rgba(0, 0, 0, 0)\") {\r\n            ctx.strokeStyle = this.strokeColour;\r\n            ctx.lineWidth = 5;\r\n            ctx.strokeRect(loc.x, loc.y, this.w * z, this.h * z);\r\n        }\r\n    }\r\n}\r\n","import { GlobalPoint, LocalPoint } from \"@/game/geom\";\r\nimport { BoundingRect } from \"@/game/shapes/boundingrect\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { g2l } from \"@/game/units\";\r\nimport { ServerText } from \"../comm/types/shapes\";\r\n\r\nexport class Text extends Shape {\r\n    type = \"text\";\r\n    text: string;\r\n    font: string;\r\n    angle: number;\r\n    constructor(\r\n        position: GlobalPoint,\r\n        text: string,\r\n        font: string,\r\n        angle?: number,\r\n        fillColour?: string,\r\n        strokeColour?: string,\r\n        uuid?: string,\r\n    ) {\r\n        super(position, fillColour, strokeColour, uuid);\r\n        this.text = text;\r\n        this.font = font;\r\n        this.angle = angle || 0;\r\n    }\r\n    asDict(): ServerText {\r\n        return Object.assign(this.getBaseDict(), {\r\n            text: this.text,\r\n            font: this.font,\r\n            angle: this.angle,\r\n        });\r\n    }\r\n    get points(): number[][] {\r\n        return [[this.refPoint.x, this.refPoint.y]];\r\n    }\r\n    getBoundingBox(): BoundingRect {\r\n        return new BoundingRect(this.refPoint, 5, 5); // TODO: fix this bounding box\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        ctx.font = this.font;\r\n        ctx.fillStyle = this.fillColour;\r\n        ctx.save();\r\n        const dest = g2l(this.refPoint);\r\n        ctx.translate(dest.x, dest.y);\r\n        ctx.rotate(this.angle);\r\n        ctx.textAlign = \"center\";\r\n        this.getLines(ctx).map(line => ctx.fillText(line.text, line.x, line.y));\r\n        ctx.restore();\r\n    }\r\n    contains(_point: GlobalPoint): boolean {\r\n        return false; // TODO\r\n    }\r\n\r\n    center(): GlobalPoint;\r\n    center(centerPoint: GlobalPoint): void;\r\n    center(_centerPoint?: GlobalPoint): GlobalPoint | void {} // TODO\r\n    visibleInCanvas(canvas: HTMLCanvasElement): boolean {\r\n        return this.getBoundingBox().visibleInCanvas(canvas);\r\n    } // TODO\r\n    snapToGrid(): void {}\r\n    resizeToGrid(): void {}\r\n    resize(_resizePoint: number, _point: LocalPoint): void {}\r\n\r\n    getMaxHeight(ctx: CanvasRenderingContext2D): number {\r\n        const lines = this.getLines(ctx);\r\n        const lineHeight = 30;\r\n        return lineHeight * lines.length;\r\n    }\r\n\r\n    getMaxWidth(ctx: CanvasRenderingContext2D): number {\r\n        const lines = this.getLines(ctx);\r\n        const widths = lines.map(line => ctx.measureText(line.text).width);\r\n        return Math.max(...widths);\r\n    }\r\n\r\n    private getLines(ctx: CanvasRenderingContext2D): { text: string; x: number; y: number }[] {\r\n        const lines = this.text.split(\"\\n\");\r\n        const allLines: { text: string; x: number; y: number }[] = [];\r\n        const maxWidth = ctx.canvas.width;\r\n        const lineHeight = 30;\r\n        const x = 0; // this.refPoint.x;\r\n        let y = 0; // this.refPoint.y;\r\n\r\n        for (const line of lines) {\r\n            let targetLine = \"\";\r\n            const words = line.split(\" \");\r\n            for (const word of words) {\r\n                const testLine = targetLine + word + \" \";\r\n                const metrics = ctx.measureText(testLine);\r\n                const testWidth = metrics.width;\r\n                if (testWidth > maxWidth) {\r\n                    ctx.fillText(targetLine, x, y);\r\n                    allLines.push({ text: targetLine, x, y });\r\n                    targetLine = word + \" \";\r\n                    y += lineHeight;\r\n                } else {\r\n                    targetLine = testLine;\r\n                }\r\n            }\r\n            allLines.push({ text: targetLine, x, y });\r\n            y += lineHeight;\r\n        }\r\n        return allLines;\r\n    }\r\n}\r\n","import { ServerPolygon } from \"../comm/types/shapes\";\r\nimport { GlobalPoint, LocalPoint } from \"../geom\";\r\nimport { g2lx, g2ly, g2lz, l2g } from \"../units\";\r\nimport { getFogColour } from \"../utils\";\r\nimport { BoundingRect } from \"./boundingrect\";\r\nimport { Shape } from \"./shape\";\r\n\r\nexport class Polygon extends Shape {\r\n    type = \"polygon\";\r\n    _vertices: GlobalPoint[] = [];\r\n\r\n    constructor(\r\n        startPoint: GlobalPoint,\r\n        vertices: GlobalPoint[] = [],\r\n        fillColour?: string,\r\n        strokeColour?: string,\r\n        uuid?: string,\r\n    ) {\r\n        super(startPoint, fillColour, strokeColour, uuid);\r\n        this._vertices = vertices;\r\n    }\r\n\r\n    get refPoint(): GlobalPoint {\r\n        return this._refPoint;\r\n    }\r\n    set refPoint(point: GlobalPoint) {\r\n        const delta = point.subtract(this._refPoint);\r\n        this._refPoint = point;\r\n        for (let i = 0; i < this._vertices.length; i++) this._vertices[i] = this._vertices[i].add(delta);\r\n    }\r\n\r\n    get vertices(): GlobalPoint[] {\r\n        return [this._refPoint, ...this._vertices];\r\n    }\r\n\r\n    asDict(): ServerPolygon {\r\n        return Object.assign(this.getBaseDict(), {\r\n            vertices: this._vertices.map(p => ({ x: p.x, y: p.y })),\r\n        });\r\n    }\r\n\r\n    fromDict(data: ServerPolygon): void {\r\n        super.fromDict(data);\r\n        this._vertices = data.vertices.map(v => new GlobalPoint(v.x, v.y));\r\n    }\r\n\r\n    get points(): number[][] {\r\n        return this.vertices.map(point => [point.x, point.y]);\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        ctx.lineCap = \"round\";\r\n        ctx.lineJoin = \"round\";\r\n\r\n        if (this.strokeColour === \"fog\") ctx.strokeStyle = getFogColour();\r\n        else if (this.vertices.length === 2) ctx.strokeStyle = this.fillColour;\r\n        else ctx.strokeStyle = this.strokeColour;\r\n        if (this.fillColour === \"fog\") ctx.fillStyle = getFogColour();\r\n        else ctx.fillStyle = this.fillColour;\r\n        ctx.lineWidth = g2lz(2);\r\n\r\n        ctx.beginPath();\r\n        ctx.moveTo(g2lx(this.vertices[0].x), g2ly(this.vertices[0].y));\r\n        for (let i = 1; i <= this.vertices.length; i++) {\r\n            const vertex = this.vertices[i % this.vertices.length];\r\n            ctx.lineTo(g2lx(vertex.x), g2ly(vertex.y));\r\n        }\r\n        ctx.fill();\r\n        ctx.stroke();\r\n    }\r\n\r\n    contains(point: GlobalPoint): boolean {\r\n        return this.getBoundingBox().contains(point);\r\n    }\r\n\r\n    center(): GlobalPoint;\r\n    center(centerPoint: GlobalPoint): void;\r\n    center(_centerPoint?: GlobalPoint): GlobalPoint | void {\r\n        return this.getBoundingBox().center();\r\n    }\r\n    visibleInCanvas(canvas: HTMLCanvasElement): boolean {\r\n        return this.getBoundingBox().visibleInCanvas(canvas);\r\n    } // TODO\r\n    snapToGrid(): void {}\r\n    resizeToGrid(): void {}\r\n    resize(resizePoint: number, point: LocalPoint): void {\r\n        if (resizePoint === 0) this._refPoint = l2g(point);\r\n        else this._vertices[resizePoint - 1] = l2g(point);\r\n    }\r\n    getBoundingBox(): BoundingRect {\r\n        let minx: number = this.refPoint.x;\r\n        let maxx: number = this.refPoint.x;\r\n        let miny: number = this.refPoint.y;\r\n        let maxy: number = this.refPoint.y;\r\n        for (const p of this._vertices) {\r\n            if (p.x < minx) minx = p.x;\r\n            if (p.x > maxx) maxx = p.x;\r\n            if (p.y < miny) miny = p.y;\r\n            if (p.y > maxy) maxy = p.y;\r\n        }\r\n        return new BoundingRect(new GlobalPoint(minx, miny), maxx - minx, maxy - miny);\r\n    }\r\n}\r\n","import {\r\n    ServerAsset,\r\n    ServerCircle,\r\n    ServerCircularToken,\r\n    ServerLine,\r\n    ServerMultiLine,\r\n    ServerPolygon,\r\n    ServerRect,\r\n    ServerShape,\r\n    ServerText,\r\n} from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Asset } from \"@/game/shapes/asset\";\r\nimport { Circle } from \"@/game/shapes/circle\";\r\nimport { CircularToken } from \"@/game/shapes/circulartoken\";\r\nimport { Line } from \"@/game/shapes/line\";\r\nimport { MultiLine } from \"@/game/shapes/multiline\";\r\nimport { Rect } from \"@/game/shapes/rect\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { Text } from \"@/game/shapes/text\";\r\nimport { Polygon } from \"./polygon\";\r\n\r\nexport function createShapeFromDict(shape: ServerShape): Shape | undefined {\r\n    let sh: Shape;\r\n\r\n    // A fromJSON and toJSON on Shape would be cleaner but ts does not allow for static abstracts so yeah.\r\n\r\n    // Shape Type specifics\r\n\r\n    const refPoint = new GlobalPoint(shape.x, shape.y);\r\n    if (shape.type_ === \"rect\") {\r\n        const rect = <ServerRect>shape;\r\n        sh = new Rect(refPoint, rect.width, rect.height, rect.fill_colour, rect.stroke_colour, rect.uuid);\r\n    } else if (shape.type_ === \"circle\") {\r\n        const circ = <ServerCircle>shape;\r\n        sh = new Circle(refPoint, circ.radius, circ.fill_colour, circ.stroke_colour, circ.uuid);\r\n    } else if (shape.type_ === \"circulartoken\") {\r\n        const token = <ServerCircularToken>shape;\r\n        sh = new CircularToken(\r\n            refPoint,\r\n            token.radius,\r\n            token.text,\r\n            token.font,\r\n            token.fill_colour,\r\n            token.stroke_colour,\r\n            token.uuid,\r\n        );\r\n    } else if (shape.type_ === \"line\") {\r\n        const line = <ServerLine>shape;\r\n        sh = new Line(refPoint, new GlobalPoint(line.x2, line.y2), line.line_width, line.stroke_colour, line.uuid);\r\n    } else if (shape.type_ === \"multiline\") {\r\n        const multiline = <ServerMultiLine>shape;\r\n        sh = new MultiLine(\r\n            refPoint,\r\n            multiline.points.map(p => new GlobalPoint(p.x, p.y)),\r\n            multiline.line_width,\r\n            multiline.stroke_colour,\r\n            multiline.uuid,\r\n        );\r\n    } else if (shape.type_ === \"polygon\") {\r\n        const polygon = <ServerPolygon>shape;\r\n        sh = new Polygon(\r\n            refPoint,\r\n            polygon.vertices.map(v => new GlobalPoint(v.x, v.y)),\r\n            polygon.fill_colour,\r\n            polygon.stroke_colour,\r\n            polygon.uuid,\r\n        );\r\n    } else if (shape.type_ === \"text\") {\r\n        const text = <ServerText>shape;\r\n        sh = new Text(refPoint, text.text, text.font, text.angle, text.fill_colour, text.stroke_colour, text.uuid);\r\n    } else if (shape.type_ === \"assetrect\") {\r\n        const asset = <ServerAsset>shape;\r\n        const img = new Image(asset.width, asset.height);\r\n        if (asset.src.startsWith(\"http\")) img.src = new URL(asset.src).pathname;\r\n        else img.src = asset.src;\r\n        sh = new Asset(img, refPoint, asset.width, asset.height, asset.uuid);\r\n        img.onload = () => {\r\n            layerManager.getLayer(shape.layer)!.invalidate(false);\r\n        };\r\n    } else {\r\n        return undefined;\r\n    }\r\n    sh.fromDict(shape);\r\n    return sh;\r\n}\r\n","import { socket } from \"@/game/api/socket\";\r\nimport { ServerShape } from \"@/game/comm/types/shapes\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { createShapeFromDict } from \"@/game/shapes/utils\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { g2lx, g2ly } from \"@/game/units\";\r\nimport { TriangulationTarget } from \"../visibility/te/pa\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\n\r\nexport class Layer {\r\n    name: string;\r\n    width: number;\r\n    height: number;\r\n    canvas: HTMLCanvasElement;\r\n    ctx: CanvasRenderingContext2D;\r\n\r\n    selectable: boolean = false;\r\n    playerEditable: boolean = false;\r\n    isVisionLayer: boolean = false;\r\n\r\n    // When set to false, the layer will be redrawn on the next tick\r\n    valid: boolean = false;\r\n    // The collection of shapes that this layer contains.\r\n    // These are ordered on a depth basis.\r\n    shapes: Shape[] = [];\r\n\r\n    // Collection of shapes that are currently selected\r\n    selection: Shape[] = [];\r\n\r\n    // Extra selection highlighting settings\r\n    selectionColor = \"#CC0000\";\r\n    selectionWidth = 2;\r\n\r\n    constructor(canvas: HTMLCanvasElement, name: string) {\r\n        this.canvas = canvas;\r\n        this.name = name;\r\n        this.width = canvas.width;\r\n        this.height = canvas.height;\r\n        this.ctx = canvas.getContext(\"2d\")!;\r\n    }\r\n\r\n    invalidate(skipLightUpdate: boolean): void {\r\n        this.valid = false;\r\n        if (!skipLightUpdate) {\r\n            layerManager.invalidateLight();\r\n        }\r\n    }\r\n\r\n    addShape(shape: Shape, sync: boolean, temporary?: boolean, invalidate = true): void {\r\n        if (temporary === undefined) temporary = false;\r\n        shape.layer = this.name;\r\n        this.shapes.push(shape);\r\n        layerManager.UUIDMap.set(shape.uuid, shape);\r\n        shape.checkVisionSources(invalidate);\r\n        shape.setMovementBlock(shape.movementObstruction, invalidate);\r\n        if (shape.ownedBy(gameStore.username) && shape.isToken) gameStore.ownedtokens.push(shape.uuid);\r\n        if (shape.annotation.length) gameStore.annotations.push(shape.uuid);\r\n        if (sync) socket.emit(\"Shape.Add\", { shape: shape.asDict(), temporary });\r\n        if (invalidate) this.invalidate(!sync);\r\n    }\r\n\r\n    setShapes(shapes: ServerShape[]): void {\r\n        for (const serverShape of shapes) {\r\n            const shape = createShapeFromDict(serverShape);\r\n            if (shape === undefined) {\r\n                console.log(`Shape with unknown type ${serverShape.type_} could not be added`);\r\n                return;\r\n            }\r\n            this.addShape(shape, false, false, false);\r\n        }\r\n        this.clearSelection(); // TODO: Fix keeping selection on those items that are not moved.\r\n        this.invalidate(false);\r\n    }\r\n\r\n    removeShape(shape: Shape, sync: boolean, temporary?: boolean): void {\r\n        if (temporary === undefined) temporary = false;\r\n        this.shapes.splice(this.shapes.indexOf(shape), 1);\r\n\r\n        if (sync) socket.emit(\"Shape.Remove\", { shape: shape.asDict(), temporary });\r\n        const lsI = gameStore.visionSources.findIndex(ls => ls.shape === shape.uuid);\r\n        const lbI = visibilityStore.visionBlockers.findIndex(ls => ls === shape.uuid);\r\n\r\n        const mbI = gameStore.movementblockers.findIndex(ls => ls === shape.uuid);\r\n        const anI = gameStore.annotations.findIndex(ls => ls === shape.uuid);\r\n        if (lsI >= 0) gameStore.visionSources.splice(lsI, 1);\r\n        if (lbI >= 0) visibilityStore.visionBlockers.splice(lbI, 1);\r\n        if (mbI >= 0) gameStore.movementblockers.splice(mbI, 1);\r\n        if (anI >= 0) gameStore.annotations.splice(anI, 1);\r\n\r\n        const annotationIndex = gameStore.annotations.indexOf(shape.uuid);\r\n        if (annotationIndex >= 0) gameStore.annotations.splice(annotationIndex, 1);\r\n\r\n        const ownedIndex = gameStore.ownedtokens.indexOf(shape.uuid);\r\n        if (ownedIndex >= 0) gameStore.ownedtokens.splice(ownedIndex, 1);\r\n\r\n        layerManager.UUIDMap.delete(shape.uuid);\r\n\r\n        const index = this.selection.indexOf(shape);\r\n        if (index >= 0) this.selection.splice(index, 1);\r\n        if (lbI >= 0)\r\n            visibilityStore.deleteFromTriag({\r\n                target: TriangulationTarget.VISION,\r\n                shape,\r\n                standalone: true,\r\n            });\r\n        if (mbI >= 0)\r\n            visibilityStore.deleteFromTriag({\r\n                target: TriangulationTarget.MOVEMENT,\r\n                shape,\r\n                standalone: true,\r\n            });\r\n\r\n        this.invalidate(!sync);\r\n    }\r\n\r\n    clear(): void {\r\n        this.ctx.clearRect(0, 0, this.width, this.height);\r\n    }\r\n\r\n    clearSelection(): void {\r\n        this.selection = [];\r\n        EventBus.$emit(\"SelectionInfo.Shape.Set\", null);\r\n    }\r\n\r\n    draw(doClear?: boolean): void {\r\n        if (!this.valid) {\r\n            const ctx = this.ctx;\r\n            const ogOP = ctx.globalCompositeOperation;\r\n            doClear = doClear === undefined ? true : doClear;\r\n\r\n            if (doClear) this.clear();\r\n\r\n            const state = this;\r\n\r\n            // We iteratre twice over all shapes\r\n            // First to draw the auras and a second time to draw the shapes themselves\r\n            // Otherwise auras from one shape could be overlapping another shape itself.\r\n\r\n            this.shapes.forEach(shape => {\r\n                if (shape.options.has(\"skipDraw\") && shape.options.get(\"skipDraw\")) return;\r\n                if (layerManager.getLayer() === undefined) return;\r\n                if (!shape.visibleInCanvas(state.canvas)) return;\r\n                if (state.name === \"fow\" && shape.visionObstruction && layerManager.getLayer()!.name !== state.name)\r\n                    return;\r\n                shape.drawAuras(ctx);\r\n            });\r\n            this.shapes.forEach(shape => {\r\n                if (shape.options.has(\"skipDraw\") && shape.options.get(\"skipDraw\")) return;\r\n                if (shape.labels.length === 0 && gameStore.filterNoLabel) return;\r\n                if (\r\n                    shape.labels.length &&\r\n                    gameStore.labelFilters.length &&\r\n                    !shape.labels.some(l => gameStore.labelFilters.includes(l.uuid))\r\n                )\r\n                    return;\r\n                if (layerManager.getLayer() === undefined) return;\r\n                if (!shape.visibleInCanvas(state.canvas)) return;\r\n                if (state.name === \"fow\" && shape.visionObstruction && layerManager.getLayer()!.name !== state.name)\r\n                    return;\r\n                shape.draw(ctx);\r\n            });\r\n\r\n            if (this.selection != null) {\r\n                ctx.fillStyle = this.selectionColor;\r\n                ctx.strokeStyle = this.selectionColor;\r\n                ctx.lineWidth = this.selectionWidth;\r\n                const z = gameStore.zoomFactor;\r\n                this.selection.forEach(sel => {\r\n                    ctx.globalCompositeOperation = sel.globalCompositeOperation;\r\n                    const bb = sel.getBoundingBox();\r\n                    // TODO: REFACTOR THIS TO Shape.drawSelection(ctx);\r\n                    ctx.strokeRect(g2lx(bb.topLeft.x), g2ly(bb.topLeft.y), bb.w * z, bb.h * z);\r\n\r\n                    for (const p of sel.points) {\r\n                        ctx.beginPath();\r\n                        ctx.arc(g2lx(p[0]), g2ly(p[1]), 3, 0, 2 * Math.PI);\r\n                        ctx.fill();\r\n                    }\r\n                    ctx.beginPath();\r\n                    ctx.moveTo(g2lx(sel.points[0][0]), g2ly(sel.points[0][1]));\r\n                    for (let i = 1; i <= sel.points.length; i++) {\r\n                        const vertex = sel.points[i % sel.points.length];\r\n                        ctx.lineTo(g2lx(vertex[0]), g2ly(vertex[1]));\r\n                    }\r\n                    ctx.stroke();\r\n                });\r\n            }\r\n            ctx.globalCompositeOperation = ogOP;\r\n            this.valid = true;\r\n        }\r\n    }\r\n\r\n    moveShapeOrder(shape: Shape, destinationIndex: number, sync: boolean): void {\r\n        const oldIdx = this.shapes.indexOf(shape);\r\n        if (oldIdx === destinationIndex) return;\r\n        this.shapes.splice(oldIdx, 1);\r\n        this.shapes.splice(destinationIndex, 0, shape);\r\n        if (sync) socket.emit(\"Shape.Order.Set\", { shape: shape.asDict(), index: destinationIndex });\r\n        this.invalidate(true);\r\n    }\r\n}\r\n","export class Settings {\r\n    static angleSteps = 4;\r\n    static drawAngleLines = false;\r\n    static drawFirstLightHit = false;\r\n    static skipPlayerFOW = false;\r\n    static skipLightFOW = false;\r\n\r\n    static tempFill: string = \"fog\";\r\n}\r\n","import { layerManager } from \"@/game/layers/manager\";\r\nimport { g2lx, g2ly } from \"@/game/units\";\r\nimport { EdgeIterator, TDS } from \"./tds\";\r\nimport { ccw, cw } from \"./triag\";\r\n\r\nexport function drawPoint(point: number[], r: number, colour?: string): void {\r\n    const dl = layerManager.getLayer(\"draw\");\r\n    if (dl === undefined) return;\r\n    const ctx = dl.ctx;\r\n    ctx.lineJoin = \"round\";\r\n    ctx.strokeStyle =\r\n        colour === undefined ? `rgb(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255})` : colour;\r\n    ctx.moveTo(g2lx(point[0]), g2ly(point[1]));\r\n    ctx.beginPath();\r\n    ctx.arc(g2lx(point[0]), g2ly(point[1]), r, 0, Math.PI * 2);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n}\r\n\r\nexport function drawPolygon(polygon: number[][], colour?: string): void {\r\n    const dl = layerManager.getLayer(\"draw\");\r\n    if (dl === undefined) return;\r\n    const ctx = dl.ctx;\r\n    ctx.lineJoin = \"round\";\r\n    // ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);\r\n    ctx.lineJoin = \"round\";\r\n    ctx.beginPath();\r\n    ctx.strokeStyle =\r\n        colour === undefined ? `rgb(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255})` : colour;\r\n    ctx.moveTo(g2lx(polygon[0][0]), g2ly(polygon[0][1]));\r\n    for (const point of polygon) {\r\n        ctx.lineTo(g2lx(point[0]), g2ly(point[1]));\r\n    }\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n}\r\n\r\nexport function drawPolygonL(polygon: number[][], colour?: string): void {\r\n    const dl = layerManager.getLayer(\"draw\");\r\n    if (dl === undefined) return;\r\n    const ctx = dl.ctx;\r\n    ctx.lineJoin = \"round\";\r\n    // ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);\r\n    ctx.lineJoin = \"round\";\r\n    ctx.beginPath();\r\n    ctx.strokeStyle =\r\n        colour === undefined ? `rgb(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255})` : colour;\r\n    ctx.moveTo(polygon[0][0], polygon[0][1]);\r\n    for (const point of polygon) {\r\n        ctx.lineTo(point[0], point[1]);\r\n    }\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n}\r\n\r\nfunction x(xx: number, local: boolean): number {\r\n    if (local) return xx;\r\n    else return g2lx(xx);\r\n}\r\n\r\nfunction y(yy: number, local: boolean): number {\r\n    if (local) return yy;\r\n    else return g2ly(yy);\r\n}\r\n\r\nlet I = 0;\r\nlet J = 0;\r\n\r\nfunction drl(from: number[], to: number[], constrained: boolean, local: boolean): void {\r\n    // J++;\r\n    // if (constrained) {\r\n    //     I++;\r\n    //     console.log(\"*\", from, to);\r\n    // } else {\r\n    //     console.log(\" \", from, to);\r\n    // }\r\n    const dl = layerManager.getLayer(\"draw\");\r\n    if (dl === undefined) return;\r\n    const ctx = dl.ctx;\r\n    ctx.beginPath();\r\n    ctx.strokeStyle = constrained ? \"rgba(255, 255, 0, 0.30)\" : \"rgba(0, 0, 0, 0.30)\";\r\n    ctx.moveTo(x(from[0], local), y(from[1], local));\r\n    ctx.lineTo(x(to[0], local), y(to[1], local));\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n}\r\n\r\nexport function drawPolygonT(tds: TDS, local = true, clear = true, logs: 0 | 1 | 2 = 0): void {\r\n    I = 0;\r\n    J = 0;\r\n    let T = 0;\r\n    const dl = layerManager.getLayer(\"draw\");\r\n    if (dl === undefined) return;\r\n    const ctx = dl.ctx;\r\n    if (clear) ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);\r\n    ctx.lineJoin = \"round\";\r\n    // ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);\r\n    ctx.lineJoin = \"round\";\r\n    const ei = new EdgeIterator(tds);\r\n    while (!ei.valid) ei.next();\r\n    do {\r\n        const fromP = ei.edge.first!.vertices[ccw(ei.edge.second)]!.point!;\r\n        const toP = ei.edge.first!.vertices[cw(ei.edge.second)]!.point!;\r\n        if (logs > 0) {\r\n            if (fromP[0] === -Infinity || toP[0] === -Infinity) {\r\n                ei.next();\r\n                continue;\r\n            }\r\n            J++;\r\n            if (ei.edge.first!.constraints[ei.edge.second]) {\r\n                I++;\r\n                if (logs === 2) console.log(`Edge: (*) ${fromP} > ${toP}   (${ei.edge.first!.uid})`);\r\n            } else if (logs === 2) console.log(`Edge: ${fromP} > ${toP}   (${ei.edge.first!.uid})`);\r\n        }\r\n        ei.next();\r\n    } while (ei.valid);\r\n    for (const t of tds.triangles) {\r\n        if (t.isInfinite()) continue;\r\n        T++;\r\n        const po = [];\r\n        ctx.fillStyle = \"blue\";\r\n        if (t.vertices[0] !== undefined) {\r\n            po.push(t.vertices[0]!.point);\r\n            ctx.beginPath();\r\n            ctx.arc(x(t.vertices[0]!.point![0], local), y(t.vertices[0]!.point![1], local), 5, 0, 2 * Math.PI);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n        if (t.vertices[1] !== undefined) {\r\n            po.push(t.vertices[1]!.point);\r\n            ctx.arc(x(t.vertices[1]!.point![0], local), y(t.vertices[1]!.point![1], local), 5, 0, 2 * Math.PI);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n        if (t.vertices[2] !== undefined) {\r\n            po.push(t.vertices[2]!.point);\r\n            ctx.arc(x(t.vertices[2]!.point![0], local), y(t.vertices[2]!.point![1], local), 5, 0, 2 * Math.PI);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n        if (logs === 2) console.log(`[T ${t.uid}] `, ...po, t.constraints);\r\n\r\n        ctx.moveTo(x(t.vertices[0]!.point![0], local), y(t.vertices[0]!.point![1], local));\r\n        if (t.vertices[0] !== undefined && t.vertices[1] !== undefined)\r\n            drl(t.vertices[0]!.point!, t.vertices[1]!.point!, t.constraints[2], local);\r\n        if (t.vertices[1] !== undefined && t.vertices[2] !== undefined)\r\n            drl(t.vertices[1]!.point!, t.vertices[2]!.point!, t.constraints[0], local);\r\n        if (t.vertices[2] !== undefined && t.vertices[0] !== undefined)\r\n            drl(t.vertices[2]!.point!, t.vertices[0]!.point!, t.constraints[1], local);\r\n    }\r\n    if (logs > 0) {\r\n        console.log(`Edges: ${I}/${J}`);\r\n        console.log(`Faces: ${T}`);\r\n    }\r\n}\r\n\r\n(<any>window).DC = drawPoint;\r\n(<any>window).DL = drl;\r\n(<any>window).DP = drawPolygon;\r\n(<any>window).DPL = drawPolygonL;\r\n(<any>window).DPT = drawPolygonT;\r\n","import { GlobalPoint } from \"@/game/geom\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\nimport { Edge } from \"./cdt\";\r\nimport { drawPolygon } from \"./draw\";\r\nimport { PA_CDT, TriangulationTarget } from \"./pa\";\r\nimport { Point, Sign, Triangle } from \"./tds\";\r\nimport { ccw, cw, orientation } from \"./triag\";\r\n\r\nexport function computeVisibility(q: GlobalPoint, target: TriangulationTarget, drawt?: boolean): number[][] {\r\n    if (drawt === undefined) drawt = gameStore.drawTEContour;\r\n    // console.time(\"CV\");\r\n    const Q: Point = [q.x, q.y];\r\n    const rawOutput: number[][] = [];\r\n    const triangle = PA_CDT[target].locate(Q, null).loc;\r\n    if (triangle === null) {\r\n        console.error(\"Triangle not found\");\r\n        return [];\r\n    }\r\n    // triangle.fill();\r\n    rawOutput.push(triangle.vertices[1]!.point!);\r\n    if (!triangle.isConstrained(0))\r\n        expandEdge(Q, triangle.vertices[2]!.point!, triangle.vertices[1]!.point!, triangle, 0, rawOutput);\r\n    rawOutput.push(triangle.vertices[2]!.point!);\r\n    if (!triangle.isConstrained(1))\r\n        expandEdge(Q, triangle.vertices[0]!.point!, triangle.vertices[2]!.point!, triangle, 1, rawOutput);\r\n    rawOutput.push(triangle.vertices[0]!.point!);\r\n    if (!triangle.isConstrained(2))\r\n        expandEdge(Q, triangle.vertices[1]!.point!, triangle.vertices[0]!.point!, triangle, 2, rawOutput);\r\n    // console.timeEnd(\"CV\");\r\n\r\n    if (drawt) drawPolygon(rawOutput, \"red\");\r\n\r\n    return rawOutput;\r\n}\r\n\r\nfunction expandEdge(\r\n    q: Point,\r\n    left: number[],\r\n    right: number[],\r\n    fh: Triangle,\r\n    index: number,\r\n    rawOutput: number[][],\r\n): void {\r\n    // fh.edge(index).draw();\r\n    const nfh = fh.neighbours[index]!;\r\n    // nfh.fill(\"rgba(255, 0, 0, 0.25)\");\r\n    const nIndex = nfh.indexT(fh);\r\n    const rIndex = ccw(nIndex);\r\n    const lIndex = cw(nIndex);\r\n    const nvh = nfh.vertices[nIndex]!;\r\n    const rvh = nfh.vertices[lIndex]!;\r\n    const lvh = nfh.vertices[rIndex]!;\r\n\r\n    const re: Edge = [nfh, rIndex];\r\n    const le: Edge = [nfh, lIndex];\r\n\r\n    const ro = orientation(q, right, nvh.point!);\r\n    const lo = orientation(q, left, nvh.point!);\r\n\r\n    // const ctx = layerManager.getLayer(\"draw\")!.ctx;\r\n    // ctx.beginPath();\r\n    // ctx.strokeStyle = \"red\";\r\n    // ctx.lineJoin = \"round\";\r\n    // ctx.moveTo(g2lx(q.x), g2ly(q.y));\r\n    // ctx.lineTo(g2lx(left[0]), g2ly(left[1]));\r\n    // ctx.moveTo(g2lx(q.x), g2ly(q.y));\r\n    // ctx.lineTo(g2lx(nvh[0]), g2ly(nvh[1]));\r\n    // ctx.strokeStyle = \"blue\";\r\n    // ctx.moveTo(g2lx(q.x), g2ly(q.y));\r\n    // ctx.lineTo(g2lx(right[0]), g2ly(right[1]));\r\n    // ctx.moveTo(g2lx(q.x), g2ly(q.y));\r\n    // ctx.lineTo(g2lx(nvh[0]), g2ly(nvh[1]));\r\n    // ctx.closePath();\r\n    // ctx.stroke();\r\n\r\n    // Right edge is seen if the new vertex is ccw of the right ray\r\n    if (ro === Sign.COUNTERCLOCKWISE) {\r\n        if (re[0].isConstrained(re[1])) {\r\n            // See if current right ray is rvh\r\n            if (right !== rvh.point!) rawOutput.push(raySegIntersection(q, right, nvh.point!, rvh.point!));\r\n            if (lo === Sign.COUNTERCLOCKWISE) rawOutput.push(raySegIntersection(q, left, nvh.point!, rvh.point!));\r\n        } else {\r\n            if (lo === Sign.COUNTERCLOCKWISE) return expandEdge(q, left, right, nfh, rIndex, rawOutput);\r\n            else expandEdge(q, nvh.point!, right, nfh, rIndex, rawOutput);\r\n        }\r\n    }\r\n\r\n    if (ro !== Sign.CLOCKWISE && lo !== Sign.COUNTERCLOCKWISE) {\r\n        rawOutput.push(nvh.point!);\r\n    }\r\n\r\n    if (lo === Sign.CLOCKWISE) {\r\n        if (le[0].isConstrained(le[1])) {\r\n            if (ro === Sign.CLOCKWISE) {\r\n                rawOutput.push(raySegIntersection(q, right, nvh.point!, lvh.point!));\r\n            }\r\n            if (left !== lvh.point!) {\r\n                rawOutput.push(raySegIntersection(q, left, nvh.point!, lvh.point!));\r\n            }\r\n            return;\r\n        } else {\r\n            if (ro === Sign.CLOCKWISE) {\r\n                return expandEdge(q, left, right, nfh, lIndex, rawOutput);\r\n            } else {\r\n                return expandEdge(q, left, nvh.point!, nfh, lIndex, rawOutput);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction raySegIntersection(q: Point, b: Point, s: Point, t: Point): Point {\r\n    const denominator = (t[1] - s[1]) * (b[0] - q[0]) - (t[0] - s[0]) * (b[1] - q[1]);\r\n    const ua = ((t[0] - s[0]) * (q[1] - s[1]) - (t[1] - s[1]) * (q[0] - s[0])) / denominator;\r\n    // const ub = ((b[0] - q.x) * (q.y - s[1]) - (b[1] - q.y) * (q.x - s[0])) / denominator;\r\n    const x = q[0] + ua * (b[0] - q[0]);\r\n    const y = q[1] + ua * (b[1] - q[1]);\r\n\r\n    return [x, y];\r\n}\r\n","import { GlobalPoint, Ray } from \"@/game/geom\";\r\nimport { Layer } from \"@/game/layers/layer\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Settings } from \"@/game/settings\";\r\nimport { Circle } from \"@/game/shapes/circle\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { g2l, g2lr, g2lx, g2ly, g2lz, getUnitDistance } from \"@/game/units\";\r\nimport { getFogColour } from \"../utils\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\nimport { TriangulationTarget } from \"../visibility/te/pa\";\r\nimport { computeVisibility } from \"../visibility/te/te\";\r\n\r\nexport class FOWLayer extends Layer {\r\n    isVisionLayer: boolean = true;\r\n    preFogShapes: Shape[] = [];\r\n    virtualCanvas: HTMLCanvasElement;\r\n    vCtx: CanvasRenderingContext2D;\r\n\r\n    constructor(canvas: HTMLCanvasElement, name: string) {\r\n        super(canvas, name);\r\n        this.virtualCanvas = document.createElement(\"canvas\");\r\n        this.virtualCanvas.width = window.innerWidth;\r\n        this.virtualCanvas.height = window.innerHeight;\r\n        this.vCtx = this.virtualCanvas.getContext(\"2d\")!;\r\n    }\r\n\r\n    addShape(shape: Shape, sync: boolean, temporary?: boolean, invalidate = true): void {\r\n        super.addShape(shape, sync, temporary, invalidate);\r\n        if (shape.options.has(\"preFogShape\") && shape.options.get(\"preFogShape\")) {\r\n            this.preFogShapes.push(shape);\r\n        }\r\n    }\r\n\r\n    removeShape(shape: Shape, sync: boolean, temporary?: boolean): void {\r\n        if (shape.options.has(\"preFogShape\") && shape.options.get(\"preFogShape\")) {\r\n            const idx = this.preFogShapes.findIndex(s => s.uuid === shape.uuid);\r\n            this.preFogShapes.splice(idx, 1);\r\n        }\r\n        super.removeShape(shape, sync, temporary);\r\n    }\r\n\r\n    draw(): void {\r\n        if (!this.valid) {\r\n            const ctx = this.ctx;\r\n\r\n            if (Settings.skipLightFOW) {\r\n                ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n                this.valid = true;\r\n                return;\r\n            }\r\n\r\n            const originalOperation = ctx.globalCompositeOperation;\r\n            ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n            ctx.fillStyle = \"rgba(0, 0, 0, 1)\";\r\n\r\n            const dctx = layerManager.getLayer(\"draw\")!.ctx;\r\n            if (Settings.drawAngleLines || Settings.drawFirstLightHit) {\r\n                dctx.clearRect(0, 0, dctx.canvas.width, dctx.canvas.height);\r\n            }\r\n\r\n            // At all times provide a minimal vision range to prevent losing your tokens in fog.\r\n            if (gameStore.fullFOW && layerManager.hasLayer(\"tokens\")) {\r\n                layerManager.getLayer(\"tokens\")!.shapes.forEach(sh => {\r\n                    if (!sh.ownedBy() || !sh.isToken) return;\r\n                    const bb = sh.getBoundingBox();\r\n                    const lcenter = g2l(sh.center());\r\n                    const alm = 0.8 * g2lz(bb.w);\r\n                    ctx.beginPath();\r\n                    ctx.arc(lcenter.x, lcenter.y, alm, 0, 2 * Math.PI);\r\n                    const gradient = ctx.createRadialGradient(lcenter.x, lcenter.y, alm / 2, lcenter.x, lcenter.y, alm);\r\n                    gradient.addColorStop(0, \"rgba(0, 0, 0, 1)\");\r\n                    gradient.addColorStop(1, \"rgba(0, 0, 0, 0)\");\r\n                    ctx.fillStyle = gradient;\r\n                    ctx.fill();\r\n                });\r\n            }\r\n\r\n            this.vCtx.clearRect(0, 0, window.innerWidth, window.innerHeight);\r\n\r\n            // First cut out all the light sources\r\n            for (const light of gameStore.visionSources) {\r\n                const shape = layerManager.UUIDMap.get(light.shape);\r\n                if (shape === undefined) continue;\r\n                const aura = shape.auras.find(a => a.uuid === light.aura);\r\n                if (aura === undefined) continue;\r\n\r\n                const auraLength = getUnitDistance(aura.value + aura.dim);\r\n                const center = shape.center();\r\n                const lcenter = g2l(center);\r\n\r\n                const auraCircle = new Circle(center, auraLength);\r\n                if (!auraCircle.visibleInCanvas(ctx.canvas)) continue;\r\n\r\n                if (visibilityStore.visionMode === \"bvh\") {\r\n                    let lastArcAngle = -1;\r\n\r\n                    const path = new Path2D();\r\n                    path.moveTo(lcenter.x, lcenter.y);\r\n                    let firstPoint: GlobalPoint;\r\n\r\n                    for (let angle = 0; angle < 2 * Math.PI; angle += (Settings.angleSteps / 180) * Math.PI) {\r\n                        const anglePoint = new GlobalPoint(\r\n                            center.x + auraLength * Math.cos(angle),\r\n                            center.y + auraLength * Math.sin(angle),\r\n                        );\r\n                        if (Settings.drawAngleLines) {\r\n                            dctx!.beginPath();\r\n                            dctx!.moveTo(g2lx(center.x), g2ly(center.y));\r\n                            dctx!.lineTo(g2lx(anglePoint.x), g2ly(anglePoint.y));\r\n                            dctx!.stroke();\r\n                        }\r\n\r\n                        // Check if there is a hit with one of the nearby light blockers.\r\n                        const lightRay = Ray.fromPoints(center, anglePoint);\r\n                        const hitResult = visibilityStore.BV.intersect(lightRay);\r\n\r\n                        if (angle === 0) firstPoint = hitResult.hit ? hitResult.intersect : anglePoint;\r\n\r\n                        // We can move on to the next angle if nothing was hit.\r\n                        if (!hitResult.hit) {\r\n                            // If an earlier hit caused the aura to leave the arc, we need to go back to the arc\r\n                            if (lastArcAngle === -1) {\r\n                                // Set the start of a new arc beginning at the current angle\r\n                                lastArcAngle = angle;\r\n                                // Draw a line from the last non arc location back to the arc\r\n                                const dest = g2l(anglePoint);\r\n                                ctx.lineTo(dest.x, dest.y);\r\n                            }\r\n                            continue;\r\n                        }\r\n                        // If hit , first finish any ongoing arc, then move to the intersection point\r\n                        if (lastArcAngle !== -1) {\r\n                            path.arc(lcenter.x, lcenter.y, g2lr(aura.value + aura.dim), lastArcAngle, angle);\r\n                            lastArcAngle = -1;\r\n                        }\r\n                        path.lineTo(g2lx(hitResult.intersect.x), g2ly(hitResult.intersect.y));\r\n                    }\r\n                    // Finish the final arc.\r\n                    if (lastArcAngle === -1) path.lineTo(g2lx(firstPoint!.x), g2ly(firstPoint!.y));\r\n                    else path.arc(lcenter.x, lcenter.y, g2lr(aura.value + aura.dim), lastArcAngle, 2 * Math.PI);\r\n\r\n                    if (gameStore.fullFOW) {\r\n                        if (aura.dim > 0) {\r\n                            // Fill the light aura with a radial dropoff towards the outside.\r\n                            const gradient = ctx.createRadialGradient(\r\n                                lcenter.x,\r\n                                lcenter.y,\r\n                                g2lr(aura.value),\r\n                                lcenter.x,\r\n                                lcenter.y,\r\n                                g2lr(aura.value + aura.dim),\r\n                            );\r\n                            gradient.addColorStop(0, \"rgba(0, 0, 0, 1)\");\r\n                            gradient.addColorStop(1, \"rgba(0, 0, 0, 0)\");\r\n                            ctx.fillStyle = gradient;\r\n                        } else {\r\n                            ctx.fillStyle = \"rgba(0, 0, 0, 1)\";\r\n                        }\r\n                        ctx.fill(path);\r\n                    }\r\n\r\n                    aura.lastPath = path;\r\n                } else {\r\n                    this.vCtx.globalCompositeOperation = \"source-over\";\r\n                    this.vCtx.fillStyle = \"rgba(0, 0, 0, 1)\";\r\n                    const polygon = computeVisibility(center, TriangulationTarget.VISION);\r\n                    this.vCtx.beginPath();\r\n                    this.vCtx.moveTo(g2lx(polygon[0][0]), g2ly(polygon[0][1]));\r\n                    for (const point of polygon) this.vCtx.lineTo(g2lx(point[0]), g2ly(point[1]));\r\n                    this.vCtx.closePath();\r\n                    this.vCtx.fill();\r\n                    if (aura.dim > 0) {\r\n                        // Fill the light aura with a radial dropoff towards the outside.\r\n                        const gradient = this.vCtx.createRadialGradient(\r\n                            lcenter.x,\r\n                            lcenter.y,\r\n                            g2lr(aura.value),\r\n                            lcenter.x,\r\n                            lcenter.y,\r\n                            g2lr(aura.value + aura.dim),\r\n                        );\r\n                        gradient.addColorStop(0, \"rgba(0, 0, 0, 1)\");\r\n                        gradient.addColorStop(1, \"rgba(0, 0, 0, 0)\");\r\n                        this.vCtx.fillStyle = gradient;\r\n                    } else {\r\n                        this.vCtx.fillStyle = \"rgba(0, 0, 0, 1)\";\r\n                    }\r\n                    this.vCtx.globalCompositeOperation = \"source-in\";\r\n                    this.vCtx.beginPath();\r\n                    this.vCtx.arc(lcenter.x, lcenter.y, g2lr(aura.value + aura.dim), 0, 2 * Math.PI);\r\n                    this.vCtx.fill();\r\n                    ctx.drawImage(this.virtualCanvas, 0, 0);\r\n                }\r\n            }\r\n\r\n            // At the DM Side due to opacity of the two fow layers, it looks strange if we just render them on top of eachother like players.\r\n            if (gameStore.fowLOS) {\r\n                ctx.globalCompositeOperation = \"source-in\";\r\n                ctx.drawImage(layerManager.getLayer(\"fow-players\")!.canvas, 0, 0);\r\n            }\r\n\r\n            for (const preShape of this.preFogShapes) {\r\n                if (!preShape.visibleInCanvas(this.canvas)) continue;\r\n                const ogComposite = preShape.globalCompositeOperation;\r\n                if (!gameStore.fullFOW) {\r\n                    if (preShape.globalCompositeOperation === \"source-over\")\r\n                        preShape.globalCompositeOperation = \"destination-out\";\r\n                    else if (preShape.globalCompositeOperation === \"destination-out\")\r\n                        preShape.globalCompositeOperation = \"source-over\";\r\n                }\r\n                preShape.draw(ctx);\r\n                preShape.globalCompositeOperation = ogComposite;\r\n            }\r\n\r\n            if (gameStore.fullFOW) {\r\n                ctx.globalCompositeOperation = \"source-out\";\r\n                ctx.fillStyle = getFogColour();\r\n                ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n            }\r\n\r\n            super.draw(false);\r\n\r\n            ctx.globalCompositeOperation = originalOperation;\r\n        }\r\n    }\r\n}\r\n","import { Ray, Vector } from \"@/game/geom\";\r\nimport { Layer } from \"@/game/layers/layer\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Settings } from \"@/game/settings\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { g2l, g2lr, g2lx, g2ly } from \"@/game/units\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\nimport { TriangulationTarget } from \"../visibility/te/pa\";\r\nimport { computeVisibility } from \"../visibility/te/te\";\r\n\r\nexport class FOWPlayersLayer extends Layer {\r\n    isVisionLayer: boolean = true;\r\n\r\n    draw(): void {\r\n        if (!this.valid) {\r\n            // console.time(\"VI\");\r\n            const ctx = this.ctx;\r\n\r\n            if (!gameStore.fowLOS || Settings.skipPlayerFOW) {\r\n                ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n                this.valid = true;\r\n                return;\r\n            }\r\n\r\n            ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n            const originalOperation = ctx.globalCompositeOperation;\r\n\r\n            ctx.fillStyle = \"rgba(0, 0, 0, 1)\";\r\n\r\n            // For the DM this is done at the end of this function.  TODO: why the split up ???\r\n            // This was done in commit be1e65cff1e7369375fe11cfa1643fab1d11beab.\r\n            if (!gameStore.IS_DM) super.draw(!gameStore.fullFOW);\r\n\r\n            // Then cut out all the player vision auras\r\n            const maxLength = ctx.canvas.width + ctx.canvas.height;\r\n\r\n            for (const tokenId of gameStore.activeTokens) {\r\n                const token = layerManager.UUIDMap.get(tokenId);\r\n                if (token === undefined) continue;\r\n                const center = token.center();\r\n                const lcenter = g2l(center);\r\n                if (visibilityStore.visionMode === \"bvh\") {\r\n                    ctx.beginPath();\r\n                    let lastArcAngle = -1;\r\n\r\n                    for (let angle = 0; angle < 2 * Math.PI; angle += (Settings.angleSteps / 2 / 180) * Math.PI) {\r\n                        const cos = Math.cos(angle);\r\n                        const sin = Math.sin(angle);\r\n                        // Check if there is a hit with one of the nearby light blockers.\r\n                        const lightRay = new Ray(center, new Vector(cos, sin));\r\n                        const hitResult = visibilityStore.BV.intersect(lightRay);\r\n\r\n                        // We can move on to the next angle if nothing was hit.\r\n                        if (!hitResult.hit) {\r\n                            // If an earlier hit caused the aura to leave the arc, we need to go back to the arc\r\n                            if (lastArcAngle === -1) {\r\n                                // Draw a line from the last non arc location back to the arc\r\n                                ctx.lineTo(lcenter.x + maxLength * cos, lcenter.y + maxLength * sin);\r\n                                // Set the start of a new arc beginning at the current angle\r\n                                lastArcAngle = angle;\r\n                            }\r\n                            continue;\r\n                        }\r\n                        // If hit , first finish any ongoing arc, then move to the intersection point\r\n                        if (lastArcAngle !== -1) {\r\n                            ctx.arc(lcenter.x, lcenter.y, maxLength, lastArcAngle, angle);\r\n                            lastArcAngle = -1;\r\n                        }\r\n                        ctx.lineTo(g2lx(hitResult.intersect.x), g2ly(hitResult.intersect.y));\r\n                    }\r\n\r\n                    // Finish the final arc.\r\n                    if (lastArcAngle !== -1) ctx.arc(lcenter.x, lcenter.y, maxLength, lastArcAngle, 2 * Math.PI);\r\n                    else ctx.closePath();\r\n                    ctx.fill();\r\n                } else {\r\n                    if (true) {\r\n                        // Add a gradient vision dropoff\r\n                        const gradient = ctx.createRadialGradient(\r\n                            lcenter.x,\r\n                            lcenter.y,\r\n                            g2lr(gameStore.visionRangeMin),\r\n                            lcenter.x,\r\n                            lcenter.y,\r\n                            g2lr(gameStore.visionRangeMax),\r\n                        );\r\n                        gradient.addColorStop(0, \"rgba(0, 0, 0, 1)\");\r\n                        gradient.addColorStop(1, \"rgba(0, 0, 0, 0)\");\r\n                        ctx.fillStyle = gradient;\r\n                    } else {\r\n                        ctx.fillStyle = \"rgba(0, 0, 0, 1)\";\r\n                    }\r\n                    try {\r\n                        const polygon = computeVisibility(token.center(), TriangulationTarget.VISION);\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(g2lx(polygon[0][0]), g2ly(polygon[0][1]));\r\n                        for (const point of polygon) ctx.lineTo(g2lx(point[0]), g2ly(point[1]));\r\n                        ctx.closePath();\r\n                        ctx.fill();\r\n                    } catch {\r\n                        // no-op\r\n                    }\r\n                }\r\n            }\r\n\r\n            // For the players this is done at the beginning of this function.  TODO: why the split up ???\r\n            // This was done in commit be1e65cff1e7369375fe11cfa1643fab1d11beab.\r\n            if (gameStore.IS_DM) super.draw(!gameStore.fullFOW);\r\n\r\n            ctx.globalCompositeOperation = originalOperation;\r\n            // console.timeEnd(\"VI\");\r\n        }\r\n    }\r\n}\r\n","import { Layer } from \"@/game/layers/layer\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\nexport class GridLayer extends Layer {\r\n    invalidate(): void {\r\n        this.valid = false;\r\n    }\r\n    draw(_doClear?: boolean): void {\r\n        if (!this.valid) {\r\n            this.drawGrid();\r\n        }\r\n    }\r\n    drawGrid(): void {\r\n        const ctx = this.ctx;\r\n        this.clear();\r\n        ctx.beginPath();\r\n\r\n        const gs = gameStore.gridSize;\r\n\r\n        for (let i = 0; i < this.width; i += gs * gameStore.zoomFactor) {\r\n            ctx.moveTo(i + (gameStore.panX % gs) * gameStore.zoomFactor, 0);\r\n            ctx.lineTo(i + (gameStore.panX % gs) * gameStore.zoomFactor, this.height);\r\n            ctx.moveTo(0, i + (gameStore.panY % gs) * gameStore.zoomFactor);\r\n            ctx.lineTo(this.width, i + (gameStore.panY % gs) * gameStore.zoomFactor);\r\n        }\r\n\r\n        ctx.strokeStyle = gameStore.gridColour;\r\n        ctx.lineWidth = 1;\r\n        ctx.stroke();\r\n        this.valid = true;\r\n    }\r\n}\r\n","import { ServerLayer } from \"@/game/comm/types/general\";\r\nimport { FOWLayer } from \"@/game/layers/fow\";\r\nimport { FOWPlayersLayer } from \"@/game/layers/fowplayers\";\r\nimport { GridLayer } from \"@/game/layers/grid\";\r\nimport { Layer } from \"@/game/layers/layer\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { GlobalPoint } from \"../geom\";\r\nimport { Asset } from \"../shapes/asset\";\r\nimport { l2gx, l2gy, l2gz } from \"../units\";\r\n\r\nexport function createLayer(layerInfo: ServerLayer): void {\r\n    // Create canvas element\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.style.zIndex = layerManager.layers.length.toString();\r\n    canvas.width = window.innerWidth;\r\n    canvas.height = window.innerHeight;\r\n\r\n    // Create the Layer instance\r\n    let layer: Layer;\r\n    if (layerInfo.type_ === \"grid\") layer = new GridLayer(canvas, layerInfo.name);\r\n    else if (layerInfo.type_ === \"fow\") layer = new FOWLayer(canvas, layerInfo.name);\r\n    else if (layerInfo.type_ === \"fow-players\") layer = new FOWPlayersLayer(canvas, layerInfo.name);\r\n    else layer = new Layer(canvas, layerInfo.name);\r\n    layer.selectable = layerInfo.selectable;\r\n    layer.playerEditable = layerInfo.player_editable;\r\n    layerManager.addLayer(layer);\r\n\r\n    // Add the element to the DOM\r\n    const layers = document.getElementById(\"layers\");\r\n    if (layers === null) {\r\n        console.warn(\"Layers div is missing, this will prevent the main game board from loading!\");\r\n        return;\r\n    }\r\n    if (layerInfo.name !== \"fow-players\") layers.appendChild(canvas);\r\n\r\n    if (layerInfo.type_ === \"grid\" && layerInfo.size) gameStore.setGridSize({ gridSize: layerInfo.size, sync: false });\r\n    // Load layer shapes\r\n    layer.setShapes(layerInfo.shapes);\r\n}\r\n\r\nexport function dropAsset(event: DragEvent): void {\r\n    const layer = layerManager.getLayer();\r\n    if (layer === undefined || event === null || event.dataTransfer === null) return;\r\n    const image = document.createElement(\"img\");\r\n    image.src = event.dataTransfer.getData(\"text/plain\");\r\n    const asset = new Asset(\r\n        image,\r\n        new GlobalPoint(l2gx(event.clientX), l2gy(event.clientY)),\r\n        l2gz(image.width),\r\n        l2gz(image.height),\r\n    );\r\n    asset.src = new URL(image.src).pathname;\r\n\r\n    if (gameStore.useGrid) {\r\n        const gs = gameStore.gridSize;\r\n        asset.refPoint = new GlobalPoint(\r\n            Math.round(asset.refPoint.x / gs) * gs,\r\n            Math.round(asset.refPoint.y / gs) * gs,\r\n        );\r\n        asset.w = Math.max(Math.round(asset.w / gs) * gs, gs);\r\n        asset.h = Math.max(Math.round(asset.h / gs) * gs, gs);\r\n    }\r\n\r\n    layer.addShape(asset, true);\r\n}\r\n","import { GlobalPoint, LocalPoint } from \"@/game/geom\";\r\nimport { Layer } from \"@/game/layers/layer\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Rect } from \"@/game/shapes/rect\";\r\nimport { Text } from \"@/game/shapes/text\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { l2g } from \"@/game/units\";\r\n\r\nexport class AnnotationManager {\r\n    annotationText: Text;\r\n    annotationRect: Rect;\r\n    layer: Layer | undefined;\r\n    shown: boolean = false;\r\n\r\n    constructor() {\r\n        const origin = new GlobalPoint(0, 0);\r\n        this.annotationText = new Text(origin, \"\", \"bold 20px serif\", 0, \"rgba(230, 230, 230, 1)\");\r\n        this.annotationRect = new Rect(origin, 0, 0, \"rgba(0, 0, 0, 0.6)\");\r\n    }\r\n\r\n    setActiveText(text: string): void {\r\n        if (this.layer === undefined) {\r\n            if (layerManager.hasLayer(\"draw\")) {\r\n                this.layer = layerManager.getLayer(\"draw\")!;\r\n                this.layer.addShape(this.annotationRect, false);\r\n                this.layer.addShape(this.annotationText, false);\r\n            } else {\r\n                console.warn(\"There is no draw layer to draw annotations on!\");\r\n                return;\r\n            }\r\n        }\r\n        this.shown = text !== \"\";\r\n        this.annotationText.refPoint = l2g(new LocalPoint(this.layer.canvas.width / 2, 50));\r\n        this.annotationText.text = text;\r\n        const width = this.shown ? this.annotationText.getMaxWidth(this.layer.ctx) + 10 : 0;\r\n        const height = this.shown ? this.annotationText.getMaxHeight(this.layer.ctx) + 10 : 0;\r\n        this.annotationRect.refPoint = l2g(new LocalPoint(this.layer.canvas.width / 2 - width / 2, 30));\r\n        this.annotationRect.w = width / gameStore.zoomFactor;\r\n        this.annotationRect.h = height / gameStore.zoomFactor;\r\n        this.layer.invalidate(true);\r\n    }\r\n}\r\n","import { sendClientOptions } from \"@/game/api/utils\";\r\nimport { ServerShape } from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { createShapeFromDict } from \"@/game/shapes/utils\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { AnnotationManager } from \"@/game/ui/annotation\";\r\nimport { g2l } from \"@/game/units\";\r\nimport { TriangulationTarget } from \"./visibility/te/pa\";\r\nimport { visibilityStore } from \"./visibility/store\";\r\nimport { EventBus } from \"./event-bus\";\r\n\r\nexport class GameManager {\r\n    selectedTool: number = 0;\r\n\r\n    annotationManager = new AnnotationManager();\r\n\r\n    addShape(shape: ServerShape): void {\r\n        if (!layerManager.hasLayer(shape.layer)) {\r\n            console.log(`Shape with unknown layer ${shape.layer} could not be added`);\r\n            return;\r\n        }\r\n        const layer = layerManager.getLayer(shape.layer)!;\r\n        const sh = createShapeFromDict(shape);\r\n        if (sh === undefined) {\r\n            console.log(`Shape with unknown type ${shape.type_} could not be added`);\r\n            return;\r\n        }\r\n        layer.addShape(sh, false);\r\n        layer.invalidate(false);\r\n    }\r\n\r\n    updateShape(data: { shape: ServerShape; redraw: boolean; move: boolean; temporary: boolean }): void {\r\n        if (!layerManager.hasLayer(data.shape.layer)) {\r\n            console.log(`Shape with unknown layer ${data.shape.layer} could not be added`);\r\n            return;\r\n        }\r\n        const sh = createShapeFromDict(data.shape);\r\n        if (sh === undefined) {\r\n            console.log(`Shape with unknown type ${data.shape.type_} could not be added`);\r\n            return;\r\n        }\r\n        const oldShape = layerManager.UUIDMap.get(data.shape.uuid);\r\n        if (oldShape === undefined) {\r\n            console.log(`Shape with unknown id could not be updated`);\r\n            return;\r\n        }\r\n        const redrawInitiative = sh.owners !== oldShape.owners;\r\n        const shape = Object.assign(oldShape, sh);\r\n        const alteredVision = shape.checkVisionSources();\r\n        const alteredMovement = shape.setMovementBlock(shape.movementObstruction);\r\n        shape.setIsToken(shape.isToken);\r\n        if (data.redraw) {\r\n            if (shape.visionObstruction && !alteredVision) {\r\n                visibilityStore.deleteFromTriag({\r\n                    target: TriangulationTarget.VISION,\r\n                    shape,\r\n                    standalone: false,\r\n                });\r\n                visibilityStore.addToTriag({ target: TriangulationTarget.VISION, shape });\r\n            }\r\n            layerManager.getLayer(data.shape.layer)!.invalidate(false);\r\n            if (shape.movementObstruction && !alteredMovement) {\r\n                visibilityStore.deleteFromTriag({\r\n                    target: TriangulationTarget.MOVEMENT,\r\n                    shape,\r\n                    standalone: false,\r\n                });\r\n                visibilityStore.addToTriag({ target: TriangulationTarget.MOVEMENT, shape });\r\n            }\r\n        }\r\n        if (redrawInitiative) EventBus.$emit(\"Initiative.ForceUpdate\");\r\n    }\r\n\r\n    setCenterPosition(position: GlobalPoint): void {\r\n        const localPos = g2l(position);\r\n        gameStore.increasePanX((window.innerWidth / 2 - localPos.x) / gameStore.zoomFactor);\r\n        gameStore.increasePanY((window.innerHeight / 2 - localPos.y) / gameStore.zoomFactor);\r\n        layerManager.invalidate();\r\n        sendClientOptions(gameStore.locationOptions);\r\n    }\r\n}\r\n\r\nexport const gameManager = new GameManager();\r\n(<any>window).gameManager = gameManager;\r\n","import { AssetList } from \"@/core/comm/types\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { BoardInfo, Note, ServerClient, ServerLocation } from \"@/game/comm/types/general\";\r\nimport { ServerShape } from \"@/game/comm/types/shapes\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { createLayer } from \"@/game/layers/utils\";\r\nimport { gameManager } from \"@/game/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { router } from \"@/router\";\r\nimport { zoomDisplay } from \"../utils\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\n\r\nsocket.on(\"connect\", () => {\r\n    console.log(\"Connected\");\r\n});\r\nsocket.on(\"disconnect\", () => {\r\n    console.log(\"Disconnected\");\r\n});\r\nsocket.on(\"connect_error\", (_error: any) => {\r\n    console.error(\"Could not connect to game session.\");\r\n    router.push(\"/dashboard\");\r\n});\r\nsocket.on(\"error\", (_error: any) => {\r\n    console.error(\"Game session does not exist.\");\r\n    router.push(\"/dashboard\");\r\n});\r\nsocket.on(\"redirect\", (destination: string) => {\r\n    console.log(\"redirecting\");\r\n    router.push(destination);\r\n});\r\nsocket.on(\r\n    \"Room.Info.Set\",\r\n    (data: {\r\n        name: string;\r\n        creator: string;\r\n        invitationCode: string;\r\n        isLocked: boolean;\r\n        players: { id: number; name: string }[];\r\n    }) => {\r\n        gameStore.setRoomName(data.name);\r\n        gameStore.setRoomCreator(data.creator);\r\n        gameStore.setInvitationCode(data.invitationCode);\r\n        gameStore.setIsLocked({ isLocked: data.isLocked, sync: false });\r\n        gameStore.setPlayers(data.players);\r\n    },\r\n);\r\nsocket.on(\"Room.Info.InvitationCode.Set\", (invitationCode: string) => {\r\n    gameStore.setInvitationCode(invitationCode);\r\n    EventBus.$emit(\"DmSettings.RefreshedInviteCode\");\r\n});\r\nsocket.on(\"Room.Info.Players.Add\", (data: { id: number; name: string }) => {\r\n    gameStore.addPlayer(data);\r\n});\r\nsocket.on(\"Username.Set\", (username: string) => {\r\n    gameStore.setUsername(username);\r\n    gameStore.setDM(username === decodeURIComponent(window.location.pathname.split(\"/\")[2]));\r\n});\r\nsocket.on(\"Client.Options.Set\", (options: ServerClient) => {\r\n    gameStore.setGridColour({ colour: options.grid_colour, sync: false });\r\n    gameStore.setFOWColour({ colour: options.fow_colour, sync: false });\r\n    gameStore.setRulerColour({ colour: options.ruler_colour, sync: false });\r\n    gameStore.setPanX(options.pan_x);\r\n    gameStore.setPanY(options.pan_y);\r\n    gameStore.setZoomDisplay(zoomDisplay(options.zoom_factor));\r\n    // gameStore.setZoomDisplay(0.5);\r\n    if (options.active_layer) layerManager.selectLayer(options.active_layer, false);\r\n    if (layerManager.getGridLayer() !== undefined) layerManager.getGridLayer()!.invalidate();\r\n});\r\nsocket.on(\"Location.Set\", (data: Partial<ServerLocation>) => {\r\n    if (data.name !== undefined) gameStore.setLocationName(data.name);\r\n    if (data.unit_size !== undefined) gameStore.setUnitSize({ unitSize: data.unit_size, sync: false });\r\n    if (data.use_grid !== undefined) gameStore.setUseGrid({ useGrid: data.use_grid, sync: false });\r\n    if (data.full_fow !== undefined) gameStore.setFullFOW({ fullFOW: data.full_fow, sync: false });\r\n    if (data.fow_opacity !== undefined) gameStore.setFOWOpacity({ fowOpacity: data.fow_opacity, sync: false });\r\n    if (data.fow_los !== undefined) gameStore.setLineOfSight({ fowLOS: data.fow_los, sync: false });\r\n    if (data.vision_min_range !== undefined) gameStore.setVisionRangeMin({ value: data.vision_min_range, sync: false });\r\n    if (data.vision_max_range !== undefined) gameStore.setVisionRangeMax({ value: data.vision_max_range, sync: false });\r\n    if (data.vision_mode !== undefined) {\r\n        visibilityStore.setVisionMode({ mode: data.vision_mode, sync: false });\r\n        visibilityStore.recalculateVision();\r\n        visibilityStore.recalculateMovement();\r\n    }\r\n});\r\nsocket.on(\"Position.Set\", (data: { x: number; y: number }) => {\r\n    gameManager.setCenterPosition(new GlobalPoint(data.x, data.y));\r\n});\r\nsocket.on(\"Notes.Set\", (notes: Note[]) => {\r\n    for (const note of notes) gameStore.newNote({ note, sync: false });\r\n});\r\nsocket.on(\"Asset.List.Set\", (assets: AssetList) => {\r\n    gameStore.setAssets(assets);\r\n});\r\nsocket.on(\"Board.Set\", (locationInfo: BoardInfo) => {\r\n    gameStore.clear();\r\n    gameStore.setLocations(locationInfo.locations);\r\n    document.getElementById(\"layers\")!.innerHTML = \"\";\r\n    gameStore.resetLayerInfo();\r\n    layerManager.reset();\r\n    for (const layer of locationInfo.layers) createLayer(layer);\r\n    // Force the correct opacity render on other layers.\r\n    layerManager.selectLayer(layerManager.getLayer()!.name, false);\r\n    EventBus.$emit(\"Initiative.Clear\");\r\n    visibilityStore.recalculateVision();\r\n    visibilityStore.recalculateMovement();\r\n    gameStore.setBoardInitialized(true);\r\n});\r\nsocket.on(\"Gridsize.Set\", (gridSize: number) => {\r\n    gameStore.setGridSize({ gridSize, sync: false });\r\n});\r\nsocket.on(\"Shape.Add\", (shape: ServerShape) => {\r\n    gameManager.addShape(shape);\r\n});\r\nsocket.on(\"Shape.Remove\", (shape: ServerShape) => {\r\n    if (!layerManager.UUIDMap.has(shape.uuid)) {\r\n        console.log(`Attempted to remove an unknown shape`);\r\n        return;\r\n    }\r\n    if (!layerManager.hasLayer(shape.layer)) {\r\n        console.log(`Attempted to remove shape from an unknown layer ${shape.layer}`);\r\n        return;\r\n    }\r\n    const layer = layerManager.getLayer(shape.layer)!;\r\n    layer.removeShape(layerManager.UUIDMap.get(shape.uuid)!, false);\r\n    layer.invalidate(false);\r\n});\r\nsocket.on(\"Shape.Order.Set\", (data: { shape: ServerShape; index: number }) => {\r\n    if (!layerManager.UUIDMap.has(data.shape.uuid)) {\r\n        console.log(`Attempted to move the shape order of an unknown shape`);\r\n        return;\r\n    }\r\n    if (!layerManager.hasLayer(data.shape.layer)) {\r\n        console.log(`Attempted to remove shape from an unknown layer ${data.shape.layer}`);\r\n        return;\r\n    }\r\n    const shape = layerManager.UUIDMap.get(data.shape.uuid)!;\r\n    const layer = layerManager.getLayer(shape.layer)!;\r\n    layer.moveShapeOrder(shape, data.index, false);\r\n});\r\nsocket.on(\"Shape.Layer.Change\", (data: { uuid: string; layer: string }) => {\r\n    const shape = layerManager.UUIDMap.get(data.uuid);\r\n    if (shape === undefined) return;\r\n    shape.moveLayer(data.layer, false);\r\n});\r\nsocket.on(\"Shape.Update\", (data: { shape: ServerShape; redraw: boolean; move: boolean; temporary: boolean }) => {\r\n    gameManager.updateShape(data);\r\n});\r\nsocket.on(\"Temp.Clear\", (shapes: ServerShape[]) => {\r\n    shapes.forEach(shape => {\r\n        if (!layerManager.UUIDMap.has(shape.uuid)) {\r\n            console.log(\"Attempted to remove an unknown temporary shape\");\r\n            return;\r\n        }\r\n        if (!layerManager.hasLayer(shape.layer)) {\r\n            console.log(`Attempted to remove shape from an unknown layer ${shape.layer}`);\r\n            return;\r\n        }\r\n        const realShape = layerManager.UUIDMap.get(shape.uuid)!;\r\n        layerManager.getLayer(shape.layer)!.removeShape(realShape, false);\r\n    });\r\n});\r\nsocket.on(\"Labels.Set\", (labels: Label[]) => {\r\n    for (const label of labels) gameStore.addLabel(label);\r\n});\r\nsocket.on(\"Label.Visibility.Set\", (data: { user: string; uuid: string; visible: boolean }) => {\r\n    gameStore.setLabelVisibility(data);\r\n});\r\nsocket.on(\"Label.Add\", (data: Label) => {\r\n    gameStore.addLabel(data);\r\n});\r\nsocket.on(\"Label.Delete\", (data: { user: string; uuid: string }) => {\r\n    gameStore.deleteLabel(data);\r\n});\r\nsocket.on(\"Labels.Filter.Add\", (uuid: string) => {\r\n    gameStore.labelFilters.push(uuid);\r\n    layerManager.invalidate();\r\n});\r\nsocket.on(\"Labels.Filter.Remove\", (uuid: string) => {\r\n    const idx = gameStore.labelFilters.indexOf(uuid);\r\n    if (idx >= 0) {\r\n        gameStore.labelFilters.splice(idx, 1);\r\n        layerManager.invalidate();\r\n    }\r\n});\r\nsocket.on(\"Labels.Filters.Set\", (filters: string[]) => {\r\n    gameStore.setLabelFilters(filters);\r\n});\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('modal',{attrs:{\"visible\":_vm.visible,\"mask\":false},on:{\"close\":function($event){_vm.visible = false}},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_c('div',[_vm._v(\"Initiative\")]),_c('div',{staticClass:\"header-close\",on:{\"click\":function($event){_vm.visible = false}}},[_c('i',{staticClass:\"far fa-window-close\"})])])}}])},[_c('div',{staticClass:\"modal-body\"},[_c('draggable',{attrs:{\"id\":\"initiative-list\",\"setData\":_vm.fakeSetData,\"disabled\":!_vm.$store.state.game.IS_DM},on:{\"change\":_vm.updateOrder},model:{value:(_vm.$store.state.initiative.data),callback:function ($$v) {_vm.$set(_vm.$store.state.initiative, \"data\", $$v)},expression:\"$store.state.initiative.data\"}},[_vm._l((_vm.$store.state.initiative.data),function(actor){return [_c('div',{key:actor.uuid,staticStyle:{\"display\":\"flex\",\"flex-direction\":\"column\",\"align-items\":\"flex-end\"}},[_c('div',{staticClass:\"initiative-actor\",class:{ 'initiative-selected': _vm.$store.state.initiative.currentActor === actor.uuid },style:({ cursor: _vm.$store.state.game.IS_DM && 'move' }),on:{\"mouseenter\":function($event){return _vm.toggleHighlight(actor, true)},\"mouseleave\":function($event){return _vm.toggleHighlight(actor, false)}}},[(actor.has_img)?[_c('img',{attrs:{\"src\":actor.source,\"width\":\"30px\",\"height\":\"30px\"}})]:[_c('span',{staticStyle:{\"width\":\"auto\"}},[_vm._v(_vm._s(actor.source))])],_c('input',{directives:[{name:\"model\",rawName:\"v-model.lazy.number\",value:(actor.initiative),expression:\"actor.initiative\",modifiers:{\"lazy\":true,\"number\":true}}],class:{ notAllowed: !_vm.owns(actor) },attrs:{\"type\":\"text\",\"placeholder\":\"value\",\"disabled\":!_vm.owns(actor)},domProps:{\"value\":(actor.initiative)},on:{\"change\":[function($event){_vm.$set(actor, \"initiative\", _vm._n($event.target.value))},function($event){return _vm.syncInitiative(actor)}],\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('div',{staticClass:\"initiative-effects-icon\",class:{ notAllowed: !_vm.owns(actor) },staticStyle:{\"opacity\":\"0.6\"},on:{\"click\":function($event){_vm.createEffect(actor, _vm.getDefaultEffect(), true)}}},[_c('i',{staticClass:\"fas fa-stopwatch\"}),(actor.effects)?[_vm._v(\"\\n                                \"+_vm._s(actor.effects.length)+\"\\n                            \")]:[_vm._v(\"\\n                                0\\n                            \")]],2),_c('div',{class:{ notAllowed: !_vm.owns(actor) },style:({ opacity: actor.visible ? '1.0' : '0.3' }),on:{\"click\":function($event){return _vm.toggleOption(actor, 'visible')}}},[_c('i',{staticClass:\"fas fa-eye\"})]),_c('div',{class:{ notAllowed: !_vm.owns(actor) },style:({ opacity: actor.group ? '1.0' : '0.3' }),on:{\"click\":function($event){return _vm.toggleOption(actor, 'group')}}},[_c('i',{staticClass:\"fas fa-users\"})]),_c('div',{class:{ notAllowed: !_vm.owns(actor) },style:({ opacity: _vm.owns(actor) ? '1.0' : '0.3' }),on:{\"click\":function($event){return _vm.removeInitiative(actor.uuid, true, true)}}},[_c('i',{staticClass:\"fas fa-trash-alt\"})])],2),(actor.effects)?_c('div',{staticClass:\"initiative-effect\"},_vm._l((actor.effects),function(effect){return _c('div',{key:effect.uuid},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(effect.name),expression:\"effect.name\"}],attrs:{\"type\":\"text\",\"size\":effect.name.length || 1},domProps:{\"value\":(effect.name)},on:{\"change\":function($event){return _vm.updateEffect(actor.uuid, effect, true)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(effect, \"name\", $event.target.value)}}}),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(effect.turns),expression:\"effect.turns\"}],attrs:{\"type\":\"text\",\"size\":effect.turns.toString().length || 1},domProps:{\"value\":(effect.turns)},on:{\"change\":function($event){return _vm.updateEffect(actor.uuid, effect, true)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(effect, \"turns\", $event.target.value)}}})])}),0):_vm._e()])]})],2),_c('div',{attrs:{\"id\":\"initiative-bar\"}},[_c('div',{attrs:{\"id\":\"initiative-round\"}},[_vm._v(\"Round \"+_vm._s(_vm.$store.state.initiative.roundCounter))]),_c('div',{staticStyle:{\"display\":\"flex\"}}),_c('div',{staticClass:\"initiative-bar-button\",style:(_vm.visionLock ? 'background-color: #82c8a0' : ''),on:{\"click\":_vm.toggleVisionLock}},[_c('i',{staticClass:\"fas fa-eye\"})]),_c('div',{staticClass:\"initiative-bar-button\",style:(_vm.cameraLock ? 'background-color: #82c8a0' : ''),on:{\"click\":function($event){_vm.cameraLock = !_vm.cameraLock}}},[_c('i',{staticClass:\"fas fa-video\"})]),_c('div',{staticClass:\"initiative-bar-button\",class:{ notAllowed: !_vm.$store.state.game.IS_DM },on:{\"click\":function($event){_vm.setRound(0, true);\n                    _vm.updateTurn(_vm.$store.state.initiative.data[0].uuid, true);}}},[_c('i',{staticClass:\"fas fa-sync-alt\"})]),_c('div',{staticClass:\"initiative-bar-button\",class:{ notAllowed: !_vm.$store.state.game.IS_DM },on:{\"click\":_vm.nextTurn}},[_c('i',{staticClass:\"fas fa-chevron-right\"})])])],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { socket } from \"@/assetManager/socket\";\r\nimport { InitiativeData } from \"@/game/comm/types/general\";\r\nimport { rootStore } from \"@/store\";\r\nimport { getModule, Module, Mutation, VuexModule } from \"vuex-module-decorators\";\r\n\r\nexport interface InitiativeState {\r\n    data: InitiativeData[];\r\n    currentActor: string | null;\r\n    roundCounter: number;\r\n}\r\n\r\n@Module({ dynamic: true, store: rootStore, name: \"initiative\", namespaced: true })\r\nclass InitiativeStore extends VuexModule implements InitiativeState {\r\n    data: InitiativeData[] = [];\r\n    currentActor: string | null = null;\r\n    roundCounter = 0;\r\n\r\n    syncInitiative(data: InitiativeData | { uuid: string }): void {\r\n        socket.emit(\"Initiative.Update\", data);\r\n    }\r\n\r\n    @Mutation\r\n    clear(): void {\r\n        this.data = [];\r\n        this.currentActor = null;\r\n    }\r\n\r\n    @Mutation\r\n    setData(data: InitiativeData[]): void {\r\n        this.data = data;\r\n    }\r\n\r\n    @Mutation\r\n    addInitiative(data: InitiativeData): void {\r\n        const d = this.data.findIndex(a => a.uuid === data.uuid);\r\n        if (d >= 0) return;\r\n        if (data.initiative === undefined) data.initiative = 0;\r\n        this.syncInitiative(data);\r\n    }\r\n\r\n    @Mutation\r\n    setRoundCounter(round: number): void {\r\n        this.roundCounter = round;\r\n    }\r\n\r\n    @Mutation\r\n    setTurn(actorId: string | null): void {\r\n        this.currentActor = actorId;\r\n    }\r\n}\r\n\r\nexport const initiativeStore = getModule(InitiativeStore);\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport draggable from \"vuedraggable\";\r\nVue.component(\"draggable\", draggable);\r\n\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\nimport { uuidv4 } from \"@/core/utils\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { InitiativeData, InitiativeEffect } from \"@/game/comm/types/general\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { initiativeStore } from \"./store\";\r\nimport { gameManager } from \"../../manager\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n        draggable,\r\n    },\r\n})\r\nexport default class Initiative extends Vue {\r\n    visible = false;\r\n    visionLock = false;\r\n    cameraLock = false;\r\n    _activeTokens: string[] = [];\r\n\r\n    mounted() {\r\n        EventBus.$on(\"Initiative.Clear\", initiativeStore.clear);\r\n        EventBus.$on(\"Initiative.Remove\", (data: string) => this.removeInitiative(data));\r\n        EventBus.$on(\"Initiative.Show\", () => (this.visible = true));\r\n        EventBus.$on(\"Initiative.ForceUpdate\", () => this.$forceUpdate());\r\n\r\n        socket.on(\"Initiative.Set\", initiativeStore.setData);\r\n        socket.on(\"Initiative.Turn.Set\", (data: string) => this.setTurn(data));\r\n        socket.on(\"Initiative.Turn.Update\", (data: string) => this.updateTurn(data, false));\r\n        socket.on(\"Initiative.Round.Update\", (data: number) => this.setRound(data, false));\r\n        socket.on(\"Initiative.Effect.New\", (data: { actor: string; effect: InitiativeEffect }) => {\r\n            const actor = this.getActor(data.actor);\r\n            if (actor === undefined) return;\r\n            this.createEffect(actor, data.effect, false);\r\n        });\r\n        socket.on(\"Initiative.Effect.Update\", (data: { actor: string; effect: InitiativeEffect }) =>\r\n            this.updateEffect(data.actor, data.effect, false),\r\n        );\r\n    }\r\n\r\n    beforeDestroy() {\r\n        EventBus.$off(\"Initiative.Clear\");\r\n        EventBus.$off(\"Initiative.Remove\");\r\n        EventBus.$off(\"Initiative.Show\");\r\n    }\r\n\r\n    // Utilities\r\n    getActor(actorId: string) {\r\n        return initiativeStore.data.find(a => a.uuid === actorId);\r\n    }\r\n    owns(actor: InitiativeData): boolean {\r\n        if (gameStore.IS_DM) return true;\r\n        const shape = layerManager.UUIDMap.get(actor.uuid);\r\n        // Shapes that are unknown to this client are hidden from this client but owned by other clients\r\n        if (shape === undefined) return false;\r\n        return shape.owners.includes(gameStore.username);\r\n    }\r\n    getDefaultEffect() {\r\n        return { uuid: uuidv4(), name: \"New Effect\", turns: 10 };\r\n    }\r\n    fakeSetData(dataTransfer: DataTransfer) {\r\n        dataTransfer.setData(\"Hack\", \"\");\r\n    }\r\n    // Events\r\n    removeInitiative(uuid: string) {\r\n        const d = initiativeStore.data.findIndex(a => a.uuid === uuid);\r\n        if (d < 0 || initiativeStore.data[d].group) return;\r\n        initiativeStore.syncInitiative({ uuid });\r\n        // Remove highlight\r\n        const shape = layerManager.UUIDMap.get(uuid);\r\n        if (shape === undefined) return;\r\n        if (shape.showHighlight) {\r\n            shape.showHighlight = false;\r\n            layerManager.getLayer(shape.layer)!.invalidate(true);\r\n        }\r\n    }\r\n    updateOrder() {\r\n        if (!gameStore.IS_DM) return;\r\n        socket.emit(\"Initiative.Set\", initiativeStore.data.map(d => d.uuid));\r\n    }\r\n    updateTurn(actorId: string | null, sync: boolean) {\r\n        if (!gameStore.IS_DM && sync) return;\r\n        initiativeStore.currentActor = actorId;\r\n        const actor = initiativeStore.data.find(a => a.uuid === actorId);\r\n        if (actor === undefined) return;\r\n        if (actor.effects) {\r\n            for (let e = actor.effects.length - 1; e >= 0; e--) {\r\n                if (actor.effects[e].turns <= 0) actor.effects.splice(e, 1);\r\n                else actor.effects[e].turns--;\r\n            }\r\n        }\r\n        if (this.visionLock) {\r\n            if (actorId !== null && gameStore.ownedtokens.includes(actorId)) gameStore.setActiveTokens([actorId]);\r\n            else gameStore.setActiveTokens([]);\r\n        }\r\n        if (this.cameraLock) {\r\n            if (actorId !== null) {\r\n                const shape = layerManager.UUIDMap.get(actorId);\r\n                if (shape !== undefined && shape.ownedBy()) {\r\n                    gameManager.setCenterPosition(shape.center());\r\n                }\r\n            }\r\n        }\r\n        if (sync) socket.emit(\"Initiative.Turn.Update\", actorId);\r\n    }\r\n    setRound(round: number, sync: boolean) {\r\n        if (!gameStore.IS_DM && sync) return;\r\n        initiativeStore.setRoundCounter(round);\r\n        if (sync) socket.emit(\"Initiative.Round.Update\", round);\r\n    }\r\n    setTurn(actorId: string | null) {\r\n        initiativeStore.setTurn(actorId);\r\n    }\r\n    nextTurn() {\r\n        if (!gameStore.IS_DM) return;\r\n        const order = initiativeStore.data;\r\n        const next = order[(order.findIndex(a => a.uuid === initiativeStore.currentActor) + 1) % order.length];\r\n        if (initiativeStore.data[0].uuid === next.uuid) this.setRound(initiativeStore.roundCounter + 1, true);\r\n        this.updateTurn(next.uuid, true);\r\n    }\r\n    toggleHighlight(actor: InitiativeData, show: boolean) {\r\n        const shape = layerManager.UUIDMap.get(actor.uuid);\r\n        if (shape === undefined) return;\r\n        shape.showHighlight = show;\r\n        layerManager.getLayer(shape.layer)!.invalidate(true);\r\n    }\r\n    toggleOption(actor: InitiativeData, option: \"visible\" | \"group\") {\r\n        if (!this.owns(actor)) return;\r\n        actor[option] = !actor[option];\r\n        initiativeStore.syncInitiative(actor);\r\n    }\r\n    createEffect(actor: InitiativeData, effect: InitiativeEffect, sync: boolean) {\r\n        if (!this.owns(actor)) return;\r\n        actor.effects.push(effect);\r\n        if (sync) socket.emit(\"Initiative.Effect.New\", { actor: actor.uuid, effect });\r\n    }\r\n    syncEffect(actor: InitiativeData, effect: InitiativeEffect) {\r\n        if (!this.owns(actor)) return;\r\n        socket.emit(\"Initiative.Effect.Update\", { actor: actor.uuid, effect });\r\n    }\r\n    updateEffect(actorId: string, effect: InitiativeEffect, sync: boolean) {\r\n        const actor = initiativeStore.data.find(a => a.uuid === actorId);\r\n        if (actor === undefined) return;\r\n        const effectIndex = actor.effects.findIndex(e => e.uuid === effect.uuid);\r\n        if (effectIndex === undefined) return;\r\n        actor.effects[effectIndex] = effect;\r\n        if (sync) this.syncEffect(actor, effect);\r\n        else this.$forceUpdate();\r\n    }\r\n    toggleVisionLock() {\r\n        this.visionLock = !this.visionLock;\r\n        if (this.visionLock) {\r\n            this._activeTokens = [...gameStore._activeTokens];\r\n            if (initiativeStore.currentActor !== null && gameStore.ownedtokens.includes(initiativeStore.currentActor))\r\n                gameStore.setActiveTokens([initiativeStore.currentActor]);\r\n        } else {\r\n            gameStore.setActiveTokens(this._activeTokens);\r\n        }\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./initiative.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./initiative.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./initiative.vue?vue&type=template&id=6bbba6d3&scoped=true&\"\nimport script from \"./initiative.vue?vue&type=script&lang=ts&\"\nexport * from \"./initiative.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./initiative.vue?vue&type=style&index=0&id=6bbba6d3&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6bbba6d3\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Modal',{attrs:{\"visible\":_vm.visible,\"mask\":false},on:{\"close\":function($event){_vm.visible = false}},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_c('div',[_vm._v(\"Label manager\")]),_c('div',{staticClass:\"header-close\",on:{\"click\":function($event){_vm.visible = false}}},[_c('i',{staticClass:\"far fa-window-close\"})])])}}])},[_c('div',{staticClass:\"modal-body\"},[_c('div',{staticClass:\"grid\"},[_c('div',{staticClass:\"header\"},[_c('abbr',{attrs:{\"title\":\"Category\"}},[_vm._v(\"Cat.\")])]),_c('div',{staticClass:\"header name\"},[_vm._v(\"Name\")]),_c('div',{staticClass:\"header\"},[_c('abbr',{attrs:{\"title\":\"Visible\"}},[_vm._v(\"Vis.\")])]),_c('div',{staticClass:\"header\"},[_c('abbr',{attrs:{\"title\":\"Delete\"}},[_vm._v(\"Del.\")])]),_c('div',{staticClass:\"separator spanrow\",staticStyle:{\"margin\":\"0 0 7px\"}}),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.search),expression:\"search\"}],ref:\"search\",staticClass:\"spanrow\",attrs:{\"type\":\"text\",\"placeholder\":\"search\"},domProps:{\"value\":(_vm.search)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.search=$event.target.value}}})]),_c('div',{staticClass:\"grid scroll\"},[_vm._l((_vm.categories),function(category){return [_vm._l((_vm.labels[category]),function(label){return [_c('div',{key:'row-' + label.uuid,staticClass:\"row\",on:{\"click\":function($event){return _vm.selectLabel(label.uuid)}}},[(label.category)?[_c('div',{key:'cat-' + label.uuid},[_vm._v(_vm._s(label.category))]),_c('div',{key:'name-' + label.uuid,staticClass:\"name\"},[_vm._v(_vm._s(label.name))])]:_vm._e(),(!label.category)?[_c('div',{key:'cat-' + label.uuid}),_c('div',{key:'name-' + label.uuid,staticClass:\"name\"},[_vm._v(_vm._s(label.name))])]:_vm._e(),_c('div',{key:'visible-' + label.uuid,class:{ 'lower-opacity': !label.visible },style:({ textAlign: 'center' }),on:{\"click\":function($event){$event.stopPropagation();return _vm.toggleVisibility(label)}}},[_c('i',{staticClass:\"fas fa-eye\"})]),_c('div',{key:'delete-' + label.uuid,on:{\"click\":function($event){$event.stopPropagation();return _vm.deleteLabel(label.uuid)}}},[_c('i',{staticClass:\"fas fa-trash-alt\"})])],2)]})]}),(_vm.labels.length === 0)?[_c('div',{attrs:{\"id\":\"no-labels\"}},[_vm._v(\"No labels exist yet\")])]:_vm._e()],2),_c('div',{staticClass:\"grid\"},[_c('div',{staticClass:\"separator spanrow\"}),_c('input',{directives:[{name:\"model\",rawName:\"v-model.trim\",value:(_vm.newCategory),expression:\"newCategory\",modifiers:{\"trim\":true}}],attrs:{\"type\":\"text\"},domProps:{\"value\":(_vm.newCategory)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.newCategory=$event.target.value.trim()},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('input',{directives:[{name:\"model\",rawName:\"v-model.trim\",value:(_vm.newName),expression:\"newName\",modifiers:{\"trim\":true}}],attrs:{\"type\":\"text\"},domProps:{\"value\":(_vm.newName)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.newName=$event.target.value.trim()},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('button',{attrs:{\"id\":\"addLabelButton\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.addLabel($event)}}},[_vm._v(\"Add\")])])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\nimport { uuidv4 } from \"@/core/utils\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n    },\r\n})\r\nexport default class LabelManager extends Vue {\r\n    visible = false;\r\n    newCategory = \"\";\r\n    newName = \"\";\r\n    search = \"\";\r\n\r\n    mounted() {\r\n        EventBus.$on(\"LabelManager.Open\", () => {\r\n            this.visible = true;\r\n            this.newCategory = \"\";\r\n            this.newName = \"\";\r\n            this.$nextTick(() => (<HTMLInputElement>this.$refs.search).focus());\r\n        });\r\n    }\r\n\r\n    beforeDestroy() {\r\n        EventBus.$off(\"LabelManager.Open\");\r\n    }\r\n\r\n    get labels() {\r\n        const cat: { [category: string]: Label[] } = { \"\": [] };\r\n        for (const uuid of Object.keys(gameStore.labels)) {\r\n            const label = gameStore.labels[uuid];\r\n            if (\r\n                this.search.length &&\r\n                `${label.category.toLowerCase()}${label.name.toLowerCase()}`.search(this.search.toLowerCase()) < 0\r\n            )\r\n                continue;\r\n            if (label.user !== gameStore.username) continue;\r\n            if (!label.category) cat[\"\"].push(label);\r\n            else {\r\n                if (!(label.category in cat)) cat[label.category] = [];\r\n                cat[label.category].push(label);\r\n                cat[label.category].sort((a, b) => a.name.localeCompare(b.name));\r\n            }\r\n        }\r\n        return cat;\r\n    }\r\n\r\n    get categories() {\r\n        return Object.keys(this.labels).sort();\r\n    }\r\n\r\n    selectLabel(label: string) {\r\n        EventBus.$emit(\"EditDialog.AddLabel\", label);\r\n        this.visible = false;\r\n    }\r\n\r\n    toggleVisibility(label: Label) {\r\n        label.visible = !label.visible;\r\n        socket.emit(\"Label.Visibility.Set\", { uuid: label.uuid, visible: label.visible });\r\n    }\r\n\r\n    addLabel() {\r\n        if (this.newName === \"\") return;\r\n        const label = {\r\n            uuid: uuidv4(),\r\n            category: this.newCategory,\r\n            name: this.newName,\r\n            visible: false,\r\n            user: gameStore.username,\r\n        };\r\n        gameStore.addLabel(label);\r\n        socket.emit(\"Label.Add\", label);\r\n        this.newCategory = \"\";\r\n        this.newName = \"\";\r\n    }\r\n\r\n    deleteLabel(uuid: string) {\r\n        gameStore.deleteLabel({ uuid, user: gameStore.username });\r\n        socket.emit(\"Label.Delete\", uuid);\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./labels.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./labels.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./labels.vue?vue&type=template&id=3261513c&scoped=true&\"\nimport script from \"./labels.vue?vue&type=script&lang=ts&\"\nexport * from \"./labels.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./labels.vue?vue&type=style&index=0&id=3261513c&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3261513c\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"menuContainer\"}},[_c('div',{ref:\"rm\",style:({\n            left: _vm.visible.settings ? '200px' : '0',\n            top: _vm.visible.locations ? '100px' : '0',\n        }),attrs:{\"id\":\"radialmenu\"}},[_c('div',{staticClass:\"rm-wrapper\"},[_c('div',{staticClass:\"rm-toggler\"},[_c('ul',{staticClass:\"rm-list\",class:{ 'rm-list-dm': _vm.IS_DM }},[(_vm.IS_DM)?_c('li',{staticClass:\"rm-item\",attrs:{\"id\":\"rm-locations\"},on:{\"click\":function($event){_vm.visible.locations = !_vm.visible.locations}}},[_vm._m(0)]):_vm._e(),_c('li',{staticClass:\"rm-item\",attrs:{\"id\":\"rm-settings\"},on:{\"click\":function($event){_vm.visible.settings = !_vm.visible.settings}}},[_vm._m(1)])])]),_vm._m(2)])]),_c('transition',{attrs:{\"name\":\"settings\"},on:{\"enter\":function($event){_vm.$refs.rm.style.transition = 'left 500ms'}}},[(_vm.visible.settings)?_c('div',{ref:\"settings\",attrs:{\"id\":\"menu\"},on:{\"click\":_vm.settingsClick}},[_c('div',{staticStyle:{\"width\":\"200px\",\"height\":\"90%\",\"overflow-y\":\"auto\",\"overflow-x\":\"hidden\"}},[(_vm.IS_DM)?[_c('button',{staticClass:\"menu-accordion\"},[_vm._v(\"Assets\")]),_c('div',{staticClass:\"menu-accordion-panel\"},[_c('a',{staticClass:\"actionButton\",attrs:{\"href\":\"/assets\",\"target\":\"blank\",\"title\":\"Open asset manager\"}},[_c('i',{staticClass:\"fas fa-external-link-alt\"})]),_c('div',{staticClass:\"directory\",attrs:{\"id\":\"menu-tokens\"}},[_c('asset-node',{attrs:{\"asset\":_vm.assets}}),(!_vm.assets)?_c('div',[_vm._v(\"No assets\")]):_vm._e()],1)]),_c('button',{staticClass:\"menu-accordion\"},[_vm._v(\"Notes\")]),_c('div',{staticClass:\"menu-accordion-panel\"},[_c('div',{staticClass:\"menu-accordion-subpanel\",attrs:{\"id\":\"menu-notes\"}},[_c('a',{staticClass:\"actionButton\",on:{\"click\":_vm.createNote}},[_c('i',{staticClass:\"far fa-plus-square\"})]),_vm._l((_vm.notes),function(note){return _c('div',{key:note.uuid,staticStyle:{\"cursor\":\"pointer\"},on:{\"click\":function($event){return _vm.openNote(note)}}},[_vm._v(\"\\n                                \"+_vm._s(note.title || \"[?]\")+\"\\n                            \")])}),(!_vm.notes.length)?_c('div',[_vm._v(\"No notes\")]):_vm._e()],2)]),_c('button',{staticClass:\"menu-accordion\",on:{\"click\":_vm.openDmSettings}},[_vm._v(\"DM Options\")])]:_vm._e(),_c('button',{staticClass:\"menu-accordion\"},[_vm._v(\"Client Options\")]),_c('div',{staticClass:\"menu-accordion-panel\"},[_c('div',{staticClass:\"menu-accordion-subpanel\"},[_c('label',{attrs:{\"for\":\"gridColour\"}},[_vm._v(\"Grid Colour:\")]),_c('color-picker',{attrs:{\"id\":\"gridColour\",\"color\":_vm.gridColour},on:{\"update:color\":function($event){_vm.gridColour=$event}}}),_c('label',{attrs:{\"for\":\"fowColour\"}},[_vm._v(\"FOW Colour:\")]),_c('color-picker',{attrs:{\"id\":\"fowColour\",\"color\":_vm.fowColour},on:{\"update:color\":function($event){_vm.fowColour=$event}}}),_c('label',{attrs:{\"for\":\"rulerColour\"}},[_vm._v(\"Ruler Colour:\")]),_c('color-picker',{attrs:{\"id\":\"rulerColour\",\"color\":_vm.rulerColour},on:{\"update:color\":function($event){_vm.rulerColour=$event}}})],1)])],2),_c('router-link',{staticClass:\"menu-accordion\",staticStyle:{\"text-decoration\":\"none\",\"display\":\"inline-block\",\"position\":\"absolute\",\"bottom\":\"0\"},attrs:{\"to\":\"/dashboard\"}},[_vm._v(\"\\n                Exit\\n            \")])],1):_vm._e()]),_c('transition',{attrs:{\"name\":\"locations\"},on:{\"enter\":function($event){_vm.$refs.rm.style.transition = 'top 500ms'}}},[(_vm.IS_DM && _vm.visible.locations)?_c('div',{attrs:{\"id\":\"locations-menu\"}},[_c('div',[_vm._l((_vm.locations),function(location){return _c('div',{key:location,on:{\"click\":function($event){return _vm.changeLocation(location)}}},[_vm._v(\"\\n                    \"+_vm._s(location)+\"\\n                \")])}),_c('div',{on:{\"click\":_vm.createLocation}},[_c('i',{staticClass:\"fas fa-plus\"})])],2)]):_vm._e()]),_c('img',{attrs:{\"id\":\"dragImage\"}})],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('a',{attrs:{\"href\":\"#\"}},[_c('i',{staticClass:\"far fa-compass\"})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('a',{attrs:{\"href\":\"#\"}},[_c('i',{staticClass:\"fas fa-cog\"})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',{staticClass:\"rm-topper\"},[_c('i',{staticClass:\"icon-share-alt\"})])}]\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"outer\",on:{\"click\":function($event){if($event.target !== $event.currentTarget){ return null; }return _vm.open($event)}}},[_c('div',{staticClass:\"current-color\",style:(_vm.transparent\n                ? 'background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)'\n                : 'background-color:' + _vm.color),on:{\"click\":function($event){if($event.target !== $event.currentTarget){ return null; }return _vm.open($event)}}}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.display),expression:\"display\"}],staticClass:\"mask\",on:{\"click\":function($event){if($event.target !== $event.currentTarget){ return null; }return _vm.closePicker($event)}}}),_c('chrome-picker',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.display),expression:\"display\"}],ref:\"chromePicker\",style:({ position: 'fixed', left: _vm.left + 'px', top: _vm.top + 'px', 'z-index': 9999 }),attrs:{\"value\":_vm.color,\"tabindex\":\"-1\"},on:{\"input\":_vm.updateColor}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport tinycolor from \"tinycolor2\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { Chrome } from \"vue-color\";\r\nimport { Prop } from \"vue-property-decorator\";\r\n\r\n@Component<ColorPicker>({\r\n    components: {\r\n        \"chrome-picker\": Chrome,\r\n    },\r\n})\r\nexport default class ColorPicker extends Vue {\r\n    @Prop(String) color!: string;\r\n    @Prop(Boolean) disabled!: boolean;\r\n\r\n    display = false;\r\n    left = 0;\r\n    top = 0;\r\n    transparent = false;\r\n\r\n    mounted() {\r\n        this.transparent = (<any>this.$refs.chromePicker).val.rgba.a === 0;\r\n        this.setPosition();\r\n    }\r\n\r\n    open() {\r\n        if (this.display || this.disabled) return; // click on the picker itself\r\n        this.setPosition();\r\n        this.display = true;\r\n        this.$nextTick(() => (<HTMLElement>this.$children[0].$el).focus());\r\n    }\r\n    updateColor(value: { rgba: { r: number; g: number; b: number; a: number } }) {\r\n        this.transparent = value.rgba.a === 0;\r\n        const newColor = tinycolor(value.rgba).toRgbString();\r\n        this.$emit(\"update:color\", newColor);\r\n        this.$emit(\"input\", newColor);\r\n    }\r\n    closePicker() {\r\n        this.display = false;\r\n        this.$emit(\"change\", this.color);\r\n    }\r\n    setPosition() {\r\n        const rect = this.$el.getBoundingClientRect();\r\n        // 224 is the width of the picker, 242 the height\r\n        if (rect.right + 224 > window.innerWidth) this.left = rect.left - 224;\r\n        else this.left = rect.right;\r\n        if (rect.bottom + 242 > window.innerHeight) this.top = rect.top - 242;\r\n        else this.top = rect.bottom;\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./colorpicker.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./colorpicker.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./colorpicker.vue?vue&type=template&id=24ff2c54&scoped=true&\"\nimport script from \"./colorpicker.vue?vue&type=script&lang=ts&\"\nexport * from \"./colorpicker.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./colorpicker.vue?vue&type=style&index=0&id=24ff2c54&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"24ff2c54\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ul',[_vm._l((_vm.folders),function(folder){return _c('li',{key:folder,staticClass:\"folder\",on:{\"click\":function($event){$event.stopPropagation();return _vm.toggle($event)}}},[_vm._v(\"\\n        \"+_vm._s(folder)+\"\\n        \"),_c('asset-node',{attrs:{\"asset\":_vm.asset[folder]}})],1)}),_vm._l((_vm.files),function(file){return _c('li',{key:file.name,staticClass:\"file draggable token\",attrs:{\"draggable\":\"true\"},on:{\"mouseover\":function($event){_vm.showImage = file.hash},\"mouseout\":function($event){_vm.showImage = null},\"dragstart\":function($event){return _vm.dragStart($event, '/static/assets/' + file.hash)}}},[_vm._v(\"\\n        \"+_vm._s(file.name)+\"\\n        \"),(_vm.showImage == file.hash)?_c('div',{staticClass:\"preview\"},[_c('img',{staticClass:\"asset-preview-image\",attrs:{\"src\":'/static/assets/' + file.hash}})]):_vm._e()])})],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport { Prop } from \"vue-property-decorator\";\r\n\r\nimport { AssetFile, AssetList } from \"@/core/comm/types\";\r\nimport { alphSort } from \"@/core/utils\";\r\n\r\n@Component({\r\n    name: \"asset-node\",\r\n})\r\nexport default class AssetNode extends Vue {\r\n    @Prop() asset!: AssetList;\r\n\r\n    showImage = null;\r\n    get folders(): string[] {\r\n        return Object.keys(this.asset)\r\n            .filter(el => ![\"__files\"].includes(el))\r\n            .sort(alphSort);\r\n    }\r\n\r\n    get files(): AssetFile[] {\r\n        if (this.asset.__files)\r\n            return (<AssetFile[]>this.asset.__files)\r\n                .concat()\r\n                .sort((a, b) => (a.name.toLowerCase() > b.name.toLowerCase() ? 1 : -1));\r\n        return [];\r\n    }\r\n\r\n    toggle(event: { target: HTMLElement }) {\r\n        // tslint:disable-next-line:prefer-for-of\r\n        for (let i = 0; i < event.target.children.length; i++) {\r\n            const el = <HTMLElement>event.target.children[i];\r\n            el.style.display = el.style.display === \"\" ? \"block\" : \"\";\r\n        }\r\n    }\r\n\r\n    dragStart(event: DragEvent, imageSource: string) {\r\n        this.showImage = null;\r\n        if (event === null || event.dataTransfer === null) return;\r\n        const img = (<HTMLElement>event.target).querySelector(\".preview\")!;\r\n        event.dataTransfer.setDragImage(img, 0, 0);\r\n        event.dataTransfer.setData(\"text/plain\", imageSource);\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./asset_node.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./asset_node.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./asset_node.vue?vue&type=template&id=03f9ac64&scoped=true&\"\nimport script from \"./asset_node.vue?vue&type=script&lang=ts&\"\nexport * from \"./asset_node.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./asset_node.vue?vue&type=style&index=0&id=03f9ac64&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"03f9ac64\",\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { mapState } from \"vuex\";\r\n\r\nimport ColorPicker from \"@/core/components/colorpicker.vue\";\r\nimport AssetNode from \"@/game/ui/menu/asset_node.vue\";\r\n\r\nimport { uuidv4 } from \"@/core/utils\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { Note } from \"@/game/comm/types/general\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { EventBus } from \"../../event-bus\";\r\nimport Game from \"../../game.vue\";\r\n\r\n@Component({\r\n    components: {\r\n        \"color-picker\": ColorPicker,\r\n        \"asset-node\": AssetNode,\r\n    },\r\n    computed: {\r\n        ...mapState(\"game\", [\"locations\", \"assets\", \"notes\"]),\r\n    },\r\n})\r\nexport default class MenuBar extends Vue {\r\n    visible = {\r\n        settings: false,\r\n        locations: false,\r\n    };\r\n\r\n    get IS_DM(): boolean {\r\n        return gameStore.IS_DM || gameStore.FAKE_PLAYER;\r\n    }\r\n    get gridColour(): string {\r\n        return gameStore.gridColour;\r\n    }\r\n    set gridColour(value: string) {\r\n        gameStore.setGridColour({ colour: value, sync: true });\r\n    }\r\n    get fowColour(): string {\r\n        return gameStore.fowColour;\r\n    }\r\n    set fowColour(value: string) {\r\n        gameStore.setFOWColour({ colour: value, sync: true });\r\n    }\r\n    get rulerColour(): string {\r\n        return gameStore.rulerColour;\r\n    }\r\n    set rulerColour(value: string) {\r\n        gameStore.setRulerColour({ colour: value, sync: true });\r\n    }\r\n    settingsClick(event: { target: HTMLElement }) {\r\n        if (event.target.classList.contains(\"menu-accordion\")) {\r\n            event.target.classList.toggle(\"menu-accordion-active\");\r\n            const next = <HTMLElement>event.target.nextElementSibling;\r\n            if (next !== null) next.style.display = next.style.display === \"\" ? \"block\" : \"\";\r\n        }\r\n    }\r\n    changeLocation(name: string) {\r\n        socket.emit(\"Location.Change\", name);\r\n    }\r\n    createLocation() {\r\n        (<Game>this.$parent.$parent).$refs.prompt.prompt(`New location name:`, `Create new location`).then(\r\n            (value: string) => {\r\n                socket.emit(\"Location.New\", value);\r\n            },\r\n            () => {},\r\n        );\r\n    }\r\n    createNote() {\r\n        const note = { title: \"New note\", text: \"\", uuid: uuidv4() };\r\n        gameStore.newNote({ note, sync: true });\r\n        this.openNote(note);\r\n    }\r\n    openNote(note: Note) {\r\n        (<Game>this.$parent.$parent).$refs.note.open(note);\r\n    }\r\n\r\n    openDmSettings() {\r\n        EventBus.$emit(\"DmSettings.Open\");\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./menu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./menu.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./menu.vue?vue&type=template&id=9190ff3e&scoped=true&\"\nimport script from \"./menu.vue?vue&type=script&lang=ts&\"\nexport * from \"./menu.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./menu.vue?vue&type=style&index=0&id=9190ff3e&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"9190ff3e\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.note !== null)?_c('modal',{attrs:{\"visible\":_vm.visible,\"mask\":false},on:{\"close\":function($event){_vm.visible = false}},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_c('span',{on:{\"click\":function($event){return _vm.$refs.title.select()}}},[_c('i',{staticClass:\"fas fa-pencil-alt\",staticStyle:{\"font-size\":\"15px\"}})]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.note.title),expression:\"note.title\"}],ref:\"title\",domProps:{\"value\":(_vm.note.title)},on:{\"change\":_vm.updateNote,\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.note, \"title\", $event.target.value)}}}),_c('div',{staticClass:\"header-close\",on:{\"click\":function($event){_vm.visible = false}}},[_c('i',{staticClass:\"far fa-window-close\"})])])}}],null,false,1320213373)},[_c('div',{staticClass:\"modal-body\"},[_c('textarea',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.note.text),expression:\"note.text\"}],ref:\"textarea\",style:({ height: _vm.calcHeight() }),domProps:{\"value\":(_vm.note.text)},on:{\"change\":_vm.updateNote,\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.note, \"text\", $event.target.value)}}})]),_c('div',{staticClass:\"modal-footer\"},[_c('button',{on:{\"click\":_vm.removeNote}},[_c('i',{staticClass:\"far fa-trash-alt\"}),_vm._v(\"\\n            Remove\\n        \")])])]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\nimport { Note } from \"@/game/comm/types/general\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport Game from \"../game.vue\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n    },\r\n})\r\nexport default class NoteDialog extends Vue {\r\n    visible = false;\r\n    note: Note | null = null;\r\n\r\n    open(note: Note) {\r\n        this.visible = true;\r\n        this.note = note;\r\n    }\r\n    calcHeight() {\r\n        if (this.$refs.textarea) {\r\n            const el = <HTMLElement>this.$refs.textarea;\r\n            el.style.height = \"auto\";\r\n            el.style.height = el.scrollHeight + \"px\";\r\n            // Using the return value without the above did not achieve what I want, so hey /shrug\r\n            return el.scrollHeight + \"px\";\r\n        }\r\n        return \"100px\";\r\n    }\r\n    updateNote() {\r\n        if (this.note) gameStore.updateNote({ note: this.note, sync: true });\r\n    }\r\n    removeNote() {\r\n        (<Game>this.$parent.$parent).$refs.confirm.open(\"Are you sure you wish to remove this?\").then(\r\n            (result: boolean) => {\r\n                if (result && this.note) {\r\n                    gameStore.removeNote({ note: this.note, sync: true });\r\n                    this.visible = false;\r\n                }\r\n            },\r\n            () => {},\r\n        );\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./note.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./note.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./note.vue?vue&type=template&id=2c1a0e9a&scoped=true&\"\nimport script from \"./note.vue?vue&type=script&lang=ts&\"\nexport * from \"./note.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./note.vue?vue&type=style&index=0&id=2c1a0e9a&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2c1a0e9a\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.shapes.length > 0),expression:\"shapes.length > 0\"}]},_vm._l((_vm.shapes),function(shape){return _c('div',{key:shape.uuid},[_c('div',{attrs:{\"id\":\"selection-menu\"}},[_c('div',{attrs:{\"id\":\"selection-edit-button\"},on:{\"click\":_vm.openEditDialog}},[_c('i',{staticClass:\"fas fa-edit\"})]),_c('div',{attrs:{\"id\":\"selection-name\"}},[_vm._v(_vm._s(shape.name))]),_c('div',{attrs:{\"id\":\"selection-trackers\"}},[_vm._l((_vm.visibleTrackers),function(tracker){return [_c('div',{key:'name-' + tracker.uuid},[_vm._v(_vm._s(tracker.name))]),_c('div',{key:'value-' + tracker.uuid,staticClass:\"selection-tracker-value\",on:{\"click\":function($event){return _vm.changeValue(tracker, false)}}},[(tracker.maxvalue === 0)?[_vm._v(\"\\n                            \"+_vm._s(tracker.value)+\"\\n                        \")]:[_vm._v(\"\\n                            \"+_vm._s(tracker.value)+\" / \"+_vm._s(tracker.maxvalue)+\"\\n                        \")]],2)]})],2),_c('div',{attrs:{\"id\":\"selection-auras\"}},[_vm._l((_vm.visibleAuras),function(aura){return [_c('div',{key:'name-' + aura.uuid},[_vm._v(_vm._s(aura.name))]),_c('div',{key:'value-' + aura.uuid,staticClass:\"selection-tracker-value\",on:{\"click\":function($event){return _vm.changeValue(aura, true)}}},[(aura.dim === 0)?[_vm._v(\"\\n                            \"+_vm._s(aura.value)+\"\\n                        \")]:[_vm._v(\"\\n                            \"+_vm._s(aura.value)+\" / \"+_vm._s(aura.dim)+\"\\n                        \")]],2)]})],2)]),_c('edit-dialog',{ref:\"editDialog\",refInFor:true,attrs:{\"shape\":shape}})],1)}),0)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Modal',{attrs:{\"visible\":_vm.visible,\"mask\":false},on:{\"close\":function($event){_vm.visible = false}},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_c('div',[_vm._v(\"Edit asset\")]),_c('div',{staticClass:\"header-close\",on:{\"click\":function($event){_vm.visible = false}}},[_c('i',{staticClass:\"far fa-window-close\"})])])}}])},[_c('div',{staticClass:\"modal-body\"},[_c('div',{staticClass:\"grid\"},[_c('label',{attrs:{\"for\":\"shapeselectiondialog-name\"}},[_vm._v(\"Name\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.shape.name),expression:\"shape.name\"}],staticStyle:{\"grid-column\":\"numerator / remove\"},attrs:{\"type\":\"text\",\"id\":\"shapeselectiondialog-name\",\"disabled\":!_vm.owned},domProps:{\"value\":(_vm.shape.name)},on:{\"change\":function($event){return _vm.updateShape(false)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.shape, \"name\", $event.target.value)}}}),_c('div',{style:({ opacity: _vm.shape.nameVisible ? 1.0 : 0.3, textAlign: 'center' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){_vm.shape.nameVisible = !_vm.shape.nameVisible;\n                    _vm.updateShape(false);}}},[_c('i',{staticClass:\"fas fa-eye\"})]),_c('label',{attrs:{\"for\":\"shapeselectiondialog-istoken\"}},[_vm._v(\"Is a token\")]),_c('input',{staticClass:\"styled-checkbox\",staticStyle:{\"grid-column-start\":\"remove\"},attrs:{\"type\":\"checkbox\",\"id\":\"shapeselectiondialog-istoken\",\"disabled\":!_vm.owned},domProps:{\"checked\":_vm.shape.isToken},on:{\"click\":_vm.setToken}}),_c('label',{attrs:{\"for\":\"shapeselectiondialog-visionblocker\"}},[_vm._v(\"Blocks vision/light\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.shape.visionObstruction),expression:\"shape.visionObstruction\"}],staticStyle:{\"grid-column-start\":\"remove\"},attrs:{\"type\":\"checkbox\",\"id\":\"shapeselectiondialog-visionblocker\",\"disabled\":!_vm.owned},domProps:{\"checked\":Array.isArray(_vm.shape.visionObstruction)?_vm._i(_vm.shape.visionObstruction,null)>-1:(_vm.shape.visionObstruction)},on:{\"change\":[function($event){var $$a=_vm.shape.visionObstruction,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.$set(_vm.shape, \"visionObstruction\", $$a.concat([$$v])))}else{$$i>-1&&(_vm.$set(_vm.shape, \"visionObstruction\", $$a.slice(0,$$i).concat($$a.slice($$i+1))))}}else{_vm.$set(_vm.shape, \"visionObstruction\", $$c)}},_vm.setVisionBlocker]}}),_c('label',{attrs:{\"for\":\"shapeselectiondialog-moveblocker\"}},[_vm._v(\"Blocks movement\")]),_c('input',{staticStyle:{\"grid-column-start\":\"remove\"},attrs:{\"type\":\"checkbox\",\"id\":\"shapeselectiondialog-moveblocker\",\"disabled\":!_vm.owned},domProps:{\"checked\":_vm.shape.movementObstruction},on:{\"click\":_vm.setMovementBlocker}}),_c('label',{attrs:{\"for\":\"shapeselectiondialog-strokecolour\"}},[_vm._v(\"Border colour\")]),_c('color-picker',{staticStyle:{\"grid-column-start\":\"remove\"},attrs:{\"color\":_vm.shape.strokeColour,\"disabled\":!_vm.owned},on:{\"update:color\":function($event){return _vm.$set(_vm.shape, \"strokeColour\", $event)},\"input\":function($event){return _vm.updateShape(true, true)},\"change\":function($event){return _vm.updateShape(true)}}}),_c('label',{attrs:{\"for\":\"shapeselectiondialog-fillcolour\"}},[_vm._v(\"Fill colour\")]),_c('color-picker',{staticStyle:{\"grid-column-start\":\"remove\"},attrs:{\"color\":_vm.shape.fillColour,\"disabled\":!_vm.owned},on:{\"update:color\":function($event){return _vm.$set(_vm.shape, \"fillColour\", $event)},\"input\":function($event){return _vm.updateShape(true, true)},\"change\":function($event){return _vm.updateShape(true)}}}),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Access\")]),_vm._l((_vm.shape.owners),function(owner){return [_c('input',{key:owner,staticStyle:{\"grid-column-start\":\"name\"},attrs:{\"type\":\"text\",\"placeholder\":\"name\",\"disabled\":!_vm.owned},domProps:{\"value\":owner},on:{\"change\":function($event){return _vm.updateOwner($event, owner)}}}),(owner !== '')?_c('div',{key:'remove-' + owner,style:({ opacity: _vm.owned ? 1.0 : 0.3, textAlign: 'center', gridColumnStart: 'remove' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){return _vm.removeOwner(owner)}}},[_c('i',{staticClass:\"fas fa-trash-alt\"})]):_vm._e()]}),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Trackers\")]),_vm._l((_vm.shape.trackers),function(tracker){return [_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(tracker.name),expression:\"tracker.name\"}],key:'name-' + tracker.uuid,staticStyle:{\"grid-column-start\":\"name\"},attrs:{\"type\":\"text\",\"placeholder\":\"name\",\"disabled\":!_vm.owned},domProps:{\"value\":(tracker.name)},on:{\"change\":function($event){return _vm.updateShape(false)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(tracker, \"name\", $event.target.value)}}}),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(tracker.value),expression:\"tracker.value\",modifiers:{\"number\":true}}],key:'value-' + tracker.uuid,attrs:{\"type\":\"text\",\"title\":\"Current value\",\"disabled\":!_vm.owned},domProps:{\"value\":(tracker.value)},on:{\"change\":function($event){return _vm.updateShape(false)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(tracker, \"value\", _vm._n($event.target.value))},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('span',{key:'fspan-' + tracker.uuid},[_vm._v(\"/\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(tracker.maxvalue),expression:\"tracker.maxvalue\",modifiers:{\"number\":true}}],key:'maxvalue-' + tracker.uuid,attrs:{\"type\":\"text\",\"title\":\"Current value\",\"disabled\":!_vm.owned},domProps:{\"value\":(tracker.maxvalue)},on:{\"change\":function($event){return _vm.updateShape(false)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(tracker, \"maxvalue\", _vm._n($event.target.value))},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('span',{key:'sspan-' + tracker.uuid}),_c('div',{key:'visibility-' + tracker.uuid,style:({ opacity: tracker.visible ? 1.0 : 0.3, textAlign: 'center' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){tracker.visible = !tracker.visible;\n                        _vm.updateShape(false);}}},[_c('i',{staticClass:\"fas fa-eye\"})]),_c('span',{key:'tspan-' + tracker.uuid}),(tracker.name !== '' || tracker.value !== 0)?_c('div',{key:'remove-' + tracker.uuid,style:({ opacity: _vm.owned ? 1.0 : 0.3, textAlign: 'center' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){return _vm.removeTracker(tracker.uuid)}}},[_c('i',{staticClass:\"fas fa-trash-alt\"})]):_vm._e()]}),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Auras\")]),_vm._l((_vm.shape.auras),function(aura){return [_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(aura.name),expression:\"aura.name\"}],key:'name-' + aura.uuid,staticStyle:{\"grid-column-start\":\"name\"},attrs:{\"type\":\"text\",\"placeholder\":\"name\",\"disabled\":!_vm.owned},domProps:{\"value\":(aura.name)},on:{\"change\":function($event){return _vm.updateShape(false)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(aura, \"name\", $event.target.value)}}}),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(aura.value),expression:\"aura.value\",modifiers:{\"number\":true}}],key:'value-' + aura.uuid,attrs:{\"type\":\"text\",\"title\":\"Current value\",\"disabled\":!_vm.owned},domProps:{\"value\":(aura.value)},on:{\"change\":function($event){return _vm.updateShape(true)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(aura, \"value\", _vm._n($event.target.value))},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('span',{key:'fspan-' + aura.uuid},[_vm._v(\"/\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(aura.dim),expression:\"aura.dim\",modifiers:{\"number\":true}}],key:'dimvalue-' + aura.uuid,attrs:{\"type\":\"text\",\"title\":\"Dim value\",\"disabled\":!_vm.owned},domProps:{\"value\":(aura.dim)},on:{\"change\":function($event){return _vm.updateShape(true)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(aura, \"dim\", _vm._n($event.target.value))},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('color-picker',{key:'colour-' + aura.uuid,attrs:{\"color\":aura.colour,\"disabled\":!_vm.owned},on:{\"update:color\":function($event){return _vm.$set(aura, \"colour\", $event)},\"input\":function($event){return _vm.updateAuraColour(aura, $event)},\"change\":function($event){return _vm.updateShape(true)}}}),_c('div',{key:'visibility-' + aura.uuid,style:({ opacity: aura.visible ? 1.0 : 0.3, textAlign: 'center' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){aura.visible = !aura.visible;\n                        _vm.updateShape(true);}}},[_c('i',{staticClass:\"fas fa-eye\"})]),_c('div',{key:'visionsource-' + aura.uuid,style:({ opacity: aura.visionSource ? 1.0 : 0.3, textAlign: 'center' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){return _vm.updateAuraVisionSource(aura)}}},[_c('i',{staticClass:\"fas fa-lightbulb\"})]),(aura.name !== '' || aura.value !== 0)?_c('div',{key:'remove-' + aura.uuid,style:({ opacity: _vm.owned ? 1.0 : 0.3, textAlign: 'center' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){return _vm.removeAura(aura.uuid)}}},[_c('i',{staticClass:\"fas fa-trash-alt\"})]):_vm._e()]}),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Labels\")]),_c('div',{staticClass:\"spanrow\",attrs:{\"id\":\"labels\"}},[_vm._l((_vm.shape.labels),function(label){return _c('div',{key:label.uuid,staticClass:\"label\"},[(label.category)?[_c('div',{staticClass:\"label-user\"},[_vm._v(_vm._s(label.category))]),_c('div',{staticClass:\"label-main\",on:{\"click\":function($event){return _vm.removeLabel(label.uuid)}}},[_vm._v(_vm._s(label.name))])]:_vm._e(),(!label.category)?[_c('div',{staticClass:\"label-main\",on:{\"click\":function($event){return _vm.removeLabel(label.uuid)}}},[_vm._v(_vm._s(label.name))])]:_vm._e()],2)}),(_vm.owned)?_c('div',{staticClass:\"label\",attrs:{\"id\":\"label-add\"}},[_c('div',{staticClass:\"label-main\",on:{\"click\":_vm.openLabelManager}},[_vm._v(\"+\")])]):_vm._e()],2),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Annotation\")]),_c('textarea',{staticClass:\"spanrow\",attrs:{\"disabled\":!_vm.owned},domProps:{\"value\":_vm.shape.annotation},on:{\"change\":_vm.updateAnnotation}})],2)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { Prop } from \"vue-property-decorator\";\r\n\r\nimport ColorPicker from \"@/core/components/colorpicker.vue\";\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\nimport { uuidv4 } from \"@/core/utils\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n        \"color-picker\": ColorPicker,\r\n    },\r\n})\r\nexport default class EditDialog extends Vue {\r\n    @Prop() shape!: Shape;\r\n\r\n    visible = false;\r\n\r\n    get owned(): boolean {\r\n        return this.shape.ownedBy();\r\n    }\r\n\r\n    mounted() {\r\n        EventBus.$on(\"EditDialog.Open\", (shape: Shape) => {\r\n            this.shape = shape;\r\n            this.visible = true;\r\n        });\r\n        EventBus.$on(\"EditDialog.AddLabel\", (label: string) => {\r\n            if (this.visible) {\r\n                this.shape.labels.push(gameStore.labels[label]);\r\n                this.updateShape(true);\r\n            }\r\n        });\r\n    }\r\n\r\n    beforeDestroy() {\r\n        EventBus.$off(\"EditDialog.Open\");\r\n        EventBus.$off(\"EditDialog.AddLabel\");\r\n    }\r\n\r\n    updated() {\r\n        this.addEmpty();\r\n    }\r\n\r\n    addEmpty() {\r\n        if (this.shape.owners[this.shape.owners.length - 1] !== \"\") this.shape.addOwner(\"\");\r\n        if (\r\n            !this.shape.trackers.length ||\r\n            this.shape.trackers[this.shape.trackers.length - 1].name !== \"\" ||\r\n            this.shape.trackers[this.shape.trackers.length - 1].value !== 0\r\n        )\r\n            this.shape.trackers.push({ uuid: uuidv4(), name: \"\", value: 0, maxvalue: 0, visible: false });\r\n        if (\r\n            !this.shape.auras.length ||\r\n            this.shape.auras[this.shape.auras.length - 1].name !== \"\" ||\r\n            this.shape.auras[this.shape.auras.length - 1].value !== 0\r\n        )\r\n            this.shape.auras.push({\r\n                uuid: uuidv4(),\r\n                name: \"\",\r\n                value: 0,\r\n                dim: 0,\r\n                visionSource: false,\r\n                colour: \"rgba(0,0,0,0)\",\r\n                visible: false,\r\n            });\r\n    }\r\n    updateShape(redraw: boolean, temporary = false) {\r\n        if (!this.owned) return;\r\n        socket.emit(\"Shape.Update\", { shape: this.shape.asDict(), redraw, temporary });\r\n        if (redraw) layerManager.invalidate();\r\n        this.addEmpty();\r\n    }\r\n    setToken(event: { target: HTMLInputElement }) {\r\n        if (!this.owned) return;\r\n        this.shape.setIsToken(event.target.checked);\r\n        this.updateShape(true);\r\n    }\r\n    setVisionBlocker(_event: { target: HTMLInputElement }) {\r\n        if (!this.owned) return;\r\n        this.shape.checkVisionSources();\r\n        this.updateShape(true);\r\n    }\r\n    setMovementBlocker(event: { target: HTMLInputElement }) {\r\n        if (!this.owned) return;\r\n        this.shape.setMovementBlock(event.target.checked);\r\n        this.updateShape(false);\r\n    }\r\n    updateAnnotation(event: { target: HTMLInputElement }) {\r\n        if (!this.owned) return;\r\n        const hadAnnotation = this.shape.annotation !== \"\";\r\n        this.shape.annotation = event.target.value;\r\n        if (this.shape.annotation !== \"\" && !hadAnnotation) {\r\n            gameStore.annotations.push(this.shape.uuid);\r\n            if (layerManager.hasLayer(\"draw\")) layerManager.getLayer(\"draw\")!.invalidate(true);\r\n        } else if (this.shape.annotation === \"\" && hadAnnotation) {\r\n            gameStore.annotations.splice(gameStore.annotations.findIndex(an => an === this.shape.uuid));\r\n            if (layerManager.hasLayer(\"draw\")) layerManager.getLayer(\"draw\")!.invalidate(true);\r\n        }\r\n        this.updateShape(false);\r\n    }\r\n    updateOwner(event: { target: HTMLInputElement }, oldValue: string) {\r\n        if (!this.owned) return;\r\n        this.shape.updateOwner(oldValue, event.target.value);\r\n        this.updateShape(gameStore.fowLOS);\r\n    }\r\n    removeOwner(value: string) {\r\n        if (!this.owned) return;\r\n        this.shape.removeOwner(value);\r\n        this.updateShape(gameStore.fowLOS);\r\n    }\r\n    removeTracker(uuid: string) {\r\n        if (!this.owned) return;\r\n        this.shape.trackers = this.shape.trackers.filter(tr => tr.uuid !== uuid);\r\n        this.updateShape(false);\r\n    }\r\n    removeAura(uuid: string) {\r\n        if (!this.owned) return;\r\n        this.shape.auras = this.shape.auras.filter(au => au.uuid !== uuid);\r\n        this.shape.checkVisionSources();\r\n        this.updateShape(true);\r\n    }\r\n    updateAuraVisionSource(aura: Aura) {\r\n        if (!this.owned) return;\r\n        aura.visionSource = !aura.visionSource;\r\n        const i = gameStore.visionSources.findIndex(ls => ls.aura === aura.uuid);\r\n        if (aura.visionSource && i === -1) gameStore.visionSources.push({ shape: this.shape.uuid, aura: aura.uuid });\r\n        else if (!aura.visionSource && i >= 0) gameStore.visionSources.splice(i, 1);\r\n        this.updateShape(true);\r\n    }\r\n    updateAuraColour(aura: Aura, _colour: string) {\r\n        if (!this.owned) return;\r\n        const layer = layerManager.getLayer(this.shape.layer);\r\n        if (layer === undefined) return;\r\n        layer.invalidate(!aura.visionSource);\r\n    }\r\n    openLabelManager() {\r\n        EventBus.$emit(\"LabelManager.Open\");\r\n    }\r\n    removeLabel(uuid: string) {\r\n        if (!this.owned) return;\r\n        this.shape.labels = this.shape.labels.filter(l => l.uuid !== uuid);\r\n        this.updateShape(true);\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./edit_dialog.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./edit_dialog.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./edit_dialog.vue?vue&type=template&id=40314b6e&scoped=true&\"\nimport script from \"./edit_dialog.vue?vue&type=script&lang=ts&\"\nexport * from \"./edit_dialog.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./edit_dialog.vue?vue&type=style&index=0&id=40314b6e&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"40314b6e\",\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport EditDialog from \"@/game/ui/selection/edit_dialog.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport Game from \"../../game.vue\";\r\n\r\n@Component({\r\n    components: {\r\n        \"edit-dialog\": EditDialog,\r\n    },\r\n})\r\nexport default class SelectionInfo extends Vue {\r\n    shape: Shape | null = null;\r\n\r\n    mounted() {\r\n        EventBus.$on(\"SelectionInfo.Shape.Set\", (shape: Shape | null) => {\r\n            this.shape = shape;\r\n        });\r\n    }\r\n\r\n    get shapes() {\r\n        if (this.shape === null) return [];\r\n        return [this.shape];\r\n    }\r\n\r\n    get visibleTrackers() {\r\n        if (this.shape === null) return [];\r\n        return this.shape.trackers.filter(tr => tr.name !== \"\" || tr.value !== 0);\r\n    }\r\n\r\n    get visibleAuras() {\r\n        if (this.shape === null) return [];\r\n        return this.shape.auras.filter(au => au.name !== \"\" || au.value !== 0);\r\n    }\r\n\r\n    beforeDestroy() {\r\n        EventBus.$off(\"SelectionInfo.Shape.Set\");\r\n    }\r\n\r\n    openEditDialog() {\r\n        (<any>this.$refs.editDialog).visible = true;\r\n    }\r\n    changeValue(object: Tracker | Aura, redraw: boolean) {\r\n        if (this.shape === null) return;\r\n        (<Game>this.$parent.$parent).$refs.prompt.prompt(`New  ${object.name} value:`, `Updating ${object.name}`).then(\r\n            (value: string) => {\r\n                if (this.shape === null) return;\r\n                const ogValue = object.value;\r\n                if (value[0] === \"+\" || value[0] === \"-\") object.value += parseInt(value, 10);\r\n                else object.value = parseInt(value, 10);\r\n                if (isNaN(object.value)) object.value = ogValue;\r\n                socket.emit(\"Shape.Update\", { shape: this.shape.asDict(), redraw, temporary: false });\r\n                if (redraw) layerManager.invalidate();\r\n            },\r\n            () => {},\r\n        );\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection_info.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection_info.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./selection_info.vue?vue&type=template&id=4ce4ab65&scoped=true&\"\nimport script from \"./selection_info.vue?vue&type=script&lang=ts&\"\nexport * from \"./selection_info.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./selection_info.vue?vue&type=style&index=0&id=4ce4ab65&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4ce4ab65\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{attrs:{\"id\":\"toolselect\"}},[_c('ul',_vm._l((_vm.visibleTools),function(tool){return _c('li',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.toolVisible(tool)),expression:\"toolVisible(tool)\"}],key:tool,ref:tool + '-selector',refInFor:true,class:{ 'tool-selected': _vm.currentTool === tool },on:{\"mousedown\":function($event){_vm.currentTool = tool}}},[_c('a',{attrs:{\"href\":\"#\"}},[_vm._v(_vm._s(tool))])])}),0)]),_c('div',[[_c('select-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Select'),expression:\"currentTool === 'Select'\"}],ref:\"selectTool\"}),_c('pan-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Pan'),expression:\"currentTool === 'Pan'\"}]}),_c('keep-alive',[_c('draw-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Draw'),expression:\"currentTool === 'Draw'\"}]})],1),_c('ruler-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Ruler'),expression:\"currentTool === 'Ruler'\"}]}),_c('map-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Map'),expression:\"currentTool === 'Map'\"}]}),_c('filter-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Filter'),expression:\"currentTool === 'Filter'\"}]}),_c('vision-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Vision'),expression:\"currentTool === 'Vision'\"}]}),_c('shape-menu',{ref:\"shapecontext\"}),_c('createtoken-dialog',{ref:\"createtokendialog\"})]],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.getActiveLayer() !== undefined)?_c('ContextMenu',{attrs:{\"visible\":_vm.visible,\"left\":_vm.x + 'px',\"top\":_vm.y + 'px'},on:{\"close\":_vm.close}},[(_vm.getLayers().length > 1)?_c('li',[_vm._v(\"\\n        Layer\\n        \"),_c('ul',_vm._l((_vm.getLayers()),function(layer){return _c('li',{key:layer.name,style:([_vm.getActiveLayer().name === layer.name ? { 'background-color': '#82c8a0' } : {}]),on:{\"click\":function($event){return _vm.setLayer(layer.name)}}},[_vm._v(\"\\n                \"+_vm._s(layer.name)+\"\\n            \")])}),0)]):_vm._e(),_c('li',{on:{\"click\":_vm.moveToBack}},[_vm._v(\"Move to back\")]),_c('li',{on:{\"click\":_vm.moveToFront}},[_vm._v(\"Move to front\")]),_c('li',{on:{\"click\":_vm.addInitiative}},[_vm._v(_vm._s(_vm.getInitiativeWord())+\" initiative\")]),_c('li',{on:{\"click\":_vm.openEditDialog}},[_vm._v(\"Show properties\")])]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { initiativeStore } from \"./store\";\n\nexport function inInitiative(uuid: string): boolean {\n    return initiativeStore.data.some(d => d.uuid === uuid);\n}\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport ContextMenu from \"@/core/components/contextmenu.vue\";\r\n\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { initiativeStore } from \"../initiative/store\";\r\nimport { inInitiative } from \"../initiative/utils\";\r\n\r\n@Component({\r\n    components: {\r\n        ContextMenu,\r\n    },\r\n})\r\nexport default class ShapeContext extends Vue {\r\n    visible = false;\r\n    x = 0;\r\n    y = 0;\r\n    shape: Shape | null = null;\r\n    get activeLayer(): string {\r\n        const layer = layerManager.getLayer();\r\n        return layer === undefined ? \"\" : layer.name;\r\n    }\r\n    open(event: MouseEvent, shape: Shape) {\r\n        this.visible = true;\r\n        this.x = event.pageX;\r\n        this.y = event.pageY;\r\n        this.shape = shape;\r\n        this.$nextTick(() => (<HTMLElement>this.$children[0].$el).focus());\r\n    }\r\n    close() {\r\n        this.visible = false;\r\n        this.shape = null;\r\n    }\r\n    getLayers() {\r\n        return layerManager.layers.filter(l => l.selectable && (gameStore.IS_DM || l.playerEditable));\r\n    }\r\n    getActiveLayer() {\r\n        return layerManager.getLayer();\r\n    }\r\n    getInitiativeWord() {\r\n        if (this.shape === null) return \"\";\r\n        return inInitiative(this.shape.uuid) ? \"Show\" : \"Add\";\r\n    }\r\n    setLayer(newLayer: string) {\r\n        if (this.shape === null) return;\r\n        this.shape.moveLayer(newLayer, true);\r\n        this.close();\r\n    }\r\n    moveToBack() {\r\n        if (this.shape === null) return;\r\n        const layer = this.getActiveLayer()!;\r\n        layer.moveShapeOrder(this.shape, 0, true);\r\n        this.close();\r\n    }\r\n    moveToFront() {\r\n        if (this.shape === null) return;\r\n        const layer = this.getActiveLayer()!;\r\n        layer.moveShapeOrder(this.shape, layer.shapes.length - 1, true);\r\n        this.close();\r\n    }\r\n    addInitiative() {\r\n        if (this.shape === null) return;\r\n        this.$parent.$parent.$parent;\r\n        if (!inInitiative(this.shape.uuid)) initiativeStore.addInitiative(this.shape.getInitiativeRepr());\r\n        EventBus.$emit(\"Initiative.Show\");\r\n        this.close();\r\n    }\r\n    openEditDialog() {\r\n        EventBus.$emit(\"EditDialog.Open\", this.shape);\r\n        this.close();\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./shapecontext.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./shapecontext.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./shapecontext.vue?vue&type=template&id=d6c7d844&scoped=true&\"\nimport script from \"./shapecontext.vue?vue&type=script&lang=ts&\"\nexport * from \"./shapecontext.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./shapecontext.vue?vue&type=style&index=0&id=d6c7d844&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"d6c7d844\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('modal',{attrs:{\"visible\":_vm.visible},on:{\"close\":function($event){_vm.visible = false}},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_vm._v(\"\\n        Create basic token\\n    \")])}}])},[_c('div',{staticClass:\"modal-body\"},[_c('label',{attrs:{\"for\":\"createtokendialog-text\"}},[_vm._v(\"Text\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.text),expression:\"text\"}],attrs:{\"type\":\"text\",\"id\":\"createtokendialog-name\"},domProps:{\"value\":(_vm.text)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.text=$event.target.value}}}),_c('label',[_vm._v(\"Colours\")]),_c('div',{staticClass:\"colours\"},[_c('span',[_vm._v(\"Fill:\")]),_c('color-picker',{attrs:{\"color\":_vm.fillColour},on:{\"update:color\":function($event){_vm.fillColour=$event}}}),_c('span',[_vm._v(\"Border:\")]),_c('color-picker',{attrs:{\"color\":_vm.borderColour},on:{\"update:color\":function($event){_vm.borderColour=$event}}})],1),_c('canvas',{ref:\"canvas\",attrs:{\"width\":\"100px\",\"height\":\"100px\"}})]),_c('div',{staticClass:\"modal-footer\"},[_c('button',{on:{\"click\":_vm.submit}},[_vm._v(\"Submit\")])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport * as tinycolor from \"tinycolor2\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { mapState } from \"vuex\";\r\n\r\nimport ColorPicker from \"@/core/components/colorpicker.vue\";\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\nimport { calcFontScale } from \"@/core/utils\";\r\nimport { LocalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { CircularToken } from \"@/game/shapes/circulartoken\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { getUnitDistance, l2g } from \"@/game/units\";\r\nimport { Watch } from \"vue-property-decorator\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n        \"color-picker\": ColorPicker,\r\n    },\r\n    computed: {\r\n        ...mapState(\"game\", [\"unitSize\"]),\r\n    },\r\n})\r\nexport default class CreateTokenModal extends Vue {\r\n    x = 0;\r\n    y = 0;\r\n    visible = false;\r\n    text = \"X\";\r\n    fillColour = \"rgba(255, 255, 255, 1)\";\r\n    borderColour = \"rgba(0, 0, 0, 1)\";\r\n\r\n    mounted() {\r\n        this.updatePreview();\r\n    }\r\n\r\n    @Watch(\"text\")\r\n    onTextChange(_newValue: string, _oldValue: string) {\r\n        this.updatePreview();\r\n    }\r\n    @Watch(\"fillColour\")\r\n    onFillChange(_newValue: string, _oldValue: string) {\r\n        this.updatePreview();\r\n    }\r\n    @Watch(\"borderColour\")\r\n    onBorderChange(_newValue: string, _oldValue: string) {\r\n        this.updatePreview();\r\n    }\r\n\r\n    open(x: number, y: number) {\r\n        this.visible = true;\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n    submit() {\r\n        const layer = layerManager.getLayer();\r\n        if (layer === undefined) return;\r\n        const token = new CircularToken(\r\n            l2g(new LocalPoint(this.x, this.y)),\r\n            getUnitDistance(gameStore.unitSize / 2),\r\n            this.text,\r\n            \"10px serif\",\r\n            this.fillColour,\r\n            this.borderColour,\r\n        );\r\n        token.addOwner(gameStore.username);\r\n        layer.addShape(token, true);\r\n        layer.invalidate(false);\r\n        this.visible = false;\r\n    }\r\n    updatePreview() {\r\n        const ctx = (<HTMLCanvasElement>this.$refs.canvas).getContext(\"2d\")!;\r\n        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.beginPath();\r\n        const dest = { x: ctx.canvas.width / 2, y: ctx.canvas.height / 2 };\r\n        const r = Math.min(dest.x, dest.y) * 0.9;\r\n\r\n        ctx.fillStyle = this.fillColour;\r\n\r\n        ctx.arc(dest.x, dest.y, r, 0, 2 * Math.PI);\r\n        ctx.fill();\r\n        if (this.borderColour !== \"rgba(0, 0, 0, 0)\") {\r\n            ctx.beginPath();\r\n            ctx.lineWidth = 5;\r\n            ctx.strokeStyle = this.borderColour;\r\n            ctx.arc(dest.x, dest.y, r, 0, 2 * Math.PI);\r\n            ctx.stroke();\r\n        }\r\n        ctx.save();\r\n        ctx.textAlign = \"center\";\r\n        ctx.textBaseline = \"middle\";\r\n        const xs = calcFontScale(ctx, this.text, r, r);\r\n        const ys = 0;\r\n        ctx.transform(xs, ys, -ys, xs, dest.x, dest.y);\r\n        ctx.fillStyle = tinycolor.mostReadable(this.fillColour, [\"#000\", \"#fff\"]).toHexString();\r\n        ctx.fillText(this.text, 0, 0);\r\n        ctx.restore();\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./createtoken_modal.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./createtoken_modal.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./createtoken_modal.vue?vue&type=template&id=bf063922&scoped=true&\"\nimport script from \"./createtoken_modal.vue?vue&type=script&lang=ts&\"\nexport * from \"./createtoken_modal.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./createtoken_modal.vue?vue&type=style&index=0&id=bf063922&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"bf063922\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.selected)?_c('div',{staticClass:\"tool-detail\",style:({ '--detailRight': _vm.detailRight, '--detailArrow': _vm.detailArrow })},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.IS_DM),expression:\"IS_DM\"}]},[_vm._v(\"Mode\")]),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.IS_DM),expression:\"IS_DM\"}],staticClass:\"selectgroup\"},_vm._l((_vm.modes),function(mode){return _c('div',{key:mode,staticClass:\"option\",class:{ 'option-selected': _vm.modeSelect === mode },on:{\"click\":function($event){_vm.modeSelect = mode}}},[_vm._v(\"\\n            \"+_vm._s(mode)+\"\\n        \")])}),0),_c('div',[_vm._v(\"Shape\")]),_c('div',{staticClass:\"selectgroup\"},_vm._l((_vm.shapes),function(shape){return _c('div',{key:shape,staticClass:\"option\",class:{ 'option-selected': _vm.shapeSelect === shape },on:{\"click\":function($event){_vm.shapeSelect = shape}}},[_c('i',{staticClass:\"fas\",class:'fa-' + shape})])}),0),_c('div',[_vm._v(\"Colours\")]),_c('div',{staticClass:\"selectgroup\"},[_c('color-picker',{staticClass:\"option\",attrs:{\"color\":_vm.fillColour},on:{\"update:color\":function($event){_vm.fillColour=$event}}}),_c('color-picker',{staticClass:\"option\",attrs:{\"color\":_vm.borderColour},on:{\"update:color\":function($event){_vm.borderColour=$event}}})],1),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.shapeSelect === 'paint-brush'),expression:\"shapeSelect === 'paint-brush'\"}]},[_vm._v(\"Brush size\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.brushSize),expression:\"brushSize\"},{name:\"show\",rawName:\"v-show\",value:(_vm.shapeSelect === 'paint-brush'),expression:\"shapeSelect === 'paint-brush'\"}],staticStyle:{\"max-width\":\"100px\"},attrs:{\"type\":\"text\"},domProps:{\"value\":(_vm.brushSize)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.brushSize=$event.target.value}}})]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\n@Component\r\nexport default class Tool extends Vue {\r\n    name = \"\";\r\n    selected = false;\r\n    active = false;\r\n    get detailRight(): string {\r\n        const rect = (<any>this.$parent.$refs[this.name + \"-selector\"])[0].getBoundingClientRect();\r\n        const mid = rect.left + rect.width / 2;\r\n\r\n        return `${window.innerWidth - Math.min(window.innerWidth - 25, mid + 75)}px`;\r\n    }\r\n    get detailArrow(): string {\r\n        const rect = (<any>this.$parent.$refs[this.name + \"-selector\"])[0].getBoundingClientRect();\r\n        const mid = rect.left + rect.width / 2;\r\n        const right = Math.min(window.innerWidth - 25, mid + 75);\r\n        return `${right - mid - 14}px`; // border width\r\n    }\r\n    created() {\r\n        this.$parent.$on(\"mousedown\", (event: MouseEvent, tool: string) => {\r\n            if (tool === this.name) this.onMouseDown(event);\r\n        });\r\n        this.$parent.$on(\"mouseup\", (event: MouseEvent, tool: string) => {\r\n            if (tool === this.name) this.onMouseUp(event);\r\n        });\r\n        this.$parent.$on(\"mousemove\", (event: MouseEvent, tool: string) => {\r\n            if (tool === this.name) this.onMouseMove(event);\r\n        });\r\n        this.$parent.$on(\"contextmenu\", (event: MouseEvent, tool: string) => {\r\n            if (tool === this.name) this.onContextMenu(event);\r\n        });\r\n        this.$parent.$on(\"tools-select-change\", (newValue: string, oldValue: string) => {\r\n            if (oldValue === this.name) {\r\n                this.selected = false;\r\n                this.onDeselect();\r\n            } else if (newValue === this.name) {\r\n                this.selected = true;\r\n                this.onSelect();\r\n            }\r\n        });\r\n    }\r\n    onSelect() {}\r\n    onDeselect() {}\r\n    onMouseDown(_event: MouseEvent) {}\r\n    onMouseUp(_event: MouseEvent) {}\r\n    onMouseMove(_event: MouseEvent) {}\r\n    onContextMenu(_event: MouseEvent) {}\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tool.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tool.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./tool.vue?vue&type=template&id=38b5fddc&\"\nimport script from \"./tool.vue?vue&type=script&lang=ts&\"\nexport * from \"./tool.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./tool.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { Watch } from \"vue-property-decorator\";\r\n\r\nimport ColorPicker from \"@/core/components/colorpicker.vue\";\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Circle } from \"@/game/shapes/circle\";\r\nimport { Line } from \"@/game/shapes/line\";\r\nimport { MultiLine } from \"@/game/shapes/multiline\";\r\nimport { Polygon } from \"@/game/shapes/polygon\";\r\nimport { Rect } from \"@/game/shapes/rect\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { getUnitDistance, l2g } from \"@/game/units\";\r\nimport { equalPoints, getMouse } from \"@/game/utils\";\r\nimport { PA_CDT, TriangulationTarget } from \"@/game/visibility/te/pa\";\r\nimport { visibilityStore } from \"../../visibility/store\";\r\n\r\n@Component({\r\n    components: {\r\n        \"color-picker\": ColorPicker,\r\n    },\r\n})\r\nexport default class DrawTool extends Tool {\r\n    name = \"Draw\";\r\n    active = false;\r\n\r\n    startPoint: GlobalPoint | null = null;\r\n    shape: Shape | null = null;\r\n    brushHelper: Circle | null = null;\r\n    ruler: Line | null = null;\r\n\r\n    fillColour = \"rgba(0, 0, 0, 1)\";\r\n    borderColour = \"rgba(255, 255, 255, 0)\";\r\n\r\n    shapeSelect = \"square\";\r\n    shapes = [\"square\", \"circle\", \"draw-polygon\", \"paint-brush\"];\r\n    modeSelect = \"normal\";\r\n    modes = [\"normal\", \"reveal\", \"hide\"];\r\n\r\n    brushSize = getUnitDistance(gameStore.unitSize);\r\n\r\n    get helperSize(): number {\r\n        if (this.shapeSelect === \"paint-brush\") return this.brushSize / 2;\r\n        return getUnitDistance(this.unitSize) / 8;\r\n    }\r\n    get IS_DM(): boolean {\r\n        return gameStore.IS_DM;\r\n    }\r\n    get unitSize(): number {\r\n        return gameStore.unitSize;\r\n    }\r\n    get useGrid(): boolean {\r\n        return gameStore.useGrid;\r\n    }\r\n\r\n    @Watch(\"fillColour\")\r\n    onFillChange() {\r\n        if (this.brushHelper) this.brushHelper.fillColour = this.fillColour;\r\n    }\r\n\r\n    @Watch(\"modeSelect\")\r\n    onModeUpdate(newValue: string, oldValue: string) {\r\n        this.onModeChange(newValue, oldValue);\r\n    }\r\n\r\n    setupBrush() {\r\n        if (this.brushHelper === null) return;\r\n        if (this.modeSelect === \"reveal\" || this.modeSelect === \"hide\") {\r\n            this.brushHelper.options.set(\"preFogShape\", true);\r\n            this.brushHelper.options.set(\"skipDraw\", true);\r\n            this.brushHelper.fillColour = \"rgba(0, 0, 0, 1)\";\r\n\r\n            if (this.modeSelect === \"reveal\") this.brushHelper.globalCompositeOperation = \"source-over\";\r\n            else if (this.modeSelect === \"hide\") this.brushHelper.globalCompositeOperation = \"destination-out\";\r\n        } else {\r\n            this.brushHelper.options.delete(\"preFogShape\");\r\n            this.brushHelper.options.delete(\"skipDraw\");\r\n            this.brushHelper.globalCompositeOperation = \"source-over\";\r\n            this.brushHelper.fillColour = this.fillColour;\r\n        }\r\n    }\r\n    onModeChange(newValue: string, oldValue: string) {\r\n        if (this.brushHelper === null) return;\r\n\r\n        const fowLayer = layerManager.getLayer(\"fow\");\r\n        const normalLayer = layerManager.getLayer();\r\n        if (fowLayer === undefined || normalLayer === undefined) return;\r\n\r\n        this.setupBrush();\r\n\r\n        if (newValue !== \"normal\" && oldValue === \"normal\") {\r\n            normalLayer.removeShape(this.brushHelper, false);\r\n            fowLayer.addShape(this.brushHelper, false);\r\n        } else if (newValue === \"normal\" && oldValue !== \"normal\") {\r\n            normalLayer.addShape(this.brushHelper, false);\r\n            fowLayer.removeShape(this.brushHelper, false);\r\n        }\r\n    }\r\n    getLayer() {\r\n        if (this.modeSelect === \"normal\") return layerManager.getLayer();\r\n        return layerManager.getLayer(\"fow\");\r\n    }\r\n    onMouseDown(event: MouseEvent) {\r\n        const layer = this.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        if (!this.active) {\r\n            this.startPoint = l2g(getMouse(event));\r\n            this.active = true;\r\n            switch (this.shapeSelect) {\r\n                case \"square\": {\r\n                    this.shape = new Rect(this.startPoint.clone(), 0, 0, this.fillColour, this.borderColour);\r\n                    break;\r\n                }\r\n                case \"circle\": {\r\n                    this.shape = new Circle(\r\n                        this.startPoint.clone(),\r\n                        this.helperSize,\r\n                        this.fillColour,\r\n                        this.borderColour,\r\n                    );\r\n                    break;\r\n                }\r\n                case \"paint-brush\": {\r\n                    this.shape = new MultiLine(this.startPoint.clone(), [], this.brushSize);\r\n                    this.shape.fillColour = this.fillColour;\r\n                    break;\r\n                }\r\n                case \"draw-polygon\": {\r\n                    this.shape = new Polygon(this.startPoint.clone(), [], this.fillColour, this.borderColour);\r\n                    break;\r\n                }\r\n                default:\r\n                    return;\r\n            }\r\n\r\n            if (this.modeSelect !== \"normal\") {\r\n                this.shape.options.set(\"preFogShape\", true);\r\n                this.shape.options.set(\"skipDraw\", true);\r\n                this.shape.fillColour = \"rgba(0, 0, 0, 1)\";\r\n            }\r\n            if (this.modeSelect === \"reveal\") this.shape.globalCompositeOperation = \"source-over\";\r\n            else if (this.modeSelect === \"hide\") this.shape.globalCompositeOperation = \"destination-out\";\r\n\r\n            this.shape.addOwner(gameStore.username);\r\n            if (layer.name === \"fow\" && this.modeSelect === \"normal\") {\r\n                this.shape.visionObstruction = true;\r\n                // this.shape.movementObstruction = true;\r\n            }\r\n            layer.addShape(this.shape, true, false, false);\r\n\r\n            // Push brushhelper to back\r\n            this.pushBrushBack();\r\n        } else if (this.shape !== null && this.shape instanceof Polygon) {\r\n            // For polygon draw\r\n            this.shape._vertices.push(l2g(getMouse(event)));\r\n        }\r\n        if (this.shape !== null && this.shape instanceof Polygon) {\r\n            const lastPoint = l2g(getMouse(event));\r\n            if (this.ruler === null) {\r\n                this.ruler = new Line(lastPoint, lastPoint, 3, \"black\");\r\n                layer.addShape(this.ruler, false);\r\n            } else {\r\n                this.ruler.refPoint = lastPoint;\r\n                this.ruler.endPoint = lastPoint;\r\n            }\r\n            if (this.shape.visionObstruction)\r\n                PA_CDT.vision.insertConstraint(\r\n                    this.shape.points[this.shape.points.length - 2],\r\n                    this.shape.points[this.shape.points.length - 1],\r\n                );\r\n            layer.invalidate(false);\r\n            socket.emit(\"Shape.Update\", { shape: this.shape!.asDict(), redraw: true, temporary: true });\r\n        }\r\n    }\r\n    onMouseMove(event: MouseEvent) {\r\n        const endPoint = l2g(getMouse(event));\r\n        const layer = this.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n\r\n        if (this.brushHelper !== null) {\r\n            this.brushHelper.r = this.helperSize;\r\n            this.brushHelper.refPoint = endPoint;\r\n            if (!this.active) layer.invalidate(false);\r\n        }\r\n\r\n        if (!this.active || this.startPoint === null || this.shape === null) return;\r\n\r\n        switch (this.shapeSelect) {\r\n            case \"square\": {\r\n                const rect = <Rect>this.shape;\r\n                const newW = Math.abs(endPoint.x - this.startPoint.x);\r\n                const newH = Math.abs(endPoint.y - this.startPoint.y);\r\n                if (newW === rect.w && newH === rect.h) return;\r\n                rect.w = newW;\r\n                rect.h = newH;\r\n                if (endPoint.x < this.startPoint.x || endPoint.y < this.startPoint.y) {\r\n                    this.shape.refPoint = new GlobalPoint(\r\n                        Math.min(this.startPoint.x, endPoint.x),\r\n                        Math.min(this.startPoint.y, endPoint.y),\r\n                    );\r\n                }\r\n                break;\r\n            }\r\n            case \"circle\": {\r\n                const circ = <Circle>this.shape;\r\n                const newR = endPoint.subtract(this.startPoint).length();\r\n                if (circ.r === newR) return;\r\n                circ.r = newR;\r\n                break;\r\n            }\r\n            case \"paint-brush\": {\r\n                const br = <MultiLine>this.shape;\r\n                if (equalPoints(br.points[br.points.length - 1], [endPoint.x, endPoint.y])) return;\r\n                br._points.push(endPoint);\r\n                break;\r\n            }\r\n            case \"draw-polygon\": {\r\n                this.ruler!.endPoint = endPoint;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (!(this.shape instanceof Polygon)) {\r\n            socket.emit(\"Shape.Update\", { shape: this.shape!.asDict(), redraw: true, temporary: true });\r\n            if (this.shape.visionObstruction) {\r\n                if (this.shape.triagVertices.length > 1)\r\n                    visibilityStore.deleteFromTriag({\r\n                        target: TriangulationTarget.VISION,\r\n                        shape: this.shape,\r\n                        standalone: false,\r\n                    });\r\n                visibilityStore.addToTriag({ target: TriangulationTarget.VISION, shape: this.shape });\r\n            }\r\n        }\r\n        layer.invalidate(false);\r\n    }\r\n    onMouseUp(event: MouseEvent) {\r\n        if (!this.active || this.shape === null || this.shape instanceof Polygon) return;\r\n        if (!event.altKey && this.useGrid) {\r\n            visibilityStore.deleteFromTriag({\r\n                target: TriangulationTarget.VISION,\r\n                shape: this.shape,\r\n                standalone: false,\r\n            });\r\n            this.shape.resizeToGrid();\r\n            visibilityStore.addToTriag({ target: TriangulationTarget.VISION, shape: this.shape });\r\n        }\r\n        this.finaliseShape();\r\n    }\r\n    onContextMenu(_event: MouseEvent) {\r\n        if (!this.active || this.shape === null || !(this.shape instanceof Polygon)) return;\r\n        const layer = this.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        layer.removeShape(this.ruler!, false);\r\n        this.ruler = null;\r\n        this.finaliseShape();\r\n    }\r\n\r\n    private finaliseShape() {\r\n        if (this.shape === null) return;\r\n        if (this.shape.visionObstruction) visibilityStore.recalculateVision();\r\n        if (this.shape.movementObstruction) visibilityStore.recalculateMovement();\r\n        socket.emit(\"Shape.Update\", { shape: this.shape!.asDict(), redraw: true, temporary: false });\r\n        this.active = false;\r\n    }\r\n\r\n    onSelect() {\r\n        const layer = this.getLayer();\r\n        if (layer === undefined) return;\r\n        this.brushHelper = new Circle(new GlobalPoint(-1000, -1000), this.brushSize / 2, this.fillColour);\r\n        this.setupBrush();\r\n        layer.addShape(this.brushHelper, false); // during mode change the shape is already added\r\n    }\r\n    onDeselect() {\r\n        const layer = this.getLayer();\r\n        if (this.brushHelper !== null && layer !== undefined) layer.removeShape(this.brushHelper, false);\r\n        if (this.active && layer !== undefined && this.shape !== null) {\r\n            layer.removeShape(this.shape, true, false);\r\n            this.shape = null;\r\n            this.active = false;\r\n            layer.invalidate(false);\r\n        }\r\n    }\r\n\r\n    private pushBrushBack() {\r\n        const layer = this.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        if (this.brushHelper !== null) layer.removeShape(this.brushHelper, false);\r\n        this.brushHelper = new Circle(new GlobalPoint(-1000, -1000), this.brushSize / 2, this.fillColour);\r\n        this.setupBrush();\r\n        layer.addShape(this.brushHelper, false); // during mode change the shape is already added\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./draw.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./draw.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./draw.vue?vue&type=template&id=4e6b5c5e&scoped=true&\"\nimport script from \"./draw.vue?vue&type=script&lang=ts&\"\nexport * from \"./draw.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./draw.vue?vue&type=style&index=0&id=4e6b5c5e&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4e6b5c5e\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.selected)?_c('div',{staticClass:\"tool-detail\",style:({ '--detailRight': _vm.detailRight, '--detailArrow': _vm.detailArrow })},[_c('div',{attrs:{\"id\":\"accordion-container\"}},_vm._l((_vm.categories),function(category){return _c('accordion',{key:category,attrs:{\"title\":category === '' ? 'no category' : category,\"showArrow\":false,\"items\":_vm.labels[category],\"initialValues\":_vm.initalValues[category]},on:{\"selectionupdate\":_vm.updateSelection}})}),1)]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"accordion\"},[_c('div',{attrs:{\"id\":\"header\"},on:{\"click\":function($event){$event.preventDefault();return _vm.toggleDisplay($event)}}},[_c('input',{ref:\"overall\",attrs:{\"type\":\"checkbox\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.toggleCategory($event)}}}),_c('strong',[_vm._v(_vm._s(_vm.title))]),(_vm.showArrow)?[_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showArrow && !_vm.active),expression:\"showArrow && !active\"}],staticClass:\"down-Arrow\"},[_vm._v(\"\")]),_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showArrow && _vm.active),expression:\"showArrow && active\"}],staticClass:\"up-Arrow\"},[_vm._v(\"\")])]:_vm._e()],2),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.active),expression:\"active\"}],attrs:{\"id\":\"body\"}},_vm._l((_vm.items),function(item){return _c('div',{key:item[0],staticClass:\"item\",on:{\"click\":function($event){return _vm.toggleSelection(item[0])}}},[_c('input',{attrs:{\"type\":\"checkbox\"},domProps:{\"checked\":_vm.selected.includes(item[0])},on:{\"click\":function($event){$event.preventDefault();}}}),_vm._v(\"\\n            \"+_vm._s(item[1])+\"\\n        \")])}),0)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { Prop } from \"vue-property-decorator\";\r\n\r\n@Component\r\nexport default class Accordion extends Vue {\r\n    @Prop(String) title!: string;\r\n    @Prop({ default: true, type: Boolean }) showArrow!: boolean;\r\n    @Prop({ default: () => [] }) items!: [string, string][];\r\n    @Prop({ default: () => [] }) initialValues!: string[];\r\n\r\n    selected: string[] = [];\r\n\r\n    active = false;\r\n\r\n    mounted() {\r\n        this.selected = this.initialValues;\r\n        this.updateCategory();\r\n    }\r\n\r\n    toggleDisplay(_event: MouseEvent) {\r\n        this.active = !this.active;\r\n    }\r\n\r\n    toggleCategory() {\r\n        const overall = this.$refs.overall as HTMLInputElement;\r\n        if (overall.checked) this.selected = this.items.map(i => i[0]);\r\n        else this.selected = [];\r\n        this.$emit(\"selectionupdate\", { title: this.title, selection: this.selected });\r\n    }\r\n\r\n    updateCategory() {\r\n        const overall = this.$refs.overall as HTMLInputElement;\r\n        if (this.selected.length === 0) {\r\n            overall.checked = false;\r\n            overall.indeterminate = false;\r\n        } else if (this.selected.length === this.items.length) {\r\n            overall.checked = true;\r\n            overall.indeterminate = false;\r\n        } else {\r\n            overall.checked = false;\r\n            overall.indeterminate = true;\r\n        }\r\n    }\r\n\r\n    toggleSelection(item: string) {\r\n        const found = this.selected.indexOf(item);\r\n        if (found === -1) this.selected.push(item);\r\n        else this.selected.splice(found, 1);\r\n        this.updateCategory();\r\n        this.$emit(\"selectionupdate\", { title: this.title, selection: this.selected });\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accordion.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accordion.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./accordion.vue?vue&type=template&id=32e257d0&scoped=true&\"\nimport script from \"./accordion.vue?vue&type=script&lang=ts&\"\nexport * from \"./accordion.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./accordion.vue?vue&type=style&index=0&id=32e257d0&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"32e257d0\",\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Component from \"vue-class-component\";\r\n\r\nimport Accordion from \"@/core/components/accordion.vue\";\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\n@Component({\r\n    components: {\r\n        accordion: Accordion,\r\n    },\r\n})\r\nexport default class FilterTool extends Tool {\r\n    name = \"Filter\";\r\n    active = false;\r\n\r\n    get labels() {\r\n        const cat: { [category: string]: [string, string][] } = { \"\": [] };\r\n        for (const uuid of Object.keys(gameStore.labels)) {\r\n            const label = gameStore.labels[uuid];\r\n            if (!label.category) cat[\"\"].push([label.uuid, label.name]);\r\n            else {\r\n                if (!(label.category in cat)) cat[label.category] = [];\r\n                cat[label.category].push([label.uuid, label.name]);\r\n                cat[label.category].sort((a, b) => a[1].localeCompare(b[1]));\r\n            }\r\n        }\r\n        return cat;\r\n    }\r\n\r\n    get initalValues() {\r\n        const values: { [category: string]: string[] } = {};\r\n        for (const cat of Object.keys(this.labels)) {\r\n            values[cat] = gameStore.labelFilters.filter(f => this.labels[cat].map(l => l[0]).includes(f));\r\n        }\r\n        return values;\r\n    }\r\n\r\n    get categories() {\r\n        return Object.keys(this.labels).sort();\r\n    }\r\n\r\n    isFilter(uuid: string): boolean {\r\n        return gameStore.labelFilters.includes(uuid);\r\n    }\r\n\r\n    toggleFilter(uuid: string) {\r\n        const i = gameStore.labelFilters.indexOf(uuid);\r\n        if (i >= 0) gameStore.labelFilters.splice(i, 1);\r\n        else gameStore.labelFilters.push(uuid);\r\n        layerManager.invalidate();\r\n    }\r\n\r\n    toggleUnlabeled() {\r\n        gameStore.toggleUnlabeledFilter();\r\n        layerManager.invalidate();\r\n    }\r\n\r\n    updateSelection(data: { title: string; selection: string[] }) {\r\n        if (!(data.title in this.labels)) return;\r\n        for (const [uuid, _] of this.labels[data.title]) {\r\n            const idx = gameStore.labelFilters.indexOf(uuid);\r\n            const selected = data.selection.includes(uuid);\r\n            if (idx >= 0 && !selected) {\r\n                gameStore.labelFilters.splice(idx, 1);\r\n                socket.emit(\"Labels.Filter.Remove\", uuid);\r\n            } else if (idx < 0 && selected) {\r\n                gameStore.labelFilters.push(uuid);\r\n                socket.emit(\"Labels.Filter.Add\", uuid);\r\n            }\r\n        }\r\n        layerManager.invalidate();\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./filter.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./filter.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./filter.vue?vue&type=template&id=75b63661&scoped=true&\"\nimport script from \"./filter.vue?vue&type=script&lang=ts&\"\nexport * from \"./filter.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./filter.vue?vue&type=style&index=0&lang=css&\"\nimport style1 from \"./filter.vue?vue&type=style&index=1&id=75b63661&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"75b63661\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.selected)?_c('div',{staticClass:\"tool-detail\",style:({ '--detailRight': _vm.detailRight, '--detailArrow': _vm.detailArrow })},[_c('div',[_vm._v(\"#X\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.xCount),expression:\"xCount\"}],attrs:{\"type\":\"text\"},domProps:{\"value\":(_vm.xCount)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.xCount=$event.target.value}}}),_c('div',[_vm._v(\"#Y\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.yCount),expression:\"yCount\"}],attrs:{\"type\":\"text\"},domProps:{\"value\":(_vm.yCount)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.yCount=$event.target.value}}})]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { BaseRect } from \"@/game/shapes/baserect\";\r\nimport { Rect } from \"@/game/shapes/rect\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { l2g } from \"@/game/units\";\r\nimport { getMouse } from \"@/game/utils\";\r\nimport Component from \"vue-class-component\";\r\n\r\n@Component\r\nexport default class MapTool extends Tool {\r\n    name = \"Map\";\r\n    active = false;\r\n    xCount = 3;\r\n    yCount = 3;\r\n    startPoint: GlobalPoint | null = null;\r\n    rect: Rect | null = null;\r\n\r\n    onMouseDown(event: MouseEvent) {\r\n        const layer = layerManager.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        this.active = true;\r\n\r\n        this.startPoint = l2g(getMouse(event));\r\n        this.rect = new Rect(this.startPoint.clone(), 0, 0, \"rgba(0,0,0,0)\", \"black\");\r\n        layer.addShape(this.rect, false, false);\r\n    }\r\n    onMouseMove(event: MouseEvent) {\r\n        if (!this.active || this.rect === null || this.startPoint === null) return;\r\n        const layer = layerManager.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n\r\n        const endPoint = l2g(getMouse(event));\r\n\r\n        this.rect.w = Math.abs(endPoint.x - this.startPoint.x);\r\n        this.rect.h = Math.abs(endPoint.y - this.startPoint.y);\r\n        this.rect.refPoint = new GlobalPoint(\r\n            Math.min(this.startPoint.x, endPoint.x),\r\n            Math.min(this.startPoint.y, endPoint.y),\r\n        );\r\n        layer.invalidate(false);\r\n    }\r\n    onMouseUp(_event: MouseEvent) {\r\n        if (!this.active || this.rect === null) return;\r\n        const layer = layerManager.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        this.active = false;\r\n\r\n        if (layer.selection.length !== 1) {\r\n            layer.removeShape(this.rect, false, false);\r\n            return;\r\n        }\r\n\r\n        const w = this.rect.w;\r\n        const h = this.rect.h;\r\n        const sel = layer.selection[0];\r\n\r\n        if (sel instanceof BaseRect) {\r\n            sel.w *= (this.xCount * gameStore.gridSize) / w;\r\n            sel.h *= (this.yCount * gameStore.gridSize) / h;\r\n        }\r\n\r\n        layer.removeShape(this.rect, false, false);\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./map.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./map.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./map.vue?vue&type=template&id=17b6b4aa&\"\nimport script from \"./map.vue?vue&type=script&lang=ts&\"\nexport * from \"./map.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { sendClientOptions } from \"@/game/api/utils\";\r\nimport { LocalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { getMouse } from \"@/game/utils\";\r\nimport Component from \"vue-class-component\";\r\n\r\n@Component\r\nexport default class PanTool extends Tool {\r\n    name = \"Pan\";\r\n    panStart = new LocalPoint(0, 0);\r\n    active = false;\r\n\r\n    onMouseDown(event: MouseEvent): void {\r\n        this.panStart = getMouse(event);\r\n        this.active = true;\r\n    }\r\n    onMouseMove(event: MouseEvent): void {\r\n        if (!this.active) return;\r\n        const mouse = getMouse(event);\r\n        const distance = mouse.subtract(this.panStart).multiply(1 / gameStore.zoomFactor);\r\n        gameStore.increasePanX(Math.round(distance.x));\r\n        gameStore.increasePanY(Math.round(distance.y));\r\n        this.panStart = mouse;\r\n        layerManager.invalidate();\r\n    }\r\n    onMouseUp(_event: MouseEvent): void {\r\n        this.active = false;\r\n        sendClientOptions(gameStore.locationOptions);\r\n    }\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('SelectContext',{ref:\"selectcontext\"})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContextMenu',{attrs:{\"visible\":_vm.visible,\"left\":_vm.x + 'px',\"top\":_vm.y + 'px'},on:{\"close\":_vm.close}},[(_vm.IS_DM)?_c('li',{on:{\"click\":_vm.bringPlayers}},[_vm._v(\"Bring players\")]):_vm._e(),_c('li',{on:{\"click\":_vm.createToken}},[_vm._v(\"Create basic token\")]),_c('li',{on:{\"click\":_vm.showInitiative}},[_vm._v(\"Show initiative\")])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport ContextMenu from \"@/core/components/contextmenu.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { l2gx, l2gy } from \"@/game/units\";\r\n\r\n@Component({\r\n    components: {\r\n        ContextMenu,\r\n    },\r\n})\r\nexport default class SelectContext extends Vue {\r\n    visible = false;\r\n    x = 0;\r\n    y = 0;\r\n\r\n    get IS_DM(): boolean {\r\n        return gameStore.IS_DM;\r\n    }\r\n\r\n    open(event: MouseEvent) {\r\n        this.visible = true;\r\n        this.x = event.pageX;\r\n        this.y = event.pageY;\r\n        this.$nextTick(() => (<HTMLElement>this.$children[0].$el).focus());\r\n    }\r\n    close() {\r\n        this.visible = false;\r\n    }\r\n    bringPlayers() {\r\n        if (!gameStore.IS_DM) return;\r\n        socket.emit(\"Players.Bring\", { x: l2gx(this.x), y: l2gy(this.y) });\r\n        this.close();\r\n    }\r\n    createToken() {\r\n        (<any>this.$parent.$parent.$refs.createtokendialog).open(this.x, this.y);\r\n        this.close();\r\n    }\r\n    showInitiative() {\r\n        EventBus.$emit(\"Initiative.Show\");\r\n        this.close();\r\n    }\r\n}\r\n","\n\n\n\n\r\nimport Component from \"vue-class-component\";\r\n\r\nimport SelectContext from \"@/game/ui/tools/selectcontext.vue\";\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { GlobalPoint, LocalPoint, Ray, Vector } from \"@/game/geom\";\r\nimport { Layer } from \"@/game/layers/layer\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Rect } from \"@/game/shapes/rect\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { calculateDelta } from \"@/game/ui/tools/utils\";\r\nimport { g2l, g2lx, g2ly, l2g, l2gz } from \"@/game/units\";\r\nimport { getMouse } from \"@/game/utils\";\r\nimport { TriangulationTarget } from \"../../visibility/te/pa\";\r\nimport { visibilityStore } from \"../../visibility/store\";\r\nimport { EventBus } from \"../../event-bus\";\r\n\r\nexport enum SelectOperations {\r\n    Noop,\r\n    Resize,\r\n    Drag,\r\n    GroupSelect,\r\n}\r\n\r\nconst start = new GlobalPoint(-1000, -1000);\r\n\r\n@Component({\r\n    components: {\r\n        SelectContext,\r\n    },\r\n})\r\nexport default class SelectTool extends Tool {\r\n    name = \"Select\";\r\n    showContextMenu = false;\r\n    active = false;\r\n\r\n    mode = SelectOperations.Noop;\r\n    resizePoint = 0;\r\n    deltaChanged = false;\r\n    // Because we never drag from the asset's (0, 0) coord and want a smoother drag experience\r\n    // we keep track of the actual offset within the asset.\r\n    dragRay = new Ray<LocalPoint>(new LocalPoint(0, 0), new Vector(0, 0));\r\n    selectionStartPoint = start;\r\n    selectionHelper = new Rect(start, 0, 0);\r\n    created() {\r\n        this.selectionHelper.globalCompositeOperation = \"source-over\";\r\n        gameStore.setSelectionHelperId(this.selectionHelper.uuid);\r\n    }\r\n    onMouseDown(event: MouseEvent) {\r\n        const layer = layerManager.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n\r\n        if (!this.selectionHelper.owners.includes(gameStore.username)) {\r\n            this.selectionHelper.addOwner(gameStore.username);\r\n        }\r\n\r\n        const mouse = getMouse(event);\r\n        const globalMouse = l2g(mouse);\r\n\r\n        let hit = false;\r\n        // The selectionStack allows for lower positioned objects that are selected to have precedence during overlap.\r\n        let selectionStack;\r\n        if (!layer.selection.length) selectionStack = layer.shapes;\r\n        else selectionStack = layer.shapes.concat(layer.selection);\r\n        for (let i = selectionStack.length - 1; i >= 0; i--) {\r\n            const shape = selectionStack[i];\r\n\r\n            this.resizePoint = shape.getPointIndex(globalMouse, l2gz(3));\r\n\r\n            // Resize case, a corner is selected\r\n            if (this.resizePoint >= 0) {\r\n                layer.selection = [shape];\r\n                EventBus.$emit(\"SelectionInfo.Shape.Set\", shape);\r\n                this.mode = SelectOperations.Resize;\r\n                layer.invalidate(true);\r\n                hit = true;\r\n                break;\r\n\r\n                // Drag case, a shape is selected\r\n            } else if (shape.contains(globalMouse)) {\r\n                const selection = shape;\r\n                if (layer.selection.indexOf(selection) === -1) {\r\n                    layer.selection = [selection];\r\n                    EventBus.$emit(\"SelectionInfo.Shape.Set\", selection);\r\n                }\r\n                this.mode = SelectOperations.Drag;\r\n                const localRefPoint = g2l(selection.refPoint);\r\n                this.dragRay = new Ray<LocalPoint>(localRefPoint, mouse.subtract(localRefPoint));\r\n                layer.invalidate(true);\r\n                hit = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        // GroupSelect case, draw a selection box to select multiple shapes\r\n        if (!hit) {\r\n            this.mode = SelectOperations.GroupSelect;\r\n            for (const selection of layer.selection) EventBus.$emit(\"SelectionInfo.Shape.Set\", selection);\r\n\r\n            this.selectionStartPoint = globalMouse;\r\n\r\n            this.selectionHelper.refPoint = this.selectionStartPoint;\r\n            this.selectionHelper.w = 0;\r\n            this.selectionHelper.h = 0;\r\n\r\n            layer.selection = [this.selectionHelper];\r\n            layer.invalidate(true);\r\n        }\r\n        this.active = true;\r\n    }\r\n    onMouseMove(event: MouseEvent) {\r\n        // if (!this.active) return;   we require mousemove for the resize cursor\r\n        const layer = layerManager.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        const mouse = getMouse(event);\r\n        const globalMouse = l2g(mouse);\r\n        this.deltaChanged = false;\r\n\r\n        if (this.mode === SelectOperations.GroupSelect) {\r\n            // Currently draw on active layer\r\n            const endPoint = globalMouse;\r\n\r\n            this.selectionHelper.w = Math.abs(endPoint.x - this.selectionStartPoint.x);\r\n            this.selectionHelper.h = Math.abs(endPoint.y - this.selectionStartPoint.y);\r\n            this.selectionHelper.refPoint = new GlobalPoint(\r\n                Math.min(this.selectionStartPoint.x, endPoint.x),\r\n                Math.min(this.selectionStartPoint.y, endPoint.y),\r\n            );\r\n            layer.invalidate(true);\r\n        } else if (layer.selection.length) {\r\n            const og = g2l(layer.selection[layer.selection.length - 1].refPoint);\r\n            const origin = og.add(this.dragRay.direction);\r\n            let delta = mouse.subtract(origin).multiply(1 / gameStore.zoomFactor);\r\n            const ogDelta = delta;\r\n            if (this.mode === SelectOperations.Drag) {\r\n                if (ogDelta.length() === 0) return;\r\n                // If we are on the tokens layer do a movement block check.\r\n                if (layer.name === \"tokens\" && !(event.shiftKey && gameStore.IS_DM)) {\r\n                    for (const sel of layer.selection) {\r\n                        if (!sel.ownedBy()) continue;\r\n                        if (sel.uuid === this.selectionHelper.uuid) continue; // the selection helper should not be treated as a real shape.\r\n                        delta = calculateDelta(delta, sel);\r\n                        if (delta !== ogDelta) this.deltaChanged = true;\r\n                    }\r\n                }\r\n                // Actually apply the delta on all shapes\r\n                for (const sel of layer.selection) {\r\n                    if (!sel.ownedBy()) continue;\r\n                    if (sel.visionObstruction)\r\n                        visibilityStore.deleteFromTriag({\r\n                            target: TriangulationTarget.VISION,\r\n                            shape: sel,\r\n                            standalone: false,\r\n                        });\r\n                    sel.refPoint = sel.refPoint.add(delta);\r\n                    if (sel.visionObstruction)\r\n                        visibilityStore.addToTriag({ target: TriangulationTarget.VISION, shape: sel });\r\n                    if (sel !== this.selectionHelper) {\r\n                        socket.emit(\"Shape.Update\", { shape: sel.asDict(), redraw: true, temporary: true });\r\n                    }\r\n                }\r\n                layer.invalidate(false);\r\n            } else if (this.mode === SelectOperations.Resize) {\r\n                for (const sel of layer.selection) {\r\n                    if (!sel.ownedBy()) continue;\r\n                    if (sel.visionObstruction)\r\n                        visibilityStore.deleteFromTriag({\r\n                            target: TriangulationTarget.VISION,\r\n                            shape: sel,\r\n                            standalone: false,\r\n                        });\r\n                    sel.resize(this.resizePoint, mouse);\r\n                    if (sel !== this.selectionHelper) {\r\n                        // todo: think about calling deleteIntersectVertex directly on the corner point\r\n                        if (sel.visionObstruction)\r\n                            visibilityStore.addToTriag({ target: TriangulationTarget.VISION, shape: sel });\r\n                        socket.emit(\"Shape.Update\", { shape: sel.asDict(), redraw: true, temporary: true });\r\n                    }\r\n                    layer.invalidate(false);\r\n                    this.updateCursor(layer, globalMouse);\r\n                }\r\n            } else {\r\n                this.updateCursor(layer, globalMouse);\r\n            }\r\n        } else {\r\n            document.body.style.cursor = \"default\";\r\n        }\r\n    }\r\n    onMouseUp(e: MouseEvent): void {\r\n        if (!this.active) return;\r\n        if (layerManager.getLayer() === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        const layer = layerManager.getLayer()!;\r\n\r\n        if (this.mode === SelectOperations.GroupSelect) {\r\n            layer.clearSelection();\r\n            layer.shapes.forEach(shape => {\r\n                if (!shape.ownedBy()) return;\r\n                if (shape === this.selectionHelper) return;\r\n                const bbox = shape.getBoundingBox();\r\n                if (!shape.ownedBy()) return;\r\n                if (\r\n                    this.selectionHelper!.refPoint.x <= bbox.topRight.x &&\r\n                    this.selectionHelper!.refPoint.x + this.selectionHelper!.w >= bbox.topLeft.x &&\r\n                    this.selectionHelper!.refPoint.y <= bbox.botLeft.y &&\r\n                    this.selectionHelper!.refPoint.y + this.selectionHelper!.h >= bbox.topLeft.y\r\n                ) {\r\n                    layer.selection.push(shape);\r\n                }\r\n            });\r\n\r\n            // Push the selection helper as the last element of the selection\r\n            // This makes sure that it will be the first one to be hit in the hit detection onMouseDown\r\n            if (layer.selection.length > 0) layer.selection.push(this.selectionHelper);\r\n\r\n            layer.invalidate(true);\r\n        } else if (layer.selection.length) {\r\n            layer.selection.forEach(sel => {\r\n                if (!sel.ownedBy()) return;\r\n                if (this.mode === SelectOperations.Drag) {\r\n                    if (\r\n                        this.dragRay.origin!.x === g2lx(sel.refPoint.x) &&\r\n                        this.dragRay.origin!.y === g2ly(sel.refPoint.y)\r\n                    )\r\n                        return;\r\n\r\n                    if (gameStore.useGrid && !e.altKey && !this.deltaChanged) {\r\n                        if (sel.visionObstruction)\r\n                            visibilityStore.deleteFromTriag({\r\n                                target: TriangulationTarget.VISION,\r\n                                shape: sel,\r\n                                standalone: false,\r\n                            });\r\n                        if (sel.movementObstruction)\r\n                            visibilityStore.deleteFromTriag({\r\n                                target: TriangulationTarget.MOVEMENT,\r\n                                shape: sel,\r\n                                standalone: false,\r\n                            });\r\n                        sel.snapToGrid();\r\n                        if (sel.visionObstruction)\r\n                            visibilityStore.addToTriag({ target: TriangulationTarget.VISION, shape: sel });\r\n                        if (sel.movementObstruction)\r\n                            visibilityStore.addToTriag({ target: TriangulationTarget.MOVEMENT, shape: sel });\r\n                    }\r\n\r\n                    if (sel !== this.selectionHelper) {\r\n                        socket.emit(\"Shape.Update\", { shape: sel.asDict(), redraw: true, temporary: false });\r\n                    }\r\n                    layer.invalidate(false);\r\n                }\r\n                if (this.mode === SelectOperations.Resize) {\r\n                    if (gameStore.useGrid && !e.altKey) {\r\n                        if (sel.visionObstruction)\r\n                            visibilityStore.deleteFromTriag({\r\n                                target: TriangulationTarget.VISION,\r\n                                shape: sel,\r\n                                standalone: false,\r\n                            });\r\n                        if (sel.movementObstruction)\r\n                            visibilityStore.deleteFromTriag({\r\n                                target: TriangulationTarget.MOVEMENT,\r\n                                shape: sel,\r\n                                standalone: false,\r\n                            });\r\n                        sel.snapToGrid();\r\n                        if (sel.visionObstruction)\r\n                            visibilityStore.addToTriag({ target: TriangulationTarget.VISION, shape: sel });\r\n                        if (sel.visionObstruction)\r\n                            visibilityStore.addToTriag({ target: TriangulationTarget.VISION, shape: sel });\r\n                    }\r\n                    if (sel !== this.selectionHelper) {\r\n                        socket.emit(\"Shape.Update\", { shape: sel.asDict(), redraw: true, temporary: false });\r\n                    }\r\n                    layer.invalidate(false);\r\n                }\r\n            });\r\n        }\r\n        this.mode = SelectOperations.Noop;\r\n        this.active = false;\r\n    }\r\n    onContextMenu(event: MouseEvent) {\r\n        if (layerManager.getLayer() === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        const layer = layerManager.getLayer()!;\r\n        const mouse = getMouse(event);\r\n        const globalMouse = l2g(mouse);\r\n\r\n        for (const shape of layer.selection) {\r\n            if (shape.contains(globalMouse) && shape !== this.selectionHelper) {\r\n                layer.selection = [shape];\r\n                EventBus.$emit(\"SelectionInfo.Shape.Set\", shape);\r\n                layer.invalidate(true);\r\n                (<any>this.$parent.$refs.shapecontext).open(event, shape);\r\n                return;\r\n            }\r\n        }\r\n        (<any>this.$refs.selectcontext).open(event);\r\n    }\r\n    updateCursor(layer: Layer, globalMouse: GlobalPoint) {\r\n        for (const sel of layer.selection) {\r\n            const resizePoint = sel.getPointIndex(globalMouse, l2gz(3));\r\n            if (resizePoint < 0) document.body.style.cursor = \"default\";\r\n            else {\r\n                let angle = sel.getPointOrientation(resizePoint).angle();\r\n                if (angle < 0) angle += 360;\r\n                const d = 45 / 2;\r\n                if (angle >= 315 + d || angle < d || (angle >= 135 + d && angle < 225 - d))\r\n                    document.body.style.cursor = \"ew-resize\";\r\n                if ((angle >= 45 + d && angle < 135 - d) || (angle >= 225 + d && angle < 315 - d))\r\n                    document.body.style.cursor = \"ns-resize\";\r\n                if ((angle >= d && angle < 90 - d) || (angle >= 180 + d && angle < 270 - d))\r\n                    document.body.style.cursor = \"nwse-resize\";\r\n                if ((angle >= 90 + d && angle < 180 - d) || (angle >= 270 + d && angle < 360 - d))\r\n                    document.body.style.cursor = \"nesw-resize\";\r\n            }\r\n        }\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selectcontext.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selectcontext.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./selectcontext.vue?vue&type=template&id=7983fcf6&scoped=true&\"\nimport script from \"./selectcontext.vue?vue&type=script&lang=ts&\"\nexport * from \"./selectcontext.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./selectcontext.vue?vue&type=style&index=0&id=7983fcf6&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7983fcf6\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./select.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./select.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./select.vue?vue&type=template&id=5a93cd5e&\"\nimport script from \"./select.vue?vue&type=script&lang=ts&\"\nexport * from \"./select.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.selected)?_c('div',{staticClass:\"tool-detail\",style:({ '--detailRight': _vm.detailRight, '--detailArrow': _vm.detailArrow })},_vm._l((_vm.tokens),function(token){return _c('div',{key:token.uuid,staticClass:\"token\",class:{ selected: _vm.selection.includes(token.uuid) },on:{\"click\":function($event){return _vm.toggle(token.uuid)}}},[(token.src)?_c('img',{attrs:{\"src\":token.src,\"width\":\"30px\",\"height\":\"30px\"}}):_vm._e(),_c('div',[_vm._v(_vm._s(token.name))])])}),0):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Component from \"vue-class-component\";\r\n\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { Shape } from \"../../shapes/shape\";\r\n\r\n@Component\r\nexport default class VisionTool extends Tool {\r\n    name = \"Vision\";\r\n    active = false;\r\n\r\n    get selection(): string[] {\r\n        return gameStore.activeTokens;\r\n    }\r\n\r\n    get tokens(): Shape[] {\r\n        return gameStore.ownedtokens.map(t => layerManager.UUIDMap.get(t)!);\r\n    }\r\n\r\n    toggle(uuid: string) {\r\n        if (this.selection.includes(uuid)) gameStore.removeActiveToken(uuid);\r\n        else gameStore.addActiveToken(uuid);\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./vision.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./vision.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./vision.vue?vue&type=template&id=f995dfd4&scoped=true&\"\nimport script from \"./vision.vue?vue&type=script&lang=ts&\"\nexport * from \"./vision.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./vision.vue?vue&type=style&index=0&id=f995dfd4&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f995dfd4\",\n  null\n  \n)\n\nexport default component.exports","import Component from \"vue-class-component\";\r\n\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Line } from \"@/game/shapes/line\";\r\nimport { Text } from \"@/game/shapes/text\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { l2g } from \"@/game/units\";\r\nimport { getMouse } from \"@/game/utils\";\r\n\r\n@Component\r\nexport class RulerTool extends Tool {\r\n    name = \"Ruler\";\r\n    active = false;\r\n    startPoint: GlobalPoint | null = null;\r\n    ruler: Line | null = null;\r\n    text: Text | null = null;\r\n    onMouseDown(event: MouseEvent): void {\r\n        const layer = layerManager.getLayer(\"draw\");\r\n        if (layer === undefined) {\r\n            console.log(\"No draw layer!\");\r\n            return;\r\n        }\r\n        this.active = true;\r\n        this.startPoint = l2g(getMouse(event));\r\n        this.ruler = new Line(this.startPoint, this.startPoint, 3, gameStore.rulerColour);\r\n        this.text = new Text(this.startPoint.clone(), \"\", \"bold 20px serif\");\r\n        this.ruler.addOwner(gameStore.username);\r\n        this.text.addOwner(gameStore.username);\r\n        layer.addShape(this.ruler, true, true);\r\n        layer.addShape(this.text, true, true);\r\n    }\r\n    onMouseMove(event: MouseEvent): void {\r\n        if (!this.active || this.ruler === null || this.startPoint === null || this.text === null) return;\r\n\r\n        const layer = layerManager.getLayer(\"draw\");\r\n        if (layer === undefined) {\r\n            console.log(\"No draw layer!\");\r\n            return;\r\n        }\r\n        const endPoint = l2g(getMouse(event));\r\n\r\n        this.ruler.endPoint = endPoint;\r\n        socket.emit(\"Shape.Update\", { shape: this.ruler!.asDict(), redraw: true, temporary: true });\r\n\r\n        const diffsign = Math.sign(endPoint.x - this.startPoint.x) * Math.sign(endPoint.y - this.startPoint.y);\r\n        const xdiff = Math.abs(endPoint.x - this.startPoint.x);\r\n        const ydiff = Math.abs(endPoint.y - this.startPoint.y);\r\n        const label =\r\n            Math.round((Math.sqrt(xdiff ** 2 + ydiff ** 2) * gameStore.unitSize) / gameStore.gridSize) + \" ft\";\r\n        const angle = Math.atan2(diffsign * ydiff, xdiff);\r\n        const xmid = Math.min(this.startPoint.x, endPoint.x) + xdiff / 2;\r\n        const ymid = Math.min(this.startPoint.y, endPoint.y) + ydiff / 2;\r\n        this.text.refPoint = new GlobalPoint(xmid, ymid);\r\n        this.text.text = label;\r\n        this.text.angle = angle;\r\n        socket.emit(\"Shape.Update\", { shape: this.text.asDict(), redraw: true, temporary: true });\r\n        layer.invalidate(true);\r\n    }\r\n    onMouseUp(_event: MouseEvent): void {\r\n        if (!this.active || this.ruler === null || this.startPoint === null || this.text === null) return;\r\n\r\n        const layer = layerManager.getLayer(\"draw\");\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        this.active = false;\r\n\r\n        layer.removeShape(this.ruler, true, true);\r\n        layer.removeShape(this.text, true, true);\r\n        layer.invalidate(true);\r\n        this.ruler = this.startPoint = this.text = null;\r\n    }\r\n}\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\n\r\nimport ShapeContext from \"@/game/ui/selection/shapecontext.vue\";\r\nimport CreateTokenModal from \"@/game/ui/tools/createtoken_modal.vue\";\r\nimport DrawTool from \"@/game/ui/tools/draw.vue\";\r\nimport FilterTool from \"@/game/ui/tools/filter.vue\";\r\nimport MapTool from \"@/game/ui/tools/map.vue\";\r\nimport PanTool from \"@/game/ui/tools/pan\";\r\nimport SelectTool from \"@/game/ui/tools/select.vue\";\r\nimport VisionTool from \"@/game/ui/tools/vision.vue\";\r\n\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameManager } from \"@/game/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { RulerTool } from \"@/game/ui/tools/ruler\";\r\nimport { l2g } from \"@/game/units\";\r\nimport { getMouse } from \"@/game/utils\";\r\nimport Component from \"vue-class-component\";\r\n\r\n@Component({\r\n    components: {\r\n        \"select-tool\": SelectTool,\r\n        \"pan-tool\": PanTool,\r\n        \"draw-tool\": DrawTool,\r\n        \"ruler-tool\": RulerTool,\r\n        \"map-tool\": MapTool,\r\n        \"filter-tool\": FilterTool,\r\n        \"vision-tool\": VisionTool,\r\n        \"shape-menu\": ShapeContext,\r\n        \"createtoken-dialog\": CreateTokenModal,\r\n    },\r\n    watch: {\r\n        currentTool(newValue, oldValue) {\r\n            this.$emit(\"tools-select-change\", newValue, oldValue);\r\n        },\r\n    },\r\n})\r\nexport default class Tools extends Vue {\r\n    $refs!: {\r\n        selectTool: InstanceType<typeof SelectTool>;\r\n    };\r\n\r\n    currentTool = \"Select\";\r\n    tools = [\"Select\", \"Pan\", \"Draw\", \"Ruler\", \"Map\", \"Filter\", \"Vision\"];\r\n    dmTools = [\"Map\"];\r\n\r\n    get IS_DM(): boolean {\r\n        return gameStore.IS_DM;\r\n    }\r\n\r\n    get currentToolComponent(): string {\r\n        return `${this.currentTool.toLowerCase()}-tool`;\r\n    }\r\n\r\n    get visibleTools(): string[] {\r\n        return this.tools.filter(t => !this.dmTools.includes(t) || this.IS_DM);\r\n    }\r\n\r\n    toolVisible(tool: string): boolean {\r\n        if (tool === \"Filter\") {\r\n            return Object.keys(gameStore.labels).length > 0;\r\n        } else if (tool === \"Vision\") {\r\n            return gameStore.ownedtokens.length > 1;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    mousedown(event: MouseEvent) {\r\n        if ((<HTMLElement>event.target).tagName !== \"CANVAS\") return;\r\n\r\n        let targetTool = this.currentTool;\r\n        if (event.button === 1) {\r\n            targetTool = \"Pan\";\r\n        } else if (event.button !== 0) {\r\n            return;\r\n        }\r\n\r\n        this.$emit(\"mousedown\", event, targetTool);\r\n    }\r\n    mouseup(event: MouseEvent) {\r\n        if ((<HTMLElement>event.target).tagName !== \"CANVAS\") return;\r\n\r\n        let targetTool = this.currentTool;\r\n        if (event.button === 1) {\r\n            targetTool = \"Pan\";\r\n        } else if (event.button !== 0) {\r\n            return;\r\n        }\r\n\r\n        this.$emit(\"mouseup\", event, targetTool);\r\n    }\r\n    mousemove(event: MouseEvent) {\r\n        if ((<HTMLElement>event.target).tagName !== \"CANVAS\") return;\r\n\r\n        let targetTool = this.currentTool;\r\n        if ((event.buttons & 4) !== 0) {\r\n            targetTool = \"Pan\";\r\n        } else if ((event.button & 1) > 1) {\r\n            return;\r\n        }\r\n\r\n        this.$emit(\"mousemove\", event, targetTool);\r\n\r\n        // Annotation hover\r\n        let found = false;\r\n        for (const uuid of gameStore.annotations) {\r\n            if (layerManager.UUIDMap.has(uuid) && layerManager.hasLayer(\"draw\")) {\r\n                const shape = layerManager.UUIDMap.get(uuid)!;\r\n                if (shape.contains(l2g(getMouse(event)))) {\r\n                    found = true;\r\n                    gameManager.annotationManager.setActiveText(shape.annotation);\r\n                }\r\n            }\r\n        }\r\n        if (!found && gameManager.annotationManager.shown) {\r\n            gameManager.annotationManager.setActiveText(\"\");\r\n        }\r\n    }\r\n    mouseleave(event: MouseEvent) {\r\n        // When leaving the window while a mouse is pressed down, act as if it was released\r\n        if ((event.buttons & 1) !== 0) {\r\n            this.$emit(\"mouseup\", event, this.currentTool);\r\n        }\r\n    }\r\n    contextmenu(event: MouseEvent) {\r\n        if ((<HTMLElement>event.target).tagName !== \"CANVAS\") return;\r\n        if (event.button !== 2 || (<HTMLElement>event.target).tagName !== \"CANVAS\") return;\r\n        this.$emit(\"contextmenu\", event, this.currentTool);\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tools.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tools.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./tools.vue?vue&type=template&id=4302f32a&scoped=true&\"\nimport script from \"./tools.vue?vue&type=script&lang=ts&\"\nexport * from \"./tools.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./tools.vue?vue&type=style&index=0&id=4302f32a&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4302f32a\",\n  null\n  \n)\n\nexport default component.exports","import { uuidv4 } from \"@/core/utils\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { sendClientOptions } from \"@/game/api/utils\";\r\nimport { ServerAura } from \"@/game/comm/types/shapes\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { Vector } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { createShapeFromDict } from \"@/game/shapes/utils\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { calculateDelta } from \"@/game/ui/tools/utils\";\r\nimport { TriangulationTarget } from \"../visibility/te/pa\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\n\r\nexport function onKeyUp(event: KeyboardEvent): void {\r\n    if (!(event.target instanceof HTMLInputElement || event.target instanceof HTMLTextAreaElement)) {\r\n        if (event.key === \"Delete\" || event.key === \"Del\" || event.key === \"Backspace\") {\r\n            if (layerManager.getLayer === undefined) {\r\n                console.log(\"No active layer selected for delete operation\");\r\n                return;\r\n            }\r\n            const l = layerManager.getLayer()!;\r\n            for (let i = l.selection.length - 1; i >= 0; i--) {\r\n                const sel = l.selection[i];\r\n                if (gameStore.selectionHelperID === sel.uuid) {\r\n                    l.selection.splice(i, 1);\r\n                    continue;\r\n                }\r\n                l.removeShape(sel, true, false);\r\n                EventBus.$emit(\"SelectionInfo.Shape.Set\", null);\r\n                EventBus.$emit(\"Initiative.Remove\", sel.uuid);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function onKeyDown(event: KeyboardEvent): void {\r\n    if (event.target instanceof HTMLInputElement || event.target instanceof HTMLTextAreaElement) {\r\n        if (event.keyCode === 65 && event.ctrlKey) event.target!.select();\r\n    } else {\r\n        if (event.keyCode >= 37 && event.keyCode <= 40) {\r\n            // todo: this should already be rounded\r\n            const gridSize = Math.round(gameStore.gridSize);\r\n            let offsetX = gridSize * (event.keyCode % 2);\r\n            let offsetY = gridSize * (event.keyCode % 2 ? 0 : 1);\r\n            if (layerManager.hasSelection()) {\r\n                const selection = layerManager.getSelection()!;\r\n                offsetX *= event.keyCode <= 38 ? -1 : 1;\r\n                offsetY *= event.keyCode <= 38 ? -1 : 1;\r\n                let delta = new Vector(offsetX, offsetY);\r\n                if (!event.shiftKey || !gameStore.IS_DM) {\r\n                    // First check for collisions.  Using the smooth wall slide collision check used on mouse move is overkill here.\r\n                    for (const sel of selection) {\r\n                        if (gameStore.selectionHelperID === sel.uuid) continue;\r\n                        delta = calculateDelta(delta, sel);\r\n                    }\r\n                }\r\n                if (delta.length() === 0) return;\r\n                for (const sel of selection) {\r\n                    if (gameStore.selectionHelperID === sel.uuid) continue;\r\n                    if (sel.movementObstruction)\r\n                        visibilityStore.deleteFromTriag({\r\n                            target: TriangulationTarget.MOVEMENT,\r\n                            shape: sel,\r\n                            standalone: false,\r\n                        });\r\n                    if (sel.visionObstruction)\r\n                        visibilityStore.deleteFromTriag({\r\n                            target: TriangulationTarget.VISION,\r\n                            shape: sel,\r\n                            standalone: false,\r\n                        });\r\n                    sel.refPoint = sel.refPoint.add(delta);\r\n                    if (sel.movementObstruction)\r\n                        visibilityStore.addToTriag({ target: TriangulationTarget.MOVEMENT, shape: sel });\r\n                    if (sel.visionObstruction)\r\n                        visibilityStore.addToTriag({ target: TriangulationTarget.VISION, shape: sel });\r\n                    // todo: Fix again\r\n                    // if (sel.refPoint.x % gridSize !== 0 || sel.refPoint.y % gridSize !== 0) sel.snapToGrid();\r\n                    socket.emit(\"Shape.Position.Update\", { shape: sel.asDict(), redraw: true, temporary: false });\r\n                }\r\n                layerManager.getLayer()!.invalidate(false);\r\n            } else {\r\n                // The pan offsets should be in the opposite direction to give the correct feel.\r\n                gameStore.increasePanX(offsetX * (event.keyCode <= 38 ? 1 : -1));\r\n                gameStore.increasePanY(offsetY * (event.keyCode <= 38 ? 1 : -1));\r\n                layerManager.invalidate();\r\n                sendClientOptions(gameStore.locationOptions);\r\n            }\r\n        } else if (event.keyCode === 68) {\r\n            const layer = layerManager.getLayer();\r\n            if (layer) {\r\n                layer.clearSelection();\r\n                layer.invalidate(true);\r\n            }\r\n        } else if (event.key === \"u\" && event.ctrlKey) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            gameStore.toggleUI();\r\n        } else if (event.key === \"c\" && event.ctrlKey) {\r\n            const layer = layerManager.getLayer();\r\n            if (!layer) return;\r\n            if (!layer.selection) return;\r\n            const clipboard = [];\r\n            for (const shape of layer.selection) {\r\n                if (gameStore.selectionHelperID === shape.uuid) continue;\r\n                clipboard.push(shape.asDict());\r\n            }\r\n            gameStore.setClipboard(clipboard);\r\n        } else if (event.key === \"v\" && event.ctrlKey) {\r\n            const layer = layerManager.getLayer();\r\n            if (!layer) return;\r\n            if (!gameStore.clipboard) return;\r\n            layer.selection = [];\r\n            for (const clip of gameStore.clipboard) {\r\n                clip.x += 10;\r\n                clip.y += 10;\r\n                clip.uuid = uuidv4();\r\n                const oldTrackers = clip.trackers;\r\n                clip.trackers = [];\r\n                for (const tracker of oldTrackers) {\r\n                    const newTracker: Tracker = {\r\n                        ...tracker,\r\n                        uuid: uuidv4(),\r\n                    };\r\n                    clip.trackers.push(newTracker);\r\n                }\r\n                const oldAuras = clip.auras;\r\n                clip.auras = [];\r\n                for (const aura of oldAuras) {\r\n                    const newAura: ServerAura = {\r\n                        ...aura,\r\n                        uuid: uuidv4(),\r\n                    };\r\n                    clip.auras.push(newAura);\r\n                }\r\n                const shape = createShapeFromDict(clip);\r\n                if (shape === undefined) continue;\r\n                layer.addShape(shape, true);\r\n                layer.selection.push(shape);\r\n            }\r\n            if (layer.selection.length === 1) EventBus.$emit(\"SelectionInfo.Shape.Set\", layer.selection[0]);\r\n            else EventBus.$emit(\"SelectionInfo.Shape.Set\", null);\r\n            layer.invalidate(false);\r\n        }\r\n    }\r\n}\r\n","import { gameStore } from \"@/game/store\";\r\nimport { l2g } from \"@/game/units\";\r\nimport { getMouse } from \"@/game/utils\";\r\n\r\nexport function scrollZoom(e: WheelEvent): void {\r\n    if (!e.target || !(<HTMLElement>e.target).tagName || (<HTMLElement>e.target).tagName !== \"CANVAS\") return;\r\n    let delta: number;\r\n    delta = Math.sign(e.deltaY) * -1;\r\n    gameStore.updateZoom({ newZoomDisplay: gameStore.zoomDisplay - 0.1 * delta, zoomLocation: l2g(getMouse(e)) });\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Modal',{attrs:{\"visible\":_vm.visible,\"colour\":'rgba(255, 255, 255, 0.8)',\"mask\":false},on:{\"close\":function($event){_vm.visible = false}},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_c('div',[_vm._v(\"DM Settings\")]),_c('div',{staticClass:\"header-close\",on:{\"click\":function($event){_vm.visible = false}}},[_c('i',{staticClass:\"far fa-window-close\"})])])}}])},[_c('div',{staticClass:\"modal-body\",on:{\"click\":_vm.handleClick}},[_c('div',{attrs:{\"id\":\"categories\"}},_vm._l((_vm.categories),function(category,c){return _c('div',{key:category,staticClass:\"category\",class:{ selected: _vm.selection === c },on:{\"click\":function($event){_vm.selection = c}}},[_vm._v(\"\\n                \"+_vm._s(category)+\"\\n            \")])}),0),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.selection === 0),expression:\"selection === 0\"}],staticClass:\"panel\"},[_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Players\")]),_vm._l((_vm.$store.state.game.players),function(player){return _c('div',{key:player.id,staticClass:\"row smallrow\"},[_c('div',[_vm._v(_vm._s(player.name))]),_c('div',[_c('div',{on:{\"click\":function($event){return _vm.kickPlayer(player.id)}}},[_vm._v(\"Kick\")])])])}),(Object.values(_vm.$store.state.game.players).length === 0)?_c('div',{staticClass:\"row smallrow\"},[_c('div',{staticClass:\"spanrow\"},[_vm._v(\"There are no players yet, invite some using the link below!\")])]):_vm._e(),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Invitecode\")]),_c('div',{staticClass:\"row\"},[_c('div',[_vm._v(\"Invitation URL:\")]),(_vm.showRefreshState)?[_c('InputCopyElement',{attrs:{\"value\":_vm.refreshState}})]:[_c('InputCopyElement',{attrs:{\"value\":_vm.invitationUrl}})]],2),_c('div',{staticClass:\"row\",on:{\"click\":_vm.refreshInviteCode}},[_c('div'),_c('div',[_c('button',[_vm._v(\"Refresh invitation code\")])])]),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"DangerZone\")]),_c('div',{staticClass:\"row\"},[_c('div',[(_vm.locked)?[_vm._v(\"\\n                        Unlock\\n                    \")]:[_vm._v(\"\\n                        Lock\\n                    \")],_vm._v(\"\\n                    Session\\n                    \"),_c('i',[_vm._v(\"(DM access only)\")])],2),_c('div',[_c('button',{staticClass:\"danger\",on:{\"click\":_vm.toggleSessionLock}},[(_vm.locked)?[_vm._v(\"\\n                            Unlock\\n                        \")]:[_vm._v(\"\\n                            Lock\\n                        \")],_vm._v(\"\\n                        this Session\\n                    \")],2)])]),_c('div',{staticClass:\"row\"},[_c('div',[_vm._v(\"Remove Session\")]),_c('div',[_c('button',{staticClass:\"danger\",on:{\"click\":_vm.deleteSession}},[_vm._v(\"Delete this Session\")])])])],2),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.selection === 1),expression:\"selection === 1\"}],staticClass:\"panel\"},[_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"useGridInput\"}},[_vm._v(\"Use grid\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.useGrid),expression:\"useGrid\"}],attrs:{\"id\":\"useGridInput\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.useGrid)?_vm._i(_vm.useGrid,null)>-1:(_vm.useGrid)},on:{\"change\":function($event){var $$a=_vm.useGrid,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.useGrid=$$a.concat([$$v]))}else{$$i>-1&&(_vm.useGrid=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.useGrid=$$c}}}})])]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"gridSizeInput\"}},[_vm._v(\"Grid Size (in pixels):\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.gridSize),expression:\"gridSize\",modifiers:{\"number\":true}}],attrs:{\"id\":\"gridSizeInput\",\"type\":\"number\",\"min\":\"0\"},domProps:{\"value\":(_vm.gridSize)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.gridSize=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})])]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"unitSizeInput\"}},[_vm._v(\"Unit Size (in ft.):\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.unitSize),expression:\"unitSize\",modifiers:{\"number\":true}}],attrs:{\"id\":\"unitSizeInput\",\"type\":\"number\"},domProps:{\"value\":(_vm.unitSize)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.unitSize=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})])])]),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.selection === 2),expression:\"selection === 2\"}],staticClass:\"panel\"},[_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Core\")]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"fakePlayerInput\"}},[_vm._v(\"Fake player:\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.fakePlayer),expression:\"fakePlayer\"}],attrs:{\"id\":\"fakePlayerInput\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.fakePlayer)?_vm._i(_vm.fakePlayer,null)>-1:(_vm.fakePlayer)},on:{\"change\":function($event){var $$a=_vm.fakePlayer,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.fakePlayer=$$a.concat([$$v]))}else{$$i>-1&&(_vm.fakePlayer=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.fakePlayer=$$c}}}})])]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"useFOWInput\"}},[_vm._v(\"Fill entire canvas with FOW:\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.fullFOW),expression:\"fullFOW\"}],attrs:{\"id\":\"useFOWInput\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.fullFOW)?_vm._i(_vm.fullFOW,null)>-1:(_vm.fullFOW)},on:{\"change\":function($event){var $$a=_vm.fullFOW,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.fullFOW=$$a.concat([$$v]))}else{$$i>-1&&(_vm.fullFOW=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.fullFOW=$$c}}}})])]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"fowLOS\"}},[_vm._v(\"Only show lights in LoS:\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.fowLOS),expression:\"fowLOS\"}],attrs:{\"id\":\"fowLOS\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.fowLOS)?_vm._i(_vm.fowLOS,null)>-1:(_vm.fowLOS)},on:{\"change\":function($event){var $$a=_vm.fowLOS,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.fowLOS=$$a.concat([$$v]))}else{$$i>-1&&(_vm.fowLOS=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.fowLOS=$$c}}}})])]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"fowOpacity\"}},[_vm._v(\"FOW opacity:\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.fowOpacity),expression:\"fowOpacity\",modifiers:{\"number\":true}}],attrs:{\"id\":\"fowOpacity\",\"type\":\"number\",\"min\":\"0\",\"max\":\"1\",\"step\":\"0.1\"},domProps:{\"value\":(_vm.fowOpacity)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.fowOpacity=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})])]),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Advanced\")]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"visionMode\"}},[_vm._v(\"Vision Mode:\")]),_c('div',[_c('select',{attrs:{\"id\":\"visionMode\"},on:{\"change\":_vm.changeVisionMode}},[_c('option',{domProps:{\"selected\":_vm.$store.state.visibility.visionMode === 'bvh'}},[_vm._v(\"BVH\")]),_c('option',{domProps:{\"selected\":_vm.$store.state.visibility.visionMode === 'triangle'}},[_vm._v(\"Triangle\")])])])]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"vmininp\"}},[_vm._v(\"Minimal full vision (ft):\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.lazy.number\",value:(_vm.visionRangeMin),expression:\"visionRangeMin\",modifiers:{\"lazy\":true,\"number\":true}}],attrs:{\"id\":\"vmininp\",\"type\":\"number\",\"min\":\"0\"},domProps:{\"value\":(_vm.visionRangeMin)},on:{\"change\":function($event){_vm.visionRangeMin=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})])]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"vmaxinp\"}},[_vm._v(\"Maximal vision (ft):\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.lazy.number\",value:(_vm.visionRangeMax),expression:\"visionRangeMax\",modifiers:{\"lazy\":true,\"number\":true}}],attrs:{\"id\":\"vmaxinp\",\"type\":\"number\",\"min\":\"0\"},domProps:{\"value\":(_vm.visionRangeMax)},on:{\"change\":function($event){_vm.visionRangeMax=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})])])])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"input-copy\"},on:{\"mouseleave\":function($event){_vm.showPopup = false}}},[_c('input',{attrs:{\"type\":\"text\",\"disabled\":\"disabled\",\"id\":\"input-element\"},domProps:{\"value\":_vm.value}}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showPopup),expression:\"showPopup\"}],attrs:{\"id\":\"show-popup\"}},[_vm._v(_vm._s(_vm.popupString))]),_c('div',{attrs:{\"id\":\"copy-button\"},on:{\"click\":_vm.copy}},[_c('i',{staticClass:\"far fa-copy\"})])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { Prop } from \"vue-property-decorator\";\r\n\r\n@Component\r\nexport default class InputCopyElement extends Vue {\r\n    @Prop() value!: string;\r\n\r\n    borderColour = \"lightgray\";\r\n    popupString = \"\";\r\n    showPopup = false;\r\n\r\n    copy() {\r\n        (<any>navigator).clipboard.writeText(this.value).then(\r\n            () => {\r\n                this.popupString = \"Copied!\";\r\n                this.showPopup = true;\r\n            },\r\n            () => {\r\n                console.log(\"Could not copy to clipboard :(\");\r\n                this.popupString = \"Error!\";\r\n                this.showPopup = true;\r\n            },\r\n        );\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./inputCopy.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./inputCopy.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./inputCopy.vue?vue&type=template&id=628dde30&scoped=true&\"\nimport script from \"./inputCopy.vue?vue&type=script&lang=ts&\"\nexport * from \"./inputCopy.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./inputCopy.vue?vue&type=style&index=0&id=628dde30&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"628dde30\",\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { mapState } from \"vuex\";\r\n\r\nimport InputCopyElement from \"@/core/components/inputCopy.vue\";\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { layerManager } from \"../layers/manager\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\nimport Game from \"../game.vue\";\r\n\r\n@Component({\r\n    components: {\r\n        InputCopyElement,\r\n        Modal,\r\n    },\r\n    computed: {\r\n        ...mapState(\"game\", [\"invitationCode\"]),\r\n    },\r\n})\r\nexport default class DmSettings extends Vue {\r\n    visible = false;\r\n    categories = [\"Admin\", \"Grid\", \"Vision\"];\r\n    selection = 0;\r\n\r\n    showRefreshState = false;\r\n    refreshState = \"pending\";\r\n\r\n    mounted() {\r\n        EventBus.$on(\"DmSettings.Open\", () => {\r\n            this.visible = true;\r\n        });\r\n        EventBus.$on(\"DmSettings.RefreshedInviteCode\", () => {\r\n            this.showRefreshState = false;\r\n        });\r\n    }\r\n\r\n    beforeDestroy() {\r\n        EventBus.$off(\"DmSettings.Open\");\r\n        EventBus.$off(\"DmSettings.RefreshedInviteCode\");\r\n    }\r\n\r\n    // Admin\r\n    get invitationUrl(): string {\r\n        return window.location.protocol + \"//\" + window.location.host + \"/invite/\" + gameStore.invitationCode;\r\n    }\r\n    get locked(): boolean {\r\n        return gameStore.isLocked;\r\n    }\r\n    // Grid\r\n    get useGrid(): boolean {\r\n        return gameStore.useGrid;\r\n    }\r\n    set useGrid(value: boolean) {\r\n        gameStore.setUseGrid({ useGrid: value, sync: true });\r\n    }\r\n    get unitSize(): number {\r\n        return gameStore.unitSize;\r\n    }\r\n    set unitSize(value: number) {\r\n        if (typeof value !== \"number\") return;\r\n        gameStore.setUnitSize({ unitSize: value, sync: true });\r\n    }\r\n    get gridSize(): number {\r\n        return gameStore.gridSize;\r\n    }\r\n    set gridSize(value: number) {\r\n        if (typeof value !== \"number\") return;\r\n        gameStore.setGridSize({ gridSize: value, sync: true });\r\n    }\r\n    // Vision\r\n    get fakePlayer(): boolean {\r\n        return gameStore.FAKE_PLAYER;\r\n    }\r\n    set fakePlayer(value: boolean) {\r\n        gameStore.setFakePlayer(value);\r\n    }\r\n    get fullFOW(): boolean {\r\n        return gameStore.fullFOW;\r\n    }\r\n    set fullFOW(value: boolean) {\r\n        gameStore.setFullFOW({ fullFOW: value, sync: true });\r\n    }\r\n    get fowOpacity(): number {\r\n        return gameStore.fowOpacity;\r\n    }\r\n    set fowOpacity(value: number) {\r\n        if (typeof value !== \"number\") return;\r\n        gameStore.setFOWOpacity({ fowOpacity: value, sync: true });\r\n    }\r\n    get fowLOS(): boolean {\r\n        return gameStore.fowLOS;\r\n    }\r\n    set fowLOS(value: boolean) {\r\n        gameStore.setLineOfSight({ fowLOS: value, sync: true });\r\n    }\r\n    get visionRangeMin(): number {\r\n        return gameStore.visionRangeMin;\r\n    }\r\n    set visionRangeMin(value: number) {\r\n        if (typeof value !== \"number\") return;\r\n        gameStore.setVisionRangeMin({ value, sync: true });\r\n    }\r\n    get visionRangeMax(): number {\r\n        return gameStore.visionRangeMax;\r\n    }\r\n    set visionRangeMax(value: number) {\r\n        if (typeof value !== \"number\") return;\r\n        gameStore.setVisionRangeMax({ value, sync: true });\r\n    }\r\n    changeVisionMode(event: { target: HTMLSelectElement }) {\r\n        const value = event.target.value.toLowerCase();\r\n        if (value !== \"bvh\" && value !== \"triangle\") return;\r\n        visibilityStore.setVisionMode({ mode: value, sync: true });\r\n        visibilityStore.recalculateVision();\r\n        visibilityStore.recalculateMovement();\r\n        layerManager.invalidate();\r\n    }\r\n    handleClick(event: { target: HTMLElement }) {\r\n        const child = event.target.firstElementChild;\r\n        if (child instanceof HTMLInputElement) {\r\n            child.click();\r\n        }\r\n    }\r\n    refreshInviteCode() {\r\n        socket.emit(\"Room.Info.InviteCode.Refresh\");\r\n        this.refreshState = \"pending\";\r\n        this.showRefreshState = true;\r\n    }\r\n    kickPlayer(id: number) {\r\n        socket.emit(\"Room.Info.Players.Kick\", id);\r\n        gameStore.kickPlayer(id);\r\n    }\r\n    toggleSessionLock() {\r\n        gameStore.setIsLocked({ isLocked: !gameStore.isLocked, sync: true });\r\n    }\r\n    deleteSession() {\r\n        (<Game>this.$parent.$parent).$refs.prompt\r\n            .prompt(\r\n                `ENTER ${gameStore.roomCreator}/${gameStore.roomName} TO CONFIRM SESSION REMOVAL.`,\r\n                `DELETING SESSION`,\r\n            )\r\n            .then(\r\n                (value: string) => {\r\n                    if (value !== `${gameStore.roomCreator}/${gameStore.roomName}`) return;\r\n                    socket.emit(\"Room.Delete\");\r\n                    this.$router.push(\"/\");\r\n                },\r\n                () => {},\r\n            );\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dmsettings.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dmsettings.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./dmsettings.vue?vue&type=template&id=261cc18f&scoped=true&\"\nimport script from \"./dmsettings.vue?vue&type=script&lang=ts&\"\nexport * from \"./dmsettings.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./dmsettings.vue?vue&type=style&index=0&id=261cc18f&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"261cc18f\",\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport throttle from \"lodash/throttle\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport vueSlider from \"vue-slider-component\";\r\nimport \"vue-slider-component/theme/default.css\";\r\n\r\nimport \"@/game/api/events\";\r\n\r\nimport ConfirmDialog from \"@/core/components/modals/confirm.vue\";\r\nimport Prompt from \"@/core/components/modals/prompt.vue\";\r\nimport Initiative from \"@/game/ui/initiative/initiative.vue\";\r\nimport LabelManager from \"@/game/ui/labels.vue\";\r\nimport MenuBar from \"@/game/ui/menu/menu.vue\";\r\nimport NoteDialog from \"@/game/ui/note.vue\";\r\nimport SelectionInfo from \"@/game/ui/selection/selection_info.vue\";\r\nimport Tools from \"@/game/ui/tools/tools.vue\";\r\n\r\nimport { createConnection, socket } from \"@/game/api/socket\";\r\nimport { onKeyDown, onKeyUp } from \"@/game/events/keyboard\";\r\nimport { scrollZoom } from \"@/game/events/mouse\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { l2g } from \"@/game/units\";\r\nimport { LocalPoint } from \"./geom\";\r\nimport DmSettings from \"./ui/dmsettings.vue\";\r\nimport { dropAsset } from \"./layers/utils\";\r\n\r\n@Component({\r\n    components: {\r\n        \"tool-bar\": Tools,\r\n        \"selection-info\": SelectionInfo,\r\n        \"prompt-dialog\": Prompt,\r\n        \"confirm-dialog\": ConfirmDialog,\r\n        \"menu-bar\": MenuBar,\r\n        \"initiative-dialog\": Initiative,\r\n        \"zoom-slider\": vueSlider,\r\n        \"note-dialog\": NoteDialog,\r\n        \"label-dialog\": LabelManager,\r\n        \"dm-settings\": DmSettings,\r\n    },\r\n    beforeRouteEnter(to, from, next) {\r\n        createConnection(to);\r\n        next();\r\n    },\r\n    beforeRouteLeave(to, from, next) {\r\n        socket.disconnect();\r\n        next();\r\n    },\r\n})\r\nexport default class Game extends Vue {\r\n    $refs!: {\r\n        confirm: InstanceType<typeof ConfirmDialog>;\r\n        note: InstanceType<typeof NoteDialog>;\r\n        tools: InstanceType<typeof Tools>;\r\n        prompt: InstanceType<typeof Prompt>;\r\n    };\r\n\r\n    ready = {\r\n        manager: false,\r\n        tools: false,\r\n    };\r\n\r\n    get showUI(): boolean {\r\n        return gameStore.showUI;\r\n    }\r\n\r\n    get IS_DM(): boolean {\r\n        return gameStore.IS_DM;\r\n    }\r\n\r\n    get FAKE_PLAYER(): boolean {\r\n        return gameStore.FAKE_PLAYER;\r\n    }\r\n\r\n    get layers(): string[] {\r\n        return gameStore.layers;\r\n    }\r\n\r\n    get selectedLayer(): string {\r\n        return gameStore.selectedLayer;\r\n    }\r\n\r\n    get zoomDisplay(): number {\r\n        return gameStore.zoomDisplay;\r\n    }\r\n\r\n    set zoomDisplay(value: number) {\r\n        gameStore.updateZoom({\r\n            newZoomDisplay: value,\r\n            zoomLocation: l2g(new LocalPoint(window.innerWidth / 2, window.innerHeight / 2)),\r\n        });\r\n    }\r\n\r\n    mounted() {\r\n        window.addEventListener(\"resize\", this.resizeWindow);\r\n        window.addEventListener(\"keyup\", onKeyUp);\r\n        window.addEventListener(\"keydown\", onKeyDown);\r\n        this.ready.manager = true;\r\n    }\r\n\r\n    destroyed() {\r\n        window.removeEventListener(\"resize\", this.resizeWindow);\r\n        window.removeEventListener(\"keyup\", onKeyUp);\r\n        window.removeEventListener(\"keydown\", onKeyDown);\r\n        this.ready.manager = false;\r\n    }\r\n\r\n    // Window events\r\n\r\n    zoom(event: WheelEvent) {\r\n        throttle(scrollZoom)(event);\r\n    }\r\n\r\n    resizeWindow() {\r\n        layerManager.setWidth(window.innerWidth);\r\n        layerManager.setHeight(window.innerHeight);\r\n        layerManager.invalidate();\r\n    }\r\n\r\n    // Mouse events\r\n\r\n    mousedown(event: MouseEvent) {\r\n        this.$refs.tools.mousedown(event);\r\n    }\r\n    mouseup(event: MouseEvent) {\r\n        this.$refs.tools.mouseup(event);\r\n    }\r\n    mousemove(event: MouseEvent) {\r\n        this.$refs.tools.mousemove(event);\r\n    }\r\n    mouseleave(event: MouseEvent) {\r\n        this.$refs.tools.mouseleave(event);\r\n    }\r\n    contextmenu(event: MouseEvent) {\r\n        this.$refs.tools.contextmenu(event);\r\n    }\r\n    selectLayer(layer: string) {\r\n        layerManager.selectLayer(layer);\r\n    }\r\n    drop(event: DragEvent) {\r\n        if (event === null || event.dataTransfer === null) return;\r\n        if (event.dataTransfer.files.length > 0) {\r\n            this.$refs.confirm\r\n                .open(\"Uploading files should be done through the asset manager.\", \"Ok\", \"\")\r\n                .then(() => {}, () => {});\r\n        } else if (event.dataTransfer.getData(\"text/plain\") === \"\") {\r\n            return;\r\n        } else {\r\n            dropAsset(event);\r\n        }\r\n    }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./game.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./game.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./game.vue?vue&type=template&id=5bd5872f&scoped=true&\"\nimport script from \"./game.vue?vue&type=script&lang=ts&\"\nexport * from \"./game.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./game.vue?vue&type=style&index=0&lang=css&\"\nimport style1 from \"./game.vue?vue&type=style&index=1&id=5bd5872f&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5bd5872f\",\n  null\n  \n)\n\nexport default component.exports","import Axios, { AxiosError, AxiosResponse } from \"axios\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport { Route } from \"vue-router\";\r\n\r\n@Component({ template: \"\" })\r\nexport default class Initiative extends Vue {\r\n    beforeRouteEnter(to: Route, from: Route, next: (nextInfo: { path: string }) => {}): void {\r\n        Axios.post(\"/api/invite\", {\r\n            code: to.params.code,\r\n        })\r\n            .then((response: AxiosResponse) => {\r\n                next({ path: response.data.sessionUrl });\r\n            })\r\n            .catch((_error: AxiosError) => {\r\n                console.error(\"Invitation code could not be redeemed\");\r\n                next({ path: \"/dashboard\" });\r\n            });\r\n    }\r\n}\r\n","// import \"./class-component-hooks\";\r\n\r\nimport axios, { AxiosResponse } from \"axios\";\r\nimport Vue from \"vue\";\r\nimport Router from \"vue-router\";\r\n\r\nVue.use(Router);\r\n\r\nimport AssetManager from \"@/assetManager/manager.vue\";\r\nimport Login from \"@/auth/login.vue\";\r\nimport Logout from \"@/auth/logout\";\r\nimport LoadComponent from \"@/core/components/load.vue\";\r\nimport Dashboard from \"@/dashboard/main.vue\";\r\nimport Game from \"@/game/game.vue\";\r\nimport Invitation from \"@/invitation/invitation\";\r\n\r\nimport { coreStore } from \"@/core/store\";\r\n// import { AssetManager } from \"./assetManager/assets\";\r\n// const AssetManager = () => import(\"./assetManager/assets\").then(m => m.AssetManager);\r\n\r\nexport const router = new Router({\r\n    mode: \"history\",\r\n    base: process.env.BASE_URL,\r\n    routes: [\r\n        {\r\n            path: \"/\",\r\n            redirect: \"/dashboard\",\r\n        },\r\n        {\r\n            path: \"/_load\",\r\n            name: \"load\",\r\n            component: LoadComponent,\r\n        },\r\n        {\r\n            path: \"/assets\",\r\n            component: AssetManager,\r\n            meta: {\r\n                auth: true,\r\n            },\r\n        },\r\n        {\r\n            path: \"/auth\",\r\n            component: { template: \"<router-view></router-view>\" },\r\n            children: [{ path: \"login\", component: Login }, { path: \"logout\", component: Logout }],\r\n        },\r\n        {\r\n            path: \"/invite/:code\",\r\n            component: Invitation,\r\n            meta: {\r\n                auth: true,\r\n            },\r\n        },\r\n        {\r\n            path: \"/dashboard\",\r\n            component: Dashboard,\r\n            meta: {\r\n                auth: true,\r\n            },\r\n        },\r\n        {\r\n            path: \"/game/:creator/:room\",\r\n            component: Game,\r\n            meta: {\r\n                auth: true,\r\n            },\r\n        },\r\n    ],\r\n});\r\n\r\nrouter.beforeEach((to, from, next) => {\r\n    if (!coreStore.initialized && to.path !== \"/_load\") {\r\n        next({ path: \"/_load\" });\r\n        axios\r\n            .get(\"/api/auth\")\r\n            .then((response: AxiosResponse) => {\r\n                if (response.data.auth) {\r\n                    coreStore.setAuthenticated(true);\r\n                    coreStore.setUsername(response.data.username);\r\n                }\r\n                coreStore.setInitialized(true);\r\n                router.push(to.path);\r\n            })\r\n            .catch(() => {\r\n                console.error(\"Authentication check could not be fulfilled.\");\r\n            });\r\n    } else if (to.matched.some(record => record.meta.auth) && !coreStore.authenticated) {\r\n        next({ path: \"/auth/login\", query: { redirect: to.path } });\r\n    } else {\r\n        next();\r\n    }\r\n});\r\n","import Vue from \"vue\";\r\n\r\nimport App from \"@/App.vue\";\r\nimport { router } from \"@/router\";\r\nimport { rootStore } from \"@/store\";\r\n\r\nVue.config.productionTip = false;\r\nVue.config.devtools = true;\r\nVue.config.performance = true;\r\n\r\nexport const app = new Vue({\r\n    router,\r\n    store: rootStore,\r\n    render: h => h(App),\r\n}).$mount(\"#app\");\r\n\r\n(<any>window).app = app;\r\n","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./game.vue?vue&type=style&index=1&id=5bd5872f&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./game.vue?vue&type=style&index=1&id=5bd5872f&scoped=true&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./main.vue?vue&type=style&index=0&id=f34c77ee&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./main.vue?vue&type=style&index=0&id=f34c77ee&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./filter.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./filter.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./inputCopy.vue?vue&type=style&index=0&id=628dde30&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./inputCopy.vue?vue&type=style&index=0&id=628dde30&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./confirm.vue?vue&type=style&index=0&id=46dc898b&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./confirm.vue?vue&type=style&index=0&id=46dc898b&scoped=true&lang=css&\""],"sourceRoot":""}